(self.webpackChunkfilmdex_client=self.webpackChunkfilmdex_client||[]).push([[266],{5266:(Ee,ne,h)=>{"use strict";h.r(ne),h.d(ne,{AdminModule:()=>zi});var g=h(1841),_=h(4466),P=h(5855),m=h(8239),N=h(2340),a=h(639);let v=(()=>{class o{constructor(e,n){this.httpClient=e,this.router=n,this.isLogined=!1}canActivate(e,n){var r=this;return(0,m.Z)(function*(){return!!r.isLogined||(yield r.reLogin())})()}login(e,n){var r=this;return(0,m.Z)(function*(){try{const i={userName:e,password:n},{accessToken:s}=yield r.httpClient.post(`${N.N.apiUrl}/auth/login`,{userName:e,password:n}).toPromise();window.localStorage.setItem("auth",JSON.stringify(i)),window.localStorage.setItem("accessToken",s),r.isLogined=!0}catch(i){throw console.error("Auth Guard : Login",i),i}})()}reLogin(){var e=this;return(0,m.Z)(function*(){try{const n=window.localStorage.getItem("auth");if(!n)throw new Error("LocalStorage Is Empty, Cannot Re Login");const r=JSON.parse(n);return yield e.login(r.userName,r.password),!0}catch(n){return console.warn("Auth Guard : Re Login : Failed, Redirect To Login Page",n),e.logout(!0),!1}})()}logout(e=!1){window.localStorage.removeItem("auth"),window.localStorage.removeItem("accessToken"),this.isLogined=!1,e&&this.router.navigate(["/admin/login"])}}return o.\u0275fac=function(e){return new(e||o)(a.LFG(g.eN),a.LFG(P.F0))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var B=h(665),G=h(8583);function J(o,t){if(1&o&&(a.TgZ(0,"p",5),a._uU(1),a.qZA()),2&o){const e=a.oxw();a.xp6(1),a.Oqu(e.errorMessage)}}let U=(()=>{class o{constructor(e,n,r){this.formBuilder=e,this.router=n,this.authGuard=r,this.errorMessage=""}ngOnInit(){this.loginForm=this.formBuilder.group({userName:["",[B.kI.required]],password:["",[B.kI.required]]}),this.authGuard.logout()}onLogin(){var e=this;return(0,m.Z)(function*(){e.errorMessage="";try{yield e.authGuard.login(e.loginForm.value.userName,e.loginForm.value.password),e.router.navigate(["/admin/films"])}catch(n){console.error("Login Component : On Login",n),e.errorMessage="Failed To Login"}})()}}return o.\u0275fac=function(e){return new(e||o)(a.Y36(B.qu),a.Y36(P.F0),a.Y36(v))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-login"]],decls:18,vars:3,consts:[[3,"formGroup","ngSubmit"],["type","text","formControlName","userName"],["type","password","formControlName","password"],["type","submit",3,"disabled"],["class","text-danger",4,"ngIf"],[1,"text-danger"]],template:function(e,n){1&e&&(a.TgZ(0,"h2"),a._uU(1,"Login"),a.qZA(),a.TgZ(2,"form",0),a.NdJ("ngSubmit",function(){return n.onLogin()}),a.TgZ(3,"dl"),a.TgZ(4,"dt"),a._uU(5,"User Name"),a.qZA(),a.TgZ(6,"dd"),a.TgZ(7,"p"),a._UZ(8,"input",1),a.qZA(),a.qZA(),a.TgZ(9,"dt"),a._uU(10,"Password"),a.qZA(),a.TgZ(11,"dd"),a.TgZ(12,"p"),a._UZ(13,"input",2),a.qZA(),a.qZA(),a.qZA(),a.TgZ(14,"p"),a.TgZ(15,"button",3),a._uU(16,"Login"),a.qZA(),a.qZA(),a.qZA(),a.YNc(17,J,2,1,"p",4)),2&e&&(a.xp6(2),a.Q6J("formGroup",n.loginForm),a.xp6(13),a.Q6J("disabled",n.loginForm.invalid),a.xp6(2),a.Q6J("ngIf",n.errorMessage))},directives:[B._Y,B.JL,B.sg,B.Fj,B.JJ,B.u,G.O5],styles:[""]}),o})();var c=h(5081),ie=(h(8482),function(){function o(){}return o.getInheritanceTree=function(t){var e=[t],n=function(r){var i=Object.getPrototypeOf(r);i&&i.name&&(e.push(i),n(i))};return n(t),e},o.isInherited=function(t,e){return t.prototype instanceof e},o.filterByTarget=function(t,e){return e?t.filter(function(n){return n.target&&-1!==e.indexOf(n.target)}):t},o}()),D=function(){function o(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return o.prototype.filterTables=function(t){return this.filterByTarget(this.tables,t)},o.prototype.filterColumns=function(t){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,t)},o.prototype.findGenerated=function(t,e){return this.generations.find(function(n){return(Array.isArray(t)?-1!==t.indexOf(n.target):n.target===t)&&n.propertyName===e})},o.prototype.findTree=function(t){return this.trees.find(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},o.prototype.filterRelations=function(t){return this.filterByTargetAndWithoutDuplicateRelationProperties(this.relations,t)},o.prototype.filterRelationIds=function(t){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,t)},o.prototype.filterRelationCounts=function(t){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,t)},o.prototype.filterIndices=function(t){return this.indices.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},o.prototype.filterUniques=function(t){return this.uniques.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},o.prototype.filterChecks=function(t){return this.checks.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},o.prototype.filterExclusions=function(t){return this.exclusions.filter(function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t})},o.prototype.filterListeners=function(t){return this.filterByTarget(this.entityListeners,t)},o.prototype.filterEmbeddeds=function(t){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,t)},o.prototype.findJoinTable=function(t,e){return this.joinTables.find(function(n){return n.target===t&&n.propertyName===e})},o.prototype.filterJoinColumns=function(t,e){return this.joinColumns.filter(function(n){return n.target===t&&n.propertyName===e})},o.prototype.filterSubscribers=function(t){return this.filterByTarget(this.entitySubscribers,t)},o.prototype.filterNamingStrategies=function(t){return this.filterByTarget(this.namingStrategies,t)},o.prototype.filterTransactionEntityManagers=function(t,e){return this.transactionEntityManagers.filter(function(n){return(Array.isArray(t)?-1!==t.indexOf(n.target):n.target===t)&&n.methodName===e})},o.prototype.filterTransactionRepository=function(t,e){return this.transactionRepositories.filter(function(n){return(Array.isArray(t)?-1!==t.indexOf(n.target):n.target===t)&&n.methodName===e})},o.prototype.filterSingleTableChildren=function(t){return this.tables.filter(function(e){return e.target instanceof Function&&t instanceof Function&&ie.isInherited(e.target,t)&&"entity-child"===e.type})},o.prototype.findInheritanceType=function(t){return this.inheritances.find(function(e){return e.target===t})},o.prototype.findDiscriminatorValue=function(t){return this.discriminatorValues.find(function(e){return e.target===t})},o.prototype.filterByTarget=function(t,e){return t.filter(function(n){return Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e})},o.prototype.filterByTargetAndWithoutDuplicateProperties=function(t,e){var n=[];return t.forEach(function(r){(Array.isArray(e)?-1!==e.indexOf(r.target):r.target===e)&&(n.find(function(s){return s.propertyName===r.propertyName})||n.push(r))}),n},o.prototype.filterByTargetAndWithoutDuplicateRelationProperties=function(t,e){var n=[];return t.forEach(function(r){if(e instanceof Array?-1!==e.indexOf(r.target):r.target===e){var s=n.findIndex(function(l){return l.propertyName===r.propertyName});if(e instanceof Array&&-1!==s&&e.indexOf(r.target)<e.indexOf(n[s].target)){var u=Object.create(n[s]);u.type=r.type,n[s]=u}else-1===s&&n.push(r)}}),n},o.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(t,e){var n=[];return t.forEach(function(r){(Array.isArray(e)?-1!==e.indexOf(r.target):r.target===e)&&(n.find(function(u){return u.prefix===r.prefix&&u.propertyName===r.propertyName})||n.push(r))}),n},o}(),A=function(){function o(){}return o.getGlobalVariable=function(){return"undefined"!=typeof window?window:global},o.load=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+t+'").');return""},o.pathNormalize=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+t+'").');return""},o.pathExtname=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+t+'").');return""},o.pathResolve=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+t+'").');return""},o.fileExist=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+t+'").');return!1},o.dotenv=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: dotenv.config({ path: "'+t+'" }).')},o.getEnvVariable=function(t){},o.readFileSync=function(t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+t+'").');return null},o.appendFileSync=function(t,e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+t+'").')},o.writeFile=function(t,e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+t+'").');return Promise.reject(null)},o.highlightSql=function(t){return t},o.highlightJson=function(t){return t},o.logInfo=function(t,e){console.info(t+" ",e)},o.logError=function(t,e){console.error(t+" ",e)},o.logWarn=function(t,e){console.warn(t+" ",e)},o.log=function(t){console.log(t)},o.warn=function(t){return t},o.type="browser",o}();"undefined"!=typeof window&&(window.Buffer=h(8988).Buffer),"undefined"!=typeof global&&(global.Buffer=h(8988).Buffer),function(){function o(){}o.prototype.all=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){throw new Error("Cannot read connection options in a browser context.")})})},o.prototype.get=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){throw new Error("Cannot read connection options in a browser context.")})})},o.prototype.has=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){throw new Error("Cannot read connection options in a browser context.")})})}}();var j=h(2221),$=h(3252),ee=h(2588),F=function(){function o(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}return o.prototype.getTableName=function(t){return t instanceof ee.i&&(t=t.name),t.split(".").pop()},o.prototype.tableName=function(t,e){return e||(0,$.fu)(t)},o.prototype.closureJunctionTableName=function(t){return t+"_closure"},o.prototype.columnName=function(t,e,n){var r=e||t;return n.length?(0,$.eV)(n.join("_"))+(0,$.Qs)(r):r},o.prototype.relationName=function(t){return t},o.prototype.primaryKeyName=function(t,e){var n=(0,c.ev)([],(0,c.CR)(e));n.sort();var s=this.getTableName(t).replace(".","_")+"_"+n.join("_");return"PK_"+j.f.sha1(s).substr(0,27)},o.prototype.uniqueConstraintName=function(t,e){var n=(0,c.ev)([],(0,c.CR)(e));n.sort();var s=this.getTableName(t).replace(".","_")+"_"+n.join("_");return"UQ_"+j.f.sha1(s).substr(0,27)},o.prototype.relationConstraintName=function(t,e,n){var r=(0,c.ev)([],(0,c.CR)(e));r.sort();var u=this.getTableName(t).replace(".","_")+"_"+r.join("_");return n&&(u+="_"+n),"REL_"+j.f.sha1(u).substr(0,26)},o.prototype.defaultConstraintName=function(t,e){var r=this.getTableName(t).replace(".","_");return"DF_"+j.f.sha1(r+"_"+e).substr(0,27)},o.prototype.foreignKeyName=function(t,e,n,r){var i=(0,c.ev)([],(0,c.CR)(e));i.sort();var l=this.getTableName(t).replace(".","_")+"_"+i.join("_");return"FK_"+j.f.sha1(l).substr(0,27)},o.prototype.indexName=function(t,e,n){var r=(0,c.ev)([],(0,c.CR)(e));r.sort();var u=this.getTableName(t).replace(".","_")+"_"+r.join("_");return n&&(u+="_"+n),"IDX_"+j.f.sha1(u).substr(0,26)},o.prototype.checkConstraintName=function(t,e,n){var i=this.getTableName(t).replace(".","_"),u="CHK_"+j.f.sha1(i+"_"+e).substr(0,26);return n?u+"_ENUM":u},o.prototype.exclusionConstraintName=function(t,e){var r=this.getTableName(t).replace(".","_");return"XCL_"+j.f.sha1(r+"_"+e).substr(0,26)},o.prototype.joinColumnName=function(t,e){return(0,$.eV)(t+"_"+e)},o.prototype.joinTableName=function(t,e,n,r){return(0,$.fu)(t+"_"+n.replace(/\./gi,"_")+"_"+e)},o.prototype.joinTableColumnDuplicationPrefix=function(t,e){return t+"_"+e},o.prototype.joinTableColumnName=function(t,e,n){return(0,$.eV)(t+"_"+(n||e))},o.prototype.joinTableInverseColumnName=function(t,e,n){return this.joinTableColumnName(t,e,n)},o.prototype.prefixTableName=function(t,e){return t+e},o.prototype.eagerJoinRelationAlias=function(t,e){return t+"_"+e.replace(".","_")},o}(),I=h(4116),y=h(2925),E=h(2427),S=function(t,e,n,r){this.id=t,this.timestamp=e,this.name=n,this.instance=r},C=h(9145),Q=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=t,this.type=e,this.params=[],this.params=n||[]},O=h(4455),W=function(){function o(t,e){this.connection=t,this.queryRunner=e,this.transaction="all";var n=this.connection.driver.options.schema,r=this.connection.driver.database;this.migrationsDatabase=r,this.migrationsSchema=n,this.migrationsTableName=t.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n,r)}return o.prototype.executeMigration=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,this.withQueryRunner(function(r){return(0,c.mG)(e,void 0,void 0,function(){return(0,c.Jh)(this,function(i){switch(i.label){case 0:return[4,this.createMigrationsTableIfNotExist(r)];case 1:return i.sent(),[4,t.instance.up(r)];case 2:return i.sent(),[4,this.insertExecutedMigration(r,t)];case 3:return i.sent(),[2,t]}})})})]})})},o.prototype.getAllMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){return[2,Promise.resolve(this.getMigrations())]})})},o.prototype.getExecutedMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t=this;return(0,c.Jh)(this,function(e){return[2,this.withQueryRunner(function(n){return(0,c.mG)(t,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return r.sent(),[4,this.loadExecutedMigrations(n)];case 2:return[2,r.sent()]}})})})]})})},o.prototype.getPendingMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return t=n.sent(),[4,this.getExecutedMigrations()];case 2:return e=n.sent(),[2,t.filter(function(r){return!e.find(function(i){return i.name===r.name})})]}})})},o.prototype.insertMigration=function(t){var e=this;return new Promise(function(n,r){e.withQueryRunner(function(i){e.insertExecutedMigration(i,t).then(n).catch(r)})})},o.prototype.deleteMigration=function(t){var e=this;return new Promise(function(n,r){e.withQueryRunner(function(i){e.deleteExecutedMigration(i,t).then(n).catch(r)})})},o.prototype.showMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u,l,b,w;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return t=!1,e=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(e)];case 1:return K.sent(),[4,this.loadExecutedMigrations(e)];case 2:n=K.sent(),r=this.getMigrations(),i=function(z){n.find(function(re){return re.name===z.name})?s.connection.logger.logSchemaBuild(" [X] "+z.name):(t=!0,s.connection.logger.logSchemaBuild(" [ ] "+z.name))},s=this;try{for(u=(0,c.XA)(r),l=u.next();!l.done;l=u.next())i(l.value)}catch(z){b={error:z}}finally{try{l&&!l.done&&(w=u.return)&&w.call(u)}finally{if(b)throw b.error}}return this.queryRunner?[3,4]:[4,e.release()];case 3:K.sent(),K.label=4;case 4:return[2,t]}})})},o.prototype.executePendingMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u,l,f,b,w,z,te,fe,de,ue=this;return(0,c.Jh)(this,function(pe){switch(pe.label){case 0:return t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return pe.sent(),[4,this.loadExecutedMigrations(t)];case 2:return e=pe.sent(),n=this.getLatestTimestampMigration(e),r=this.getMigrations(),i=[],(s=r.filter(function(xe){return!e.find(function(Be){return Be.name===xe.name})})).length?[3,5]:(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner?[3,4]:[4,t.release()]);case 3:pe.sent(),pe.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(e.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(r.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(s.length+" migrations are new migrations that needs to be executed."),u=!1,"all"!==this.transaction||t.isTransactionActive?[3,7]:[4,t.startTransaction()];case 6:pe.sent(),u=!0,pe.label=7;case 7:pe.trys.push([7,18,23,26]),l=function(xe){return(0,c.Jh)(this,function(Te){switch(Te.label){case 0:return"each"!==f.transaction||t.isTransactionActive?[3,2]:[4,t.startTransaction()];case 1:Te.sent(),u=!0,Te.label=2;case 2:return[4,xe.instance.up(t).then(function(){return(0,c.mG)(ue,void 0,void 0,function(){return(0,c.Jh)(this,function(Be){switch(Be.label){case 0:return[4,this.insertExecutedMigration(t,xe)];case 1:return Be.sent(),"each"===this.transaction&&u?[4,t.commitTransaction()]:[3,3];case 2:Be.sent(),Be.label=3;case 3:return[2]}})})}).then(function(){i.push(xe),ue.connection.logger.logSchemaBuild("Migration "+xe.name+" has been executed successfully.")})];case 3:return Te.sent(),[2]}})},f=this,pe.label=8;case 8:pe.trys.push([8,13,14,15]),b=(0,c.XA)(s),w=b.next(),pe.label=9;case 9:return w.done?[3,12]:[5,l(w.value)];case 10:pe.sent(),pe.label=11;case 11:return w=b.next(),[3,9];case 12:return[3,15];case 13:return z=pe.sent(),fe={error:z},[3,15];case 14:try{w&&!w.done&&(de=b.return)&&de.call(b)}finally{if(fe)throw fe.error}return[7];case 15:return"all"===this.transaction&&u?[4,t.commitTransaction()]:[3,17];case 16:pe.sent(),pe.label=17;case 17:return[3,26];case 18:if(te=pe.sent(),!u)return[3,22];pe.label=19;case 19:return pe.trys.push([19,21,,22]),[4,t.rollbackTransaction()];case 20:case 21:return pe.sent(),[3,22];case 22:throw te;case 23:return this.queryRunner?[3,25]:[4,t.release()];case 24:pe.sent(),pe.label=25;case 25:return[7];case 26:return[2,i]}})})},o.prototype.undoLastMigration=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return t=this.queryRunner||this.connection.createQueryRunner(),[4,this.createMigrationsTableIfNotExist(t)];case 1:return f.sent(),[4,this.loadExecutedMigrations(t)];case 2:if(e=f.sent(),!(n=this.getLatestExecutedMigration(e)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(r=this.getMigrations(),!(i=r.find(function(b){return b.name===n.name})))throw new O.K_("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(e.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),s=!1,"none"===this.transaction||t.isTransactionActive?[3,4]:[4,t.startTransaction()];case 3:f.sent(),s=!0,f.label=4;case 4:return f.trys.push([4,9,14,17]),[4,i.instance.down(t)];case 5:return f.sent(),[4,this.deleteExecutedMigration(t,i)];case 6:return f.sent(),this.connection.logger.logSchemaBuild("Migration "+i.name+" has been reverted successfully."),s?[4,t.commitTransaction()]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,17];case 9:if(u=f.sent(),!s)return[3,13];f.label=10;case 10:return f.trys.push([10,12,,13]),[4,t.rollbackTransaction()];case 11:case 12:return f.sent(),[3,13];case 13:throw u;case 14:return this.queryRunner?[3,16]:[4,t.release()];case 15:f.sent(),f.label=16;case 16:return[7];case 17:return[2]}})})},o.prototype.createMigrationsTableIfNotExist=function(t){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return this.connection.driver instanceof C.Qd?[2]:[4,t.hasTable(this.migrationsTable)];case 1:return n.sent()?[3,3]:[4,t.createTable(new ee.i({database:this.migrationsDatabase,schema:this.migrationsSchema,name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:n.sent(),n.label=3;case 3:return[2]}})})},o.prototype.loadExecutedMigrations=function(t){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return this.connection.driver instanceof C.Qd?[4,t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()]:[3,2];case 1:return[2,r.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(t).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,r.sent().map(function(i){return new S(parseInt(i.id),parseInt(i.timestamp),i.name)})]}})})},o.prototype.getMigrations=function(){var t=this.connection.migrations.map(function(e){var n=e.name||e.constructor.name,r=parseInt(n.substr(-13),10);if(!r||isNaN(r))throw new O.K_(n+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new S(void 0,r,n,e)});return this.checkForDuplicateMigrations(t),t.sort(function(e,n){return e.timestamp-n.timestamp})},o.prototype.checkForDuplicateMigrations=function(t){var e=t.map(function(r){return r.name}),n=Array.from(new Set(e.filter(function(r,i){return e.indexOf(r)<i})));if(n.length>0)throw Error("Duplicate migrations: "+n.join(", "))},o.prototype.getLatestTimestampMigration=function(t){var e=t.map(function(n){return n}).sort(function(n,r){return-1*(n.timestamp-r.timestamp)});return e.length>0?e[0]:void 0},o.prototype.getLatestExecutedMigration=function(t){return t.length>0?t[0]:void 0},o.prototype.insertExecutedMigration=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return n={},this.connection.driver instanceof C.Z0?(n.timestamp=new Q(e.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new Q(e.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=e.timestamp,n.name=e.name),this.connection.driver instanceof C.Qd?[4,t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insertOne(n)]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,t.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:s.sent(),s.label=4;case 4:return[2]}})})},o.prototype.deleteExecutedMigration=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return n={},this.connection.driver instanceof C.Z0?(n.timestamp=new Q(e.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new Q(e.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=e.timestamp,n.name=e.name),this.connection.driver instanceof C.Qd?[4,t.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)]:[3,2];case 1:return s.sent(),[3,4];case 2:return[4,(i=t.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(i.escape("timestamp")+" = :timestamp").andWhere(i.escape("name")+" = :name").setParameters(n).execute()];case 3:s.sent(),s.label=4;case 4:return[2]}})})},o.prototype.withQueryRunner=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:e=this.queryRunner||this.connection.createQueryRunner(),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,t(e)];case 2:return this.queryRunner?[3,4]:[4,e.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}})})},o}(),V=h(7129),oe=h(173);function me(o,t,e){var n=[],r={};return function i(s){r[s]=!0,n.push(s),o[s].forEach(function(u){if(r[u]){if(n.indexOf(u)>=0)throw n.push(u),new O.K_("Dependency Cycle Found: "+n.join(" -> "))}else i(u)}),n.pop(),(!t||0===o[s].length)&&-1===e.indexOf(s)&&e.push(s)}}var he=function(){function o(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return o.prototype.addNode=function(t,e){this.hasNode(t)||(this.nodes[t]=2===arguments.length?e:t,this.outgoingEdges[t]=[],this.incomingEdges[t]=[])},o.prototype.removeNode=function(t){this.hasNode(t)&&(delete this.nodes[t],delete this.outgoingEdges[t],delete this.incomingEdges[t],[this.incomingEdges,this.outgoingEdges].forEach(function(e){Object.keys(e).forEach(function(n){var r=e[n].indexOf(t);r>=0&&e[n].splice(r,1)},this)}))},o.prototype.hasNode=function(t){return this.nodes.hasOwnProperty(t)},o.prototype.getNodeData=function(t){if(this.hasNode(t))return this.nodes[t];throw new O.K_("Node does not exist: "+t)},o.prototype.setNodeData=function(t,e){if(!this.hasNode(t))throw new O.K_("Node does not exist: "+t);this.nodes[t]=e},o.prototype.addDependency=function(t,e){if(!this.hasNode(t))throw new O.K_("Node does not exist: "+t);if(!this.hasNode(e))throw new O.K_("Node does not exist: "+e);return-1===this.outgoingEdges[t].indexOf(e)&&this.outgoingEdges[t].push(e),-1===this.incomingEdges[e].indexOf(t)&&this.incomingEdges[e].push(t),!0},o.prototype.removeDependency=function(t,e){var n;this.hasNode(t)&&(n=this.outgoingEdges[t].indexOf(e))>=0&&this.outgoingEdges[t].splice(n,1),this.hasNode(e)&&(n=this.incomingEdges[e].indexOf(t))>=0&&this.incomingEdges[e].splice(n,1)},o.prototype.dependenciesOf=function(t,e){if(this.hasNode(t)){var n=[];me(this.outgoingEdges,e,n)(t);var i=n.indexOf(t);return i>=0&&n.splice(i,1),n}throw new O.K_("Node does not exist: "+t)},o.prototype.dependantsOf=function(t,e){if(this.hasNode(t)){var n=[];me(this.incomingEdges,e,n)(t);var i=n.indexOf(t);return i>=0&&n.splice(i,1),n}throw new O.K_("Node does not exist: "+t)},o.prototype.overallOrder=function(t){var e=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=me(this.outgoingEdges,!1,[]);r.forEach(function(u){i(u)});var s=me(this.outgoingEdges,t,n);return r.filter(function(u){return 0===e.incomingEdges[u].length}).forEach(function(u){s(u)}),n},o}(),be=h(4314),Me=h(867),Ne=h(8293),Pe=function(){function o(){}return o.prototype.validateMany=function(t,e){var n=this;t.forEach(function(r){return n.validate(r,t,e)}),this.validateDependencies(t),this.validateEagerRelations(t)},o.prototype.validate=function(t,e,n){if(!t.primaryColumns.length&&!t.isJunction)throw new V.H(t);if("STI"===t.inheritancePattern||"entity-child"===t.tableType){if(!t.discriminatorColumn)throw new O.K_("Entity "+t.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(void 0===t.discriminatorValue)throw new O.K_("Entity "+t.name+" has an undefined discriminator value. Discriminator value should be defined.");var r=e.find(function(f){return f!==t&&("STI"===f.inheritancePattern||"entity-child"===f.tableType)&&f.discriminatorValue===t.discriminatorValue&&f.inheritanceTree.some(function(b){return-1!==t.inheritanceTree.indexOf(b)})});if(r)throw new O.K_("Entities "+t.name+" and "+r.name+" have the same discriminator values. Make sure they are different while using the @ChildEntity decorator.")}if(t.relationCounts.forEach(function(f){if(f.relation.isManyToOne||f.relation.isOneToOne)throw new O.K_("Relation count can not be implemented on ManyToOne or OneToOne relations.")}),n instanceof C.Qd||t.columns.forEach(function(f){var b=n.normalizeType(f);if(-1===n.supportedDataTypes.indexOf(b))throw new be.q(f,b,n.options.type);if(f.length&&-1===n.withLengthColumnTypes.indexOf(b))throw new O.K_("Column "+f.propertyName+" of Entity "+t.name+" does not support length property.");if("enum"===f.type&&!f.enum&&!f.enumName)throw new O.K_('Column "'+f.propertyName+'" of Entity "'+t.name+'" is defined as enum, but missing "enum" or "enumName" properties.')}),(n instanceof C.p$||n instanceof C.xI)&&t.columns.filter(function(f){return f.isGenerated&&"uuid"!==f.generationStrategy}).length>1)throw new O.K_("Error in "+t.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof C.p$&&0===e.filter(function(f){return f.database}).length&&!n.database)throw new Me.H("database");if(n instanceof C.Z0&&t.columns.filter(function(f){return f.charset}).length>1)throw new O.K_("Character set specifying is not supported in Sql Server");var l=t.create();t.relations.forEach(function(f){if(f.isManyToMany||f.isOneToMany){if(!1===f.persistenceEnabled)return;var b=f.getEntityValue(l);if(Array.isArray(b))throw new Ne.j(f)}}),t.relations.forEach(function(f){}),t.relations.forEach(function(f){if(f.isCascadeRemove&&f.inverseRelation&&f.inverseRelation.isCascadeRemove)throw new O.K_("Relation "+t.name+"#"+f.propertyName+" and "+f.inverseRelation.entityMetadata.name+"#"+f.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")}),t.eagerRelations.forEach(function(f){})},o.prototype.validateDependencies=function(t){var e=new he;t.forEach(function(n){e.addNode(n.name)}),t.forEach(function(n){n.relationsWithJoinColumns.filter(function(r){return!r.isNullable}).forEach(function(r){e.addDependency(n.name,r.inverseEntityMetadata.name)})});try{e.overallOrder()}catch(n){throw new oe.u(n.toString().replace("Error: Dependency Cycle Found: ",""))}},o.prototype.validateEagerRelations=function(t){t.forEach(function(e){e.eagerRelations.forEach(function(n){if(n.inverseRelation&&n.inverseRelation.isEager)throw new O.K_("Circular eager relations are disallowed. "+e.targetName+"#"+n.propertyPath+' contains "eager: true", and its inverse side '+n.inverseEntityMetadata.targetName+"#"+n.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')})})},o}(),Ae=h(5737),Oe=h(4906),Je=h(6496),je=function(){function o(){}return o.prototype.createQueryBuilder=function(t,e){return this.manager.createQueryBuilder(this.metadata.target,t||this.metadata.targetName,e||this.queryRunner)},Object.defineProperty(o.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),o.prototype.hasId=function(t){return this.manager.hasId(this.metadata.target,t)},o.prototype.getId=function(t){return this.manager.getId(this.metadata.target,t)},o.prototype.create=function(t){return this.manager.create(this.metadata.target,t)},o.prototype.merge=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(e=this.manager).merge.apply(e,(0,c.ev)([this.metadata.target,t],(0,c.CR)(n)))},o.prototype.preload=function(t){return this.manager.preload(this.metadata.target,t)},o.prototype.save=function(t,e){return this.manager.save(this.metadata.target,t,e)},o.prototype.remove=function(t,e){return this.manager.remove(this.metadata.target,t,e)},o.prototype.softRemove=function(t,e){return this.manager.softRemove(this.metadata.target,t,e)},o.prototype.recover=function(t,e){return this.manager.recover(this.metadata.target,t,e)},o.prototype.insert=function(t){return this.manager.insert(this.metadata.target,t)},o.prototype.update=function(t,e){return this.manager.update(this.metadata.target,t,e)},o.prototype.delete=function(t){return this.manager.delete(this.metadata.target,t)},o.prototype.softDelete=function(t){return this.manager.softDelete(this.metadata.target,t)},o.prototype.restore=function(t){return this.manager.restore(this.metadata.target,t)},o.prototype.count=function(t){return this.manager.count(this.metadata.target,t)},o.prototype.find=function(t){return this.manager.find(this.metadata.target,t)},o.prototype.findAndCount=function(t){return this.manager.findAndCount(this.metadata.target,t)},o.prototype.findByIds=function(t,e){return this.manager.findByIds(this.metadata.target,t,e)},o.prototype.findOne=function(t,e){return this.manager.findOne(this.metadata.target,t,e)},o.prototype.findOneOrFail=function(t,e){return this.manager.findOneOrFail(this.metadata.target,t,e)},o.prototype.query=function(t,e){return this.manager.query(t,e)},o.prototype.clear=function(){return this.manager.clear(this.metadata.target)},o.prototype.increment=function(t,e,n){return this.manager.increment(this.metadata.target,t,e,n)},o.prototype.decrement=function(t,e,n){return this.manager.decrement(this.metadata.target,t,e,n)},o}(),He=h(5746),Se=h(5797),it=h(5368),Ge=h(3092),Le=function(){function o(){}return o.isFindOneOptions=function(t){var e=t;return e&&(Array.isArray(e.select)||e.where instanceof Object||"string"==typeof e.where||Array.isArray(e.relations)||e.join instanceof Object||e.order instanceof Object||e.cache instanceof Object||"boolean"==typeof e.cache||"number"==typeof e.cache||e.lock instanceof Object||e.loadRelationIds instanceof Object||"boolean"==typeof e.loadRelationIds||"boolean"==typeof e.loadEagerRelations||"boolean"==typeof e.withDeleted||"boolean"==typeof e.transaction)},o.isFindManyOptions=function(t){var e=t;return e&&(this.isFindOneOptions(e)||"number"==typeof e.skip||"number"==typeof e.take||"string"==typeof e.skip||"string"==typeof e.take)},o.extractFindManyOptionsAlias=function(t){if(this.isFindManyOptions(t)&&t.join)return t.join.alias},o.applyFindManyOptionsOrConditionsToQueryBuilder=function(t,e){return this.isFindManyOptions(e)?this.applyOptionsToQueryBuilder(t,e):e?t.where(e):t},o.applyOptionsToQueryBuilder=function(t,e){if(!e||!this.isFindOneOptions(e)&&!this.isFindManyOptions(e)||(!0===e.transaction&&(t.expressionMap.useTransaction=!0),!t.expressionMap.mainAlias||!t.expressionMap.mainAlias.hasMetadata))return t;var n=t.expressionMap.mainAlias.metadata;if(e.withDeleted&&t.withDeleted(),e.select&&(t.select([]),e.select.forEach(function(u){var l,f;if(!n.hasColumnWithPropertyPath(""+u))throw new O.K_(u+" column was not found in the "+n.name+" entity.");var b=n.findColumnsWithPropertyPath(""+u);try{for(var w=(0,c.XA)(b),K=w.next();!K.done;K=w.next())t.addSelect(t.alias+"."+K.value.propertyPath)}catch(te){l={error:te}}finally{try{K&&!K.done&&(f=w.return)&&f.call(w)}finally{if(l)throw l.error}}})),e.relations){var r=(0,c.ev)([],(0,c.CR)(e.relations));if(this.applyRelationsRecursively(t,r,t.expressionMap.mainAlias.name,t.expressionMap.mainAlias.metadata,""),r.length>0)throw new it.P(r)}if(e.join&&(e.join.leftJoin&&Object.keys(e.join.leftJoin).forEach(function(u){t.leftJoin(e.join.leftJoin[u],u)}),e.join.innerJoin&&Object.keys(e.join.innerJoin).forEach(function(u){t.innerJoin(e.join.innerJoin[u],u)}),e.join.leftJoinAndSelect&&Object.keys(e.join.leftJoinAndSelect).forEach(function(u){t.leftJoinAndSelect(e.join.leftJoinAndSelect[u],u)}),e.join.innerJoinAndSelect&&Object.keys(e.join.innerJoinAndSelect).forEach(function(u){t.innerJoinAndSelect(e.join.innerJoinAndSelect[u],u)})),e.cache)if(e.cache instanceof Object){var i=e.cache;t.cache(i.id,i.milliseconds)}else t.cache(e.cache);if(e.lock)if("optimistic"===e.lock.mode)t.setLock(e.lock.mode,e.lock.version);else if("pessimistic_read"===e.lock.mode||"pessimistic_write"===e.lock.mode||"dirty_read"===e.lock.mode||"pessimistic_partial_write"===e.lock.mode||"pessimistic_write_or_fail"===e.lock.mode){var s=e.lock.tables?e.lock.tables.map(function(u){var l=t.expressionMap.aliases.find(function(f){return f.metadata.tableNameWithoutPrefix===u});if(!l)throw new O.K_('"'+u+'" is not part of this query');return t.escape(l.name)}):void 0;t.setLock(e.lock.mode,void 0,s)}return!0===e.loadRelationIds?t.loadAllRelationIds():e.loadRelationIds instanceof Object&&t.loadAllRelationIds(e.loadRelationIds),e.where&&t.where(e.where),e.skip&&t.skip(e.skip),e.take&&t.take(e.take),e.order&&Object.keys(e.order).forEach(function(u){var l=e.order[u];if(!n.findColumnWithPropertyPath(u))throw new Error(u+" column was not found in the "+n.name+" entity.");switch(l){case 1:t.addOrderBy(t.alias+"."+u,"ASC");break;case-1:t.addOrderBy(t.alias+"."+u,"DESC");break;case"ASC":t.addOrderBy(t.alias+"."+u,"ASC");break;case"DESC":t.addOrderBy(t.alias+"."+u,"DESC")}}),t},o.applyRelationsRecursively=function(t,e,n,r,i){var s=this,u=[];if(i){var l=new RegExp("^"+i.replace(".","\\.")+"\\.");u=e.filter(function(f){return f.match(l)}).map(function(f){return f.replace(l,"")}).filter(function(f){return r.findRelationWithPropertyPath(f)})}else u=e.filter(function(f){return r.findRelationWithPropertyPath(f)});u.forEach(function(f){var b=Ge.z.buildAlias(t.connection.driver,{shorten:!0,joiner:"__"},n,f),w=n+"."+f;t.leftJoinAndSelect(w,b),e.splice(e.indexOf(i?i+"."+f:f),1);var K=t.expressionMap.joinAttributes.find(function(te){return te.entityOrProperty===w});s.applyRelationsRecursively(t,e,K.alias.name,K.metadata,i?i+"."+f:f);var z=r.relations.find(function(te){return te.propertyName===f});z&&s.joinEagerRelations(t,b,z.inverseEntityMetadata)})},o.joinEagerRelations=function(t,e,n){var r=this;n.eagerRelations.forEach(function(i){var s,u,l,f,b=Ge.z.buildAlias(t.connection.driver,{shorten:!0},t.connection.namingStrategy.eagerJoinRelationAlias(e,i.propertyPath)),w=!0;try{for(var K=(0,c.XA)(t.expressionMap.joinAttributes),z=K.next();!z.done;z=K.next()){var te=z.value;if(void 0===te.condition&&void 0===te.mapToProperty&&void 0===te.isMappingMany&&"LEFT"===te.direction&&te.entityOrProperty===e+"."+i.propertyPath){w=!1,b=te.alias.name;break}}}catch(pe){s={error:pe}}finally{try{z&&!z.done&&(u=K.return)&&u.call(K)}finally{if(s)throw s.error}}w&&t.leftJoin(e+"."+i.propertyPath,b);var re=!0;try{for(var fe=(0,c.XA)(t.expressionMap.selects),de=fe.next();!de.done;de=fe.next()){var ue=de.value;if(void 0===ue.aliasName&&void 0===ue.virtual&&ue.selection===b){re=!1;break}}}catch(pe){l={error:pe}}finally{try{de&&!de.done&&(f=fe.return)&&f.call(fe)}finally{if(l)throw l.error}}re&&t.addSelect(b),r.joinEagerRelations(t,b,i.inverseEntityMetadata)})},o}(),Ke=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return(0,c.ZT)(t,o),t.prototype.findTrees=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r=this;return(0,c.Jh)(this,function(i){switch(i.label){case 0:return[4,this.findRoots(e)];case 1:return n=i.sent(),[4,Promise.all(n.map(function(s){return r.findDescendantsTree(s,e)}))];case 2:return i.sent(),[2,n]}})})},t.prototype.findRoots=function(e){var n=this,s=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,this.metadata.primaryColumns[0].propertyName),u=this.createQueryBuilder("treeEntity");if(null==e?void 0:e.relations){var l=(0,c.ev)([],(0,c.CR)(e.relations));if(Le.applyRelationsRecursively(u,l,u.expressionMap.mainAlias.name,u.expressionMap.mainAlias.metadata,""),l.length>0)throw new O.PI(l)}return u.where(("treeEntity",n.manager.connection.driver.escape("treeEntity")+"."+function(f){return n.manager.connection.driver.escape(f)}(s)+" IS NULL")).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:if(r=this.createDescendantsQueryBuilder("treeEntity","treeClosure",e),(null==n?void 0:n.relations)&&(i=(0,c.ev)([],(0,c.CR)(n.relations)),Le.applyRelationsRecursively(r,i,r.expressionMap.mainAlias.name,r.expressionMap.mainAlias.metadata,""),i.length>0))throw new O.PI(i);return[4,r.getRawAndEntities()];case 1:return s=l.sent(),u=this.createRelationMaps("treeEntity",s.raw),this.buildChildrenEntityTree(e,s.entities,u),[2,e]}})})},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,n,r){var i=this,s=function(w){return i.manager.connection.driver.escape(w)};if("closure-table"===this.metadata.treeType){var u=this.metadata.closureJunctionTable.descendantColumns.map(function(w){return s(n)+"."+s(w.propertyPath)+" = "+s(e)+"."+s(w.referencedColumn.propertyPath)}).join(" AND "),l={},f=this.metadata.closureJunctionTable.ancestorColumns.map(function(w){return l[w.referencedColumn.propertyName]=w.referencedColumn.getEntityValue(r),s(n)+"."+s(w.propertyPath)+" = :"+w.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,n,u).where(f).setParameters(l)}if("nested-set"===this.metadata.treeType){f=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath;var b={};return u=this.metadata.treeParentRelation.joinColumns.map(function(z){var te=z.referencedColumn.propertyPath.replace(".","_");return b[te]=z.referencedColumn.getEntityValue(r),"joined."+z.referencedColumn.propertyPath+" = :"+te}).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",f).where(u,b)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(w){var K=w.subQuery().select(i.metadata.targetName+"."+i.metadata.materializedPathColumn.propertyPath,"path").from(i.metadata.target,i.metadata.targetName).whereInIds(i.metadata.getEntityIdMap(r));return i.manager.connection.driver instanceof He.w?e+"."+i.metadata.materializedPathColumn.propertyPath+" LIKE "+K.getQuery()+" || '%'":e+"."+i.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+K.getQuery()+", '%')"});throw new Se.K("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var n=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then(function(r){var i=n.createRelationMaps("treeEntity",r.raw);return n.buildParentEntityTree(e,r.entities,i),e})},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,n,r){var i=this;if("closure-table"===this.metadata.treeType){var s=this.metadata.closureJunctionTable.ancestorColumns.map(function(b){return n+"."+b.propertyPath+" = "+e+"."+b.referencedColumn.propertyPath}).join(" AND "),u={},l=this.metadata.closureJunctionTable.descendantColumns.map(function(b){return u[b.referencedColumn.propertyName]=b.referencedColumn.getEntityValue(r),n+"."+b.propertyPath+" = :"+b.referencedColumn.propertyName}).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,n,s).where(l).setParameters(u)}if("nested-set"===this.metadata.treeType){s="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath;var f={};return l=this.metadata.treeParentRelation.joinColumns.map(function(K){var z=K.referencedColumn.propertyPath.replace(".","_");return f[z]=K.referencedColumn.getEntityValue(r),"joined."+K.referencedColumn.propertyPath+" = :"+z}).join(" AND "),this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(l,f)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where(function(b){var w=b.subQuery().select(i.metadata.targetName+"."+i.metadata.materializedPathColumn.propertyPath,"path").from(i.metadata.target,i.metadata.targetName).whereInIds(i.metadata.getEntityIdMap(r));return i.manager.connection.driver instanceof He.w?w.getQuery()+" LIKE "+e+"."+i.metadata.materializedPathColumn.propertyPath+" || '%'":w.getQuery()+" LIKE CONCAT("+e+"."+i.metadata.materializedPathColumn.propertyPath+", '%')"});throw new Se.K("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,n){var r=this;return n.map(function(i){var s=r.metadata.treeParentRelation.joinColumns[0],f=i[e+"_"+(s.givenDatabaseName||s.databaseName)];return{id:r.manager.connection.driver.prepareHydratedValue(i[e+"_"+r.metadata.primaryColumns[0].databaseName],r.metadata.primaryColumns[0]),parentId:r.manager.connection.driver.prepareHydratedValue(f,s)}})},t.prototype.buildChildrenEntityTree=function(e,n,r){var i=this,s=this.metadata.treeChildrenRelation.propertyName,u=this.metadata.primaryColumns[0].getEntityValue(e),l=r.filter(function(b){return b.parentId===u}),f=new Set(l.map(function(b){return b.id}));e[s]=n.filter(function(b){return f.has(i.metadata.primaryColumns[0].getEntityValue(b))}),e[s].forEach(function(b){i.buildChildrenEntityTree(b,n,r)})},t.prototype.buildParentEntityTree=function(e,n,r){var i=this,s=this.metadata.treeParentRelation.propertyName,u=this.metadata.primaryColumns[0].getEntityValue(e),l=r.find(function(b){return b.id===u}),f=n.find(function(b){return!!l&&i.metadata.primaryColumns[0].getEntityValue(b)===l.parentId});f&&(e[s]=f,this.buildParentEntityTree(e[s],n,r))},t}(je),tt=function(){function o(){}return o.prototype.transform=function(t,e,n,r){return void 0===r&&(r=!1),this.groupAndTransform(t,e,n,r),t},o.prototype.groupAndTransform=function(t,e,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach(function(s){var u=s.getEntityValue(e);void 0!==u&&s.setEntityValue(t,u)}),n.relations.length&&n.relations.forEach(function(s){var u=s.getEntityValue(t),l=s.getEntityValue(e,r);if(void 0!==l)if(s.isOneToMany||s.isManyToMany){if(!Array.isArray(l))return;u||s.setEntityValue(t,u=[]),l.forEach(function(f){var b=u.find(function(w){return s.inverseEntityMetadata.compareEntities(f,w)});b||(b=s.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),u.push(b)),i.groupAndTransform(b,f,s.inverseEntityMetadata,r)})}else{if(!(l instanceof Object))return void(u instanceof Object||s.setEntityValue(t,l));u||(u=s.inverseEntityMetadata.create(void 0,{fromDeserializer:!0}),s.setEntityValue(t,u)),i.groupAndTransform(u,l,s.inverseEntityMetadata,r)}})},o}(),lt=function(){function o(t,e,n,r){this.plainEntity=t,this.metadata=e,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(o.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!1,configurable:!0}),o}(),nt=function(){function o(){this.loadMapItems=[]}return Object.defineProperty(o.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find(function(t){return!t.relation&&!t.parentLoadMapItem})},enumerable:!1,configurable:!0}),o.prototype.addLoadMap=function(t){this.loadMapItems.find(function(n){return n.target===t.target&&n.id===t.id})||this.loadMapItems.push(t)},o.prototype.fillEntities=function(t,e){var n=this;e.forEach(function(r){var i=n.loadMapItems.find(function(s){return s.target===t&&s.metadata.compareEntities(r,s.plainEntity)});i&&(i.entity=r)})},o.prototype.groupByTargetIds=function(){var t=[];return this.loadMapItems.forEach(function(e){var n=t.find(function(r){return r.target===e.target});n||t.push(n={target:e.target,ids:[]}),n.ids.push(e.id)}),t},o}(),rt=function(){function o(t){this.manager=t}return o.prototype.transform=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return e.hasAllPrimaryKeys(t)?(n=new nt,(r=function(u,l,f,b){var w=new lt(u,l,f,b);n.addLoadMap(w),l.extractRelationValuesFromEntity(u,e.relations).filter(function(K){return null!=K}).forEach(function(K){var z=(0,c.CR)(K,3);return r(z[1],z[2],w,z[0])})})(t,e),[4,Promise.all(n.groupByTargetIds().map(function(u){return i.manager.findByIds(u.target,u.ids).then(function(l){return n.fillEntities(u.target,l)})}))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return s.sent(),n.loadMapItems.forEach(function(u){!u.relation||!u.entity||!u.parentLoadMapItem||!u.parentLoadMapItem.entity||(u.relation.isManyToMany||u.relation.isOneToMany?(u.parentLoadMapItem.entity[u.relation.propertyName]||(u.parentLoadMapItem.entity[u.relation.propertyName]=[]),u.parentLoadMapItem.entity[u.relation.propertyName].push(u.entity)):u.parentLoadMapItem.entity[u.relation.propertyName]=u.entity)}),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}})})},o}(),ze=h(5998),ae=h(6661),le=function(){function o(){}return Object.defineProperty(o.prototype,"repository",{get:function(){var t=this.getCustomRepositoryTarget(this);if(!t)throw new ae.b(this.constructor);return this.manager.getRepository(t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"treeRepository",{get:function(){var t=this.getCustomRepositoryTarget(this);if(!t)throw new ae.b(this.constructor);return this.manager.getTreeRepository(t)},enumerable:!1,configurable:!0}),o.prototype.createQueryBuilder=function(t){var e=this.getCustomRepositoryTarget(this.constructor);if(!e)throw new ae.b(this.constructor);return this.manager.getRepository(e).createQueryBuilder(t)},o.prototype.createQueryBuilderFor=function(t,e){return this.getRepositoryFor(t).createQueryBuilder(e)},o.prototype.getRepositoryFor=function(t){return this.manager.getRepository(t)},o.prototype.getTreeRepositoryFor=function(t){return this.manager.getTreeRepository(t)},o.prototype.getCustomRepositoryTarget=function(t){var e=yt().entityRepositories.find(function(n){return n.target===(t instanceof Function?t:t.constructor)});if(!e)throw new ze.n(t);return e.entity},o}(),ve=h(6454),Ce=h(2111),M=h(2095),d=function(){function o(){}return o.prototype.create=function(t,e,n){if(e.treeType){var r=new Ke;return Object.assign(r,{manager:t,metadata:e,queryRunner:n}),r}return r=void 0,r=t.connection.driver instanceof C.Qd?new C.yX:new je,Object.assign(r,{manager:t,metadata:e,queryRunner:n}),r},o}(),p=h(3546),q=h(3908),k=function(){function o(t){this.subjects=(0,c.ev)([],(0,c.CR)(t)),this.metadatas=this.getUniqueMetadatas(this.subjects)}return o.prototype.sort=function(t){var e=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===t){var r=this.subjects.filter(function(f){return!f.entity&&!f.databaseEntity});n.push.apply(n,(0,c.ev)([],(0,c.CR)(r))),this.removeAlreadySorted(r)}var i=this.getNonNullableDependencies(),s=this.toposort(i);"insert"===t&&(s=s.reverse()),s.forEach(function(f){var b=e.subjects.filter(function(w){return w.metadata.targetName===f});n.push.apply(n,(0,c.ev)([],(0,c.CR)(b))),e.removeAlreadySorted(b)});var u=this.getDependencies(),l=this.toposort(u);return"insert"===t&&(l=l.reverse()),l.forEach(function(f){var b=e.subjects.filter(function(w){return w.metadata.targetName===f});n.push.apply(n,(0,c.ev)([],(0,c.CR)(b))),e.removeAlreadySorted(b)}),n.push.apply(n,(0,c.ev)([],(0,c.CR)(this.subjects))),n},o.prototype.removeAlreadySorted=function(t){var e=this;t.forEach(function(n){e.subjects.splice(e.subjects.indexOf(n),1)})},o.prototype.getUniqueMetadatas=function(t){var e=[];return t.forEach(function(n){-1===e.indexOf(n.metadata)&&e.push(n.metadata)}),e},o.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce(function(t,e){return e.relationsWithJoinColumns.forEach(function(n){n.isNullable||t.push([e.targetName,n.inverseEntityMetadata.targetName])}),t},[])},o.prototype.getDependencies=function(){return this.metadatas.reduce(function(t,e){return e.relationsWithJoinColumns.forEach(function(n){n.inverseEntityMetadata!==e&&t.push([e.targetName,n.inverseEntityMetadata.targetName])}),t},[])},o.prototype.toposort=function(t){for(var n=function(f){for(var b=[],w=0,K=f.length;w<K;w++){var z=f[w];b.indexOf(z[0])<0&&b.push(z[0]),b.indexOf(z[1])<0&&b.push(z[1])}return b}(t),r=n.length,i=new Array(r),s={},u=r;u--;)s[u]||l(n[u],u,[]);function l(f,b,w){if(w.indexOf(f)>=0)throw new O.K_("Cyclic dependency: "+JSON.stringify(f));if(!~n.indexOf(f))throw new O.K_("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(f));if(!s[b]){s[b]=!0;var K=t.filter(function(re){return re[0]===f});if(b=K.length){var z=w.concat(f);do{var te=K[--b][1];l(te,n.indexOf(te),z)}while(b)}i[--r]=f}}return i},o}(),se=h(4205),ce=h(1018),Qe=h(9100),ot=function(){function o(){}return o.prototype.compute=function(t){var e=this;t.forEach(function(n){e.computeDiffColumns(n),e.computeDiffRelationalColumns(t,n)})},o.prototype.computeDiffColumns=function(t){!t.entity||t.metadata.columns.forEach(function(e){if(!e.isVirtual&&!e.isDiscriminator){var n=t.changeMaps.find(function(f){return f.column===e});n&&t.changeMaps.splice(t.changeMaps.indexOf(n),1);var r=e.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var s=e.getEntityValue(t.databaseEntity,"json"!==e.type&&"jsonb"!==e.type);if(e.relationMetadata&&null!=e.relationMetadata.getEntityValue(t.entity))return;var l=r;if(null!==r){switch(e.type){case"date":l=se.E.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":l=se.E.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":l=se.E.mixedDateToUtcDatetimeString(r),s=se.E.mixedDateToUtcDatetimeString(s);break;case"json":case"jsonb":if(ce.s.deepCompare(r,s))return;break;case"simple-array":l=se.E.simpleArrayToString(r),s=se.E.simpleArrayToString(s);break;case"simple-enum":l=se.E.simpleEnumToString(r),s=se.E.simpleEnumToString(s);break;case"simple-json":l=se.E.simpleJsonToString(r),s=se.E.simpleJsonToString(s)}e.transformer&&(l=Qe.A.transformTo(e.transformer,r))}if(l instanceof Buffer&&s instanceof Buffer){if(l.equals(s))return}else if(l===s)return}t.diffColumns.push(e),t.changeMaps.push({column:e,value:r})}}})},o.prototype.computeDiffRelationalColumns=function(t,e){!e.entity||e.metadata.relationsWithJoinColumns.forEach(function(n){var r=n.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var s=n.getEntityValue(e.databaseEntity);if(ce.s.compareIds(i,s))return;e.diffRelations.push(n)}var l=t.find(function(b){return b.mustBeInserted&&b.entity===r});l&&(r=l);var f=e.changeMaps.find(function(b){return b.relation===n});f?f.value=r:e.changeMaps.push({relation:n,value:r})}})},o}(),st=h(9387),ct=h(5714),qe=h(9535),Nn=function(o){function t(){return o.call(this,"Nested sets do not support multiple root entities.")||this}return(0,c.ZT)(t,o),t}(Se.K),mn=function(){function o(t){this.queryRunner=t}return o.prototype.insert=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,b=this;return(0,c.Jh)(this,function(w){switch(w.label){case 0:return e=function(K){return b.queryRunner.connection.driver.escape(K)},n=this.getTableName(t.metadata.tablePath),r=e(t.metadata.nestedSetLeftColumn.databaseName),i=e(t.metadata.nestedSetRightColumn.databaseName),!(s=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(s=t.parentSubject.insertedValueSet?t.parentSubject.insertedValueSet:t.parentSubject.entity),u=t.metadata.getEntityIdMap(s),l=void 0,u?[4,this.queryRunner.manager.createQueryBuilder().select(t.metadata.targetName+"."+t.metadata.nestedSetRightColumn.propertyPath,"right").from(t.metadata.target,t.metadata.targetName).whereInIds(u).getRawOne().then(function(K){var z=K?K.right:void 0;return"string"==typeof z?parseInt(z):z})]:[3,2];case 1:l=w.sent(),w.label=2;case 2:return void 0===l?[3,4]:[4,this.queryRunner.query("UPDATE "+n+" SET "+r+" = CASE WHEN "+r+" > "+l+" THEN "+r+" + 2 ELSE "+r+" END,"+i+" = "+i+" + 2 WHERE "+i+" >= "+l)];case 3:return w.sent(),ce.s.mergeDeep(t.insertedValueSet,t.metadata.nestedSetLeftColumn.createValueMap(l),t.metadata.nestedSetRightColumn.createValueMap(l+1)),[3,6];case 4:return[4,this.isUniqueRootEntity(t,s)];case 5:if(!w.sent())throw new Nn;ce.s.mergeDeep(t.insertedValueSet,t.metadata.nestedSetLeftColumn.createValueMap(1),t.metadata.nestedSetRightColumn.createValueMap(2)),w.label=6;case 6:return[2]}})})},o.prototype.update=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,f,b,w,K,z,te,re,fe,de,ue,xe=this;return(0,c.Jh)(this,function(Te){switch(Te.label){case 0:return!(e=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(e=t.parentSubject.entity),!(n=t.databaseEntity)&&e&&(n=t.metadata.treeChildrenRelation.getEntityValue(e).find(function(Be){return Object.entries(t.identifier).every(function(_e){var Ze=(0,c.CR)(_e,2);return Be[Ze[0]]===Ze[1]})})),void 0===n||void 0===e?[2]:(r=t.metadata.treeParentRelation.getEntityValue(n),i=t.metadata.getEntityIdMap(r),s=t.metadata.getEntityIdMap(e),ce.s.compareIds(i,s)?[2]:e?(u=function(Be){return xe.queryRunner.connection.driver.escape(Be)},l=this.getTableName(t.metadata.tablePath),f=u(t.metadata.nestedSetLeftColumn.databaseName),b=u(t.metadata.nestedSetRightColumn.databaseName),w=t.metadata.getEntityIdMap(n),K=void 0,w?[4,this.getNestedSetIds(t.metadata,w)]:[3,2]):[3,9]);case 1:K=Te.sent()[0],Te.label=2;case 2:return z=void 0,s?[4,this.getNestedSetIds(t.metadata,s)]:[3,4];case 3:z=Te.sent()[0],Te.label=4;case 4:return void 0!==K&&void 0!==z?(re=K.right-K.left+1,void 0,de="WHEN "+f+" >= "+K.left+" AND "+f+" < "+K.right+" THEN "+f+" + "+(fe=(te=z.left>K.left)?z.left-K.right:z.right-K.left)+" ",ue="WHEN "+b+" > "+K.left+" AND "+b+" <= "+K.right+" THEN "+b+" + "+fe+" ",te?[4,this.queryRunner.query("UPDATE "+l+" SET "+f+" = CASE WHEN "+f+" > "+K.right+" AND "+f+" <= "+z.left+" THEN "+f+" - "+re+" "+de+"ELSE "+f+" END, "+b+" = CASE WHEN "+b+" > "+K.right+" AND "+b+" < "+z.left+" THEN "+b+" - "+re+" "+ue+"ELSE "+b+" END")]:[3,6]):[3,8];case 5:return Te.sent(),[3,8];case 6:return[4,this.queryRunner.query("UPDATE "+l+" SET "+f+" = CASE WHEN "+f+" < "+K.left+" AND "+f+" > "+z.right+" THEN "+f+" + "+re+" "+de+"ELSE "+f+" END, "+b+" = CASE WHEN "+b+" < "+K.left+" AND "+b+" >= "+z.right+" THEN "+b+" + "+re+" "+ue+"ELSE "+b+" END")];case 7:Te.sent(),Te.label=8;case 8:return[3,11];case 9:return[4,this.isUniqueRootEntity(t,e)];case 10:if(!Te.sent())throw new Nn;Te.label=11;case 11:return[2]}})})},o.prototype.remove=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,f,w,K,z,te,re,fe,de,ue,pe,xe,Te,Be=this;return(0,c.Jh)(this,function(_e){switch(_e.label){case 0:Array.isArray(t)||(t=[t]),n=function(Ze){return Be.queryRunner.connection.driver.escape(Ze)},r=this.getTableName((e=t[0].metadata).tablePath),i=n(e.nestedSetLeftColumn.databaseName),s=n(e.nestedSetRightColumn.databaseName),u=[];try{for(l=(0,c.XA)(t),f=l.next();!f.done;f=l.next())(w=e.getEntityIdMap(f.value.entity))&&u.push(w)}catch(Ze){ue={error:Ze}}finally{try{f&&!f.done&&(pe=l.return)&&pe.call(l)}finally{if(ue)throw ue.error}}return[4,this.getNestedSetIds(e,u)];case 1:K=_e.sent(),_e.label=2;case 2:_e.trys.push([2,7,8,9]),z=(0,c.XA)(K),te=z.next(),_e.label=3;case 3:return te.done?[3,6]:[4,this.queryRunner.query("UPDATE "+r+" SET "+i+" = CASE WHEN "+i+" > "+(re=te.value).left+" THEN "+i+" - "+(fe=re.right-re.left+1)+" ELSE "+i+" END, "+s+" = CASE WHEN "+s+" > "+re.right+" THEN "+s+" - "+fe+" ELSE "+s+" END")];case 4:_e.sent(),_e.label=5;case 5:return te=z.next(),[3,3];case 6:return[3,9];case 7:return de=_e.sent(),xe={error:de},[3,9];case 8:try{te&&!te.done&&(Te=z.return)&&Te.call(z)}finally{if(xe)throw xe.error}return[7];case 9:return[2]}})})},o.prototype.getNestedSetIds=function(t,e){var n={left:t.targetName+"."+t.nestedSetLeftColumn.propertyPath,right:t.targetName+"."+t.nestedSetRightColumn.propertyPath},r=this.queryRunner.manager.createQueryBuilder();return Object.entries(n).forEach(function(i){var s=(0,c.CR)(i,2);r.addSelect(s[1],s[0])}),r.from(t.target,t.targetName).whereInIds(e).orderBy(n.right,"DESC").getRawMany().then(function(i){var s,u,l,f,b=[];try{for(var w=(0,c.XA)(i),K=w.next();!K.done;K=w.next()){var z=K.value,te={};try{for(var re=(l=void 0,(0,c.XA)(Object.keys(n))),fe=re.next();!fe.done;fe=re.next()){var de=fe.value,ue=z?z[de]:void 0;te[de]="string"==typeof ue?parseInt(ue):ue}}catch(pe){l={error:pe}}finally{try{fe&&!fe.done&&(f=re.return)&&f.call(re)}finally{if(l)throw l.error}}b.push(te)}}catch(pe){s={error:pe}}finally{try{K&&!K.done&&(u=w.return)&&u.call(w)}finally{if(s)throw s.error}}return b})},o.prototype.isUniqueRootEntity=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u,l,f=this;return(0,c.Jh)(this,function(b){switch(b.label){case 0:return n=function(w){return f.queryRunner.connection.driver.escape(w)},r=this.getTableName(t.metadata.tablePath),i=[],s=t.metadata.treeParentRelation.joinColumns.map(function(w){var K=n(w.databaseName),z=w.getEntityValue(e);return null==z?K+" IS NULL":(i.push(z),K+" = "+f.queryRunner.connection.driver.createParameter("entity_"+w.databaseName,i.length-1))}).join(" AND "),[4,this.queryRunner.query("SELECT COUNT(1) AS "+n(u="count")+" FROM "+r+" WHERE "+s,i,!0)];case 1:return l=b.sent(),[2,0===parseInt(l.records[0][u])]}})})},o.prototype.getTableName=function(t){var e=this;return t.split(".").map(function(n){return""===n?n:e.queryRunner.connection.driver.escape(n)}).join(".")},o}(),Pn=h(8369),yn=function(){function o(t){this.queryRunner=t}return o.prototype.insert=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,f,b,w=this;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return e={},t.metadata.closureJunctionTable.ancestorColumns.forEach(function(z){e[z.databaseName]=t.identifier}),t.metadata.closureJunctionTable.descendantColumns.forEach(function(z){e[z.databaseName]=t.identifier}),[4,this.queryRunner.manager.createQueryBuilder().insert().into(t.metadata.closureJunctionTable.tablePath).values(e).updateEntity(!1).callListeners(!1).execute()];case 1:return K.sent(),!(n=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(n=t.parentSubject.insertedValueSet?t.parentSubject.insertedValueSet:t.parentSubject.entity),n?(r=function(z){return w.queryRunner.connection.driver.escape(z)},i=this.getTableName(t.metadata.closureJunctionTable.tablePath),s=[],u=t.metadata.closureJunctionTable.ancestorColumns.map(function(z){return r(z.databaseName)}),l=t.metadata.closureJunctionTable.descendantColumns.map(function(z){return r(z.databaseName)}),f=t.metadata.primaryColumns.map(function(z){return s.push(z.getEntityValue(t.insertedValueSet?t.insertedValueSet:t.entity)),w.queryRunner.connection.driver.createParameter("child_entity_"+z.databaseName,s.length-1)}),b=t.metadata.closureJunctionTable.descendantColumns.map(function(z){var te=r(z.databaseName),re=z.referencedColumn.getEntityValue(n);if(!re)throw new Pn.a(t.metadata.name);return s.push(re),te+" = "+w.queryRunner.connection.driver.createParameter("parent_entity_"+z.referencedColumn.databaseName,s.length-1)}),[4,this.queryRunner.query("INSERT INTO "+i+" ("+(0,c.ev)((0,c.ev)([],(0,c.CR)(u)),(0,c.CR)(l)).join(", ")+") SELECT "+u.join(", ")+", "+f.join(", ")+" FROM "+i+" WHERE "+b.join(" AND "),s)]):[3,3];case 2:K.sent(),K.label=3;case 3:return[2]}})})},o.prototype.update=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,f,b,w,K,z,te,re,fe,de,ue,pe,xe,Te,Be,_e,Ze,Re=this;return(0,c.Jh)(this,function(et){switch(et.label){case 0:if(!(e=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(e=t.parentSubject.entity),!(n=t.databaseEntity)&&e&&(n=t.metadata.treeChildrenRelation.getEntityValue(e).find(function(Ue){return Object.entries(t.identifier).every(function(at){var Ye=(0,c.CR)(at,2);return Ue[Ye[0]]===Ye[1]})})),void 0===n||void 0===e)return[2];if(r=t.metadata.treeParentRelation.getEntityValue(n),i=t.metadata.getEntityIdMap(r),s=t.metadata.getEntityIdMap(e),ce.s.compareIds(i,s))return[2];u=function(Ue){return Re.queryRunner.connection.driver.escape(Ue)},f=(l=t.metadata.closureJunctionTable).ancestorColumns.map(function(Ue){return u(Ue.databaseName)}),b=l.descendantColumns.map(function(Ue){return u(Ue.databaseName)}),w=function(Ue,at){var Ye,De,ke="sub"+at,Fe=Ue.createQueryBuilder().select(b.join(", ")).from(l.tablePath,ke);try{for(var We=(0,c.XA)(l.ancestorColumns),ft=We.next();!ft.done;ft=We.next()){var vt=ft.value;Fe.andWhere(u(ke)+"."+u(vt.databaseName)+" = :value_"+vt.referencedColumn.databaseName)}}catch(gt){Ye={error:gt}}finally{try{ft&&!ft.done&&(De=We.return)&&De.call(We)}finally{if(Ye)throw Ye.error}}return Ue.createQueryBuilder().select(b.join(", ")).from("("+Fe.getQuery()+")",at).setParameters(Fe.getParameters()).getQuery()},K={};try{for(z=(0,c.XA)(t.metadata.primaryColumns),te=z.next();!te.done;te=z.next())K["value_"+(re=te.value).databaseName]=n[re.databaseName]}catch(Ue){_e={error:Ue}}finally{try{te&&!te.done&&(Ze=z.return)&&Ze.call(z)}finally{if(_e)throw _e.error}}return[4,this.queryRunner.manager.createQueryBuilder().delete().from(l.tablePath).where(function(Ue){return"("+b.join(", ")+") IN ("+w(Ue,"descendant")+")"}).andWhere(function(Ue){return"("+f.join(", ")+") NOT IN ("+w(Ue,"ancestor")+")"}).setParameters(K).execute()];case 1:return et.sent(),e?(fe=[],de=this.getTableName(l.tablePath),ue=u("supertree"),pe=u("subtree"),xe=(0,c.ev)((0,c.ev)([],(0,c.CR)(f.map(function(Ue){return ue+"."+Ue}))),(0,c.CR)(b.map(function(Ue){return pe+"."+Ue}))),Te=t.metadata.closureJunctionTable.ancestorColumns.map(function(Ue){var at=u(Ue.databaseName),Ye=Ue.referencedColumn.getEntityValue(n);fe.push(Ye);var De=Re.queryRunner.connection.driver.createParameter("entity_"+Ue.referencedColumn.databaseName,fe.length-1);return pe+"."+at+" = "+De}),Be=t.metadata.closureJunctionTable.descendantColumns.map(function(Ue){var at=u(Ue.databaseName),Ye=Ue.referencedColumn.getEntityValue(e);if(!Ye)throw new Pn.a(t.metadata.name);fe.push(Ye);var De=Re.queryRunner.connection.driver.createParameter("parent_entity_"+Ue.referencedColumn.databaseName,fe.length-1);return ue+"."+at+" = "+De}),[4,this.queryRunner.query("INSERT INTO "+de+" ("+(0,c.ev)((0,c.ev)([],(0,c.CR)(f)),(0,c.CR)(b)).join(", ")+") SELECT "+xe.join(", ")+" FROM "+de+" AS "+ue+", "+de+" AS "+pe+" WHERE "+(0,c.ev)((0,c.ev)([],(0,c.CR)(Te)),(0,c.CR)(Be)).join(" AND "),fe)]):[3,3];case 2:et.sent(),et.label=3;case 3:return[2]}})})},o.prototype.remove=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l=this;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return this.queryRunner.connection.driver instanceof C.Z0?(Array.isArray(t)||(t=[t]),e=function(b){return l.queryRunner.connection.driver.escape(b)},n=t.map(function(b){return b.identifier}),s=(i=function(b){return b.map(function(w){var K=n.map(function(z){return z[w.referencedColumn.databaseName]});return e(w.databaseName)+" IN ("+K.join(", ")+")"}).join(" AND ")})((r=t[0].metadata.closureJunctionTable).ancestorColumns),u=i(r.descendantColumns),[4,this.queryRunner.manager.createQueryBuilder().delete().from(r.tablePath).where(s).orWhere(u).execute()]):[2];case 1:return f.sent(),[2]}})})},o.prototype.getTableName=function(t){var e=this;return t.split(".").map(function(n){return""===n?n:e.queryRunner.connection.driver.escape(n)}).join(".")},o}(),Sn=function(){function o(t){this.queryRunner=t}return o.prototype.insert=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return!(e=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(e=t.parentSubject.insertedValueSet?t.parentSubject.insertedValueSet:t.parentSubject.entity),n=t.metadata.getEntityIdMap(e),r="",n?[4,this.getEntityPath(t,n)]:[3,2];case 1:r=u.sent(),u.label=2;case 2:return i=t.metadata.treeParentRelation.joinColumns.map(function(l){return l.referencedColumn.getEntityValue(t.insertedValueSet)}).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set((s={},s[t.metadata.materializedPathColumn.propertyPath]=r+i+".",s)).where(t.identifier).execute()];case 3:return u.sent(),[2]}})})},o.prototype.update=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,i,s,u,l,f,b,w;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return!(e=t.metadata.treeParentRelation.getEntityValue(t.entity))&&t.parentSubject&&t.parentSubject.entity&&(e=t.parentSubject.entity),!(n=t.databaseEntity)&&e&&(n=t.metadata.treeChildrenRelation.getEntityValue(e).find(function(z){return Object.entries(t.identifier).every(function(te){var re=(0,c.CR)(te,2);return z[re[0]]===re[1]})})),r=t.metadata.treeParentRelation.getEntityValue(n),i=t.metadata.getEntityIdMap(r),s=t.metadata.getEntityIdMap(e),ce.s.compareIds(i,s)?[2]:(u="",s?[4,this.getEntityPath(t,s)]:[3,2]);case 1:u=K.sent(),K.label=2;case 2:return l="",i?[4,this.getEntityPath(t,i)]:[3,4];case 3:l=K.sent()||"",K.label=4;case 4:return f=t.metadata.treeParentRelation.joinColumns.map(function(z){return z.referencedColumn.getEntityValue(n)}).join("_"),b=t.metadata.materializedPathColumn.propertyPath,[4,this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set((w={},w[b]=function(){return"REPLACE("+b+", '"+l+f+".', '"+u+f+".')"},w)).where(b+" LIKE :path",{path:""+l+f+".%"}).execute()];case 5:return K.sent(),[2]}})})},o.prototype.getEntityPath=function(t,e){return this.queryRunner.manager.createQueryBuilder().select(t.metadata.targetName+"."+t.metadata.materializedPathColumn.propertyPath,"path").from(t.metadata.target,t.metadata.targetName).whereInIds(e).getRawOne().then(function(n){return n?n.path:void 0})},o}(),tr=function(){function o(t,e,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=t,this.allSubjects=e,this.options=n,this.validate(),this.recompute()}return o.prototype.execute=function(){return(0,c.mG)(this,void 0,void 0,function(){var t;return(0,c.Jh)(this,function(e){switch(e.label){case 0:return t=void 0,this.options&&!1===this.options.listeners?[3,2]:(t=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(t.promises)]:[3,2];case 1:e.sent(),e.label=2;case 2:return t&&t.count>0&&(this.insertSubjects.forEach(function(n){return n.recompute()}),this.updateSubjects.forEach(function(n){return n.recompute()}),this.removeSubjects.forEach(function(n){return n.recompute()}),this.softRemoveSubjects.forEach(function(n){return n.recompute()}),this.recoverSubjects.forEach(function(n){return n.recompute()}),this.recompute()),this.insertSubjects=new k(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return e.sent(),this.updateSubjects=this.allSubjects.filter(function(n){return n.mustBeUpdated}),[4,this.executeUpdateOperations()];case 4:return e.sent(),this.removeSubjects=new k(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return e.sent(),this.softRemoveSubjects=this.allSubjects.filter(function(n){return n.mustBeSoftRemoved}),[4,this.executeSoftRemoveOperations()];case 6:return e.sent(),this.recoverSubjects=this.allSubjects.filter(function(n){return n.mustBeRecovered}),[4,this.executeRecoverOperations()];case 7:return e.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:return e.sent(),this.options&&!1===this.options.listeners?[3,10]:(t=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(t.promises)]:[3,10];case 9:e.sent(),e.label=10;case 10:return[2]}})})},o.prototype.validate=function(){this.allSubjects.forEach(function(t){if(t.mustBeUpdated&&t.mustBeRemoved)throw new ct.B(t)})},o.prototype.recompute=function(){(new ot).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter(function(t){return t.mustBeInserted}),this.updateSubjects=this.allSubjects.filter(function(t){return t.mustBeUpdated}),this.removeSubjects=this.allSubjects.filter(function(t){return t.mustBeRemoved}),this.softRemoveSubjects=this.allSubjects.filter(function(t){return t.mustBeSoftRemoved}),this.recoverSubjects=this.allSubjects.filter(function(t){return t.mustBeRecovered}),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0},o.prototype.broadcastBeforeEventsForAll=function(){var t=this,e=new qe.D;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastBeforeInsertEvent(e,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastBeforeRemoveEvent(e,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastBeforeUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),e},o.prototype.broadcastAfterEventsForAll=function(){var t=this,e=new qe.D;return this.insertSubjects.length&&this.insertSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastAfterInsertEvent(e,n.metadata,n.entity)}),this.updateSubjects.length&&this.updateSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.removeSubjects.length&&this.removeSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastAfterRemoveEvent(e,n.metadata,n.entity,n.databaseEntity)}),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),this.recoverSubjects.length&&this.recoverSubjects.forEach(function(n){return t.queryRunner.broadcaster.broadcastAfterUpdateEvent(e,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)}),e},o.prototype.executeInsertOperations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u,f,b,w,K=this;return(0,c.Jh)(this,function(z){switch(z.label){case 0:t=(0,c.CR)(this.groupBulkSubjects(this.insertSubjects,"insert"),2),e=t[0],n=t[1],r=function(te){var re,fe,de,ue,xe,Te,Be,_e,Ze,et,Ue,at;return(0,c.Jh)(this,function(Ye){switch(Ye.label){case 0:return fe=[],de=[],ue=[],(re=e[te]).forEach(i.queryRunner.connection.driver instanceof C.Qd?function(De){De.metadata.createDateColumn&&De.entity&&(De.entity[De.metadata.createDateColumn.databaseName]=new Date),De.metadata.updateDateColumn&&De.entity&&(De.entity[De.metadata.updateDateColumn.databaseName]=new Date),De.createValueSetAndPopChangeMap(),de.push(De),fe.push(De.entity)}:i.queryRunner.connection.driver instanceof C.XR?function(De){ue.push(De)}:function(De){0===De.changeMaps.length||De.metadata.treeType||K.queryRunner.connection.driver instanceof C.XR||K.queryRunner.connection.driver instanceof C.tU?ue.push(De):(de.push(De),fe.push(De.createValueSetAndPopChangeMap()))}),i.queryRunner instanceof C.En?[4,i.queryRunner.manager.insert(re[0].metadata.target,fe)]:[3,2];case 1:return xe=Ye.sent(),re.forEach(function(De,ke){De.identifier=xe.identifiers[ke],De.generatedMap=xe.generatedMaps[ke],De.insertedValueSet=fe[ke]}),[3,12];case 2:return fe.length>0?[4,i.queryRunner.manager.createQueryBuilder().insert().into(re[0].metadata.target).values(fe).updateEntity(!(i.options&&!1===i.options.reload)).callListeners(!1).execute()]:[3,4];case 3:Te=Ye.sent(),de.forEach(function(De,ke){De.identifier=Te.identifiers[ke],De.generatedMap=Te.generatedMaps[ke],De.insertedValueSet=fe[ke]}),Ye.label=4;case 4:if(!(ue.length>0))return[3,12];Be=function(De){return(0,c.Jh)(this,function(ke){switch(ke.label){case 0:return De.insertedValueSet=De.createValueSetAndPopChangeMap(),"nested-set"!==De.metadata.treeType?[3,2]:[4,new mn(i.queryRunner).insert(De)];case 1:ke.sent(),ke.label=2;case 2:return[4,i.queryRunner.manager.createQueryBuilder().insert().into(De.metadata.target).values(De.insertedValueSet).updateEntity(!(i.options&&!1===i.options.reload)).callListeners(!1).execute().then(function(Fe){De.identifier=Fe.identifiers[0],De.generatedMap=Fe.generatedMaps[0]})];case 3:return ke.sent(),"closure-table"!==De.metadata.treeType?[3,5]:[4,new yn(i.queryRunner).insert(De)];case 4:return ke.sent(),[3,7];case 5:return"materialized-path"!==De.metadata.treeType?[3,7]:[4,new Sn(i.queryRunner).insert(De)];case 6:ke.sent(),ke.label=7;case 7:return[2]}})},Ye.label=5;case 5:Ye.trys.push([5,10,11,12]),Ue=void 0,_e=(0,c.XA)(ue),Ze=_e.next(),Ye.label=6;case 6:return Ze.done?[3,9]:[5,Be(Ze.value)];case 7:Ye.sent(),Ye.label=8;case 8:return Ze=_e.next(),[3,6];case 9:return[3,12];case 10:return et=Ye.sent(),Ue={error:et},[3,12];case 11:try{Ze&&!Ze.done&&(at=_e.return)&&at.call(_e)}finally{if(Ue)throw Ue.error}return[7];case 12:return re.forEach(function(De){De.generatedMap&&De.metadata.columns.forEach(function(ke){var Fe=ke.getEntityValue(De.generatedMap);if(null!=Fe){var We=K.queryRunner.connection.driver.prepareHydratedValue(Fe,ke);ke.setEntityValue(De.generatedMap,We)}})}),[2]}})},i=this,z.label=1;case 1:z.trys.push([1,6,7,8]),s=(0,c.XA)(n),u=s.next(),z.label=2;case 2:return u.done?[3,5]:[5,r(u.value)];case 3:z.sent(),z.label=4;case 4:return u=s.next(),[3,2];case 5:return[3,8];case 6:return f=z.sent(),b={error:f},[3,8];case 7:try{u&&!u.done&&(w=s.return)&&w.call(s)}finally{if(b)throw b.error}return[7];case 8:return[2]}})})},o.prototype.executeUpdateOperations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u,l,f,b=this;return(0,c.Jh)(this,function(w){switch(w.label){case 0:t=function(K){return(0,c.mG)(b,void 0,void 0,function(){var z,re,de,ue,pe,xe=this;return(0,c.Jh)(this,function(Te){switch(Te.label){case 0:if(!K.identifier)throw new st.H(K);return this.queryRunner instanceof C.En?(z=this.cloneMongoSubjectEntity(K),K.metadata.objectIdColumn&&K.metadata.objectIdColumn.propertyName&&delete z[K.metadata.objectIdColumn.propertyName],K.metadata.createDateColumn&&K.metadata.createDateColumn.propertyName&&delete z[K.metadata.createDateColumn.propertyName],K.metadata.updateDateColumn&&K.metadata.updateDateColumn.propertyName&&(z[K.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(K.metadata.target,K.identifier,z)]):[3,2];case 1:return Te.sent(),[3,11];case 2:switch(re=K.createValueSetAndPopChangeMap(),K.metadata.treeType){case"nested-set":return[3,3];case"closure-table":return[3,5];case"materialized-path":return[3,7]}return[3,9];case 3:return[4,new mn(this.queryRunner).update(K)];case 4:return Te.sent(),[3,9];case 5:return[4,new yn(this.queryRunner).update(K)];case 6:return Te.sent(),[3,9];case 7:return[4,new Sn(this.queryRunner).update(K)];case 8:return Te.sent(),[3,9];case 9:return de=this.queryRunner.manager.createQueryBuilder().update(K.metadata.target).set(re).updateEntity(!(this.options&&!1===this.options.reload)).callListeners(!1),K.entity?de.whereEntity(K.identifier):de.where(K.identifier),[4,de.execute()];case 10:ue=Te.sent(),(pe=ue.generatedMaps[0])&&(K.metadata.columns.forEach(function(Be){var _e=Be.getEntityValue(pe);if(null!=_e){var Ze=xe.queryRunner.connection.driver.prepareHydratedValue(_e,Be);Be.setEntityValue(pe,Ze)}}),K.generatedMap||(K.generatedMap={}),Object.assign(K.generatedMap,pe)),Te.label=11;case 11:return[2]}})})},e=[],n=[];try{for(r=(0,c.XA)(this.updateSubjects),i=r.next();!i.done;i=r.next())"nested-set"===(s=i.value).metadata.treeType?e.push(s):n.push(s)}catch(K){l={error:K}}finally{try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}}return u=new Promise(function(K,z){return(0,c.mG)(b,void 0,void 0,function(){var te,re,fe,de,ue,pe,xe;return(0,c.Jh)(this,function(Te){switch(Te.label){case 0:Te.trys.push([0,7,8,9]),te=(0,c.XA)(e),re=te.next(),Te.label=1;case 1:if(re.done)return[3,6];fe=re.value,Te.label=2;case 2:return Te.trys.push([2,4,,5]),[4,t(fe)];case 3:return Te.sent(),[3,5];case 4:return de=Te.sent(),z(de),[3,5];case 5:return re=te.next(),[3,1];case 6:return[3,9];case 7:return ue=Te.sent(),pe={error:ue},[3,9];case 8:try{re&&!re.done&&(xe=te.return)&&xe.call(te)}finally{if(pe)throw pe.error}return[7];case 9:return K(),[2]}})})}),[4,Promise.all((0,c.ev)((0,c.ev)([],(0,c.CR)(n.map(t))),[u]))];case 1:return w.sent(),[2]}})})},o.prototype.executeRemoveOperations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,u,l,w,K,z;return(0,c.Jh)(this,function(te){switch(te.label){case 0:t=(0,c.CR)(this.groupBulkSubjects(this.removeSubjects,"delete"),2),e=t[0],n=t[1],te.label=1;case 1:te.trys.push([1,13,14,15]),r=(0,c.XA)(n),i=r.next(),te.label=2;case 2:return i.done?[3,12]:(l=(u=e[i.value]).map(function(re){if(!re.identifier)throw new st.H(re);return re.identifier}),this.queryRunner instanceof C.En?[4,this.queryRunner.manager.delete(u[0].metadata.target,l)]:[3,4]);case 3:return te.sent(),[3,11];case 4:switch(u[0].metadata.treeType){case"nested-set":return[3,5];case"closure-table":return[3,7]}return[3,9];case 5:return[4,new mn(this.queryRunner).remove(u)];case 6:return te.sent(),[3,9];case 7:return[4,new yn(this.queryRunner).remove(u)];case 8:return te.sent(),[3,9];case 9:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(u[0].metadata.target).where(l).callListeners(!1).execute()];case 10:te.sent(),te.label=11;case 11:return i=r.next(),[3,2];case 12:return[3,15];case 13:return w=te.sent(),K={error:w},[3,15];case 14:try{i&&!i.done&&(z=r.return)&&z.call(r)}finally{if(K)throw K.error}return[7];case 15:return[2]}})})},o.prototype.cloneMongoSubjectEntity=function(t){var e,n,r={};if(t.entity)try{for(var i=(0,c.XA)(t.metadata.columns),s=i.next();!s.done;s=i.next())ce.s.mergeDeep(r,s.value.getEntityValueMap(t.entity))}catch(l){e={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},o.prototype.executeSoftRemoveOperations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t=this;return(0,c.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map(function(n){return(0,c.mG)(t,void 0,void 0,function(){var r,i,u,l=this;return(0,c.Jh)(this,function(f){switch(f.label){case 0:if(!n.identifier)throw new st.H(n);return this.queryRunner instanceof C.En?(i=this.cloneMongoSubjectEntity(n),n.metadata.objectIdColumn&&n.metadata.objectIdColumn.propertyName&&delete i[n.metadata.objectIdColumn.propertyName],n.metadata.createDateColumn&&n.metadata.createDateColumn.propertyName&&delete i[n.metadata.createDateColumn.propertyName],n.metadata.updateDateColumn&&n.metadata.updateDateColumn.propertyName&&(i[n.metadata.updateDateColumn.propertyName]=new Date),n.metadata.deleteDateColumn&&n.metadata.deleteDateColumn.propertyName&&(i[n.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(n.metadata.target,n.identifier,i)]):[3,2];case 1:return r=f.sent(),[3,4];case 2:return u=this.queryRunner.manager.createQueryBuilder().softDelete().from(n.metadata.target).updateEntity(!(this.options&&!1===this.options.reload)).callListeners(!1),n.entity?u.whereEntity(n.identifier):u.where(n.identifier),[4,u.execute()];case 3:r=f.sent(),f.label=4;case 4:return n.generatedMap=r.generatedMaps[0],n.generatedMap&&n.metadata.columns.forEach(function(b){var w=b.getEntityValue(n.generatedMap);if(null!=w){var K=l.queryRunner.connection.driver.prepareHydratedValue(w,b);b.setEntityValue(n.generatedMap,K)}}),[2]}})})}))];case 1:return e.sent(),[2]}})})},o.prototype.executeRecoverOperations=function(){return(0,c.mG)(this,void 0,void 0,function(){var t=this;return(0,c.Jh)(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.recoverSubjects.map(function(n){return(0,c.mG)(t,void 0,void 0,function(){var r,i,u,l=this;return(0,c.Jh)(this,function(f){switch(f.label){case 0:if(!n.identifier)throw new st.H(n);return this.queryRunner instanceof C.En?(i=this.cloneMongoSubjectEntity(n),n.metadata.objectIdColumn&&n.metadata.objectIdColumn.propertyName&&delete i[n.metadata.objectIdColumn.propertyName],n.metadata.createDateColumn&&n.metadata.createDateColumn.propertyName&&delete i[n.metadata.createDateColumn.propertyName],n.metadata.updateDateColumn&&n.metadata.updateDateColumn.propertyName&&(i[n.metadata.updateDateColumn.propertyName]=new Date),n.metadata.deleteDateColumn&&n.metadata.deleteDateColumn.propertyName&&(i[n.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(n.metadata.target,n.identifier,i)]):[3,2];case 1:return r=f.sent(),[3,4];case 2:return u=this.queryRunner.manager.createQueryBuilder().restore().from(n.metadata.target).updateEntity(!(this.options&&!1===this.options.reload)).callListeners(!1),n.entity?u.whereEntity(n.identifier):u.where(n.identifier),[4,u.execute()];case 3:r=f.sent(),f.label=4;case 4:return n.generatedMap=r.generatedMaps[0],n.generatedMap&&n.metadata.columns.forEach(function(b){var w=b.getEntityValue(n.generatedMap);if(null!=w){var K=l.queryRunner.connection.driver.prepareHydratedValue(w,b);b.setEntityValue(n.generatedMap,K)}}),[2]}})})}))];case 1:return e.sent(),[2]}})})},o.prototype.updateSpecialColumnsInPersistedEntities=function(){var t=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach(function(e){!e.entity||e.metadata.primaryColumns.forEach(function(n){n.setEntityValue(e.entity,void 0)})}),this.allSubjects.forEach(function(e){!e.entity||(e.metadata.relationIds.forEach(function(n){n.setValue(e.entity)}),t.queryRunner instanceof C.En&&e.metadata.objectIdColumn&&e.metadata.objectIdColumn.databaseName&&e.metadata.objectIdColumn.databaseName!==e.metadata.objectIdColumn.propertyName&&delete e.entity[e.metadata.objectIdColumn.databaseName])})},o.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(t){var e=this;t.forEach(function(n){!n.entity||(n.metadata.columns.forEach(function(r){n.metadata.childEntityMetadatas.length>0&&-1!==n.metadata.childEntityMetadatas.map(function(s){return s.target}).indexOf(r.target)||r.isVirtual||(r.isNullable&&void 0===r.getEntityValue(n.entity)&&r.setEntityValue(n.entity,null),n.updatedRelationMaps.length>0&&n.updatedRelationMaps.forEach(function(s){s.relation.joinColumns.forEach(function(u){!0!==u.isVirtual&&u.setEntityValue(n.entity,s.value instanceof Object?u.referencedColumn.getEntityValue(s.value):s.value)})}))}),n.generatedMap&&e.queryRunner.manager.merge(n.metadata.target,n.entity,n.generatedMap))})},o.prototype.groupBulkSubjects=function(t,e){var n={},r=[],i="delete"===e||this.queryRunner.connection.driver.isReturningSqlSupported();return t.forEach(function(s,u){var l=i||s.metadata.isJunction?s.metadata.name:s.metadata.name+"_"+u;n[l]?n[l].push(s):(n[l]=[s],r.push(l))}),[n,r]},o}(),nr=h(6812),_t=function(){function o(t){var e;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=t.metadata,this.entity=t.entity,this.parentSubject=t.parentSubject,void 0!==t.canBeInserted&&(this.canBeInserted=t.canBeInserted),void 0!==t.canBeUpdated&&(this.canBeUpdated=t.canBeUpdated),void 0!==t.mustBeRemoved&&(this.mustBeRemoved=t.mustBeRemoved),void 0!==t.canBeSoftRemoved&&(this.canBeSoftRemoved=t.canBeSoftRemoved),void 0!==t.canBeRecovered&&(this.canBeRecovered=t.canBeRecovered),void 0!==t.identifier&&(this.identifier=t.identifier),void 0!==t.changeMaps&&(e=this.changeMaps).push.apply(e,(0,c.ev)([],(0,c.CR)(t.changeMaps))),this.recompute()}return Object.defineProperty(o.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mustBeSoftRemoved",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"mustBeRecovered",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!1,configurable:!0}),o.prototype.createValueSetAndPopChangeMap=function(){var t=this,e=[],n=this.changeMaps.reduce(function(r,i){var u,s=i.value;if(s instanceof o&&(s=s.insertedValueSet?s.insertedValueSet:s.entity),t.metadata.isJunction&&i.column)u=i.column.createValueMap(i.column.referencedColumn.getEntityValue(s));else if(i.column)u=i.column.createValueMap(s);else if(i.relation)if(s instanceof Object&&!(s instanceof Buffer)){var l=i.relation.getRelationIdMap(s);if(void 0===l)return e.push(i),t.canBeUpdated=!0,r;u=i.relation.createValueMap(l),t.updatedRelationMaps.push({relation:i.relation,value:l})}else u=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s});return ce.s.mergeDeep(r,u),r},{});return this.changeMaps=e,n},o.prototype.recompute=function(){var t=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach(function(e){if(e.relationMetadata&&e.relationMetadata.inverseEntityMetadata===t.parentSubject.metadata){var n=e.referencedColumn.getEntityValue(t.parentSubject.entity);e.setEntityValue(t.entityWithFulfilledIds,n)}}),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},o}(),Vt=h(4138),rr=function(){function o(t){this.subjects=t}return o.prototype.build=function(){var t=this;this.subjects.forEach(function(e){e.metadata.oneToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&t.buildForSubjectRelation(e,n)})})},o.prototype.buildForSubjectRelation=function(t,e){var n=this,r=[];t.databaseEntity&&(r=e.getEntityValue(t.databaseEntity));var i=e.getEntityValue(t.entity);if(null===i&&(i=[]),void 0!==i){var s=[];i.forEach(function(u){var l=e.inverseEntityMetadata.getEntityIdMap(u),f=n.subjects.find(function(w){return w.entity===u});if(f&&(l=f.identifier),l)r.find(function(w){return ce.s.compareIds(l,w)})||(f||(f=new _t({metadata:e.inverseEntityMetadata,parentSubject:t,canBeUpdated:!0,identifier:l}),n.subjects.push(f)),f.changeMaps.push({relation:e.inverseRelation,value:t})),s.push(l);else{if(!f)return;f.changeMaps.push({relation:e.inverseRelation,value:t})}}),Vt.T.difference(r,s).forEach(function(u){var l=new _t({metadata:e.inverseEntityMetadata,parentSubject:t,identifier:u});e.inverseRelation&&"nullify"!==e.inverseRelation.orphanedRowAction?"delete"===e.inverseRelation.orphanedRowAction&&(l.mustBeRemoved=!0):(l.canBeUpdated=!0,l.changeMaps=[{relation:e.inverseRelation,value:null}]),n.subjects.push(l)})}},o}(),ir=function(){function o(t){this.subjects=t}return o.prototype.build=function(){var t=this;this.subjects.forEach(function(e){e.metadata.oneToOneRelations.forEach(function(n){n.isOwning||!1===n.persistenceEnabled||t.buildForSubjectRelation(e,n)})})},o.prototype.buildForSubjectRelation=function(t,e){var n=void 0;t.databaseEntity&&(n=e.getEntityValue(t.databaseEntity));var r=e.getEntityValue(t.entity);if(void 0!==r){if(null===r){if(n){var i=new _t({metadata:e.inverseEntityMetadata,parentSubject:t,canBeUpdated:!0,identifier:n,changeMaps:[{relation:e.inverseRelation,value:null}]});this.subjects.push(i)}return}var s=e.inverseEntityMetadata.getEntityIdMap(r),u=this.subjects.find(function(f){return!!f.entity&&f.entity===r});if(u&&(s=u.identifier),!s){if(!u)return;u.changeMaps.push({relation:e.inverseRelation,value:t})}n&&ce.s.compareIds(s,n)||(u||(u=new _t({metadata:e.inverseEntityMetadata,canBeUpdated:!0,identifier:s}),this.subjects.push(u)),u.changeMaps.push({relation:e.inverseRelation,value:t}))}},o}(),On=function(){function o(t){this.subjects=t}return o.prototype.build=function(){var t=this;this.subjects.forEach(function(e){!e.entity||e.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&t.buildForSubjectRelation(e,n)})})},o.prototype.buildForAllRemoval=function(t){var e=this;!t.databaseEntity||t.metadata.manyToManyRelations.forEach(function(n){!1!==n.persistenceEnabled&&n.getEntityValue(t.databaseEntity).forEach(function(i){var s=new _t({metadata:n.junctionEntityMetadata,parentSubject:t,mustBeRemoved:!0,identifier:e.buildJunctionIdentifier(t,n,i)});e.subjects.push(s)})})},o.prototype.buildForSubjectRelation=function(t,e){var n=this,r=[];t.databaseEntity&&(r=e.getEntityValue(t.databaseEntity));var i=e.getEntityValue(t.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach(function(l){var f=e.inverseEntityMetadata.getEntityIdMap(l),b=n.subjects.find(function(re){return re.entity===l});if(b&&(f=b.identifier),(f||b)&&!r.find(function(re){return ce.s.compareIds(re,f)})){var K=e.isOwning?t:b||l,z=e.isOwning?b||l:t,te=new _t({metadata:e.junctionEntityMetadata,parentSubject:t,canBeInserted:!0});n.subjects.push(te),e.junctionEntityMetadata.ownerColumns.forEach(function(re){te.changeMaps.push({column:re,value:K})}),e.junctionEntityMetadata.inverseColumns.forEach(function(re){te.changeMaps.push({column:re,value:z})})}});var s=[];i.forEach(function(l){var f=e.inverseEntityMetadata.getEntityIdMap(l),b=n.subjects.find(function(w){return w.entity===l});b&&(f=b.identifier),null!=f&&s.push(f)}),r.filter(function(l){return!s.find(function(f){return ce.s.compareIds(f,l)})}).forEach(function(l){var f=new _t({metadata:e.junctionEntityMetadata,parentSubject:t,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(t,e,l)});n.subjects.push(f)})}},o.prototype.buildJunctionIdentifier=function(t,e,n){var r=e.isOwning?t.entity:n,i=e.isOwning?n:t.entity,s={};return e.junctionEntityMetadata.ownerColumns.forEach(function(u){ce.s.mergeDeep(s,u.createValueMap(u.referencedColumn.getEntityValue(r)))}),e.junctionEntityMetadata.inverseColumns.forEach(function(u){ce.s.mergeDeep(s,u.createValueMap(u.referencedColumn.getEntityValue(i)))}),s},o}(),ar=function(){function o(t,e){this.queryRunner=t,this.subjects=e}return o.prototype.load=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n=this;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return e=this.groupByEntityTargets().map(function(i){return(0,c.mG)(n,void 0,void 0,function(){var s,u,l,f,w,K,te,re,fe=this;return(0,c.Jh)(this,function(de){switch(de.label){case 0:return s=[],u=[],i.subjects.forEach(function(ue){ue.databaseEntity||!ue.identifier||(s.push(ue.identifier),u.push(ue))}),s.length?(l=[],"save"===t||"soft-remove"===t||"recover"===t?i.subjects.forEach(function(ue){ue.metadata.relations.forEach(function(pe){void 0!==pe.getEntityValue(ue.entityWithFulfilledIds)&&-1===l.indexOf(pe.propertyPath)&&l.push(pe.propertyPath)})}):l.push.apply(l,(0,c.ev)([],(0,c.CR)(i.subjects[0].metadata.manyToManyRelations.map(function(ue){return ue.propertyPath})))),f={loadEagerRelations:!1,loadRelationIds:{relations:l,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(i.target).findByIds(s,f)]):[2];case 1:de.sent().forEach(function(ue){fe.findByPersistEntityLike(i.target,ue).forEach(function(xe){xe.databaseEntity=ue,xe.identifier||(xe.identifier=xe.metadata.hasAllPrimaryKeys(ue)?xe.metadata.getEntityIdMap(ue):void 0)})});try{for(w=(0,c.XA)(u),K=w.next();!K.done;K=w.next())K.value.databaseEntityLoaded=!0}catch(ue){te={error:ue}}finally{try{K&&!K.done&&(re=w.return)&&re.call(w)}finally{if(te)throw te.error}}return[2]}})})}),[4,Promise.all(e)];case 1:return r.sent(),[2]}})})},o.prototype.findByPersistEntityLike=function(t,e){return this.subjects.filter(function(n){return!!n.entity&&(n.entity===e||n.metadata.target===t&&n.metadata.compareEntities(n.entityWithFulfilledIds,e))})},o.prototype.groupByEntityTargets=function(){return this.subjects.reduce(function(t,e){var n=t.find(function(r){return r.target===e.metadata.target});return n||t.push(n={target:e.metadata.target,subjects:[]}),n.subjects.push(e),t},[])},o}(),sr=function(){function o(t){this.allSubjects=t}return o.prototype.build=function(t,e){var n=this;t.metadata.extractRelationValuesFromEntity(t.entity,t.metadata.relations).forEach(function(r){var i=(0,c.CR)(r,3),s=i[0],u=i[1],l=i[2];if(null!=u&&(s.isCascadeInsert||s.isCascadeUpdate||s.isCascadeSoftRemove||s.isCascadeRecover)&&u instanceof Object){var f=n.findByPersistEntityLike(l.target,u);if(f)return!1===f.canBeInserted&&(f.canBeInserted=!0===s.isCascadeInsert&&"save"===e),!1===f.canBeUpdated&&(f.canBeUpdated=!0===s.isCascadeUpdate&&"save"===e),!1===f.canBeSoftRemoved&&(f.canBeSoftRemoved=!0===s.isCascadeSoftRemove&&"soft-remove"===e),void(!1===f.canBeRecovered&&(f.canBeRecovered=!0===s.isCascadeRecover&&"recover"===e));var b=new _t({metadata:l,parentSubject:t,entity:u,canBeInserted:!0===s.isCascadeInsert&&"save"===e,canBeUpdated:!0===s.isCascadeUpdate&&"save"===e,canBeSoftRemoved:!0===s.isCascadeSoftRemove&&"soft-remove"===e,canBeRecovered:!0===s.isCascadeRecover&&"recover"===e});n.allSubjects.push(b),n.build(b,e)}})},o.prototype.findByPersistEntityLike=function(t,e){return this.allSubjects.find(function(n){return!!n.entity&&(n.entity===e||n.metadata.target===t&&n.metadata.compareEntities(n.entityWithFulfilledIds,e))})},o}(),rn=function(){function o(t,e,n,r,i,s){this.connection=t,this.queryRunner=e,this.mode=n,this.target=r,this.entity=i,this.options=s}return o.prototype.execute=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,i,s,u,l,f,w,K,te,re,fe=this;return(0,c.Jh)(this,function(de){switch(de.label){case 0:return this.entity&&"object"==typeof this.entity?[4,Promise.resolve()]:[2,Promise.reject(new q.B(this.mode,this.entity))];case 1:de.sent(),t=this.queryRunner||this.connection.createQueryRunner(),e=t.data,this.options&&this.options.data&&(t.data=this.options.data),de.label=2;case 2:return de.trys.push([2,,22,25]),n=Array.isArray(this.entity)?this.entity:[this.entity],r=this.options&&this.options.chunk&&this.options.chunk>0?ce.s.chunk(n,this.options.chunk):[n],[4,Promise.all(r.map(function(ue){return(0,c.mG)(fe,void 0,void 0,function(){var pe,xe,Te=this;return(0,c.Jh)(this,function(Be){switch(Be.label){case 0:return pe=[],ue.forEach(function(_e){var Ze=Te.target?Te.target:_e.constructor;if(Ze===Object)throw new nr.c(Te.mode);pe.push(new _t({metadata:Te.connection.getMetadata(Ze),entity:_e,canBeInserted:"save"===Te.mode,canBeUpdated:"save"===Te.mode,mustBeRemoved:"remove"===Te.mode,canBeSoftRemoved:"soft-remove"===Te.mode,canBeRecovered:"recover"===Te.mode}))}),xe=new sr(pe),pe.forEach(function(_e){xe.build(_e,Te.mode)}),[4,new ar(t,pe).load(this.mode)];case 1:return Be.sent(),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new rr(pe).build(),new ir(pe).build(),new On(pe).build()):pe.forEach(function(_e){_e.mustBeRemoved&&new On(pe).buildForAllRemoval(_e)}),[2,new tr(t,pe,this.options)]}})})}))];case 3:if(i=de.sent(),0===(s=i.filter(function(ue){return ue.hasExecutableOperations})).length)return[2];u=!1,de.label=4;case 4:return de.trys.push([4,16,,21]),t.isTransactionActive||this.options&&!1===this.options.transaction?[3,6]:(u=!0,[4,t.startTransaction()]);case 5:de.sent(),de.label=6;case 6:de.trys.push([6,11,12,13]),l=(0,c.XA)(s),f=l.next(),de.label=7;case 7:return f.done?[3,10]:[4,f.value.execute()];case 8:de.sent(),de.label=9;case 9:return f=l.next(),[3,7];case 10:return[3,13];case 11:return w=de.sent(),te={error:w},[3,13];case 12:try{f&&!f.done&&(re=l.return)&&re.call(l)}finally{if(te)throw te.error}return[7];case 13:return!0!==u?[3,15]:[4,t.commitTransaction()];case 14:de.sent(),de.label=15;case 15:return[3,21];case 16:if(K=de.sent(),!u)return[3,20];de.label=17;case 17:return de.trys.push([17,19,,20]),[4,t.rollbackTransaction()];case 18:case 19:return de.sent(),[3,20];case 20:throw K;case 21:return[3,25];case 22:return t.data=e,this.queryRunner?[3,24]:[4,t.release()];case 23:de.sent(),de.label=24;case 24:return[7];case 25:return[2]}})})},o}(),Gt=h(2183),Pt=h(5526),Dn=function(){function o(t,e){this.repositories=[],this.plainObjectToEntityTransformer=new tt,this.connection=t,e&&(this.queryRunner=e,Gt.g.assign(this.queryRunner,{manager:this}))}return o.prototype.transaction=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u;return(0,c.Jh)(this,function(f){switch(f.label){case 0:if(n="string"==typeof t?t:void 0,!(r="function"==typeof t?t:e))throw new O.K_("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof C.Qd)throw new O.K_("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new Ae.i;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new O.K_("Cannot start transaction because its already started");i=this.queryRunner||this.connection.createQueryRunner(),f.label=1;case 1:return f.trys.push([1,8,13,16]),n?[4,i.startTransaction(n)]:[3,3];case 2:return f.sent(),[3,5];case 3:return[4,i.startTransaction()];case 4:f.sent(),f.label=5;case 5:return[4,r(i.manager)];case 6:return s=f.sent(),[4,i.commitTransaction()];case 7:return f.sent(),[2,s];case 8:u=f.sent(),f.label=9;case 9:return f.trys.push([9,11,,12]),[4,i.rollbackTransaction()];case 10:case 11:return f.sent(),[3,12];case 12:throw u;case 13:return this.queryRunner?[3,15]:[4,i.release()];case 14:f.sent(),f.label=15;case 15:return[7];case 16:return[2]}})})},o.prototype.query=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,this.connection.query(t,e,this.queryRunner)]})})},o.prototype.createQueryBuilder=function(t,e,n){return e?this.connection.createQueryBuilder(t,e,n||this.queryRunner):this.connection.createQueryBuilder(t||n||this.queryRunner)},o.prototype.hasId=function(t,e){var n=2===arguments.length?t:t.constructor,r=2===arguments.length?e:t,i=this.connection.getMetadata(n);return i.hasId(r)},o.prototype.getId=function(t,e){var n=2===arguments.length?t:t.constructor,r=2===arguments.length?e:t,i=this.connection.getMetadata(n);return i.getEntityIdMixedMap(r)},o.prototype.create=function(t,e){var n=this,r=this.connection.getMetadata(t);if(!e)return r.create(this.queryRunner);if(Array.isArray(e))return e.map(function(s){return n.create(t,s)});var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,e,r,!0),i},o.prototype.merge=function(t,e){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var s=this.connection.getMetadata(t);return r.forEach(function(u){return n.plainObjectToEntityTransformer.transform(e,u,s)}),e},o.prototype.preload=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return n=this.connection.getMetadata(t),[4,new rt(this.connection.manager).transform(e,n)];case 1:return(i=s.sent())?[2,this.merge(t,i,e)]:[2,void 0]}})})},o.prototype.save=function(t,e,n){var r=arguments.length>1&&(t instanceof Function||t instanceof Pt.I||"string"==typeof t)?t:void 0,i=r?e:t,s=r?n:e;return r instanceof Pt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new rn(this.connection,this.queryRunner,"save",r,i,s).execute().then(function(){return i})},o.prototype.remove=function(t,e,n){var r=arguments.length>1&&(t instanceof Function||"string"==typeof t)?t:void 0,i=r?e:t,s=r?n:e;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new rn(this.connection,this.queryRunner,"remove",r,i,s).execute().then(function(){return i})},o.prototype.softRemove=function(t,e,n){var r=arguments.length>1&&(t instanceof Function||t instanceof Pt.I||"string"==typeof t)?t:void 0,i=r?e:t,s=r?n:e;return r instanceof Pt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new rn(this.connection,this.queryRunner,"soft-remove",r,i,s).execute().then(function(){return i})},o.prototype.recover=function(t,e,n){var r=arguments.length>1&&(t instanceof Function||t instanceof Pt.I||"string"==typeof t)?t:void 0,i=r?e:t,s=r?n:e;return r instanceof Pt.I&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new rn(this.connection,this.queryRunner,"recover",r,i,s).execute().then(function(){return i})},o.prototype.insert=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,this.createQueryBuilder().insert().into(t).values(e).execute()]})})},o.prototype.update=function(t,e,n){return null==e||""===e||Array.isArray(e)&&0===e.length?Promise.reject(new O.K_("Empty criteria(s) are not allowed for the update method.")):"string"==typeof e||"number"==typeof e||e instanceof Date||Array.isArray(e)?this.createQueryBuilder().update(t).set(n).whereInIds(e).execute():this.createQueryBuilder().update(t).set(n).where(e).execute()},o.prototype.delete=function(t,e){return null==e||""===e||Array.isArray(e)&&0===e.length?Promise.reject(new O.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof e||"number"==typeof e||e instanceof Date||Array.isArray(e)?this.createQueryBuilder().delete().from(t).whereInIds(e).execute():this.createQueryBuilder().delete().from(t).where(e).execute()},o.prototype.softDelete=function(t,e){return null==e||""===e||Array.isArray(e)&&0===e.length?Promise.reject(new O.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof e||"number"==typeof e||e instanceof Date||Array.isArray(e)?this.createQueryBuilder().softDelete().from(t).whereInIds(e).execute():this.createQueryBuilder().softDelete().from(t).where(e).execute()},o.prototype.restore=function(t,e){return null==e||""===e||Array.isArray(e)&&0===e.length?Promise.reject(new O.K_("Empty criteria(s) are not allowed for the delete method.")):"string"==typeof e||"number"==typeof e||e instanceof Date||Array.isArray(e)?this.createQueryBuilder().restore().from(t).whereInIds(e).execute():this.createQueryBuilder().restore().from(t).where(e).execute()},o.prototype.count=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){return n=this.connection.getMetadata(t),r=this.createQueryBuilder(t,Le.extractFindManyOptionsAlias(e)||n.name),[2,Le.applyFindManyOptionsOrConditionsToQueryBuilder(r,e).getCount()]})})},o.prototype.find=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){return n=this.connection.getMetadata(t),r=this.createQueryBuilder(t,Le.extractFindManyOptionsAlias(e)||n.name),Le.applyFindManyOptionsOrConditionsToQueryBuilder(r,e),(!Le.isFindManyOptions(e)||!1!==e.loadEagerRelations)&&Le.joinEagerRelations(r,r.alias,n),[2,r.getMany()]})})},o.prototype.findAndCount=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){return n=this.connection.getMetadata(t),r=this.createQueryBuilder(t,Le.extractFindManyOptionsAlias(e)||n.name),Le.applyFindManyOptionsOrConditionsToQueryBuilder(r,e),(!Le.isFindManyOptions(e)||!1!==e.loadEagerRelations)&&Le.joinEagerRelations(r,r.alias,n),[2,r.getManyAndCount()]})})},o.prototype.findByIds=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(s){return e.length?(r=this.connection.getMetadata(t),i=this.createQueryBuilder(t,Le.extractFindManyOptionsAlias(n)||r.name),Le.applyFindManyOptionsOrConditionsToQueryBuilder(i,n),(!Le.isFindManyOptions(n)||!1!==n.loadEagerRelations)&&Le.joinEagerRelations(i,i.alias,r),[2,i.andWhereInIds(e).getMany()]):[2,Promise.resolve([])]})})},o.prototype.findOne=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f;return(0,c.Jh)(this,function(b){return r=void 0,Le.isFindOneOptions(e)?r=e:n&&Le.isFindOneOptions(n)&&(r=n),i=void 0,e instanceof Object&&!Le.isFindOneOptions(e)&&(i=e),s=this.connection.getMetadata(t),u=s.name,r&&r.join?u=r.join.alias:n&&Le.isFindOneOptions(n)&&n.join&&(u=n.join.alias),l=this.createQueryBuilder(t,u),(f="string"==typeof e||"number"==typeof e||e instanceof Date)||(r=(0,c.pi)((0,c.pi)({},r||{}),{take:1})),Le.applyOptionsToQueryBuilder(l,r),(!r||!1!==r.loadEagerRelations)&&Le.joinEagerRelations(l,l.alias,l.expressionMap.mainAlias.metadata),i?l.where(i):f&&l.andWhereInIds(s.ensureEntityIdMap(e)),[2,l.getOne()]})})},o.prototype.findOneOrFail=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){return[2,this.findOne(t,e,n).then(function(i){return void 0===i?Promise.reject(new Oe.E(t,e)):Promise.resolve(i)})]})})},o.prototype.clear=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:e=this.connection.getMetadata(t),n=this.queryRunner||this.connection.createQueryRunner(),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(e.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}})})},o.prototype.increment=function(t,e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l=this;return(0,c.Jh)(this,function(f){if(i=this.connection.getMetadata(t),!(s=i.findColumnWithPropertyPath(n)))throw new O.K_("Column "+n+" was not found in "+i.targetName+" entity.");if(isNaN(Number(r)))throw new O.K_('Value "'+r+'" is not a number.');return u=n.split(".").reduceRight(function(b,w){var K;return(K={})[w]=b,K},function(){return l.connection.driver.escape(s.databaseName)+" + "+r}),[2,this.createQueryBuilder(t,"entity").update(t).set(u).where(e).execute()]})})},o.prototype.decrement=function(t,e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l=this;return(0,c.Jh)(this,function(f){if(i=this.connection.getMetadata(t),!(s=i.findColumnWithPropertyPath(n)))throw new O.K_("Column "+n+" was not found in "+i.targetName+" entity.");if(isNaN(Number(r)))throw new O.K_('Value "'+r+'" is not a number.');return u=n.split(".").reduceRight(function(b,w){var K;return(K={})[w]=b,K},function(){return l.connection.driver.escape(s.databaseName)+" - "+r}),[2,this.createQueryBuilder(t,"entity").update(t).set(u).where(e).execute()]})})},o.prototype.getRepository=function(t){if(!this.connection.hasMetadata(t))throw new Ce.V(this.connection.name,t);var e=this.connection.getMetadata(t),n=this.repositories.find(function(i){return i.metadata===e});if(n)return n;var r=(new d).create(this,e,this.queryRunner);return this.repositories.push(r),r},o.prototype.getTreeRepository=function(t){if(!1===this.connection.driver.treeSupport)throw new p.A(this.connection.driver);var e=this.getRepository(t);if(!(e instanceof Ke))throw new M.c(t);return e},o.prototype.getMongoRepository=function(t){return this.connection.getMongoRepository(t)},o.prototype.getCustomRepository=function(t){var e=yt().entityRepositories.find(function(i){return i.target===(t instanceof Function?t:t.constructor)});if(!e)throw new ze.n(t);var n=e.entity?this.connection.getMetadata(e.entity):void 0,r=new e.target(this,n);if(r instanceof le&&(r.manager||(r.manager=this)),r instanceof je){if(!n)throw new ve.R(t);r.manager=this,r.metadata=n}return r},o.prototype.release=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){if(!this.queryRunner)throw new Je.r;return[2,this.queryRunner.release()]})})},o}(),In=function(o){function t(e,n){var r=o.call(this,e,n)||this;return r.driver=e.driver,r}return(0,c.ZT)(t,o),t.prototype.loadDatabase=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.driver.load(e)];case 1:return n.sent(),[2]}})})},t.prototype.saveDatabase=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.driver.save(e)];case 1:return n.sent(),[2]}})})},t.prototype.exportDatabase=function(){return this.driver.export()},t}(Dn),St=h(6235),an=h(326),Ft=h(8637),Mt=h(7915),sn=h(2446),wt=function(){function o(t){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata,this.referencedColumn=t.referencedColumn,t.args.target&&(this.target=t.args.target),t.args.propertyName&&(this.propertyName=t.args.propertyName),t.args.options.name&&(this.givenDatabaseName=t.args.options.name),t.args.options.type&&(this.type=t.args.options.type),t.args.options.length&&(this.length=t.args.options.length?t.args.options.length.toString():""),t.args.options.width&&(this.width=t.args.options.width),t.args.options.charset&&(this.charset=t.args.options.charset),t.args.options.collation&&(this.collation=t.args.options.collation),t.args.options.primary&&(this.isPrimary=t.args.options.primary),null===t.args.options.default&&(this.isNullable=!0),void 0!==t.args.options.nullable&&(this.isNullable=t.args.options.nullable),void 0!==t.args.options.select&&(this.isSelect=t.args.options.select),void 0!==t.args.options.insert&&(this.isInsert=t.args.options.insert),void 0!==t.args.options.update&&(this.isUpdate=t.args.options.update),void 0!==t.args.options.readonly&&(this.isUpdate=!t.args.options.readonly),t.args.options.comment&&(this.comment=t.args.options.comment),void 0!==t.args.options.default&&(this.default=t.args.options.default),t.args.options.onUpdate&&(this.onUpdate=t.args.options.onUpdate),null!=t.args.options.scale&&(this.scale=t.args.options.scale),t.args.options.zerofill&&(this.zerofill=t.args.options.zerofill,this.unsigned=!0),t.args.options.unsigned&&(this.unsigned=t.args.options.unsigned),null!==t.args.options.precision&&(this.precision=t.args.options.precision),t.args.options.enum&&(this.enum=t.args.options.enum instanceof Object&&!Array.isArray(t.args.options.enum)?Object.keys(t.args.options.enum).filter(function(e){return isNaN(+e)&&"function"!=typeof t.args.options.enum[e]}).map(function(e){return t.args.options.enum[e]}):t.args.options.enum),t.args.options.enumName&&(this.enumName=t.args.options.enumName),t.args.options.asExpression&&(this.asExpression=t.args.options.asExpression,this.generatedType=t.args.options.generatedType?t.args.options.generatedType:"VIRTUAL"),t.args.options.hstoreType&&(this.hstoreType=t.args.options.hstoreType),t.args.options.array&&(this.isArray=t.args.options.array),t.args.mode&&(this.isVirtual="virtual"===t.args.mode,this.isTreeLevel="treeLevel"===t.args.mode,this.isCreateDate="createDate"===t.args.mode,this.isUpdateDate="updateDate"===t.args.mode,this.isDeleteDate="deleteDate"===t.args.mode,this.isVersion="version"===t.args.mode,this.isObjectId="objectId"===t.args.mode),t.args.options.transformer&&(this.transformer=t.args.options.transformer),t.args.options.spatialFeatureType&&(this.spatialFeatureType=t.args.options.spatialFeatureType),void 0!==t.args.options.srid&&(this.srid=t.args.options.srid),this.isTreeLevel&&(this.type=t.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=t.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return t.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&void 0===t.args.options.precision&&t.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=t.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=t.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return t.connection.driver.mappedDataTypes.updateDateDefault}),this.onUpdate||(this.onUpdate=t.connection.driver.mappedDataTypes.updateDateDefault),void 0===this.precision&&void 0===t.args.options.precision&&t.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=t.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=t.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=t.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&void 0===t.args.options.precision&&t.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=t.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=t.connection.driver.mappedDataTypes.version),t.closureType&&(this.closureType=t.closureType),t.nestedSetLeft&&(this.isNestedSetLeft=t.nestedSetLeft),t.nestedSetRight&&(this.isNestedSetRight=t.nestedSetRight),t.materializedPath&&(this.isMaterializedPath=t.materializedPath)}return o.prototype.createValueMap=function(t,e){var n,r=this;if(void 0===e&&(e=!1),this.embeddedMetadata){var i=(0,c.ev)([],(0,c.CR)(this.embeddedMetadata.parentPropertyNames)),s=function(u,l){var f=u.shift();return f?(l[f]={},s(u,l[f]),l):(("increment"===r.generationStrategy||"rowid"===r.generationStrategy)&&"bigint"===r.type&&null!==t&&(t=String(t)),l[e?r.databaseName:r.propertyName]=t,l)};return s(i,{})}return("increment"===this.generationStrategy||"rowid"===this.generationStrategy)&&"bigint"===this.type&&null!==t&&(t=String(t)),(n={})[e?this.databaseName:this.propertyName]=t,n},o.prototype.getEntityValueMap=function(t,e){var n,r,i=this;if(this.embeddedMetadata){var u=(0,c.ev)([],(0,c.CR)(this.embeddedMetadata.parentPropertyNames)),l=this.embeddedMetadata.isArray,f=function(w,K){var z,te;if(void 0===K)return{};var re=w.shift();if(re){var fe=f(w,K[re]);return Object.keys(fe).length>0?((z={})[re]=fe,z):{}}return l&&Array.isArray(K)?K.map(function(de){var ue;return(ue={})[i.propertyName]=de[i.propertyName],ue}):void 0!==K[i.propertyName]?((te={})[i.propertyName]=K[i.propertyName],te):{}},b=f(u,t);return Object.keys(b).length>0?b:void 0}return this.relationMetadata&&t[this.relationMetadata.propertyName]&&t[this.relationMetadata.propertyName]instanceof Object?(b=this.relationMetadata.joinColumns.reduce(function(K,z){var te=z.referencedColumn.getEntityValueMap(t[i.relationMetadata.propertyName]);return void 0===te?K:ce.s.mergeDeep(K,te)},{}),Object.keys(b).length>0?((n={})[this.propertyName]=b,n):void 0):void 0!==t[this.propertyName]?((r={})[this.propertyName]=t[this.propertyName],r):void 0},o.prototype.getEntityValue=function(t,e){var n=this;if(void 0===e&&(e=!1),null!=t){var r=void 0;if(this.embeddedMetadata){var i=(0,c.ev)([],(0,c.CR)(this.embeddedMetadata.parentPropertyNames)),s=this.embeddedMetadata.isArray,u=function(b,w){var K=b.shift();return K&&w?u(b,w[K]):w},l=u(i,t);l&&(r=this.relationMetadata&&this.referencedColumn?!((f=this.relationMetadata.getEntityValue(l))&&f instanceof Object)||f instanceof sn.J||f instanceof Buffer?!(l[this.propertyName]&&l[this.propertyName]instanceof Object)||l[this.propertyName]instanceof sn.J||l[this.propertyName]instanceof Buffer||l[this.propertyName]instanceof Date?l[this.propertyName]:this.referencedColumn.getEntityValue(l[this.propertyName]):this.referencedColumn.getEntityValue(f):this.referencedColumn?this.referencedColumn.getEntityValue(l[this.propertyName]):s&&Array.isArray(l)?l.map(function(b){return b[n.propertyName]}):l[this.propertyName])}else if(this.relationMetadata&&this.referencedColumn){var f;r=!((f=this.relationMetadata.getEntityValue(t))&&f instanceof Object)||f instanceof sn.J||f instanceof Function||f instanceof Buffer?!(t[this.propertyName]&&t[this.propertyName]instanceof Object)||t[this.propertyName]instanceof sn.J||t[this.propertyName]instanceof Function||t[this.propertyName]instanceof Buffer||t[this.propertyName]instanceof Date?t[this.propertyName]:this.referencedColumn.getEntityValue(t[this.propertyName]):this.referencedColumn.getEntityValue(f)}else r=this.referencedColumn?this.referencedColumn.getEntityValue(t[this.propertyName]):t[this.propertyName];return e&&this.transformer&&(r=Qe.A.transformTo(this.transformer,r)),r}},o.prototype.setEntityValue=function(t,e){var n=this;if(this.embeddedMetadata){var r=function(i,s){var u=i.shift();return u?(s[u.propertyName]||(s[u.propertyName]=u.create()),r(i,s[u.propertyName]),s):(s[n.propertyName]=e,s)};return r((0,c.ev)([],(0,c.CR)(this.embeddedMetadata.embeddedMetadataTree)),t)}!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName?(this.propertyName in t||(t[this.propertyName]={}),t[this.propertyName][this.referencedColumn.propertyName]=e):t[this.propertyName]=e},o.prototype.build=function(t){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(t),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=t.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},o.prototype.buildPropertyPath=function(){var t="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(t=this.embeddedMetadata.parentPropertyNames.join(".")+"."),t+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(t+="."+this.referencedColumn.propertyName),t},o.prototype.buildDatabasePath=function(){var t="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(t=this.embeddedMetadata.parentPropertyNames.join(".")+"."),t+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(t+="."+this.referencedColumn.databaseName),t},o.prototype.buildDatabaseName=function(t){var e=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return t.driver instanceof C.Qd&&(e=[]),t.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,e)},o}(),kt=h(3664),zt=h(7170),Ht=h(2373),ye=function(t,e){this.query=t,this.parameters=e},Bt=h(7529),on=function(){this.upQueries=[],this.downQueries=[]},_n=function(){function o(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new on}return o.prototype.getTable=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return e=this,[4,this.loadTables([t])];case 1:return e.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}})})},o.prototype.getTables=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return t?[3,2]:[4,this.loadTables(t)];case 1:return[2,n.sent()];case 2:return e=this,[4,this.loadTables(t)];case 3:return e.loadedTables=n.sent(),[2,this.loadedTables]}})})},o.prototype.getView=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return e=this,[4,this.loadViews([t])];case 1:return e.loadedViews=n.sent(),[2,this.loadedViews.length>0?this.loadedViews[0]:void 0]}})})},o.prototype.getViews=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return e=this,[4,this.loadViews(t)];case 1:return e.loadedViews=n.sent(),[2,this.loadedViews]}})})},o.prototype.enableSqlMemory=function(){this.sqlInMemory=new on,this.sqlMemoryMode=!0},o.prototype.disableSqlMemory=function(){this.sqlInMemory=new on,this.sqlMemoryMode=!1},o.prototype.clearSqlMemory=function(){this.sqlInMemory=new on},o.prototype.getMemorySql=function(){return this.sqlInMemory},o.prototype.executeMemoryUpSql=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,7]),t=(0,c.XA)(this.sqlInMemory.upQueries),e=t.next(),f.label=1;case 1:return e.done?[3,4]:[4,this.query((n=e.value).query,n.parameters)];case 2:f.sent(),f.label=3;case 3:return e=t.next(),[3,1];case 4:return[3,7];case 5:return s=f.sent(),u={error:s},[3,7];case 6:try{e&&!e.done&&(l=t.return)&&l.call(t)}finally{if(u)throw u.error}return[7];case 7:return[2]}})})},o.prototype.executeMemoryDownSql=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,7]),t=(0,c.XA)(this.sqlInMemory.downQueries.reverse()),e=t.next(),f.label=1;case 1:return e.done?[3,4]:[4,this.query((n=e.value).query,n.parameters)];case 2:f.sent(),f.label=3;case 3:return e=t.next(),[3,1];case 4:return[3,7];case 5:return s=f.sent(),u={error:s},[3,7];case 6:try{e&&!e.done&&(l=t.return)&&l.call(t)}finally{if(u)throw u.error}return[7];case 7:return[2]}})})},o.prototype.getCachedView=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return(e=this.loadedViews.find(function(i){return i.name===t}))?[2,e]:[4,this.loadViews([t])];case 1:if((n=r.sent()).length>0)return this.loadedViews.push(n[0]),[2,n[0]];throw new Se.K('View "'+t+'" does not exist.')}})})},o.prototype.getCachedTable=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return(e=this.loadedTables.find(function(i){return i.name===t}))?[2,e]:[4,this.loadTables([t])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw new Se.K('Table "'+t+'" does not exist.')}})})},o.prototype.replaceCachedTable=function(t,e){var n=this.loadedTables.find(function(r){return r.name===t.name});n&&(n.database=e.database,n.schema=e.schema,n.name=e.name,n.columns=e.columns,n.indices=e.indices,n.foreignKeys=e.foreignKeys,n.uniques=e.uniques,n.checks=e.checks,n.justCreated=e.justCreated,n.engine=e.engine)},o.prototype.getTablePath=function(t){return t instanceof ee.i?t.name:t instanceof zt.U?t.referencedTableName:t instanceof Vt.T?t.tablePath:t},o.prototype.getTypeormMetadataTableName=function(){var t=this.connection.driver.options;return this.connection.driver.buildTableName("typeorm_metadata",t.schema,t.database)},o.prototype.isColumnChanged=function(t,e,n,r){return t.charset!==e.charset||t.collation!==e.collation||t.precision!==e.precision||t.scale!==e.scale||t.width!==e.width||t.zerofill!==e.zerofill||t.unsigned!==e.unsigned||t.asExpression!==e.asExpression||n&&t.default!==e.default||t.onUpdate!==e.onUpdate||t.isNullable!==e.isNullable||r&&t.comment!==e.comment||t.enum!==e.enum},o.prototype.isDefaultColumnLength=function(t,e,n){if(this.connection.hasMetadata(t.name)){var i=this.connection.getMetadata(t.name).findColumnWithDatabaseName(e.name);if(i&&this.connection.driver.getColumnLength(i))return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[e.type]&&this.connection.driver.dataTypeDefaults[e.type].length)&&this.connection.driver.dataTypeDefaults[e.type].length.toString()===n.toString()},o.prototype.isDefaultColumnPrecision=function(t,e,n){if(this.connection.hasMetadata(t.name)){var i=this.connection.getMetadata(t.name).findColumnWithDatabaseName(e.name);if(i&&null!=i.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[e.type]||null==this.connection.driver.dataTypeDefaults[e.type].precision)&&this.connection.driver.dataTypeDefaults[e.type].precision===n},o.prototype.isDefaultColumnScale=function(t,e,n){if(this.connection.hasMetadata(t.name)){var i=this.connection.getMetadata(t.name).findColumnWithDatabaseName(e.name);if(i&&null!=i.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[e.type]||null==this.connection.driver.dataTypeDefaults[e.type].scale)&&this.connection.driver.dataTypeDefaults[e.type].scale===n},o.prototype.executeQueries=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,l,f,b,w,K;return(0,c.Jh)(this,function(z){switch(z.label){case 0:if(t instanceof ye&&(t=[t]),e instanceof ye&&(e=[e]),(f=this.sqlInMemory.upQueries).push.apply(f,(0,c.ev)([],(0,c.CR)(t))),(b=this.sqlInMemory.downQueries).push.apply(b,(0,c.ev)([],(0,c.CR)(e))),!0===this.sqlMemoryMode)return[2,Promise.resolve()];z.label=1;case 1:z.trys.push([1,6,7,8]),n=(0,c.XA)(t),r=n.next(),z.label=2;case 2:return r.done?[3,5]:[4,this.query((i=r.value).query,i.parameters)];case 3:z.sent(),z.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return l=z.sent(),w={error:l},[3,8];case 7:try{r&&!r.done&&(K=n.return)&&K.call(n)}finally{if(w)throw w.error}return[7];case 8:return[2]}})})},o}(),$t=h(6176),Yt=function(o){function t(){return o.call(this)||this}return(0,c.ZT)(t,o),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){switch(i.label){case 0:if(this.isTransactionActive)throw new an.S;if(!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new O.K_("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");return"READ UNCOMMITTED"!==e?[3,2]:[4,this.query("PRAGMA read_uncommitted = true")];case 1:return i.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:i.sent(),i.label=4;case 4:return n=new qe.D,this.broadcaster.broadcastBeforeTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,6];case 5:i.sent(),i.label=6;case 6:return this.isTransactionActive=!0,[4,this.query("BEGIN TRANSACTION")];case 7:return i.sent(),r=new qe.D,this.broadcaster.broadcastAfterTransactionStartEvent(r),r.promises.length>0?[4,Promise.all(r.promises)]:[3,9];case 8:i.sent(),i.label=9;case 9:return[2]}})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.query("COMMIT")];case 3:return r.sent(),this.isTransactionActive=!1,n=new qe.D,this.broadcaster.broadcastAfterTransactionCommitEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return r.sent(),this.isTransactionActive=!1,n=new qe.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.stream=function(e,n,r,i){throw new O.K_("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,Promise.resolve(!1)]})})},t.prototype.getCurrentDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2,Promise.resolve(void 0)]})})},t.prototype.hasSchema=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){throw new O.K_("This driver does not support table schemas")})})},t.prototype.getCurrentSchema=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2,Promise.resolve(void 0)]})})},t.prototype.hasTable=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(s){switch(s.label){case 0:return[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+(e instanceof ee.i?e.name:e)+"'")];case 1:return[2,!!s.sent().length]}})})},t.prototype.hasColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(u){switch(u.label){case 0:return[4,this.query('PRAGMA table_info("'+(e instanceof ee.i?e.name:e)+'")')];case 1:return[2,!!u.sent().find(function(l){return l.name===n})]}})})},t.prototype.createDatabase=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){return[2,Promise.resolve()]})})},t.prototype.dropDatabase=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){return[2,Promise.resolve()]})})},t.prototype.createSchema=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){return[2,Promise.resolve()]})})},t.prototype.dropSchema=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){return[2,Promise.resolve()]})})},t.prototype.createTable=function(e,n,r,i){return void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),(0,c.mG)(this,void 0,void 0,function(){var s,u,f=this;return(0,c.Jh)(this,function(b){switch(b.label){case 0:return s=[],u=[],n?[4,this.hasTable(e)]:[3,2];case 1:if(b.sent())return[2,Promise.resolve()];b.label=2;case 2:return s.push(this.createTableSql(e,r)),u.push(this.dropTableSql(e)),i&&e.indices.forEach(function(w){w.name||(w.name=f.connection.namingStrategy.indexName(e,w.columnNames,w.where)),s.push(f.createIndexSql(e,w)),u.push(f.dropIndexSql(w))}),[4,this.executeQueries(s,u)];case 3:return b.sent(),[2]}})})},t.prototype.dropTable=function(e,n,r,i){return void 0===r&&(r=!0),void 0===i&&(i=!0),(0,c.mG)(this,void 0,void 0,function(){var u,l,f,b,w,K=this;return(0,c.Jh)(this,function(z){switch(z.label){case 0:return n?[4,this.hasTable(e)]:[3,2];case 1:if(!z.sent())return[2,Promise.resolve()];z.label=2;case 2:return u=r,e instanceof ee.i?(f=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:f=z.sent(),z.label=5;case 5:return l=f,b=[],w=[],i&&l.indices.forEach(function(te){b.push(K.dropIndexSql(te)),w.push(K.createIndexSql(l,te))}),b.push(this.dropTableSql(l,n)),w.push(this.createTableSql(l,u)),[4,this.executeQueries(b,w)];case 6:return z.sent(),[2]}})})},t.prototype.createView=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){switch(i.label){case 0:return r=[],(n=[]).push(this.createViewSql(e)),n.push(this.insertViewDefinitionSql(e)),r.push(this.dropViewSql(e)),r.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(n,r)];case 1:return i.sent(),[2]}})})},t.prototype.dropView=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return[4,this.getCachedView(e instanceof Ht.G?e.name:e)];case 1:return r=u.sent(),s=[],(i=[]).push(this.deleteViewDefinitionSql(r)),i.push(this.dropViewSql(r)),s.push(this.insertViewDefinitionSql(r)),s.push(this.createViewSql(r)),[4,this.executeQueries(i,s)];case 2:return u.sent(),[2]}})})},t.prototype.renameTable=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f=this;return(0,c.Jh)(this,function(b){switch(b.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=b.sent(),b.label=3;case 3:return(s=(r=i).clone()).name=n,u=new ye('ALTER TABLE "'+r.name+'" RENAME TO "'+n+'"'),l=new ye('ALTER TABLE "'+n+'" RENAME TO "'+r.name+'"'),[4,this.executeQueries(u,l)];case 4:return b.sent(),r.name=s.name,s.uniques.forEach(function(w){w.name=f.connection.namingStrategy.uniqueConstraintName(s,w.columnNames)}),s.foreignKeys.forEach(function(w){w.name=f.connection.namingStrategy.foreignKeyName(s,w.columnNames,f.getTablePath(w),w.referencedColumnNames)}),s.indices.forEach(function(w){w.name=f.connection.namingStrategy.indexName(s,w.columnNames,w.where)}),[4,this.recreateTable(s,r)];case 5:return b.sent(),[2]}})})},t.prototype.addColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=s.sent(),s.label=3;case 3:return[2,this.addColumns(i,[n])]}})})},t.prototype.addColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.addColumn(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.renameColumn=function(e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(s=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:s=f.sent(),f.label=3;case 3:if(i=s,!(u=n instanceof Mt.D?n:i.columns.find(function(b){return b.name===n})))throw new O.K_('Column "'+n+'" was not found in the "'+i.name+'" table.');return l=void 0,r instanceof Mt.D?l=r:(l=u.clone()).name=r,[2,this.changeColumn(i,u,l)]}})})},t.prototype.changeColumn=function(e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(s=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:s=l.sent(),l.label=3;case 3:if(i=s,!(u=n instanceof Mt.D?n:i.columns.find(function(f){return f.name===n})))throw new O.K_('Column "'+n+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:u,newColumn:r}])];case 4:return l.sent(),[2]}})})},t.prototype.changeColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u=this;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return s=(r=i).clone(),n.forEach(function(f){f.newColumn.name!==f.oldColumn.name&&(s.findColumnUniques(f.oldColumn).forEach(function(w){w.columnNames.splice(w.columnNames.indexOf(f.oldColumn.name),1),w.columnNames.push(f.newColumn.name),w.name=u.connection.namingStrategy.uniqueConstraintName(s,w.columnNames)}),s.findColumnForeignKeys(f.oldColumn).forEach(function(w){w.columnNames.splice(w.columnNames.indexOf(f.oldColumn.name),1),w.columnNames.push(f.newColumn.name),w.name=u.connection.namingStrategy.foreignKeyName(s,w.columnNames,u.getTablePath(w),w.referencedColumnNames)}),s.findColumnIndices(f.oldColumn).forEach(function(w){w.columnNames.splice(w.columnNames.indexOf(f.oldColumn.name),1),w.columnNames.push(f.newColumn.name),w.name=u.connection.namingStrategy.indexName(s,w.columnNames,w.where)}));var b=s.columns.find(function(w){return w.name===f.oldColumn.name});b&&(s.columns[s.columns.indexOf(b)]=f.newColumn)}),[4,this.recreateTable(s,r)];case 4:return l.sent(),[2]}})})},t.prototype.dropColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:if(r=i,!(s=n instanceof Mt.D?n:r.findColumnByName(n)))throw new O.K_('Column "'+n+'" was not found in table "'+r.name+'"');return[4,this.dropColumns(r,[s])];case 4:return u.sent(),[2]}})})},t.prototype.dropColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){var f=l instanceof Mt.D?l:r.findColumnByName(l);if(!f)throw new Error('Column "'+l+'" was not found in table "'+r.name+'"');s.removeColumn(f),s.findColumnUniques(f).forEach(function(b){return s.removeUniqueConstraint(b)}),s.findColumnIndices(f).forEach(function(b){return s.removeIndex(b)}),s.findColumnForeignKeys(f).forEach(function(b){return s.removeForeignKey(b)})}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.createPrimaryKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return(s=(r=i).clone()).columns.forEach(function(l){n.find(function(f){return f===l.name})&&(l.isPrimary=!0)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),r.columns.forEach(function(l){n.find(function(f){return f===l.name})&&(l.isPrimary=!0)}),[2]}})})},t.prototype.updatePrimaryKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.resolve()];case 1:return r.sent(),[2]}})})},t.prototype.dropPrimaryKey=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return e instanceof ee.i?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=s.sent(),s.label=3;case 3:return(i=(n=r).clone()).primaryColumns.forEach(function(u){u.isPrimary=!1}),[4,this.recreateTable(i,n)];case 4:return s.sent(),n.primaryColumns.forEach(function(u){u.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.createUniqueConstraints(e,[n])];case 1:return r.sent(),[2]}})})},t.prototype.createUniqueConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.addUniqueConstraint(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.dropUniqueConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:if(r=i,!(s=n instanceof Bt.v?n:r.uniques.find(function(l){return l.name===n})))throw new O.K_("Supplied unique constraint was not found in table "+r.name);return[4,this.dropUniqueConstraints(r,[s])];case 4:return u.sent(),[2]}})})},t.prototype.dropUniqueConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.removeUniqueConstraint(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.createCheckConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.createCheckConstraints(e,[n])];case 1:return r.sent(),[2]}})})},t.prototype.createCheckConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.addCheckConstraint(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:if(r=i,!(s=n instanceof $t.r?n:r.checks.find(function(l){return l.name===n})))throw new O.K_("Supplied check constraint was not found in table "+r.name);return[4,this.dropCheckConstraints(r,[s])];case 4:return u.sent(),[2]}})})},t.prototype.dropCheckConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.removeCheckConstraint(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){throw new O.K_("Sqlite does not support exclusion constraints.")})})},t.prototype.createExclusionConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){throw new O.K_("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){throw new O.K_("Sqlite does not support exclusion constraints.")})})},t.prototype.dropExclusionConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){throw new O.K_("Sqlite does not support exclusion constraints.")})})},t.prototype.createForeignKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.createForeignKeys(e,[n])];case 1:return r.sent(),[2]}})})},t.prototype.createForeignKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.addForeignKey(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.dropForeignKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:if(r=i,!(s=n instanceof zt.U?n:r.foreignKeys.find(function(l){return l.name===n})))throw new O.K_("Supplied foreign key was not found in table "+r.name);return[4,this.dropForeignKeys(e,[s])];case 4:return u.sent(),[2]}})})},t.prototype.dropForeignKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=u.sent(),u.label=3;case 3:return s=(r=i).clone(),n.forEach(function(l){return s.removeForeignKey(l)}),[4,this.recreateTable(s,r)];case 4:return u.sent(),[2]}})})},t.prototype.createIndex=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.indexName(r,n.columnNames,n.where)),s=this.createIndexSql(r,n),u=this.dropIndexSql(n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addIndex(n),[2]}})})},t.prototype.createIndices=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.createIndex(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.dropIndex=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof kt.s?n:r.indices.find(function(b){return b.name===n})))throw new O.K_("Supplied index was not found in table "+r.name);return u=this.dropIndexSql(s),l=this.createIndexSql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeIndex(s),[2]}})})},t.prototype.dropIndices=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.dropIndex(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.clearTable=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return n.sent(),[2]}})})},t.prototype.clearDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){var n,i,s,l=this;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return f.sent(),[4,this.startTransaction()];case 2:f.sent(),f.label=3;case 3:return f.trys.push([3,9,14,16]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 4:return n=f.sent(),[4,Promise.all(n.map(function(b){return l.query(b.query)}))];case 5:return f.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 6:return i=f.sent(),[4,Promise.all(i.map(function(b){return l.query(b.query)}))];case 7:return f.sent(),[4,this.commitTransaction()];case 8:return f.sent(),[3,16];case 9:s=f.sent(),f.label=10;case 10:return f.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:case 12:return f.sent(),[3,13];case 13:throw s;case 14:return[4,this.query("PRAGMA foreign_keys = ON;")];case 15:return f.sent(),[7];case 16:return[2]}})})},t.prototype.loadViews=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return u.sent()?(e||(e=[]),r=e.map(function(l){return"'"+l+"'"}).join(", "),i='SELECT "t".* FROM "'+this.getTypeormMetadataTableName()+'" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = \'view\' WHERE "t"."type" = \'VIEW\'',r.length>0&&(i+=' AND "t"."name" IN ('+r+")"),[4,this.query(i)]):[2,[]];case 2:return[2,u.sent().map(function(l){var f=new Ht.G;return f.name=l.name,f.expression=l.value,f})]}})})},t.prototype.loadTables=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,i,s,u,l,f,b,w,K,z,te,re,fe=this;return(0,c.Jh)(this,function(de){switch(de.label){case 0:return e&&0===e.length?[2,[]]:(n=[],e?[3,2]:(s=(i=n.push).apply,u=[n],l=[[]],[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\'')]));case 1:return s.apply(i,u.concat([c.ev.apply(void 0,l.concat([c.CR.apply(void 0,[de.sent()])]))])),[3,4];case 2:return f=e.map(function(ue){return"'"+ue+"'"}).join(", "),w=(b=n.push).apply,K=[n],z=[[]],[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+f+")")];case 3:w.apply(b,K.concat([c.ev.apply(void 0,z.concat([c.CR.apply(void 0,[de.sent()])]))])),de.label=4;case 4:return 0===n.length?[2,[]]:(te=n.map(function(ue){return"'"+ue.name+"'"}).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+te+")")]);case 5:return re=de.sent(),[2,Promise.all(n.map(function(ue){return(0,c.mG)(fe,void 0,void 0,function(){var pe,xe,Te,Be,_e,Ze,Re,et,Ue,at,Ye,De,ke,Fe,We,ft,vt,gt,Tt,Ie,mt,Ct=this;return(0,c.Jh)(this,function(Ut){switch(Ut.label){case 0:return(pe=new ee.i).name=ue.name,xe=ue.sql,[4,Promise.all([this.query('PRAGMA table_info("'+ue.name+'")'),this.query('PRAGMA index_list("'+ue.name+'")'),this.query('PRAGMA foreign_key_list("'+ue.name+'")')])];case 1:for(Te=c.CR.apply(void 0,[Ut.sent(),3]),Be=Te[0],_e=Te[1],Ze=Te[2],Re=void 0,-1!==(Ue=(et=ue.sql).toUpperCase().indexOf("AUTOINCREMENT"))&&(Re=et.substr(0,Ue),at=Re.lastIndexOf(","),Ye=Re.lastIndexOf("("),-1!==at?Re=(Re=(Re=Re.substr(at)).substr(0,Re.lastIndexOf('"'))).substr(Re.indexOf('"')+1):-1!==Ye&&(Re=(Re=(Re=Re.substr(Ye)).substr(0,Re.lastIndexOf('"'))).substr(Re.indexOf('"')+1))),pe.columns=Be.map(function(Ve){var Xe=new Mt.D;if(Xe.name=Ve.name,Xe.type=Ve.type.toLowerCase(),Xe.default=null!=Ve.dflt_value?Ve.dflt_value:void 0,Xe.isNullable=0===Ve.notnull,Xe.isPrimary=Ve.pk>0,Xe.comment="",Xe.isGenerated=Re===Ve.name,Xe.isGenerated&&(Xe.generationStrategy="increment"),"varchar"===Xe.type){var ge=xe.match(new RegExp('"('+Xe.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));ge&&(Xe.enum=ge[2].substr(1,ge[2].length-2).split("','"))}var $e=Xe.type.indexOf("(");if(-1!==$e){var we=Xe.type,ut=we.substr(0,$e);if(Ct.driver.withLengthColumnTypes.find(function(dt){return dt===ut})){var bt=parseInt(we.substring($e+1,we.length-1));bt&&(Xe.length=bt.toString(),Xe.type=ut)}if(Ct.driver.withPrecisionColumnTypes.find(function(dt){return dt===ut})){var Et=new RegExp("^"+ut+"\\((\\d+),?\\s?(\\d+)?\\)"),ht=we.match(Et);ht&&ht[1]&&(Xe.precision=+ht[1]),Ct.driver.withScaleColumnTypes.find(function(dt){return dt===ut})&&ht&&ht[2]&&(Xe.scale=+ht[2]),Xe.type=ut}}return Xe}),De=ce.s.uniq(Ze,function(Ve){return Ve.id}),pe.foreignKeys=De.map(function(Ve){var Xe=Ze.filter(function(ut){return ut.id===Ve.id&&ut.table===Ve.table}),ge=Xe.map(function(ut){return ut.from}),$e=Xe.map(function(ut){return ut.to}),we=Ct.connection.namingStrategy.foreignKeyName(pe,ge,Ve.referencedTableName,Ve.referencedColumnNames);return new zt.U({name:we,columnNames:ge,referencedTableName:Ve.table,referencedColumnNames:$e,onDelete:Ve.on_delete,onUpdate:Ve.on_update})}),Fe=[],We=/CONSTRAINT "([^"]*)" UNIQUE \((.*?)\)/g;null!==(ke=We.exec(xe));)Fe.push({name:ke[1],columns:ke[2].substr(1,ke[2].length-2).split('", "')});return ft=_e.filter(function(Ve){return"u"===Ve.origin}).map(function(Ve){return Ve.name}).filter(function(Ve,Xe,ge){return ge.indexOf(Ve)===Xe}).map(function(Ve){return(0,c.mG)(Ct,void 0,void 0,function(){var Xe,ge,$e,we,ut;return(0,c.Jh)(this,function(bt){switch(bt.label){case 0:return Xe=_e.find(function(Et){return Et.name===Ve}),[4,this.query('PRAGMA index_info("'+Xe.name+'")')];case 1:return ge=bt.sent(),1===($e=ge.sort(function(Et,ht){return parseInt(Et.seqno)-parseInt(ht.seqno)}).map(function(Et){return Et.name})).length&&(we=pe.columns.find(function(Et){return!!$e.find(function(ht){return ht===Et.name})}))&&(we.isUnique=!0),ut=Fe.find(function(Et){return Et.columns.every(function(ht){return-1!==$e.indexOf(ht)})}),[2,new Bt.v({name:ut?ut.name:this.connection.namingStrategy.uniqueConstraintName(pe,$e),columnNames:$e})]}})})}),vt=pe,[4,Promise.all(ft)];case 2:for(vt.uniques=Ut.sent(),Tt=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(gt=Tt.exec(xe));)pe.checks.push(new $t.r({name:gt[1],expression:gt[2]}));return Ie=_e.filter(function(Ve){return"c"===Ve.origin}).map(function(Ve){return Ve.name}).filter(function(Ve,Xe,ge){return ge.indexOf(Ve)===Xe}).map(function(Ve){return(0,c.mG)(Ct,void 0,void 0,function(){var Xe,ge,$e,we,ut;return(0,c.Jh)(this,function(Et){switch(Et.label){case 0:return Xe=re.find(function(ht){return ht.name===Ve}),ge=/WHERE (.*)/.exec(Xe.sql),$e=_e.find(function(ht){return ht.name===Ve}),[4,this.query('PRAGMA index_info("'+$e.name+'")')];case 1:return we=Et.sent(),ut=we.sort(function(ht,dt){return parseInt(ht.seqno)-parseInt(dt.seqno)}).map(function(ht){return ht.name}),[2,new kt.s({table:pe,name:$e.name,columnNames:ut,isUnique:"1"===$e.unique||1===$e.unique,where:ge?ge[1]:void 0})]}})})}),[4,Promise.all(Ie)];case 3:return mt=Ut.sent(),pe.indices=mt.filter(function(Ve){return!!Ve}),[2,pe]}})})}))]}})})},t.prototype.createTableSql=function(e,n){var r=this,i=e.columns.filter(function(re){return re.isPrimary}),s=i.find(function(re){return re.isGenerated&&"increment"===re.generationStrategy}),u=i.length>1;if(u&&s)throw new O.K_("Sqlite does not support AUTOINCREMENT on composite primary key");var l=e.columns.map(function(re){return r.buildCreateColumnSql(re,u)}).join(", "),f='CREATE TABLE "'+e.name+'" ('+l;e.columns.filter(function(re){return re.isUnique}).forEach(function(re){e.uniques.some(function(de){return 1===de.columnNames.length&&de.columnNames[0]===re.name})||e.uniques.push(new Bt.v({name:r.connection.namingStrategy.uniqueConstraintName(e,[re.name]),columnNames:[re.name]}))}),e.uniques.length>0&&(f+=", "+e.uniques.map(function(re){return'CONSTRAINT "'+(re.name?re.name:r.connection.namingStrategy.uniqueConstraintName(e,re.columnNames))+'" UNIQUE ('+re.columnNames.map(function(ue){return'"'+ue+'"'}).join(", ")+")"}).join(", ")),e.checks.length>0&&(f+=", "+e.checks.map(function(re){return'CONSTRAINT "'+(re.name?re.name:r.connection.namingStrategy.checkConstraintName(e,re.expression))+'" CHECK ('+re.expression+")"}).join(", ")),e.foreignKeys.length>0&&n&&(f+=", "+e.foreignKeys.map(function(re){var fe=re.columnNames.map(function(pe){return'"'+pe+'"'}).join(", ");re.name||(re.name=r.connection.namingStrategy.foreignKeyName(e,re.columnNames,r.getTablePath(re),re.referencedColumnNames));var de=re.referencedColumnNames.map(function(pe){return'"'+pe+'"'}).join(", "),ue='CONSTRAINT "'+re.name+'" FOREIGN KEY ('+fe+') REFERENCES "'+re.referencedTableName+'" ('+de+")";return re.onDelete&&(ue+=" ON DELETE "+re.onDelete),re.onUpdate&&(ue+=" ON UPDATE "+re.onUpdate),ue}).join(", ")),i.length>1&&(f+=", PRIMARY KEY ("+i.map(function(re){return'"'+re.name+'"'}).join(", ")+")"),f+=")";var te=this.connection.entityMetadatas.find(function(re){return r.getTablePath(e)===r.getTablePath(re)});return te&&te.withoutRowid&&(f+=" WITHOUT ROWID"),new ye(f)},t.prototype.dropTableSql=function(e,n){var r=e instanceof ee.i?e.name:e;return new ye(n?'DROP TABLE IF EXISTS "'+r+'"':'DROP TABLE "'+r+'"')},t.prototype.createViewSql=function(e){return new ye("string"==typeof e.expression?'CREATE VIEW "'+e.name+'" AS '+e.expression:'CREATE VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var n="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),r=(0,c.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:n}).getQueryAndParameters(),2);return new ye(r[0],r[1])},t.prototype.dropViewSql=function(e){return new ye('DROP VIEW "'+(e instanceof Ht.G?e.name:e)+'"')},t.prototype.deleteViewDefinitionSql=function(e){var n=e instanceof Ht.G?e.name:e,r=this.connection.createQueryBuilder(),i=(0,c.CR)(r.delete().from(this.getTypeormMetadataTableName()).where(r.escape("type")+" = 'VIEW'").andWhere(r.escape("name")+" = :name",{name:n}).getQueryAndParameters(),2);return new ye(i[0],i[1])},t.prototype.createIndexSql=function(e,n){var r=n.columnNames.map(function(i){return'"'+i+'"'}).join(", ");return new ye("CREATE "+(n.isUnique?"UNIQUE ":"")+'INDEX "'+n.name+'" ON "'+e.name+'" ('+r+") "+(n.where?"WHERE "+n.where:""))},t.prototype.dropIndexSql=function(e){return new ye('DROP INDEX "'+(e instanceof kt.s?e.name:e)+'"')},t.prototype.buildCreateColumnSql=function(e,n){var r='"'+e.name+'"';return r+=e instanceof wt?" "+this.driver.normalizeType(e):" "+this.connection.driver.createFullType(e),e.enum&&(r+=" CHECK( "+e.name+" IN ("+e.enum.map(function(i){return"'"+i+"'"}).join(",")+") )"),e.isPrimary&&!n&&(r+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(r+=" AUTOINCREMENT"),e.collation&&(r+=" COLLATE "+e.collation),!0!==e.isNullable&&(r+=" NOT NULL"),null!=e.default&&(r+=" DEFAULT ("+e.default+")"),r},t.prototype.recreateTable=function(e,n,r){return void 0===r&&(r=!0),(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l,f=this;return(0,c.Jh)(this,function(b){switch(b.label){case 0:return i=[],s=[],n.indices.forEach(function(w){i.push(f.dropIndexSql(w)),s.push(f.createIndexSql(n,w))}),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),s.push(this.dropTableSql(e)),r&&(u=e.columns.map(function(w){return'"'+w.name+'"'}).join(", "),l=n.columns.map(function(w){return'"'+w.name+'"'}).join(", "),n.columns.length<e.columns.length?u=e.columns.filter(function(w){return n.columns.find(function(K){return K.name===w.name})}).map(function(w){return'"'+w.name+'"'}).join(", "):n.columns.length>e.columns.length&&(l=n.columns.filter(function(w){return e.columns.find(function(K){return K.name===w.name})}).map(function(w){return'"'+w.name+'"'}).join(", ")),i.push(new ye('INSERT INTO "'+e.name+'"('+u+") SELECT "+l+' FROM "'+n.name+'"')),s.push(new ye('INSERT INTO "'+n.name+'"('+l+") SELECT "+u+' FROM "'+e.name+'"'))),i.push(this.dropTableSql(n)),s.push(this.createTableSql(n,!0)),i.push(new ye('ALTER TABLE "'+e.name+'" RENAME TO "'+n.name+'"')),s.push(new ye('ALTER TABLE "'+n.name+'" RENAME TO "'+e.name+'"')),e.name=n.name,e.indices.forEach(function(w){w.name||(w.name=f.connection.namingStrategy.indexName(e,w.columnNames,w.where)),i.push(f.createIndexSql(e,w)),s.push(f.dropIndexSql(w))}),[4,this.executeQueries(i,s)];case 1:return b.sent(),this.replaceCachedTable(n,e),[2]}})})},t}(_n),Kt=function(){function o(t){this.queryRunner=t}return o.prototype.broadcastBeforeInsertEvent=function(t,e,n){var r=this;n&&e.beforeInsertListeners.length&&e.beforeInsertListeners.forEach(function(i){if(i.isAllowed(n)){var s=i.execute(n);s instanceof Promise&&t.promises.push(s),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,e.target)&&i.beforeInsert){var s=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:e});s instanceof Promise&&t.promises.push(s),t.count++}})},o.prototype.broadcastBeforeUpdateEvent=function(t,e,n,r,i,s){var u=this;n&&e.beforeUpdateListeners.length&&e.beforeUpdateListeners.forEach(function(l){if(l.isAllowed(n)){var f=l.execute(n);f instanceof Promise&&t.promises.push(f),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(l){if(u.isAllowedSubscriber(l,e.target)&&l.beforeUpdate){var f=l.beforeUpdate({connection:u.queryRunner.connection,queryRunner:u.queryRunner,manager:u.queryRunner.manager,entity:n,metadata:e,databaseEntity:r,updatedColumns:i||[],updatedRelations:s||[]});f instanceof Promise&&t.promises.push(f),t.count++}})},o.prototype.broadcastBeforeRemoveEvent=function(t,e,n,r){var i=this;n&&e.beforeRemoveListeners.length&&e.beforeRemoveListeners.forEach(function(s){if(s.isAllowed(n)){var u=s.execute(n);u instanceof Promise&&t.promises.push(u),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(i.isAllowedSubscriber(s,e.target)&&s.beforeRemove){var u=s.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:e,databaseEntity:r,entityId:e.getEntityIdMixedMap(r)});u instanceof Promise&&t.promises.push(u),t.count++}})},o.prototype.broadcastAfterInsertEvent=function(t,e,n){var r=this;n&&e.afterInsertListeners.length&&e.afterInsertListeners.forEach(function(i){if(i.isAllowed(n)){var s=i.execute(n);s instanceof Promise&&t.promises.push(s),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(i){if(r.isAllowedSubscriber(i,e.target)&&i.afterInsert){var s=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:e});s instanceof Promise&&t.promises.push(s),t.count++}})},o.prototype.broadcastBeforeTransactionStartEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionStart){var r=n.beforeTransactionStart({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastAfterTransactionStartEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionStart){var r=n.afterTransactionStart({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastBeforeTransactionCommitEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionCommit){var r=n.beforeTransactionCommit({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastAfterTransactionCommitEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionCommit){var r=n.afterTransactionCommit({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastBeforeTransactionRollbackEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.beforeTransactionRollback){var r=n.beforeTransactionRollback({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastAfterTransactionRollbackEvent=function(t){var e=this;this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(n){if(n.afterTransactionRollback){var r=n.afterTransactionRollback({connection:e.queryRunner.connection,queryRunner:e.queryRunner,manager:e.queryRunner.manager});r instanceof Promise&&t.promises.push(r),t.count++}})},o.prototype.broadcastAfterUpdateEvent=function(t,e,n,r,i,s){var u=this;n&&e.afterUpdateListeners.length&&e.afterUpdateListeners.forEach(function(l){if(l.isAllowed(n)){var f=l.execute(n);f instanceof Promise&&t.promises.push(f),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(l){if(u.isAllowedSubscriber(l,e.target)&&l.afterUpdate){var f=l.afterUpdate({connection:u.queryRunner.connection,queryRunner:u.queryRunner,manager:u.queryRunner.manager,entity:n,metadata:e,databaseEntity:r,updatedColumns:i||[],updatedRelations:s||[]});f instanceof Promise&&t.promises.push(f),t.count++}})},o.prototype.broadcastAfterRemoveEvent=function(t,e,n,r){var i=this;n&&e.afterRemoveListeners.length&&e.afterRemoveListeners.forEach(function(s){if(s.isAllowed(n)){var u=s.execute(n);u instanceof Promise&&t.promises.push(u),t.count++}}),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach(function(s){if(i.isAllowedSubscriber(s,e.target)&&s.afterRemove){var u=s.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:e,databaseEntity:r,entityId:e.getEntityIdMixedMap(r)});u instanceof Promise&&t.promises.push(u),t.count++}})},o.prototype.broadcastLoadEventsForAll=function(t,e,n){var r=this;n.forEach(function(i){i instanceof Promise||(e.relations.length&&e.relations.forEach(function(s){if(!s.isLazy||i.hasOwnProperty(s.propertyName)){var u=s.getEntityValue(i);u instanceof Object&&r.broadcastLoadEventsForAll(t,s.inverseEntityMetadata,Array.isArray(u)?u:[u])}}),e.afterLoadListeners.length&&e.afterLoadListeners.forEach(function(s){if(s.isAllowed(i)){var u=s.execute(i);u instanceof Promise&&t.promises.push(u),t.count++}}),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach(function(s){if(r.isAllowedSubscriber(s,e.target)&&s.afterLoad){var u=s.afterLoad(i,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:i,metadata:e});u instanceof Promise&&t.promises.push(u),t.count++}}))})},o.prototype.isAllowedSubscriber=function(t,e){return!t.listenTo||!t.listenTo()||t.listenTo()===Object||t.listenTo()===e||t.listenTo().isPrototypeOf(e)},o}(),Wt=h(4469),Lt=function(){this.records=[]},or=function(o){function t(e){var n=o.call(this)||this;return n.isDirty=!1,n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.flush=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:return this.isDirty?[4,this.driver.autoSave()]:[3,2];case 1:e.sent(),this.isDirty=!1,e.label=2;case 2:return[2]}})})},t.prototype.release=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:return[4,this.flush()];case 1:return e.sent(),[2,o.prototype.release.call(this)]}})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:return[4,o.prototype.commitTransaction.call(this)];case 1:return e.sent(),[4,this.flush()];case 2:return e.sent(),[2]}})})},t.prototype.query=function(e,n,r){var i=this;if(void 0===n&&(n=[]),void 0===r&&(r=!1),this.isReleased)throw new St.Y;var s=e.trim().split(" ",1)[0];return new Promise(function(u,l){return(0,c.mG)(i,void 0,void 0,function(){var f,b,w,K,z,te,re,fe;return(0,c.Jh)(this,function(de){f=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,n,this),b=+new Date;try{for(w=f.prepare(e),n&&(n=n.map(function(ue){return void 0!==ue?ue:null}),w.bind(n)),K=this.driver.options.maxQueryExecutionTime,z=+new Date,te=z-b,K&&te>K&&this.driver.connection.logger.logQuerySlow(te,e,n,this),re=[];w.step();)re.push(w.getAsObject());(fe=new Lt).affected=f.getRowsModified(),fe.records=re,fe.raw=re,w.free(),"SELECT"!==s&&(this.isDirty=!0),u(r?fe:fe.raw)}catch(ue){w&&w.free(),this.driver.connection.logger.logQueryError(ue,e,n,this),l(new Wt.O(e,n,ue))}return[2]})})})},t}(Yt),un=h(7292),qt=h(1482),Bn=function(o){function t(e){var n=o.call(this,e)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new qt.f("location or autoSaveCallback");return n.loadDependencies(),n}return(0,c.ZT)(t,o),t.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=n.sent(),[2]}})})},t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){try{e.queryRunner=void 0,e.databaseConnection.close(),r()}catch(s){i(s)}})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new or(this)),this.queryRunner},t.prototype.load=function(e,n){return void 0===n&&(n=!0),(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:if("string"!=typeof e)return[3,8];if("node"!==A.type)return[3,1];if(A.fileExist(e))return r=A.readFileSync(e),[2,this.createDatabaseConnectionWithImport(r)];if(n)throw new O.K_("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=s.sent(),[3,4];case 3:throw new O.K_("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=A.getGlobalVariable().localStorage.getItem(e),s.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(n)throw new O.K_("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}})})},t.prototype.save=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:if(!e&&!this.options.location)throw new O.K_("No location is set, specify a location parameter or add the location option to your configuration");if(n="",e?n=e:this.options.location&&(n=this.options.location),"node"!==A.type)return[3,5];l.label=1;case 1:return l.trys.push([1,3,,4]),r=Buffer.from(this.databaseConnection.export()),[4,A.writeFile(n,r)];case 2:return l.sent(),[3,4];case 3:throw i=l.sent(),new O.K_("Could not save database, error: "+i);case 4:return[3,10];case 5:return s=this.databaseConnection.export(),u=[].slice.call(s),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(n,JSON.stringify(u))]:[3,7]:[3,9];case 6:return l.sent(),[3,8];case 7:throw new O.K_("localforage is not defined - please import localforage.js into your site");case 8:return[3,10];case 9:A.getGlobalVariable().localStorage.setItem(n,JSON.stringify(u)),l.label=10;case 10:return[2]}})})},t.prototype.autoSave=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},t.prototype.export=function(){return this.databaseConnection.export()},t.prototype.createGeneratedMap=function(e,n){var r=this,i=e.generatedColumns.reduce(function(s,u){if(u.isPrimary&&"increment"===u.generationStrategy){var l="SELECT last_insert_rowid()";try{var f=r.databaseConnection.exec(l);return r.connection.logger.logQuery(l),ce.s.mergeDeep(s,u.createValueMap(f[0].values[0][0]))}catch(b){r.connection.logger.logQueryError(b,l,[])}}return s},{});return Object.keys(i).length>0?i:void 0},t.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},t.prototype.createDatabaseConnectionWithImport=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s=this;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return"function"==typeof this.sqlite.Database?(i=this.sqlite,[3,3]):[3,1];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:i=u.sent(),u.label=3;case 3:return r=i,this.databaseConnection=e&&e.length>0?new r.Database(e):new r.Database,[2,new Promise(function(l,f){try{s.databaseConnection.exec("PRAGMA foreign_keys = ON;"),l(s.databaseConnection)}catch(b){f(b)}})]}})})},t.prototype.loadDependencies=function(){if("browser"===A.type)this.sqlite=window.SQL;else try{this.sqlite=A.load("sql.js")}catch(e){throw new un.z("sql.js","sql.js")}},t}(He.w),ur=function(){function o(){}return o.prototype.create=function(t,e){return t.driver instanceof C.Qd?new C.$2(t):t.driver instanceof Bn?new In(t,e):new Dn(t,e)},o}(),cr=h(4015),lr=function(o){function t(e){var n=o.call(this)||this;return n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i=this;return(0,c.Jh)(this,function(s){if(this.isReleased)throw new St.Y;return[2,new Promise(function(u,l){return(0,c.mG)(i,void 0,void 0,function(){var f,b,w=this;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return[4,this.connect()];case 1:return f=K.sent(),this.driver.connection.logger.logQuery(e,n,this),b=+new Date,f.executeSql(e,n,function(z){var te=w.driver.options.maxQueryExecutionTime,fe=+new Date-b;te&&fe>te&&w.driver.connection.logger.logQuerySlow(fe,e,n,w);var de=new Lt;if("INSERT INTO"===e.substr(0,11))de.raw=z.insertId;else{for(var ue=[],pe=0;pe<z.rows.length;pe++)ue.push(z.rows.item(pe));de.records=ue,de.raw=ue}u(r?de:de.raw)},function(z){w.driver.connection.logger.logQueryError(z,e,n,w),l(new Wt.O(e,n,z))}),[2]}})})})]})})},t.prototype.startTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){throw new O.K_("Transactions are not supported by the Cordova driver")})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){throw new O.K_("Transactions are not supported by the Cordova driver")})})},t.prototype.rollbackTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){throw new O.K_("Transactions are not supported by the Cordova driver")})})},t.prototype.clearDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){var n,i,s=this;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:u.sent(),u.label=2;case 2:return u.trys.push([2,,7,9]),[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 3:return n=u.sent(),[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 4:return i=u.sent(),[4,Promise.all(n.map(function(l){return s.query(l.query)}))];case 5:return u.sent(),[4,Promise.all(i.map(function(l){return s.query(l.query)}))];case 6:return u.sent(),[3,9];case 7:return[4,this.query("PRAGMA foreign_keys = ON;")];case 8:return u.sent(),[7];case 9:return[2]}})})},t.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(r,i){return'"'+r+'"=?'})},t}(Yt),fr=function(o){function t(e){var n=o.call(this,e)||this;if(n.database=n.options.database,!n.options.database)throw new qt.f("database");if(!n.options.location)throw new qt.f("location");return n.loadDependencies(),n}return(0,c.ZT)(t,o),t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){e.queryRunner=void 0,e.databaseConnection.close(r,i)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new lr(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(n,r){var i=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(i,function(s){var u=s;u.executeSql("PRAGMA foreign_keys = ON;",[],function(l){n(u)},function(l){r(l)})},function(s){r(s)})})},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new un.z("Cordova-SQLite","cordova-sqlite-storage")}},t}(He.w),hr=function(o){function t(e){var n=o.call(this)||this;return n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.query=function(e,n,r){var i=this;if(void 0===r&&(r=!1),this.isReleased)throw new St.Y;return new Promise(function(s,u){return(0,c.mG)(i,void 0,void 0,function(){var l,f,b=this;return(0,c.Jh)(this,function(w){switch(w.label){case 0:return[4,this.connect()];case 1:return l=w.sent(),this.driver.connection.logger.logQuery(e,n,this),f=+new Date,l.executeSql(e,n,function(K){var z=b.driver.options.maxQueryExecutionTime,re=+new Date-f;z&&re>z&&b.driver.connection.logger.logQuerySlow(re,e,n,b);var fe=new Lt;if("INSERT INTO"===e.substr(0,11)&&(fe.raw=K.insertId),(null==K?void 0:K.hasOwnProperty("rowsAffected"))&&(fe.affected=K.rowsAffected),null==K?void 0:K.hasOwnProperty("rows")){for(var de=[],ue=0;ue<K.rows.length;ue++)de.push(K.rows.item(ue));fe.raw=de,fe.records=de}s(r?fe:fe.raw)},function(K){b.driver.connection.logger.logQueryError(K,e,n,b),u(new Wt.O(e,n,K))}),[2]}})})})},t.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(r,i){return'"'+r+'"=?'})},t}(Yt),dr=function(o){function t(e){var n=o.call(this,e)||this;if(n.database=n.options.database,!n.options.database)throw new qt.f("database");if(!n.options.location)throw new qt.f("location");return n.loadDependencies(),n}return(0,c.ZT)(t,o),t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){e.queryRunner=void 0,e.databaseConnection.close(r,i)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new hr(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(n,r){var i=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(i,function(s){var u=s;u.executeSql("PRAGMA foreign_keys = ON;",[],function(l){n(u)},function(l){r(l)})},function(s){r(s)})})},t.prototype.loadDependencies=function(){try{this.sqlite=h(2748)}catch(e){throw new un.z("React-Native","react-native-sqlite-storage")}},t}(He.w),pr=function(o){function t(e){var n=o.call(this)||this;return n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i,s=this;return(0,c.Jh)(this,function(u){if(this.isReleased)throw new St.Y;return i=this.driver.connection,[2,new Promise(function(l,f){var b="INSERT INTO"===e.substr(0,11),w=function(z,te){var re=this.driver.options.maxQueryExecutionTime,de=+new Date-K;if(re&&de>re&&i.logger.logQuerySlow(de,e,n,this),z)i.logger.logQueryError(z,e,n,this),f(new Wt.O(e,n,z));else{var ue=new Lt;ue.raw=te,!b&&Array.isArray(te)&&(ue.records=te),l(r?ue:ue.raw)}};s.driver.connection.logger.logQuery(e,n,s);var K=+new Date;s.connect().then(function(z){b?z.execSQL(e,n,w):z.all(e,n,w)})})]})})},t.prototype.parametrize=function(e,n){return void 0===n&&(n=0),Object.keys(e).map(function(r,i){return'"'+r+'"=?'})},t}(Yt),mr=function(o){function t(e){var n=o.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new qt.f("database");return n.loadDependencies(),n}return(0,c.ZT)(t,o),t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){e.queryRunner=void 0,e.databaseConnection.close().then(r).catch(i)})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new pr(this)),this.queryRunner},t.prototype.normalizeType=function(e){return e.type===Buffer?"blob":o.prototype.normalizeType.call(this,e)},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(n,r){var i=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,i,function(s,u){if(s)return r(s);u.resultType(e.sqlite.RESULTSASOBJECT),u.execSQL("PRAGMA foreign_keys = ON;",[],function(l,f){if(l)return r(l);n(u)})})})},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new un.z("Nativescript","nativescript-sqlite")},t}(He.w),yr=function(o){function t(e){var n=o.call(this)||this;return n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.startTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(this.isTransactionActive&&void 0!==this.transaction)throw new an.S;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionStartEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.isTransactionActive=!0,n=new qe.D,this.broadcaster.broadcastAfterTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,n=new qe.D,this.broadcaster.broadcastAfterTransactionCommitEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive&&void 0===this.transaction)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.isTransactionActive=!1,this.transaction=void 0,n=new qe.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i=this;return(0,c.Jh)(this,function(s){if(this.isReleased)throw new St.Y;return[2,new Promise(function(u,l){return(0,c.mG)(i,void 0,void 0,function(){var f,b,w=this;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return[4,this.connect()];case 1:return f=K.sent(),this.driver.connection.logger.logQuery(e,n,this),b=+new Date,f.transaction(function(z){void 0===w.transaction&&(w.startTransaction(),w.transaction=z),w.transaction.executeSql(e,n,function(te,re){var fe=w.driver.options.maxQueryExecutionTime,ue=+new Date-b;fe&&ue>fe&&w.driver.connection.logger.logQuerySlow(ue,e,n,w);var pe=new Lt;if("INSERT INTO"===e.substr(0,11)&&(pe.raw=re.insertId),(null==re?void 0:re.hasOwnProperty("rowsAffected"))&&(pe.affected=re.rowsAffected),null==re?void 0:re.hasOwnProperty("rows")){for(var xe=[],Te=0;Te<re.rows.length;Te++)xe.push(re.rows.item(Te));pe.raw=xe,pe.records=xe}u(r?pe:pe.raw)},function(te,re){w.driver.connection.logger.logQueryError(re,e,n,w),l(new Wt.O(e,n,re))})},function(z){w.rollbackTransaction()},function(){w.isTransactionActive=!1,w.transaction=void 0}),[2]}})})})]})})},t}(Yt),vr=function(o){function t(e){var n=o.call(this,e)||this;if(n.database=n.options.database,!n.options.database)throw new qt.f("database");if(!n.options.driver)throw new qt.f("driver");return n.sqlite=n.options.driver,n}return(0,c.ZT)(t,o),t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,r()}catch(s){i(s)}})]})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new yr(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise(function(n,r){try{var i=e.sqlite.openDatabase(e.options.database);i.transaction(function(s){s.executeSql("PRAGMA foreign_keys = ON;",[],function(u,l){n(i)},function(u,l){r({transaction:u,error:l})})},function(s){r(s)})}catch(s){r(s)}})},t}(He.w),vn=h(890),gr=function(){function o(){}return o.isGreaterOrEqual=function(t,e){var n=Un(t),r=Un(e);return n[0]>r[0]||n[0]===r[0]&&n[1]>r[1]||n[0]===r[0]&&n[1]===r[1]&&n[2]>=r[2]},o}();function Un(o){void 0===o&&(o="");var t=[0,0,0];return o.split(".").forEach(function(e,n){return t[n]=parseInt(e,10)}),t}var Tr=function(o){function t(e,n,r){var i=o.call(this,e,r)||this;return i.client=n,i}return(0,c.ZT)(t,o),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||(this.databaseConnectionPromise="slave"===this.mode&&this.driver.isReplicated?this.driver.obtainSlaveConnection().then(function(n){var r=(0,c.CR)(n,2),i=r[0],s=r[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=s,e.databaseConnection}):this.driver.obtainMasterConnection().then(function(n){var r=(0,c.CR)(n,2),i=r[0],s=r[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=s,e.databaseConnection})),this.databaseConnectionPromise)},t.prototype.startTransaction=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){switch(i.label){case 0:if(this.isTransactionActive)throw new an.S;return n=new qe.D,this.broadcaster.broadcastBeforeTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.isTransactionActive=!0,[4,this.client.startTransaction()];case 3:return i.sent(),r=new qe.D,this.broadcaster.broadcastAfterTransactionStartEvent(r),r.promises.length>0?[4,Promise.all(r.promises)]:[3,5];case 4:i.sent(),i.label=5;case 5:return[2]}})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.client.commitTransaction()];case 3:return r.sent(),this.isTransactionActive=!1,n=new qe.D,this.broadcaster.broadcastAfterTransactionCommitEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.client.rollbackTransaction()];case 3:return r.sent(),n=new qe.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:if(this.isReleased)throw new St.Y;return[4,this.client.query(e,n)];case 1:return i=u.sent(),(s=new Lt).raw=i,(null==i?void 0:i.hasOwnProperty("records"))&&Array.isArray(i.records)&&(s.records=i.records),(null==i?void 0:i.hasOwnProperty("numberOfRecordsUpdated"))&&(s.affected=i.numberOfRecordsUpdated),r?[2,s]:[2,s.raw]}})})},t}(function(o){function t(e,n){return o.call(this,e,n)||this}return(0,c.ZT)(t,o),t}(function(o){function t(e,n){var r=o.call(this)||this;return r.driver=e,r.connection=e.connection,r.mode=n,r.broadcaster=new Kt(r),r}return(0,c.ZT)(t,o),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||(this.databaseConnectionPromise="slave"===this.mode&&this.driver.isReplicated?this.driver.obtainSlaveConnection().then(function(n){var r=(0,c.CR)(n,2),i=r[0],s=r[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var u=function(l){return e.releasePostgresConnection(l)};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",u),s()},e.databaseConnection.on("error",u),e.databaseConnection}):this.driver.obtainMasterConnection().then(function(n){var r=(0,c.CR)(n,2),i=r[0],s=r[1];e.driver.connectedQueryRunners.push(e),e.databaseConnection=i;var u=function(l){return e.releasePostgresConnection(l)};return e.releaseCallback=function(){e.databaseConnection.removeListener("error",u),s()},e.databaseConnection.on("error",u),e.databaseConnection})),this.databaseConnectionPromise)},t.prototype.releasePostgresConnection=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n;return(0,c.Jh)(this,function(r){return this.isReleased||(this.isReleased=!0,this.releaseCallback&&(this.releaseCallback(e),this.releaseCallback=void 0),-1!==(n=this.driver.connectedQueryRunners.indexOf(this))&&this.driver.connectedQueryRunners.splice(n,1)),[2]})})},t.prototype.release=function(){return this.releasePostgresConnection()},t.prototype.startTransaction=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(i){switch(i.label){case 0:if(this.isTransactionActive)throw new an.S;return n=new qe.D,this.broadcaster.broadcastBeforeTransactionStartEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,2];case 1:i.sent(),i.label=2;case 2:return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 3:return i.sent(),e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)]:[3,5];case 4:i.sent(),i.label=5;case 5:return r=new qe.D,this.broadcaster.broadcastAfterTransactionStartEvent(r),r.promises.length>0?[4,Promise.all(r.promises)]:[3,7];case 6:i.sent(),i.label=7;case 7:return[2]}})})},t.prototype.commitTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionCommitEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.query("COMMIT")];case 3:return r.sent(),this.isTransactionActive=!1,n=new qe.D,this.broadcaster.broadcastAfterTransactionCommitEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.rollbackTransaction=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isTransactionActive)throw new Ft.W;return e=new qe.D,this.broadcaster.broadcastBeforeTransactionRollbackEvent(e),e.promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,this.query("ROLLBACK")];case 3:return r.sent(),this.isTransactionActive=!1,n=new qe.D,this.broadcaster.broadcastAfterTransactionRollbackEvent(n),n.promises.length>0?[4,Promise.all(n.promises)]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l,f,b,w,K;return(0,c.Jh)(this,function(z){switch(z.label){case 0:if(this.isReleased)throw new St.Y;return[4,this.connect()];case 1:i=z.sent(),this.driver.connection.logger.logQuery(e,n,this),z.label=2;case 2:return z.trys.push([2,4,,5]),s=+new Date,[4,i.query(e,n)];case 3:switch(u=z.sent(),l=this.driver.options.maxQueryExecutionTime,f=+new Date,b=f-s,l&&b>l&&this.driver.connection.logger.logQuerySlow(b,e,n,this),w=new Lt,(null==u?void 0:u.hasOwnProperty("rows"))&&(w.records=u.rows),(null==u?void 0:u.hasOwnProperty("rowCount"))&&(w.affected=u.rowCount),u.command){case"DELETE":case"UPDATE":w.raw=[u.rows,u.rowCount];break;default:w.raw=u.rows}return r?[2,w]:[2,w.raw];case 4:throw K=z.sent(),this.driver.connection.logger.logQueryError(K,e,n,this),new Wt.O(e,n,K);case 5:return[2]}})})},t.prototype.stream=function(e,n,r,i){var s=this,u=this.driver.loadStreamDependency();if(this.isReleased)throw new St.Y;return new Promise(function(l,f){return(0,c.mG)(s,void 0,void 0,function(){var b,w,K;return(0,c.Jh)(this,function(z){switch(z.label){case 0:return z.trys.push([0,2,,3]),[4,this.connect()];case 1:return b=z.sent(),this.driver.connection.logger.logQuery(e,n,this),w=b.query(new u(e,n)),r&&w.on("end",r),i&&w.on("error",i),l(w),[3,3];case 2:return K=z.sent(),f(K),[3,3];case 3:return[2]}})})})},t.prototype.getDatabases=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2,Promise.resolve([])]})})},t.prototype.getSchemas=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,Promise.resolve([])]})})},t.prototype.hasDatabase=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.query("SELECT * FROM pg_database WHERE datname='"+e+"';")];case 1:return[2,!!r.sent().length]}})})},t.prototype.getCurrentDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT * FROM current_database()")];case 1:return[2,n.sent()[0].current_database]}})})},t.prototype.hasSchema=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,this.query('SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = \''+e+"'")];case 1:return[2,!!r.sent().length]}})})},t.prototype.getCurrentSchema=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return[2,n.sent()[0].current_schema]}})})},t.prototype.hasTable=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return(n=this.driver.parseTableName(e)).schema?[3,2]:(r=n,[4,this.getCurrentSchema()]);case 1:r.schema=u.sent(),u.label=2;case 2:return[4,this.query('SELECT * FROM "information_schema"."tables" WHERE "table_schema" = \''+n.schema+"' AND \"table_name\" = '"+n.tableName+"'")];case 3:return[2,!!u.sent().length]}})})},t.prototype.hasColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return(r=this.driver.parseTableName(e)).schema?[3,2]:(i=r,[4,this.getCurrentSchema()]);case 1:i.schema=l.sent(),l.label=2;case 2:return[4,this.query('SELECT * FROM "information_schema"."columns" WHERE "table_schema" = \''+r.schema+"' AND \"table_name\" = '"+r.tableName+"' AND \"column_name\" = '"+n+"'")];case 3:return[2,!!l.sent().length]}})})},t.prototype.createDatabase=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return n?[4,this.hasDatabase(e)]:[3,2];case 1:if(u.sent())return[2,Promise.resolve()];u.label=2;case 2:return s='DROP DATABASE "'+e+'"',[4,this.executeQueries(new ye('CREATE DATABASE "'+e+'"'),new ye(s))];case 3:return u.sent(),[2]}})})},t.prototype.dropDatabase=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(new ye(n?'DROP DATABASE IF EXISTS "'+e+'"':'DROP DATABASE "'+e+'"'),new ye(i))];case 1:return s.sent(),[2]}})})},t.prototype.createSchema=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return r=-1===e.indexOf(".")?e:e.split(".")[1],s='DROP SCHEMA "'+r+'" CASCADE',[4,this.executeQueries(new ye(n?'CREATE SCHEMA IF NOT EXISTS "'+r+'"':'CREATE SCHEMA "'+r+'"'),new ye(s))];case 1:return u.sent(),[2]}})})},t.prototype.dropSchema=function(e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[1],u='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new ye(n?'DROP SCHEMA IF EXISTS "'+i+'" '+(r?"CASCADE":""):'DROP SCHEMA "'+i+'" '+(r?"CASCADE":"")),new ye(u))];case 1:return l.sent(),[2]}})})},t.prototype.createTable=function(e,n,r,i){return void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===i&&(i=!0),(0,c.mG)(this,void 0,void 0,function(){var u,l,f,b,w,K,z,te,re,fe,de,ue,pe=this;return(0,c.Jh)(this,function(xe){switch(xe.label){case 0:return n?[4,this.hasTable(e)]:[3,2];case 1:if(xe.sent())return[2,Promise.resolve()];xe.label=2;case 2:u=[],l=[],f=e.columns.filter(function(Te){return"enum"===Te.type||"simple-enum"===Te.type}),b=[],xe.label=3;case 3:xe.trys.push([3,8,9,10]),w=(0,c.XA)(f),K=w.next(),xe.label=4;case 4:return K.done?[3,7]:[4,this.hasEnumType(e,z=K.value)];case 5:te=xe.sent(),re=this.buildEnumName(e,z),!te&&-1===b.indexOf(re)&&(b.push(re),u.push(this.createEnumTypeSql(e,z,re)),l.push(this.dropEnumTypeSql(e,z,re))),xe.label=6;case 6:return K=w.next(),[3,4];case 7:return[3,10];case 8:return fe=xe.sent(),de={error:fe},[3,10];case 9:try{K&&!K.done&&(ue=w.return)&&ue.call(w)}finally{if(de)throw de.error}return[7];case 10:return u.push(this.createTableSql(e,r)),l.push(this.dropTableSql(e)),r&&e.foreignKeys.forEach(function(Te){return l.push(pe.dropForeignKeySql(e,Te))}),i&&e.indices.forEach(function(Te){Te.name||(Te.name=pe.connection.namingStrategy.indexName(e,Te.columnNames,Te.where)),u.push(pe.createIndexSql(e,Te)),l.push(pe.dropIndexSql(e,Te))}),[4,this.executeQueries(u,l)];case 11:return xe.sent(),[2]}})})},t.prototype.dropTable=function(e,n,r,i){return void 0===r&&(r=!0),void 0===i&&(i=!0),(0,c.mG)(this,void 0,void 0,function(){var u,l,f,b,w,K=this;return(0,c.Jh)(this,function(z){switch(z.label){case 0:return n?[4,this.hasTable(e)]:[3,2];case 1:if(!z.sent())return[2,Promise.resolve()];z.label=2;case 2:return u=r,l=this.getTablePath(e),[4,this.getCachedTable(l)];case 3:return f=z.sent(),b=[],w=[],i&&f.indices.forEach(function(te){b.push(K.dropIndexSql(f,te)),w.push(K.createIndexSql(f,te))}),r&&f.foreignKeys.forEach(function(te){return b.push(K.dropForeignKeySql(f,te))}),b.push(this.dropTableSql(f)),w.push(this.createTableSql(f,u)),[4,this.executeQueries(b,w)];case 4:return z.sent(),[2]}})})},t.prototype.createView=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return r=[],(n=[]).push(this.createViewSql(e)),s=(i=n).push,[4,this.insertViewDefinitionSql(e)];case 1:return s.apply(i,[f.sent()]),r.push(this.dropViewSql(e)),l=(u=r).push,[4,this.deleteViewDefinitionSql(e)];case 2:return l.apply(u,[f.sent()]),[4,this.executeQueries(n,r)];case 3:return f.sent(),[2]}})})},t.prototype.dropView=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f,b;return(0,c.Jh)(this,function(w){switch(w.label){case 0:return[4,this.getCachedView(e instanceof Ht.G?e.name:e)];case 1:return r=w.sent(),s=[],l=(u=i=[]).push,[4,this.deleteViewDefinitionSql(r)];case 2:return l.apply(u,[w.sent()]),i.push(this.dropViewSql(r)),b=(f=s).push,[4,this.insertViewDefinitionSql(r)];case 3:return b.apply(f,[w.sent()]),s.push(this.createViewSql(r)),[4,this.executeQueries(i,s)];case 4:return w.sent(),[2]}})})},t.prototype.renameTable=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f,b,w,K,z,te,re,fe,de,ue,pe,xe,Te,Be,_e=this;return(0,c.Jh)(this,function(Ze){switch(Ze.label){case 0:return r=[],i=[],e instanceof ee.i?(u=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:u=Ze.sent(),Ze.label=3;case 3:l=(s=u).clone(),f=this.driver.parseTableName(s),w=f.tableName,l.name=(b=f.schema)?b+"."+n:n,r.push(new ye("ALTER TABLE "+this.escapePath(s)+' RENAME TO "'+n+'"')),i.push(new ye("ALTER TABLE "+this.escapePath(l)+' RENAME TO "'+w+'"')),l.primaryColumns.length>0&&(K=l.primaryColumns.map(function(Re){return Re.name}),z=this.connection.namingStrategy.primaryKeyName(s,K),te=this.connection.namingStrategy.primaryKeyName(l,K),r.push(new ye("ALTER TABLE "+this.escapePath(l)+' RENAME CONSTRAINT "'+z+'" TO "'+te+'"')),i.push(new ye("ALTER TABLE "+this.escapePath(l)+' RENAME CONSTRAINT "'+te+'" TO "'+z+'"'))),l.columns.map(function(Re){if(Re.isGenerated&&"increment"===Re.generationStrategy){var et=_e.buildSequencePath(s,Re.name),Ue=_e.buildSequenceName(s,Re.name),at=_e.buildSequencePath(l,Re.name),Ye=_e.buildSequenceName(l,Re.name),De="ALTER SEQUENCE "+_e.escapePath(et)+' RENAME TO "'+Ye+'"',ke="ALTER SEQUENCE "+_e.escapePath(at)+' RENAME TO "'+Ue+'"';r.push(new ye(De)),i.push(new ye(ke))}}),l.uniques.forEach(function(Re){var et=_e.connection.namingStrategy.uniqueConstraintName(l,Re.columnNames);r.push(new ye("ALTER TABLE "+_e.escapePath(l)+' RENAME CONSTRAINT "'+Re.name+'" TO "'+et+'"')),i.push(new ye("ALTER TABLE "+_e.escapePath(l)+' RENAME CONSTRAINT "'+et+'" TO "'+Re.name+'"')),Re.name=et}),l.indices.forEach(function(Re){var et=_e.driver.parseTableName(l).schema,Ue=_e.connection.namingStrategy.indexName(l,Re.columnNames,Re.where),Ye=et?'ALTER INDEX "'+et+'"."'+Ue+'" RENAME TO "'+Re.name+'"':'ALTER INDEX "'+Ue+'" RENAME TO "'+Re.name+'"';r.push(new ye(et?'ALTER INDEX "'+et+'"."'+Re.name+'" RENAME TO "'+Ue+'"':'ALTER INDEX "'+Re.name+'" RENAME TO "'+Ue+'"')),i.push(new ye(Ye)),Re.name=Ue}),l.foreignKeys.forEach(function(Re){var et=_e.connection.namingStrategy.foreignKeyName(l,Re.columnNames,_e.getTablePath(Re),Re.referencedColumnNames);r.push(new ye("ALTER TABLE "+_e.escapePath(l)+' RENAME CONSTRAINT "'+Re.name+'" TO "'+et+'"')),i.push(new ye("ALTER TABLE "+_e.escapePath(l)+' RENAME CONSTRAINT "'+et+'" TO "'+Re.name+'"')),Re.name=et}),re=l.columns.filter(function(Re){return"enum"===Re.type||"simple-enum"===Re.type}),Ze.label=4;case 4:Ze.trys.push([4,9,10,11]),fe=(0,c.XA)(re),de=fe.next(),Ze.label=5;case 5:return de.done?[3,8]:(ue=de.value).enumName?[3,7]:[4,this.getUserDefinedTypeName(s,ue)];case 6:pe=Ze.sent(),r.push(new ye('ALTER TYPE "'+pe.schema+'"."'+pe.name+'" RENAME TO '+this.buildEnumName(l,ue,!1))),i.push(new ye("ALTER TYPE "+this.buildEnumName(l,ue)+' RENAME TO "'+pe.name+'"')),Ze.label=7;case 7:return de=fe.next(),[3,5];case 8:return[3,11];case 9:return xe=Ze.sent(),Te={error:xe},[3,11];case 10:try{de&&!de.done&&(Be=fe.return)&&Be.call(fe)}finally{if(Te)throw Te.error}return[7];case 11:return[4,this.executeQueries(r,i)];case 12:return Ze.sent(),[2]}})})},t.prototype.addColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,b,w,K,z,te,re,fe;return(0,c.Jh)(this,function(de){switch(de.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=de.sent(),de.label=3;case 3:return s=(r=i).clone(),u=[],l=[],"enum"===n.type||"simple-enum"===n.type?[4,this.hasEnumType(r,n)]:[3,5];case 4:de.sent()||(u.push(this.createEnumTypeSql(r,n)),l.push(this.dropEnumTypeSql(r,n))),de.label=5;case 5:return u.push(new ye("ALTER TABLE "+this.escapePath(r)+" ADD "+this.buildCreateColumnSql(r,n))),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP COLUMN "'+n.name+'"')),n.isPrimary&&((b=s.primaryColumns).length>0&&(w=this.connection.namingStrategy.primaryKeyName(s,b.map(function(ue){return ue.name})),K=b.map(function(ue){return'"'+ue.name+'"'}).join(", "),u.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP CONSTRAINT "'+w+'"')),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+K+")"))),b.push(n),z=this.connection.namingStrategy.primaryKeyName(s,b.map(function(ue){return ue.name})),te=b.map(function(ue){return'"'+ue.name+'"'}).join(", "),u.push(new ye("ALTER TABLE "+this.escapePath(r)+' ADD CONSTRAINT "'+z+'" PRIMARY KEY ('+te+")")),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP CONSTRAINT "'+z+'"'))),(re=s.indices.find(function(ue){return 1===ue.columnNames.length&&ue.columnNames[0]===n.name}))&&(u.push(this.createIndexSql(r,re)),l.push(this.dropIndexSql(r,re))),n.isUnique&&(fe=new Bt.v({name:this.connection.namingStrategy.uniqueConstraintName(r,[n.name]),columnNames:[n.name]}),s.uniques.push(fe),u.push(new ye("ALTER TABLE "+this.escapePath(r)+' ADD CONSTRAINT "'+fe.name+'" UNIQUE ("'+n.name+'")')),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP CONSTRAINT "'+fe.name+'"'))),n.comment&&(u.push(new ye("COMMENT ON COLUMN "+this.escapePath(r)+'."'+n.name+'" IS '+this.escapeComment(n.comment))),l.push(new ye("COMMENT ON COLUMN "+this.escapePath(r)+'."'+n.name+'" IS '+this.escapeComment(n.comment)))),[4,this.executeQueries(u,l)];case 6:return de.sent(),s.addColumn(n),this.replaceCachedTable(r,s),[2]}})})},t.prototype.addColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.addColumn(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.renameColumn=function(e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(s=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:s=f.sent(),f.label=3;case 3:if(i=s,!(u=n instanceof Mt.D?n:i.columns.find(function(b){return b.name===n})))throw new O.K_('Column "'+n+'" was not found in the "'+i.name+'" table.');return r instanceof Mt.D?l=r:(l=u.clone()).name=r,[2,this.changeColumn(i,u,l)]}})})},t.prototype.changeColumn=function(e,n,r){return(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l,f,b,w,K,re,fe,de,ue,pe,xe,Te,Be,_e,Ze,Re,et,Ue,at,Ye,De,ke,z,ft,Fe,te,vt,gt=this;return(0,c.Jh)(this,function(Tt){switch(Tt.label){case 0:return e instanceof ee.i?(s=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:s=Tt.sent(),Tt.label=3;case 3:if(u=(i=s).clone(),l=[],f=[],b=!1,!(w=n instanceof Mt.D?n:i.columns.find(function(Ie){return Ie.name===n})))throw new O.K_('Column "'+n+'" was not found in the "'+i.name+'" table.');return w.type!==r.type||w.length!==r.length||r.isArray!==w.isArray?[4,this.dropColumn(i,w)]:[3,6];case 4:return Tt.sent(),[4,this.addColumn(i,r)];case 5:return Tt.sent(),u=i.clone(),[3,10];case 6:return w.name===r.name?[3,9]:(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+w.name+'" TO "'+r.name+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+r.name+'" TO "'+w.name+'"')),"enum"===w.type||"simple-enum"===w.type?[4,this.getUserDefinedTypeName(i,w)]:[3,8]);case 7:K=Tt.sent(),l.push(new ye('ALTER TYPE "'+K.schema+'"."'+K.name+'" RENAME TO '+this.buildEnumName(i,r,!1))),f.push(new ye("ALTER TYPE "+this.buildEnumName(i,r)+' RENAME TO "'+K.name+'"')),Tt.label=8;case 8:!0===w.isPrimary&&(te=(z=u.primaryColumns).map(function(Ie){return Ie.name}),re=this.connection.namingStrategy.primaryKeyName(u,te),te.splice(te.indexOf(w.name),1),te.push(r.name),fe=this.connection.namingStrategy.primaryKeyName(u,te),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+re+'" TO "'+fe+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+fe+'" TO "'+re+'"'))),!0===w.isGenerated&&"increment"===r.generationStrategy&&(de=this.buildSequencePath(i,w.name),ue=this.buildSequenceName(i,w.name),pe=this.buildSequencePath(i,r.name),xe=this.buildSequenceName(i,r.name),Te="ALTER SEQUENCE "+this.escapePath(de)+' RENAME TO "'+xe+'"',Be="ALTER SEQUENCE "+this.escapePath(pe)+' RENAME TO "'+ue+'"',l.push(new ye(Te)),f.push(new ye(Be))),u.findColumnUniques(w).forEach(function(Ie){Ie.columnNames.splice(Ie.columnNames.indexOf(w.name),1),Ie.columnNames.push(r.name);var mt=gt.connection.namingStrategy.uniqueConstraintName(u,Ie.columnNames);l.push(new ye("ALTER TABLE "+gt.escapePath(i)+' RENAME CONSTRAINT "'+Ie.name+'" TO "'+mt+'"')),f.push(new ye("ALTER TABLE "+gt.escapePath(i)+' RENAME CONSTRAINT "'+mt+'" TO "'+Ie.name+'"')),Ie.name=mt}),u.findColumnIndices(w).forEach(function(Ie){Ie.columnNames.splice(Ie.columnNames.indexOf(w.name),1),Ie.columnNames.push(r.name);var mt=gt.driver.parseTableName(i).schema,Ct=gt.connection.namingStrategy.indexName(u,Ie.columnNames,Ie.where),Ve=mt?'ALTER INDEX "'+mt+'"."'+Ct+'" RENAME TO "'+Ie.name+'"':'ALTER INDEX "'+Ct+'" RENAME TO "'+Ie.name+'"';l.push(new ye(mt?'ALTER INDEX "'+mt+'"."'+Ie.name+'" RENAME TO "'+Ct+'"':'ALTER INDEX "'+Ie.name+'" RENAME TO "'+Ct+'"')),f.push(new ye(Ve)),Ie.name=Ct}),u.findColumnForeignKeys(w).forEach(function(Ie){Ie.columnNames.splice(Ie.columnNames.indexOf(w.name),1),Ie.columnNames.push(r.name);var mt=gt.connection.namingStrategy.foreignKeyName(u,Ie.columnNames,gt.getTablePath(Ie),Ie.referencedColumnNames);l.push(new ye("ALTER TABLE "+gt.escapePath(i)+' RENAME CONSTRAINT "'+Ie.name+'" TO "'+mt+'"')),f.push(new ye("ALTER TABLE "+gt.escapePath(i)+' RENAME CONSTRAINT "'+mt+'" TO "'+Ie.name+'"')),Ie.name=mt}),_e=u.columns.find(function(Ie){return Ie.name===w.name}),u.columns[u.columns.indexOf(_e)].name=r.name,w.name=r.name,Tt.label=9;case 9:(r.precision!==w.precision||r.scale!==w.scale)&&(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+this.driver.createFullType(r))),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+this.driver.createFullType(w)))),("enum"===r.type||"simple-enum"===r.type)&&("enum"===w.type||"simple-enum"===w.type)&&(!ce.s.isArraysEqual(r.enum,w.enum)||r.enumName!==w.enumName)&&(Ze=r.isArray?"[]":"",Re=this.buildEnumName(i,r),et=this.buildEnumName(i,w),Ue=this.buildEnumName(i,w,!1),at=this.buildEnumName(i,w,!0,!1,!0),Ye=this.buildEnumName(i,w,!1,!1,!0),l.push(new ye("ALTER TYPE "+et+" RENAME TO "+Ye)),f.push(new ye("ALTER TYPE "+at+" RENAME TO "+Ue)),l.push(this.createEnumTypeSql(i,r,Re)),f.push(this.dropEnumTypeSql(i,r,Re)),null!=w.default&&(b=!0,l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" DROP DEFAULT')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" SET DEFAULT '+w.default))),De=""+Re+Ze+' USING "'+r.name+'"::"text"::'+Re+Ze,ke=""+at+Ze+' USING "'+r.name+'"::"text"::'+at+Ze,l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+De)),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+ke)),null!=r.default&&(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" SET DEFAULT '+r.default)),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT'))),l.push(this.dropEnumTypeSql(i,w,at)),f.push(this.createEnumTypeSql(i,w,at))),w.isNullable!==r.isNullable&&(r.isNullable?(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" DROP NOT NULL')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" SET NOT NULL'))):(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" SET NOT NULL')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+w.name+'" DROP NOT NULL')))),w.comment!==r.comment&&(l.push(new ye("COMMENT ON COLUMN "+this.escapePath(i)+'."'+w.name+'" IS '+this.escapeComment(r.comment))),f.push(new ye("COMMENT ON COLUMN "+this.escapePath(i)+'."'+r.name+'" IS '+this.escapeComment(w.comment)))),r.isPrimary!==w.isPrimary&&((z=u.primaryColumns).length>0&&(Fe=this.connection.namingStrategy.primaryKeyName(u,z.map(function(Ie){return Ie.name})),te=z.map(function(Ie){return'"'+Ie.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+Fe+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+Fe+'" PRIMARY KEY ('+te+")"))),!0===r.isPrimary?(z.push(r),u.columns.find(function(Ie){return Ie.name===r.name}).isPrimary=!0,Fe=this.connection.namingStrategy.primaryKeyName(u,z.map(function(Ie){return Ie.name})),te=z.map(function(Ie){return'"'+Ie.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+Fe+'" PRIMARY KEY ('+te+")")),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+Fe+'"'))):(ft=z.find(function(Ie){return Ie.name===r.name}),z.splice(z.indexOf(ft),1),u.columns.find(function(Ie){return Ie.name===r.name}).isPrimary=!1,z.length>0&&(Fe=this.connection.namingStrategy.primaryKeyName(u,z.map(function(Ie){return Ie.name})),te=z.map(function(Ie){return'"'+Ie.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+Fe+'" PRIMARY KEY ('+te+")")),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+Fe+'"'))))),r.isUnique!==w.isUnique&&(!0===r.isUnique?(vt=new Bt.v({name:this.connection.namingStrategy.uniqueConstraintName(i,[r.name]),columnNames:[r.name]}),u.uniques.push(vt),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+vt.name+'" UNIQUE ("'+r.name+'")')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+vt.name+'"'))):(vt=u.uniques.find(function(Ie){return 1===Ie.columnNames.length&&!!Ie.columnNames.find(function(mt){return mt===r.name})}),u.uniques.splice(u.uniques.indexOf(vt),1),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+vt.name+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+vt.name+'" UNIQUE ("'+r.name+'")')))),w.isGenerated!==r.isGenerated&&"uuid"!==r.generationStrategy&&(!0===r.isGenerated?(l.push(new ye("CREATE SEQUENCE IF NOT EXISTS "+this.escapePath(this.buildSequencePath(i,r))+" OWNED BY "+this.escapePath(i)+'."'+r.name+'"')),f.push(new ye("DROP SEQUENCE "+this.escapePath(this.buildSequencePath(i,r)))),l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+"\" SET DEFAULT nextval('"+this.escapePath(this.buildSequencePath(i,r))+"')")),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT'))):(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+"\" SET DEFAULT nextval('"+this.escapePath(this.buildSequencePath(i,r))+"')")),l.push(new ye("DROP SEQUENCE "+this.escapePath(this.buildSequencePath(i,r)))),f.push(new ye("CREATE SEQUENCE IF NOT EXISTS "+this.escapePath(this.buildSequencePath(i,r))+" OWNED BY "+this.escapePath(i)+'."'+r.name+'"')))),r.default!==w.default&&!b&&(null!=r.default?(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" SET DEFAULT '+r.default)),f.push(new ye(null!=w.default?"ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" SET DEFAULT '+w.default:"ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT'))):null!=w.default&&(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" DROP DEFAULT')),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" SET DEFAULT '+w.default)))),((r.spatialFeatureType||"").toLowerCase()!==(w.spatialFeatureType||"").toLowerCase()||r.srid!==w.srid)&&(l.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+this.driver.createFullType(r))),f.push(new ye("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+r.name+'" TYPE '+this.driver.createFullType(w)))),Tt.label=10;case 10:return[4,this.executeQueries(l,f)];case 11:return Tt.sent(),this.replaceCachedTable(i,u),[2]}})})},t.prototype.changeColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,f,b,w;return(0,c.Jh)(this,function(K){switch(K.label){case 0:K.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),K.label=1;case 1:return i.done?[3,4]:[4,this.changeColumn(e,(s=i.value).oldColumn,s.newColumn)];case 2:K.sent(),K.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return f=K.sent(),b={error:f},[3,7];case 6:try{i&&!i.done&&(w=r.return)&&w.call(r)}finally{if(b)throw b.error}return[7];case 7:return[2]}})})},t.prototype.dropColumn=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f,b,w,z,te,re,fe,de,pe,xe;return(0,c.Jh)(this,function(Te){switch(Te.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=Te.sent(),Te.label=3;case 3:if(r=i,!(s=n instanceof Mt.D?n:r.findColumnByName(n)))throw new O.K_('Column "'+n+'" was not found in table "'+r.name+'"');return u=r.clone(),l=[],f=[],s.isPrimary&&(b=this.connection.namingStrategy.primaryKeyName(u,u.primaryColumns.map(function(Be){return Be.name})),w=u.primaryColumns.map(function(Be){return'"'+Be.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(u)+' DROP CONSTRAINT "'+b+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(u)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+w+")")),u.findColumnByName(s.name).isPrimary=!1,u.primaryColumns.length>0&&(z=this.connection.namingStrategy.primaryKeyName(u,u.primaryColumns.map(function(Be){return Be.name})),te=u.primaryColumns.map(function(Be){return'"'+Be.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(u)+' ADD CONSTRAINT "'+z+'" PRIMARY KEY ('+te+")")),f.push(new ye("ALTER TABLE "+this.escapePath(u)+' DROP CONSTRAINT "'+z+'"')))),(re=u.indices.find(function(Be){return 1===Be.columnNames.length&&Be.columnNames[0]===s.name}))&&(u.indices.splice(u.indices.indexOf(re),1),l.push(this.dropIndexSql(r,re)),f.push(this.createIndexSql(r,re))),(fe=u.checks.find(function(Be){return!!Be.columnNames&&1===Be.columnNames.length&&Be.columnNames[0]===s.name}))&&(u.checks.splice(u.checks.indexOf(fe),1),l.push(this.dropCheckConstraintSql(r,fe)),f.push(this.createCheckConstraintSql(r,fe))),(de=u.uniques.find(function(Be){return 1===Be.columnNames.length&&Be.columnNames[0]===s.name}))&&(u.uniques.splice(u.uniques.indexOf(de),1),l.push(this.dropUniqueConstraintSql(r,de)),f.push(this.createUniqueConstraintSql(r,de))),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP COLUMN "'+s.name+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(r)+" ADD "+this.buildCreateColumnSql(r,s))),"enum"===s.type||"simple-enum"===s.type?[4,this.hasEnumType(r,s)]:[3,6];case 4:return Te.sent()?[4,this.getUserDefinedTypeName(r,s)]:[3,6];case 5:pe=Te.sent(),l.push(this.dropEnumTypeSql(r,s,xe='"'+pe.schema+'"."'+pe.name+'"')),f.push(this.createEnumTypeSql(r,s,xe)),Te.label=6;case 6:return[4,this.executeQueries(l,f)];case 7:return Te.sent(),u.removeColumn(s),this.replaceCachedTable(r,u),[2]}})})},t.prototype.dropColumns=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.dropColumn(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.createPrimaryKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:return s=(r=i).clone(),u=this.createPrimaryKeySql(r,n),s.columns.forEach(function(b){n.find(function(w){return w===b.name})&&(b.isPrimary=!0)}),l=this.dropPrimaryKeySql(s),[4,this.executeQueries(u,l)];case 4:return f.sent(),this.replaceCachedTable(r,s),[2]}})})},t.prototype.updatePrimaryKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l,f,b,w,K,z,te;return(0,c.Jh)(this,function(re){switch(re.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=re.sent(),re.label=3;case 3:return s=(r=i).clone(),u=n.map(function(fe){return fe.name}),l=[],f=[],(b=s.primaryColumns).length>0&&(w=this.connection.namingStrategy.primaryKeyName(s,b.map(function(fe){return fe.name})),K=b.map(function(fe){return'"'+fe.name+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP CONSTRAINT "'+w+'"')),f.push(new ye("ALTER TABLE "+this.escapePath(r)+' ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+K+")"))),s.columns.filter(function(fe){return-1!==u.indexOf(fe.name)}).forEach(function(fe){return fe.isPrimary=!0}),z=this.connection.namingStrategy.primaryKeyName(s,u),te=u.map(function(fe){return'"'+fe+'"'}).join(", "),l.push(new ye("ALTER TABLE "+this.escapePath(r)+' ADD CONSTRAINT "'+z+'" PRIMARY KEY ('+te+")")),f.push(new ye("ALTER TABLE "+this.escapePath(r)+' DROP CONSTRAINT "'+z+'"')),[4,this.executeQueries(l,f)];case 4:return re.sent(),this.replaceCachedTable(r,s),[2]}})})},t.prototype.dropPrimaryKey=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s;return(0,c.Jh)(this,function(u){switch(u.label){case 0:return e instanceof ee.i?(r=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:r=u.sent(),u.label=3;case 3:return i=this.dropPrimaryKeySql(n=r),s=this.createPrimaryKeySql(n,n.primaryColumns.map(function(l){return l.name})),[4,this.executeQueries(i,s)];case 4:return u.sent(),n.primaryColumns.forEach(function(l){l.isPrimary=!1}),[2]}})})},t.prototype.createUniqueConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.uniqueConstraintName(r,n.columnNames)),s=this.createUniqueConstraintSql(r,n),u=this.dropUniqueConstraintSql(r,n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addUniqueConstraint(n),[2]}})})},t.prototype.createUniqueConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.createUniqueConstraint(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.dropUniqueConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof Bt.v?n:r.uniques.find(function(b){return b.name===n})))throw new O.K_("Supplied unique constraint was not found in table "+r.name);return u=this.dropUniqueConstraintSql(r,s),l=this.createUniqueConstraintSql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeUniqueConstraint(s),[2]}})})},t.prototype.dropUniqueConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.dropUniqueConstraint(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.createCheckConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.checkConstraintName(r,n.expression)),s=this.createCheckConstraintSql(r,n),u=this.dropCheckConstraintSql(r,n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addCheckConstraint(n),[2]}})})},t.prototype.createCheckConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.createCheckConstraint(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.dropCheckConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof $t.r?n:r.checks.find(function(b){return b.name===n})))throw new O.K_("Supplied check constraint was not found in table "+r.name);return u=this.dropCheckConstraintSql(r,s),l=this.createCheckConstraintSql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeCheckConstraint(s),[2]}})})},t.prototype.dropCheckConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.dropCheckConstraint(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.createExclusionConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.exclusionConstraintName(r,n.expression)),s=this.createExclusionConstraintSql(r,n),u=this.dropExclusionConstraintSql(r,n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addExclusionConstraint(n),[2]}})})},t.prototype.createExclusionConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.createExclusionConstraint(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.dropExclusionConstraint=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof vn.N?n:r.exclusions.find(function(b){return b.name===n})))throw new O.K_("Supplied exclusion constraint was not found in table "+r.name);return u=this.dropExclusionConstraintSql(r,s),l=this.createExclusionConstraintSql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeExclusionConstraint(s),[2]}})})},t.prototype.dropExclusionConstraints=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return r=n.map(function(u){return i.dropExclusionConstraint(e,u)}),[4,Promise.all(r)];case 1:return s.sent(),[2]}})})},t.prototype.createForeignKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.foreignKeyName(r,n.columnNames,this.getTablePath(n),n.referencedColumnNames)),s=this.createForeignKeySql(r,n),u=this.dropForeignKeySql(r,n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addForeignKey(n),[2]}})})},t.prototype.createForeignKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.createForeignKey(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.dropForeignKey=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof zt.U?n:r.foreignKeys.find(function(b){return b.name===n})))throw new O.K_("Supplied foreign key was not found in table "+r.name);return u=this.dropForeignKeySql(r,s),l=this.createForeignKeySql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeForeignKey(s),[2]}})})},t.prototype.dropForeignKeys=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.dropForeignKey(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.createIndex=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=l.sent(),l.label=3;case 3:return r=i,n.name||(n.name=this.connection.namingStrategy.indexName(r,n.columnNames,n.where)),s=this.createIndexSql(r,n),u=this.dropIndexSql(r,n),[4,this.executeQueries(s,u)];case 4:return l.sent(),r.addIndex(n),[2]}})})},t.prototype.createIndices=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.createIndex(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.dropIndex=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return e instanceof ee.i?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=f.sent(),f.label=3;case 3:if(r=i,!(s=n instanceof kt.s?n:r.indices.find(function(b){return b.name===n})))throw new O.K_("Supplied index was not found in table "+r.name);return u=this.dropIndexSql(r,s),l=this.createIndexSql(r,s),[4,this.executeQueries(u,l)];case 4:return f.sent(),r.removeIndex(s),[2]}})})},t.prototype.dropIndices=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:b.trys.push([0,5,6,7]),r=(0,c.XA)(n),i=r.next(),b.label=1;case 1:return i.done?[3,4]:[4,this.dropIndex(e,i.value)];case 2:b.sent(),b.label=3;case 3:return i=r.next(),[3,1];case 4:return[3,7];case 5:return u=b.sent(),l={error:u},[3,7];case 6:try{i&&!i.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 7:return[2]}})})},t.prototype.clearTable=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return n.sent(),[2]}})})},t.prototype.clearDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,n,r,s,l,b,w,z=this;return(0,c.Jh)(this,function(te){switch(te.label){case 0:return e=[],this.connection.entityMetadatas.filter(function(re){return re.schema}).forEach(function(re){e.find(function(de){return de===re.schema})||e.push(re.schema)}),e.push(this.driver.options.schema||"current_schema()"),n=e.map(function(re){return"current_schema()"===re?re:"'"+re+"'"}).join(", "),[4,this.startTransaction()];case 1:te.sent(),te.label=2;case 2:return te.trys.push([2,13,,18]),[4,this.getVersion()];case 3:return r=te.sent(),[4,this.query('SELECT \'DROP VIEW IF EXISTS "\' || schemaname || \'"."\' || viewname || \'" CASCADE;\' as "query" FROM "pg_views" WHERE "schemaname" IN ('+n+") AND \"viewname\" NOT IN ('geography_columns', 'geometry_columns', 'raster_columns', 'raster_overviews')")];case 4:return s=te.sent(),[4,Promise.all(s.map(function(re){return z.query(re.query)}))];case 5:return te.sent(),gr.isGreaterOrEqual(r,"9.3")?[4,this.query('SELECT \'DROP MATERIALIZED VIEW IF EXISTS "\' || schemaname || \'"."\' || matviewname || \'" CASCADE;\' as "query" FROM "pg_matviews" WHERE "schemaname" IN ('+n+")")]:[3,8];case 6:return l=te.sent(),[4,Promise.all(l.map(function(re){return z.query(re.query)}))];case 7:te.sent(),te.label=8;case 8:return[4,this.query('SELECT \'DROP TABLE IF EXISTS "\' || schemaname || \'"."\' || tablename || \'" CASCADE;\' as "query" FROM "pg_tables" WHERE "schemaname" IN ('+n+") AND \"tablename\" NOT IN ('spatial_ref_sys')")];case 9:return b=te.sent(),[4,Promise.all(b.map(function(re){return z.query(re.query)}))];case 10:return te.sent(),[4,this.dropEnumTypes(n)];case 11:return te.sent(),[4,this.commitTransaction()];case 12:return te.sent(),[3,18];case 13:w=te.sent(),te.label=14;case 14:return te.trys.push([14,16,,17]),[4,this.rollbackTransaction()];case 15:case 16:return te.sent(),[3,17];case 17:throw w;case 18:return[2]}})})},t.prototype.loadViews=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,f=this;return(0,c.Jh)(this,function(b){switch(b.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return b.sent()?(e||(e=[]),[4,this.getCurrentDatabase()]):[2,[]];case 2:return r=b.sent(),[4,this.getCurrentSchema()];case 3:return i=b.sent(),s=0===e.length?"1=1":e.map(function(w){return f.driver.parseTableName(w)}).map(function(w){var K=w.schema;return K||(K=f.driver.options.schema||i),'("t"."schema" = \''+K+'\' AND "t"."name" = \''+w.tableName+"')"}).join(" OR "),u='SELECT "t".* FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" INNER JOIN "pg_catalog"."pg_class" "c" ON "c"."relname" = "t"."name" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "c"."relnamespace" AND "n"."nspname" = "t"."schema" WHERE "t"."type" IN (\'VIEW\', \'MATERIALIZED_VIEW\') '+(s?"AND ("+s+")":""),[4,this.query(u)];case 4:return[2,b.sent().map(function(w){var K=new Ht.G,z=w.schema!==i||f.driver.options.schema?w.schema:void 0;return K.database=r,K.schema=w.schema,K.name=f.driver.buildTableName(w.name,z),K.expression=w.value,K.materialized="MATERIALIZED_VIEW"===w.type,K})]}})})},t.prototype.loadTables=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,u,l,f,b,w,K,z,te,re,fe,de,ue,pe,xe,Te,Be,Ze,Re,et,Ue,at,Ye,De=this;return(0,c.Jh)(this,function(ke){switch(ke.label){case 0:return e&&0===e.length?[2,[]]:[4,this.getCurrentSchema()];case 1:return n=ke.sent(),[4,this.getCurrentDatabase()];case 2:return r=ke.sent(),i=[],e?[3,4]:(l=(u=i.push).apply,f=[i],b=[[]],[4,this.query('SELECT "table_schema", "table_name" FROM "information_schema"."tables"')]);case 3:return l.apply(u,f.concat([c.ev.apply(void 0,b.concat([c.CR.apply(void 0,[ke.sent()])]))])),[3,6];case 4:return w=e.map(function(Fe){return De.driver.parseTableName(Fe)}).map(function(Fe){return'("table_schema" = \''+(Fe.schema||n)+"' AND \"table_name\" = '"+Fe.tableName+"')"}).join(" OR "),z=(K=i.push).apply,te=[i],re=[[]],[4,this.query('SELECT "table_schema", "table_name" FROM "information_schema"."tables" WHERE '+w)];case 5:z.apply(K,te.concat([c.ev.apply(void 0,re.concat([c.CR.apply(void 0,[ke.sent()])]))])),ke.label=6;case 6:return 0===i.length?[2,[]]:(fe=i.map(function(Fe){return'("table_schema" = \''+Fe.table_schema+"' AND \"table_name\" = '"+Fe.table_name+"')"}).join(" OR "),de='SELECT columns.*, pg_catalog.col_description((\'"\' || table_catalog || \'"."\' || table_schema || \'"."\' || table_name || \'"\')::regclass::oid, ordinal_position) AS description, (\'"\' || "udt_schema" || \'"."\' || "udt_name" || \'"\')::"regtype" AS "regtype", pg_catalog.format_type("col_attr"."atttypid", "col_attr"."atttypmod") AS "format_type" FROM "information_schema"."columns" LEFT JOIN "pg_catalog"."pg_attribute" AS "col_attr" ON "col_attr"."attname" = "columns"."column_name" AND "col_attr"."attrelid" = ( SELECT "cls"."oid" FROM "pg_catalog"."pg_class" AS "cls" LEFT JOIN "pg_catalog"."pg_namespace" AS "ns" ON "ns"."oid" = "cls"."relnamespace" WHERE "cls"."relname" = "columns"."table_name" AND "ns"."nspname" = "columns"."table_schema" ) WHERE '+fe,ue=i.map(function(Fe){return'("ns"."nspname" = \''+Fe.table_schema+'\' AND "t"."relname" = \''+Fe.table_name+"')"}).join(" OR "),pe='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN \'p\' THEN \'PRIMARY\' WHEN \'u\' THEN \'UNIQUE\' WHEN \'c\' THEN \'CHECK\' WHEN \'x\' THEN \'EXCLUDE\' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" IN (\'r\', \'p\') AND ('+ue+")",xe='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN \'t\' THEN \'TRUE\' ELSE\'FALSE\' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" IN (\'r\', \'p\') AND "cnst"."contype" IS NULL AND ('+ue+")",Te=i.map(function(Fe){return'("ns"."nspname" = \''+Fe.table_schema+'\' AND "cl"."relname" = \''+Fe.table_name+"')"}).join(" OR "),[4,this.hasSupportForPartitionedTables()]);case 7:return Be=ke.sent(),Ze='SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update", "con"."condeferrable" AS "deferrable", "con"."condeferred" AS "deferred" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", "con1"."condeferrable", CASE WHEN "con1"."condeferred" THEN \'INITIALLY DEFERRED\' ELSE \'INITIALLY IMMEDIATE\' END as condeferred, CASE "con1"."confdeltype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confdeltype", CASE "con1"."confupdtype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = \'f\' AND ('+Te+') ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" '+(Be?' AND "cl"."relispartition" = \'f\'':"")+'INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"',[4,Promise.all([this.query(de),this.query(pe),this.query(xe),this.query(Ze)])];case 8:return Re=c.CR.apply(void 0,[ke.sent(),4]),et=Re[0],Ue=Re[1],at=Re[2],Ye=Re[3],[2,Promise.all(i.map(function(Fe){return(0,c.mG)(De,void 0,void 0,function(){var We,ft,vt,gt,Tt,Ie,mt,Ct,Ut,Ve=this;return(0,c.Jh)(this,function(Xe){switch(Xe.label){case 0:return We=new ee.i,vt=(ft=function(ge,$e){return ge[$e]!==n||Ve.driver.options.schema&&Ve.driver.options.schema!==n?ge[$e]:void 0})(Fe,"table_schema"),We.database=r,We.schema=Fe.table_schema,We.name=this.driver.buildTableName(Fe.table_name,vt),gt=We,[4,Promise.all(et.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema}).map(function(ge){return(0,c.mG)(Ve,void 0,void 0,function(){var $e,we,ut,bt,Et,zn,dt,nn,Rn,pn,Xn,$n,er,xn;return(0,c.Jh)(this,function(jt){switch(jt.label){case 0:return $e=Ue.filter(function(At){return At.table_name===ge.table_name&&At.table_schema===ge.table_schema&&At.column_name===ge.column_name}),(we=new Mt.D).name=ge.column_name,we.type=ge.regtype.toLowerCase(),("numeric"===we.type||"decimal"===we.type||"float"===we.type)&&(null===ge.numeric_precision||this.isDefaultColumnPrecision(We,we,ge.numeric_precision)?null!==ge.numeric_scale&&!this.isDefaultColumnScale(We,we,ge.numeric_scale)&&(we.precision=void 0):we.precision=ge.numeric_precision,null===ge.numeric_scale||this.isDefaultColumnScale(We,we,ge.numeric_scale)?null!==ge.numeric_precision&&!this.isDefaultColumnPrecision(We,we,ge.numeric_precision)&&(we.scale=void 0):we.scale=ge.numeric_scale),("interval"===we.type||"time without time zone"===we.type||"time with time zone"===we.type||"timestamp without time zone"===we.type||"timestamp with time zone"===we.type)&&(we.precision=this.isDefaultColumnPrecision(We,we,ge.datetime_precision)?void 0:ge.datetime_precision),"USER-DEFINED"===ge.data_type||"ARRAY"===ge.data_type?[4,this.getUserDefinedTypeName(We,we)]:[3,3];case 1:return ut=jt.sent().name,bt=this.buildEnumName(We,we,!1,!0),[4,this.query('SELECT "e"."enumlabel" AS "value" FROM "pg_enum" "e" INNER JOIN "pg_type" "t" ON "t"."oid" = "e"."enumtypid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = \''+Fe.table_schema+'\' AND "t"."typname" = \''+((Et=bt!==ut?ut:void 0)||ut)+"'")];case 2:(dt=jt.sent()).length&&(we.type="enum",we.enum=dt.map(function(At){return At.value}),we.enumName=Et),"ARRAY"===ge.data_type&&(we.isArray=!0,zn=we.type.replace("[]",""),we.type=this.connection.driver.normalizeType({type:zn})),jt.label=3;case 3:return"geometry"!==we.type?[3,5]:[4,this.query('SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geometry_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geometry_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = \''+ge.column_name+"' AND\n                          \"table_schema\" = '"+ge.table_schema+"' AND\n                          \"table_name\" = '"+ge.table_name+"'")];case 4:(dt=jt.sent()).length>0&&(we.spatialFeatureType=dt[0].type,we.srid=dt[0].srid),jt.label=5;case 5:return"geography"!==we.type?[3,7]:[4,this.query('SELECT * FROM (\n                        SELECT\n                          "f_table_schema" "table_schema",\n                          "f_table_name" "table_name",\n                          "f_geography_column" "column_name",\n                          "srid",\n                          "type"\n                        FROM "geography_columns"\n                      ) AS _\n                      WHERE\n                          "column_name" = \''+ge.column_name+"' AND\n                          \"table_schema\" = '"+ge.table_schema+"' AND\n                          \"table_name\" = '"+ge.table_name+"'")];case 6:(dt=jt.sent()).length>0&&(we.spatialFeatureType=dt[0].type,we.srid=dt[0].srid),jt.label=7;case 7:return-1!==this.driver.withLengthColumnTypes.indexOf(we.type)&&(we.isArray?(Rn=/\((\d+)\)/.exec(ge.format_type),nn=Rn?Rn[1]:void 0):ge.character_maximum_length&&(nn=ge.character_maximum_length.toString()),nn&&(we.length=this.isDefaultColumnLength(We,we,nn)?"":nn)),we.isNullable="YES"===ge.is_nullable,we.isPrimary=!!$e.find(function(At){return"PRIMARY"===At.constraint_type}),pn=$e.find(function(At){return"UNIQUE"===At.constraint_type}),Xn=!!pn&&!!Ue.find(function(At){return"UNIQUE"===At.constraint_type&&At.constraint_name===pn.constraint_name&&At.column_name!==ge.column_name}),we.isUnique=!!pn&&!Xn,null!=ge.column_default&&($n="nextval('"+this.buildSequenceName(We,ge.column_name)+"'::regclass)",er="nextval('"+this.buildSequencePath(We,ge.column_name)+"'::regclass)",(xn=ge.column_default.replace(/"/g,""))===$n||xn===er?(we.isGenerated=!0,we.generationStrategy="increment"):"gen_random_uuid()"===ge.column_default||/^uuid_generate_v\d\(\)/.test(ge.column_default)?(we.isGenerated=!0,we.generationStrategy="uuid"):"now()"===ge.column_default||-1!==ge.column_default.indexOf("'now'::text")?we.default=ge.column_default:(we.default=ge.column_default.replace(/::[\w\s\[\]\"]+/g,""),we.default=we.default.replace(/^(-?\d+)$/,"'$1'"))),we.comment=ge.description?ge.description:void 0,ge.character_set_name&&(we.charset=ge.character_set_name),ge.collation_name&&(we.collation=ge.collation_name),[2,we]}})})}))];case 1:return gt.columns=Xe.sent(),Tt=ce.s.uniq(Ue.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema&&"UNIQUE"===ge.constraint_type}),function(ge){return ge.constraint_name}),We.uniques=Tt.map(function(ge){var $e=Ue.filter(function(we){return we.constraint_name===ge.constraint_name});return new Bt.v({name:ge.constraint_name,columnNames:$e.map(function(we){return we.column_name})})}),Ie=ce.s.uniq(Ue.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema&&"CHECK"===ge.constraint_type}),function(ge){return ge.constraint_name}),We.checks=Ie.map(function(ge){var $e=Ue.filter(function(we){return we.constraint_name===ge.constraint_name});return new $t.r({name:ge.constraint_name,columnNames:$e.map(function(we){return we.column_name}),expression:ge.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})}),mt=ce.s.uniq(Ue.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema&&"EXCLUDE"===ge.constraint_type}),function(ge){return ge.constraint_name}),We.exclusions=mt.map(function(ge){return new vn.N({name:ge.constraint_name,expression:ge.expression.substring(8)})}),Ct=ce.s.uniq(Ye.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema}),function(ge){return ge.constraint_name}),We.foreignKeys=Ct.map(function(ge){var $e=Ye.filter(function(bt){return bt.constraint_name===ge.constraint_name}),we=ft(ge,"referenced_table_schema"),ut=Ve.driver.buildTableName(ge.referenced_table_name,we);return new zt.U({name:ge.constraint_name,columnNames:$e.map(function(bt){return bt.column_name}),referencedTableName:ut,referencedColumnNames:$e.map(function(bt){return bt.referenced_column_name}),onDelete:ge.on_delete,onUpdate:ge.on_update,deferrable:ge.deferrable?ge.deferred:void 0})}),Ut=ce.s.uniq(at.filter(function(ge){return ge.table_name===Fe.table_name&&ge.table_schema===Fe.table_schema}),function(ge){return ge.constraint_name}),We.indices=Ut.map(function(ge){var $e=at.filter(function(we){return we.table_schema===ge.table_schema&&we.table_name===ge.table_name&&we.constraint_name===ge.constraint_name});return new kt.s({table:We,name:ge.constraint_name,columnNames:$e.map(function(we){return we.column_name}),isUnique:"TRUE"===ge.is_unique,where:ge.condition,isSpatial:$e.every(function(we){return Ve.driver.spatialTypes.indexOf(we.type_name)>=0}),isFulltext:!1})}),[2,We]}})})}))]}})})},t.prototype.createTableSql=function(e,n){var r=this,i=e.columns.map(function(te){return r.buildCreateColumnSql(e,te)}).join(", "),s="CREATE TABLE "+this.escapePath(e)+" ("+i;if(e.columns.filter(function(te){return te.isUnique}).forEach(function(te){e.uniques.some(function(fe){return 1===fe.columnNames.length&&fe.columnNames[0]===te.name})||e.uniques.push(new Bt.v({name:r.connection.namingStrategy.uniqueConstraintName(e,[te.name]),columnNames:[te.name]}))}),e.uniques.length>0){var u=e.uniques.map(function(te){return'CONSTRAINT "'+(te.name?te.name:r.connection.namingStrategy.uniqueConstraintName(e,te.columnNames))+'" UNIQUE ('+te.columnNames.map(function(de){return'"'+de+'"'}).join(", ")+")"}).join(", ");s+=", "+u}if(e.checks.length>0){var l=e.checks.map(function(te){return'CONSTRAINT "'+(te.name?te.name:r.connection.namingStrategy.checkConstraintName(e,te.expression))+'" CHECK ('+te.expression+")"}).join(", ");s+=", "+l}if(e.exclusions.length>0){var f=e.exclusions.map(function(te){return'CONSTRAINT "'+(te.name?te.name:r.connection.namingStrategy.exclusionConstraintName(e,te.expression))+'" EXCLUDE '+te.expression}).join(", ");s+=", "+f}if(e.foreignKeys.length>0&&n){var b=e.foreignKeys.map(function(te){var re=te.columnNames.map(function(ue){return'"'+ue+'"'}).join(", ");te.name||(te.name=r.connection.namingStrategy.foreignKeyName(e,te.columnNames,r.getTablePath(te),te.referencedColumnNames));var fe=te.referencedColumnNames.map(function(ue){return'"'+ue+'"'}).join(", "),de='CONSTRAINT "'+te.name+'" FOREIGN KEY ('+re+") REFERENCES "+r.escapePath(r.getTablePath(te))+" ("+fe+")";return te.onDelete&&(de+=" ON DELETE "+te.onDelete),te.onUpdate&&(de+=" ON UPDATE "+te.onUpdate),te.deferrable&&(de+=" DEFERRABLE "+te.deferrable),de}).join(", ");s+=", "+b}var w=e.columns.filter(function(te){return te.isPrimary});if(w.length>0){var K=this.connection.namingStrategy.primaryKeyName(e,w.map(function(te){return te.name})),z=w.map(function(te){return'"'+te.name+'"'}).join(", ");s+=', CONSTRAINT "'+K+'" PRIMARY KEY ('+z+")"}return s+=")",e.columns.filter(function(te){return te.comment}).forEach(function(te){return s+="; COMMENT ON COLUMN "+r.escapePath(e)+'."'+te.name+'" IS '+r.escapeComment(te.comment)}),new ye(s)},t.prototype.getVersion=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("SHOW SERVER_VERSION")];case 1:return[2,n.sent()[0].server_version]}})})},t.prototype.dropTableSql=function(e){return new ye("DROP TABLE "+this.escapePath(e))},t.prototype.createViewSql=function(e){var n=e.materialized?"MATERIALIZED ":"",r=this.escapePath(e);return new ye("string"==typeof e.expression?"CREATE "+n+"VIEW "+r+" AS "+e.expression:"CREATE "+n+"VIEW "+r+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u,l,f;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return[4,this.getCurrentSchema()];case 1:return n=K.sent(),r=this.driver.parseTableName(e),s=r.tableName,(i=r.schema)||(i=n),u=e.materialized?"MATERIALIZED_VIEW":"VIEW",l="string"==typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),f=(0,c.CR)(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:u,schema:i,name:s,value:l}).getQueryAndParameters(),2),[2,new ye(f[0],f[1])]}})})},t.prototype.dropViewSql=function(e){return new ye("DROP "+(e.materialized?"MATERIALIZED ":"")+"VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return(0,c.mG)(this,void 0,void 0,function(){var n,r,i,s,u,l,f;return(0,c.Jh)(this,function(K){switch(K.label){case 0:return[4,this.getCurrentSchema()];case 1:return n=K.sent(),r=this.driver.parseTableName(e),s=r.tableName,(i=r.schema)||(i=n),u=e.materialized?"MATERIALIZED_VIEW":"VIEW",l=this.connection.createQueryBuilder(),f=(0,c.CR)(l.delete().from(this.getTypeormMetadataTableName()).where(l.escape("type")+" = :type",{type:u}).andWhere(l.escape("schema")+" = :schema",{schema:i}).andWhere(l.escape("name")+" = :name",{name:s}).getQueryAndParameters(),2),[2,new ye(f[0],f[1])]}})})},t.prototype.dropEnumTypes=function(e){return(0,c.mG)(this,void 0,void 0,function(){var r,i=this;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return[4,this.query('SELECT \'DROP TYPE IF EXISTS "\' || n.nspname || \'"."\' || t.typname || \'" CASCADE;\' as "query" FROM "pg_type" "t" INNER JOIN "pg_enum" "e" ON "e"."enumtypid" = "t"."oid" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" IN ('+e+') GROUP BY "n"."nspname", "t"."typname"')];case 1:return r=s.sent(),[4,Promise.all(r.map(function(u){return i.query(u.query)}))];case 2:return s.sent(),[2]}})})},t.prototype.hasEnumType=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(l){switch(l.label){case 0:return(r=this.driver.parseTableName(e).schema)?[3,2]:[4,this.getCurrentSchema()];case 1:r=l.sent(),l.label=2;case 2:return i=this.buildEnumName(e,n,!1,!0),[4,this.query('SELECT "n"."nspname", "t"."typname" FROM "pg_type" "t" INNER JOIN "pg_namespace" "n" ON "n"."oid" = "t"."typnamespace" WHERE "n"."nspname" = \''+r+'\' AND "t"."typname" = \''+i+"'")];case 3:return[2,!!l.sent().length]}})})},t.prototype.createEnumTypeSql=function(e,n,r){r||(r=this.buildEnumName(e,n));var i=n.enum.map(function(s){return"'"+s.replace("'","''")+"'"}).join(", ");return new ye("CREATE TYPE "+r+" AS ENUM("+i+")")},t.prototype.dropEnumTypeSql=function(e,n,r){return r||(r=this.buildEnumName(e,n)),new ye("DROP TYPE "+r)},t.prototype.createIndexSql=function(e,n){var r=n.columnNames.map(function(i){return'"'+i+'"'}).join(", ");return new ye("CREATE "+(n.isUnique?"UNIQUE ":"")+'INDEX "'+n.name+'" ON '+this.escapePath(e)+" "+(n.isSpatial?"USING GiST ":"")+"("+r+") "+(n.where?"WHERE "+n.where:""))},t.prototype.dropIndexSql=function(e,n){var r=n instanceof kt.s?n.name:n,i=this.driver.parseTableName(e).schema;return new ye(i?'DROP INDEX "'+i+'"."'+r+'"':'DROP INDEX "'+r+'"')},t.prototype.createPrimaryKeySql=function(e,n){var r=this.connection.namingStrategy.primaryKeyName(e,n),i=n.map(function(s){return'"'+s+'"'}).join(", ");return new ye("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+r+'" PRIMARY KEY ('+i+")")},t.prototype.dropPrimaryKeySql=function(e){var n=e.primaryColumns.map(function(i){return i.name}),r=this.connection.namingStrategy.primaryKeyName(e,n);return new ye("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+r+'"')},t.prototype.createUniqueConstraintSql=function(e,n){var r=n.columnNames.map(function(i){return'"'+i+'"'}).join(", ");return new ye("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n.name+'" UNIQUE ('+r+")")},t.prototype.dropUniqueConstraintSql=function(e,n){var r=n instanceof Bt.v?n.name:n;return new ye("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+r+'"')},t.prototype.createCheckConstraintSql=function(e,n){return new ye("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n.name+'" CHECK ('+n.expression+")")},t.prototype.dropCheckConstraintSql=function(e,n){var r=n instanceof $t.r?n.name:n;return new ye("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+r+'"')},t.prototype.createExclusionConstraintSql=function(e,n){return new ye("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n.name+'" EXCLUDE '+n.expression)},t.prototype.dropExclusionConstraintSql=function(e,n){var r=n instanceof vn.N?n.name:n;return new ye("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+r+'"')},t.prototype.createForeignKeySql=function(e,n){var r=n.columnNames.map(function(u){return'"'+u+'"'}).join(", "),i=n.referencedColumnNames.map(function(u){return'"'+u+'"'}).join(","),s="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n.name+'" FOREIGN KEY ('+r+") REFERENCES "+this.escapePath(this.getTablePath(n))+"("+i+")";return n.onDelete&&(s+=" ON DELETE "+n.onDelete),n.onUpdate&&(s+=" ON UPDATE "+n.onUpdate),n.deferrable&&(s+=" DEFERRABLE "+n.deferrable),new ye(s)},t.prototype.dropForeignKeySql=function(e,n){var r=n instanceof zt.U?n.name:n;return new ye("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+r+'"')},t.prototype.buildSequenceName=function(e,n){var r=this.driver.parseTableName(e).tableName,i=n instanceof Mt.D?n.name:n,s=r+"_"+i+"_seq";return s.length>this.connection.driver.maxAliasLength&&(s=r.substring(0,29)+"_"+i.substring(0,Math.max(29,63-e.name.length-5))+"_seq"),s},t.prototype.buildSequencePath=function(e,n){var r=this.driver.parseTableName(e).schema;return r?r+"."+this.buildSequenceName(e,n):this.buildSequenceName(e,n)},t.prototype.buildEnumName=function(e,n,r,i,s){void 0===r&&(r=!0);var u=this.driver.parseTableName(e),l=u.schema,b=n.enumName?n.enumName:u.tableName+"_"+n.name.toLowerCase()+"_enum";return l&&r&&(b=l+"."+b),s&&(b+="_old"),b.split(".").map(function(w){return i?w:'"'+w+'"'}).join(".")},t.prototype.getUserDefinedTypeName=function(e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:return r=this.driver.parseTableName(e),s=r.tableName,(i=r.schema)?[3,2]:[4,this.getCurrentSchema()];case 1:i=f.sent(),f.label=2;case 2:return[4,this.query('SELECT "udt_schema", "udt_name" FROM "information_schema"."columns" WHERE "table_schema" = \''+i+"' AND \"table_name\" = '"+s+"' AND \"column_name\"='"+n.name+"'")];case 3:return u=f.sent(),0===(l=u[0].udt_name).indexOf("_")&&(l=l.substr(1,l.length)),[2,{schema:u[0].udt_schema,name:l}]}})})},t.prototype.escapeComment=function(e){return e&&0!==e.length?"'"+(e=e.replace(/'/g,"''").replace(/\u0000/g,""))+"'":"NULL"},t.prototype.escapePath=function(e){var n=this.driver.parseTableName(e),r=n.schema,i=n.tableName;return r?'"'+r+'"."'+i+'"':'"'+i+'"'},t.prototype.buildCreateColumnSql=function(e,n){var r='"'+n.name+'"';return!0===n.isGenerated&&"uuid"!==n.generationStrategy&&(("integer"===n.type||"int"===n.type||"int4"===n.type)&&(r+=" SERIAL"),("smallint"===n.type||"int2"===n.type)&&(r+=" SMALLSERIAL"),("bigint"===n.type||"int8"===n.type)&&(r+=" BIGSERIAL")),"enum"===n.type||"simple-enum"===n.type?(r+=" "+this.buildEnumName(e,n),n.isArray&&(r+=" array")):(!n.isGenerated||"uuid"===n.type)&&(r+=" "+this.connection.driver.createFullType(n)),n.charset&&(r+=' CHARACTER SET "'+n.charset+'"'),n.collation&&(r+=' COLLATE "'+n.collation+'"'),!0!==n.isNullable&&(r+=" NOT NULL"),null!=n.default&&(r+=" DEFAULT "+n.default),n.isGenerated&&"uuid"===n.generationStrategy&&!n.default&&(r+=" DEFAULT "+this.driver.uuidGenerator),r},t.prototype.hasSupportForPartitionedTables=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.query("SELECT TRUE FROM information_schema.columns WHERE table_name = 'pg_class' and column_name = 'relispartition'")];case 1:return[2,!!n.sent().length]}})})},t}(_n))),wr=function(o){function t(e){var n=o.call(this)||this;return n.connection=e,n.options=e.options,n.isReplicated=!1,n.loadDependencies(),n.client=new n.DataApiDriver(n.options.region,n.options.secretArn,n.options.resourceArn,n.options.database,function(r,i){return n.connection.logger.logQuery(r,i)},n.options.serviceConfigOptions,n.options.formatOptions),n.database=Ge.z.buildDriverOptions(n.options).database,n}return(0,c.ZT)(t,o),t.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2]})})},t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2]})})},t.prototype.createQueryRunner=function(e){var n=this;return new Tr(this,new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,function(r,i){return n.connection.logger.logQuery(r,i)},this.options.serviceConfigOptions,this.options.formatOptions),e)},t.prototype.preparePersistentValue=function(e,n){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?o.prototype.preparePersistentValue.call(this,e,n):(n.transformer&&(e=Qe.A.transformTo(n.transformer,e)),this.client.preparePersistentValue(e,n))},t.prototype.prepareHydratedValue=function(e,n){return this.options.formatOptions&&!1===this.options.formatOptions.castParameters?o.prototype.prepareHydratedValue.call(this,e,n):(n.transformer&&(e=Qe.A.transformFrom(n.transformer,e)),this.client.prepareHydratedValue(e,n))},t.prototype.loadDependencies=function(){var e=A.load("typeorm-aurora-data-api-driver").pg;this.DataApiDriver=e},t.prototype.executeQuery=function(e,n){return this.connection.query(n)},t.prototype.afterConnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,this.checkMetadataForExtensions()];case 1:return(e=n.sent()).hasExtensions?[4,this.enableExtensions(e,this.connection)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2,Promise.resolve()]}})})},t}(function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return(0,c.ZT)(t,o),t}(C.U4)),Ar=function(o){function t(e){var n=o.call(this)||this;return n.driver=e,n.connection=e.connection,n.broadcaster=new Kt(n),n}return(0,c.ZT)(t,o),t.prototype.executeSet=function(e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(this.isReleased)throw new St.Y;return[4,this.connect()];case 1:return[2,r.sent().executeSet(e,!1)]}})})},t.prototype.query=function(e,n,r){return void 0===r&&(r=!1),(0,c.mG)(this,void 0,void 0,function(){var i,s,u,l,f;return(0,c.Jh)(this,function(b){switch(b.label){case 0:if(this.isReleased)throw new St.Y;return[4,this.connect()];case 1:i=b.sent(),this.driver.connection.logger.logQuery(e,n,this),s=e.substr(0,e.indexOf(" ")),b.label=2;case 2:return b.trys.push([2,9,,10]),u=void 0,-1===["BEGIN","ROLLBACK","COMMIT","CREATE","ALTER","DROP"].indexOf(s)?[3,4]:[4,i.execute(e,!1)];case 3:return u=b.sent(),[3,8];case 4:return-1===["INSERT","UPDATE","DELETE"].indexOf(s)?[3,6]:[4,i.run(e,n,!1)];case 5:return u=b.sent(),[3,8];case 6:return[4,i.query(e,n||[])];case 7:u=b.sent(),b.label=8;case 8:return l=new Lt,(null==u?void 0:u.hasOwnProperty("values"))&&(l.raw=u.values,l.records=u.values),(null==u?void 0:u.hasOwnProperty("changes"))&&(l.affected=u.changes.changes,l.raw=u.changes.lastId||u.changes.changes),r?[2,l]:[2,l.raw];case 9:throw f=b.sent(),this.driver.connection.logger.logQueryError(f,e,n,this),new Wt.O(e,n,f);case 10:return[2]}})})},t.prototype.parametrize=function(e){return Object.keys(e).map(function(n){return'"'+n+'"=?'})},t}(Yt),Mr=function(o){function t(e){var n=o.call(this,e)||this;if(n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new O.fd("database");if(!n.options.driver)throw new O.fd("driver");return n.sqlite=n.options.driver,n}return(0,c.ZT)(t,o),t.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:return this.databaseConnection=this.createDatabaseConnection(),[4,this.databaseConnection];case 1:return e.sent(),[2]}})})},t.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var n=this;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return this.queryRunner=void 0,[4,this.databaseConnection];case 1:return[2,r.sent().close().then(function(){n.databaseConnection=void 0})]}})})},t.prototype.createQueryRunner=function(e){return this.queryRunner||(this.queryRunner=new Ar(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){return(0,c.mG)(this,void 0,void 0,function(){var e,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return[4,this.sqlite.createConnection(this.options.database,"no-encryption"!==(e=this.options.mode||"no-encryption"),e,void 0===this.options.version?1:this.options.version)];case 1:return[4,(i=s.sent()).open()];case 2:return s.sent(),[4,i.query("PRAGMA foreign_keys = ON")];case 3:return s.sent(),this.options.journalMode&&-1!==["DELETE","TRUNCATE","PERSIST","MEMORY","WAL","OFF"].indexOf(this.options.journalMode)?[4,i.query("PRAGMA journal_mode = "+this.options.journalMode)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2,i]}})})},t.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new O.zm("Capacitor","@capacitor-community/sqlite")},t}(He.w),Rr=function(){function o(){}return o.prototype.create=function(t){var e=t.options.type;switch(e){case"mysql":return new C.p$(t);case"postgres":return new C.U4(t);case"cockroachdb":return new C.J1(t);case"sap":return new C.tU(t);case"mariadb":return new C.p$(t);case"sqlite":return new C.Z7(t);case"better-sqlite3":return new C.R4(t);case"cordova":return new fr(t);case"nativescript":return new mr(t);case"react-native":return new dr(t);case"sqljs":return new Bn(t);case"oracle":return new C.XR(t);case"mssql":return new C.Z0(t);case"mongodb":return new C.Qd(t);case"expo":return new vr(t);case"aurora-data-api":return new C.xI(t);case"aurora-data-api-pg":return new wr(t);case"capacitor":return new Mr(t);default:throw new cr.R(e,["aurora-data-api","aurora-data-api-pg","better-sqlite3","capacitor","cockroachdb","cordova","expo","mariadb","mongodb","mssql","mysql","nativescript","oracle","postgres","react-native","sap","sqlite","sqljs"])}},o}();function gn(o,t,e){return void 0===e&&(e=[".js",".cjs",".ts"]),[]}var xr=new(function(){function o(){this.instances=[]}return o.prototype.get=function(t){var e=this.instances.find(function(n){return n.type===t});return e||(e={type:t,object:new t},this.instances.push(e)),e.object},o}());function bn(o){return xr.get(o)}var Rt=function(){function o(t){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata,t.columns&&(this.columns=t.columns),t.args&&(this.target=t.args.target,null!=t.args.synchronize&&(this.synchronize=t.args.synchronize),this.isUnique=!!t.args.unique,this.isSpatial=!!t.args.spatial,this.isFulltext=!!t.args.fulltext,this.parser=t.args.parser,this.where=t.args.where,this.isSparse=t.args.sparse,this.isBackground=t.args.background,this.expireAfterSeconds=t.args.expireAfterSeconds,this.givenName=t.args.name,this.givenColumnNames=t.args.columns)}return o.prototype.build=function(t){var e=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(s){return e.embeddedMetadata?e.embeddedMetadata.propertyPath+"."+s:s.trim()})).forEach(function(s){return n[s]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(s){return String(s)})).forEach(function(s){return n[s]=1}):(r=Object.keys(i).map(function(s){return String(s)}),Object.keys(i).forEach(function(s){return n[s]=i[s]}))}this.columns=r.map(function(s){var u=e.entityMetadata.columns.find(function(w){return w.propertyPath===s});if(u)return[u];var l=e.entityMetadata.relations.find(function(w){return w.isWithJoinColumn&&w.propertyName===s});if(l)return l.joinColumns;throw new O.K_("Index "+(e.givenName?'"'+e.givenName+'" ':"")+"contains column that is missing in the entity ("+e.entityMetadata.targetName+"): "+s)}).reduce(function(s,u){return s.concat(u)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(s,u){var l=e.entityMetadata.columns.find(function(f){return f.propertyPath===u});return l&&(s[l.databasePath]=n[u]),s},{}),this.name=this.givenName?this.givenName:t.indexName(this.entityMetadata.tableName,this.columns.map(function(s){return s.databaseName}),this.where),this},o}(),Fn=function(){function o(t){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.createForeignKeyConstraints=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata;var e=t.args;this.target=e.target,this.propertyName=e.propertyName,this.relationType=e.relationType,e.inverseSideProperty&&(this.givenInverseSidePropertyFactory=e.inverseSideProperty),this.isLazy=e.isLazy||!1,this.isCascadeInsert=!0===e.options.cascade||Array.isArray(e.options.cascade)&&-1!==e.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===e.options.cascade||Array.isArray(e.options.cascade)&&-1!==e.options.cascade.indexOf("update"),this.isCascadeRemove=!0===e.options.cascade||Array.isArray(e.options.cascade)&&-1!==e.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===e.options.cascade||Array.isArray(e.options.cascade)&&-1!==e.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===e.options.cascade||Array.isArray(e.options.cascade)&&-1!==e.options.cascade.indexOf("recover"),this.isPrimary=e.options.primary||!1,this.isNullable=!(!1===e.options.nullable||this.isPrimary),this.onDelete=e.options.onDelete,this.onUpdate=e.options.onUpdate,this.deferrable=e.options.deferrable,this.createForeignKeyConstraints=!1!==e.options.createForeignKeyConstraints,this.isEager=e.options.eager||!1,this.persistenceEnabled=!1!==e.options.persistence,this.orphanedRowAction=e.options.orphanedRowAction||"nullify",this.isTreeParent=e.isTreeParent||!1,this.isTreeChildren=e.isTreeChildren||!1,this.type=e.type instanceof Function?e.type():e.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return o.prototype.getRelationIdMap=function(t){var n=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(r){return r.referencedColumn});return Vt.T.getValueMap(t,n)},o.prototype.ensureRelationIdMap=function(t){if(t instanceof Object)return t;var n=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map(function(r){return r.referencedColumn});if(n.length>1)throw new O.K_("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return n[0].createValueMap(t)},o.prototype.getEntityValue=function(t,e){if(void 0===e&&(e=!1),null!=t){if(this.embeddedMetadata){var n=(0,c.ev)([],(0,c.CR)(this.embeddedMetadata.parentPropertyNames)),r=function(s,u){var l=s.shift();return l?u[l]?r(s,u[l]):void 0:u},i=r(n,t);return this.isLazy?void 0!==i["__"+this.propertyName+"__"]?i["__"+this.propertyName+"__"]:!0===e?i[this.propertyName]:void 0:i?i[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==t["__"+this.propertyName+"__"]?t["__"+this.propertyName+"__"]:!0===e?t[this.propertyName]:void 0:t[this.propertyName]}},o.prototype.setEntityValue=function(t,e){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){var r=function(i,s){var u=i.shift();return u?(s[u.propertyName]||(s[u.propertyName]=u.create()),r(i,s[u.propertyName]),s):(s[n]=e,s)};return r((0,c.ev)([],(0,c.CR)(this.embeddedMetadata.embeddedMetadataTree)),t)}t[n]=e},o.prototype.createValueMap=function(t){var e,n=this;if(this.embeddedMetadata){var r=(0,c.ev)([],(0,c.CR)(this.embeddedMetadata.parentPropertyNames)),i=function(s,u){var l=s.shift();return l?(u[l]={},i(s,u[l]),u):(u[n.propertyName]=t,u)};return i(r,{})}return(e={})[this.propertyName]=t,e},o.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},o.prototype.registerForeignKeys=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(t=this.foreignKeys).push.apply(t,(0,c.ev)([],(0,c.CR)(e)))},o.prototype.registerJoinColumns=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]),this.joinColumns=t,this.inverseJoinColumns=e,this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},o.prototype.registerJunctionEntityMetadata=function(t){this.junctionEntityMetadata=t,this.joinTableName=t.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=t,this.joinTableName=t.tableName)},o.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){if("function"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(this.inverseEntityMetadata.propertiesMap);if("string"==typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},o.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},o}(),Nr=function(){function o(t){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isAlwaysUsingConstructor=!0,this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=t.entityMetadata,this.type=t.args.type(),this.propertyName=t.args.propertyName,this.customPrefix=t.args.prefix,this.isArray=t.args.isArray}return o.prototype.create=function(t){return!(null==t?void 0:t.fromDeserializer)||this.isAlwaysUsingConstructor?new this.type:Object.create(this.type.prototype)},o.prototype.build=function(t){return this.embeddeds.forEach(function(e){return e.build(t)}),this.prefix=this.buildPrefix(t),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),t.options.entitySkipConstructor&&(this.isAlwaysUsingConstructor=!t.options.entitySkipConstructor),this},o.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"==typeof this.customPrefix)return[this.customPrefix];throw new O.K_("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},o.prototype.buildPrefix=function(t){if(t.driver instanceof C.Qd)return this.propertyName;var e=[];return this.parentEmbeddedMetadata&&e.push(this.parentEmbeddedMetadata.buildPrefix(t)),e.push.apply(e,(0,c.ev)([],(0,c.CR)(this.buildPartialPrefix()))),e.join("_")},o.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},o.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},o.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},o.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildColumnsFromTree())},this.columns)},o.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildRelationsFromTree())},this.relations)},o.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildListenersFromTree())},this.listeners)},o.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildIndicesFromTree())},this.indices)},o.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildUniquesFromTree())},this.uniques)},o.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildRelationIdsFromTree())},this.relationIds)},o.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce(function(t,e){return t.concat(e.buildRelationCountsFromTree())},this.relationCounts)},o}(),Ln=function(){function o(t){this.entityMetadata=t.entityMetadata,this.target=t.args.target,this.propertyName=t.args.propertyName,this.relationNameOrFactory=t.args.relation,this.alias=t.args.alias,this.queryBuilderFactory=t.args.queryBuilderFactory}return o.prototype.setValue=function(t){var e=this,n=this.relation.getEntityValue(t);if(Array.isArray(n))t[this.propertyName]=n.map(function(i){return e.relation.inverseEntityMetadata.getEntityIdMixedMap(i)}).filter(function(i){return null!=i});else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(t[this.propertyName]=r)}},o.prototype.build=function(){var t=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,e=this.entityMetadata.findRelationWithPropertyPath(t);if(!e)throw new O.K_("Cannot find relation "+t+". Wrong relation specified for @RelationId decorator.");this.relation=e},o}(),qn=function(){function o(t){this.entityMetadata=t.entityMetadata,this.target=t.args.target,this.propertyName=t.args.propertyName,this.relationNameOrFactory=t.args.relation,this.alias=t.args.alias,this.queryBuilderFactory=t.args.queryBuilderFactory}return o.prototype.build=function(){var t=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,e=this.entityMetadata.findRelationWithPropertyPath(t);if(!e)throw new O.K_("Cannot find relation "+t+". Wrong relation specified for @RelationCount decorator.");this.relation=e},o}(),Zt=function(){function o(){}return o.AFTER_LOAD="after-load",o.BEFORE_INSERT="before-insert",o.AFTER_INSERT="after-insert",o.BEFORE_UPDATE="before-update",o.AFTER_UPDATE="after-update",o.BEFORE_REMOVE="before-remove",o.AFTER_REMOVE="after-remove",o}(),tn=function(){function o(t){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=t.entityMetadata,this.referencedEntityMetadata=t.referencedEntityMetadata,this.columns=t.columns,this.referencedColumns=t.referencedColumns,this.onDelete=t.onDelete||"NO ACTION",this.onUpdate=t.onUpdate||"NO ACTION",this.deferrable=t.deferrable,t.namingStrategy&&this.build(t.namingStrategy)}return o.prototype.build=function(t){this.columnNames=this.columns.map(function(e){return e.databaseName}),this.referencedColumnNames=this.referencedColumns.map(function(e){return e.databaseName}),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=t.foreignKeyName(this.entityMetadata.tableName,this.columnNames,this.referencedEntityMetadata.tableName,this.referencedColumnNames)},o}(),Pr=function(){function o(t){this.connection=t}return o.prototype.build=function(t,e){var n=this,r=this.collectReferencedColumns(t,e),i=this.collectInverseReferencedColumns(t,e),s=e.name||this.connection.namingStrategy.joinTableName(t.entityMetadata.tableNameWithoutPrefix,t.inverseEntityMetadata.tableNameWithoutPrefix,t.propertyPath,t.inverseRelation?t.inverseRelation.propertyName:""),u=new Vt.T({connection:this.connection,args:{target:"",name:s,type:"junction",database:e.database||t.entityMetadata.database,schema:e.schema||t.entityMetadata.schema}});u.build();var l=r.map(function(b){var w=e.joinColumns?e.joinColumns.find(function(z){return!(z.referencedColumnName&&z.referencedColumnName!==b.propertyName||!z.name)}):void 0,K=w&&w.name?w.name:n.connection.namingStrategy.joinTableColumnName(t.entityMetadata.tableNameWithoutPrefix,b.propertyName,b.databaseName);return new wt({connection:n.connection,entityMetadata:u,referencedColumn:b,args:{target:"",mode:"virtual",propertyName:K,options:{name:K,length:b.length||!(n.connection.driver instanceof C.p$||n.connection.driver instanceof C.xI)||"uuid"!==b.generationStrategy&&"uuid"!==b.type?b.length:"36",width:b.width,type:b.type,precision:b.precision,scale:b.scale,charset:b.charset,collation:b.collation,zerofill:b.zerofill,unsigned:!!b.zerofill||b.unsigned,enum:b.enum,enumName:b.enumName,nullable:!1,primary:!0}}})}),f=i.map(function(b){var w=e.inverseJoinColumns?e.inverseJoinColumns.find(function(z){return!(z.referencedColumnName&&z.referencedColumnName!==b.propertyName||!z.name)}):void 0,K=w&&w.name?w.name:n.connection.namingStrategy.joinTableInverseColumnName(t.inverseEntityMetadata.tableNameWithoutPrefix,b.propertyName,b.databaseName);return new wt({connection:n.connection,entityMetadata:u,referencedColumn:b,args:{target:"",mode:"virtual",propertyName:K,options:{length:b.length||!(n.connection.driver instanceof C.p$||n.connection.driver instanceof C.xI)||"uuid"!==b.generationStrategy&&"uuid"!==b.type?b.length:"36",width:b.width,type:b.type,precision:b.precision,scale:b.scale,charset:b.charset,collation:b.collation,zerofill:b.zerofill,unsigned:!!b.zerofill||b.unsigned,enum:b.enum,enumName:b.enumName,name:K,nullable:!1,primary:!0}}})});return this.changeDuplicatedColumnNames(l,f),u.ownerColumns=l,u.inverseColumns=f,u.ownColumns=(0,c.ev)((0,c.ev)([],(0,c.CR)(l)),(0,c.CR)(f)),u.ownColumns.forEach(function(b){return b.relationMetadata=t}),u.foreignKeys=t.createForeignKeyConstraints?[new tn({entityMetadata:u,referencedEntityMetadata:t.entityMetadata,columns:l,referencedColumns:r,onDelete:t.onDelete||"CASCADE",onUpdate:this.connection.driver instanceof C.XR?"NO ACTION":t.onUpdate||"CASCADE"}),new tn({entityMetadata:u,referencedEntityMetadata:t.inverseEntityMetadata,columns:f,referencedColumns:i,onDelete:t.inverseRelation?t.inverseRelation.onDelete:"CASCADE",onUpdate:this.connection.driver instanceof C.XR?"NO ACTION":t.inverseRelation?t.inverseRelation.onUpdate:"CASCADE"})]:[],u.ownIndices=[new Rt({entityMetadata:u,columns:l,args:{target:u.target,synchronize:!0}}),new Rt({entityMetadata:u,columns:f,args:{target:u.target,synchronize:!0}})],u},o.prototype.collectReferencedColumns=function(t,e){var n=!!e.joinColumns&&e.joinColumns.find(function(r){return!!r.referencedColumnName});return!e.joinColumns||e.joinColumns&&!n?t.entityMetadata.columns.filter(function(r){return r.isPrimary}):e.joinColumns.map(function(r){var i=t.entityMetadata.columns.find(function(s){return s.propertyName===r.referencedColumnName});if(!i)throw new O.K_("Referenced column "+r.referencedColumnName+" was not found in entity "+t.entityMetadata.name);return i})},o.prototype.collectInverseReferencedColumns=function(t,e){var n=!!e.inverseJoinColumns,r=!!n&&e.inverseJoinColumns.find(function(i){return!!i.referencedColumnName});return!n||n&&!r?t.inverseEntityMetadata.primaryColumns:e.inverseJoinColumns.map(function(i){var s=t.inverseEntityMetadata.ownColumns.find(function(u){return u.propertyName===i.referencedColumnName});if(!s)throw new O.K_("Referenced column "+i.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return s})},o.prototype.changeDuplicatedColumnNames=function(t,e){var n=this;t.forEach(function(r){e.forEach(function(i){if(r.givenDatabaseName===i.givenDatabaseName){var s=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(r.propertyName,1);r.propertyName=s,r.givenDatabaseName=s;var u=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(i.propertyName,2);i.propertyName=u,i.givenDatabaseName=u}})})},o}(),Sr=function(){function o(t){this.connection=t}return o.prototype.build=function(t){var e=this,n=new Vt.T({parentClosureEntityMetadata:t,connection:this.connection,args:{target:"",name:t.treeOptions&&t.treeOptions.closureTableName?t.treeOptions.closureTableName:t.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),t.primaryColumns.forEach(function(r){n.ownColumns.push(new wt({connection:e.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:t.treeOptions&&t.treeOptions.ancestorColumnName?t.treeOptions.ancestorColumnName(r):r.propertyName+"_ancestor",options:{primary:!0,length:r.length,type:r.type}}})),n.ownColumns.push(new wt({connection:e.connection,entityMetadata:n,closureType:"descendant",referencedColumn:r,args:{target:"",mode:"virtual",propertyName:t.treeOptions&&t.treeOptions.descendantColumnName?t.treeOptions.descendantColumnName(r):r.propertyName+"_descendant",options:{primary:!0,length:r.length,type:r.type}}}))}),n.ownIndices=[new Rt({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new Rt({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],t.treeLevelColumn&&n.ownColumns.push(new wt({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new tn({entityMetadata:n,referencedEntityMetadata:t,columns:[n.ownColumns[0]],referencedColumns:t.primaryColumns,onDelete:this.connection.driver instanceof C.Z0?"NO ACTION":"CASCADE"}),new tn({entityMetadata:n,referencedEntityMetadata:t,columns:[n.ownColumns[1]],referencedColumns:t.primaryColumns,onDelete:this.connection.driver instanceof C.Z0?"NO ACTION":"CASCADE"})],n},o}(),cn=function(){function o(t){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata,t.columns&&(this.columns=t.columns),t.args&&(this.target=t.args.target,this.givenName=t.args.name,this.givenColumnNames=t.args.columns)}return o.prototype.build=function(t){var e=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map(function(s){return e.embeddedMetadata?e.embeddedMetadata.propertyPath+"."+s:s.trim()})).forEach(function(s){return n[s]=1});else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map(function(s){return String(s)})).forEach(function(s){return n[s]=1}):(r=Object.keys(i).map(function(s){return String(s)}),Object.keys(i).forEach(function(s){return n[s]=i[s]}))}this.columns=r.map(function(s){var u=e.entityMetadata.columns.find(function(w){return w.propertyPath===s});if(u)return[u];var l=e.entityMetadata.relations.find(function(w){return w.isWithJoinColumn&&w.propertyName===s});if(l)return l.joinColumns;throw new O.K_("Unique constraint "+(e.givenName?'"'+e.givenName+'" ':"")+"contains column that is missing in the entity ("+e.entityMetadata.targetName+"): "+s)}).reduce(function(s,u){return s.concat(u)})}return this.columnNamesWithOrderingMap=Object.keys(n).reduce(function(s,u){var l=e.entityMetadata.columns.find(function(f){return f.propertyPath===u});return l&&(s[l.databasePath]=n[u]),s},{}),this.name=this.givenName?this.givenName:t.uniqueConstraintName(this.entityMetadata.tableName,this.columns.map(function(s){return s.databaseName})),this},o}(),Or=function(){function o(t){this.connection=t}return o.prototype.build=function(t,e){var n=this.collectReferencedColumns(t,e),r=this.collectColumns(t,e,n);if(!n.length||!e.createForeignKeyConstraints)return{foreignKey:void 0,columns:r,uniqueConstraint:void 0};var i=new tn({entityMetadata:e.entityMetadata,referencedEntityMetadata:e.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:e.onDelete,onUpdate:e.onUpdate,deferrable:e.deferrable});if(this.connection.driver instanceof C.XR&&r.every(function(u){return u.isPrimary}))return{foreignKey:i,columns:r,uniqueConstraint:void 0};if(n.length>0&&e.isOneToOne){var s=new cn({entityMetadata:e.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(e.entityMetadata.tableName,i.columns.map(function(u){return u.databaseName})),target:e.entityMetadata.target}});return s.build(this.connection.namingStrategy),{foreignKey:i,columns:r,uniqueConstraint:s}}return{foreignKey:i,columns:r,uniqueConstraint:void 0}},o.prototype.collectReferencedColumns=function(t,e){var n=t.find(function(s){return!!s.referencedColumnName});return 0===t.length&&e.isManyToOne||t.length>0&&!n?e.inverseEntityMetadata.primaryColumns:t.map(function(s){var u=e.inverseEntityMetadata.ownColumns.find(function(l){return l.propertyName===s.referencedColumnName});if(!u)throw new O.K_("Referenced column "+s.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return u})},o.prototype.collectColumns=function(t,e,n){var r=this;return n.map(function(i){var s=t.find(function(f){return!(f.referencedColumnName&&f.referencedColumnName!==i.propertyName||!f.name)}),u=s?s.name:r.connection.namingStrategy.joinColumnName(e.propertyName,i.propertyName),l=e.entityMetadata.ownColumns.find(function(f){return f.databaseName===u});return l||(l=new wt({connection:r.connection,entityMetadata:e.entityMetadata,args:{target:"",mode:"virtual",propertyName:e.propertyName,options:{name:u,type:i.type,length:i.length||!(r.connection.driver instanceof C.p$||r.connection.driver instanceof C.xI)||"uuid"!==i.generationStrategy&&"uuid"!==i.type?i.length:"36",width:i.width,charset:i.charset,collation:i.collation,precision:i.precision,scale:i.scale,zerofill:i.zerofill,unsigned:i.unsigned,comment:i.comment,enum:i.enum,enumName:i.enumName,primary:e.isPrimary,nullable:e.isNullable}}}),e.entityMetadata.registerColumn(l)),l.referencedColumn=i,l.type=i.type,l.relationMetadata=e,l.build(r.connection),l})},o}(),Jn=function(){function o(t){this.entityMetadata=t.entityMetadata,this.embeddedMetadata=t.embeddedMetadata,this.target=t.args.target,this.propertyName=t.args.propertyName,this.type=t.args.type}return o.prototype.isAllowed=function(t){return this.entityMetadata.target===t.constructor||this.entityMetadata.target instanceof Function&&t.constructor.prototype instanceof this.entityMetadata.target},o.prototype.execute=function(t){if(!this.embeddedMetadata)return t[this.propertyName]();this.callEntityEmbeddedMethod(t,this.embeddedMetadata.propertyPath.split("."))},o.prototype.callEntityEmbeddedMethod=function(t,e){var n=this,r=e.shift();!r||!t[r]||(0===e.length?t[r]instanceof Array?t[r].map(function(i){return i[n.propertyName]()}):t[r][this.propertyName]():t[r]&&this.callEntityEmbeddedMethod(t[r],e))},o}(),Dr=function(){function o(t){this.entityMetadata=t.entityMetadata,t.args&&(this.target=t.args.target,this.expression=t.args.expression,this.givenName=t.args.name)}return o.prototype.build=function(t){return this.name=this.givenName?this.givenName:t.checkConstraintName(this.entityMetadata.tableName,this.expression),this},o}(),Ir=function(){function o(t){this.entityMetadata=t.entityMetadata,t.args&&(this.target=t.args.target,this.expression=t.args.expression,this.givenName=t.args.name)}return o.prototype.build=function(t){return this.name=this.givenName?this.givenName:t.exclusionConstraintName(this.entityMetadata.tableName,this.expression),this},o}(),Qn=function(){function o(t,e){this.connection=t,this.metadataArgsStorage=e,this.junctionEntityMetadataBuilder=new Pr(t),this.closureJunctionEntityMetadataBuilder=new Sr(t),this.relationJoinColumnBuilder=new Or(t)}return o.prototype.build=function(t){var e=this,i=(t?this.metadataArgsStorage.filterTables(t):this.metadataArgsStorage.tables).filter(function(s){return"regular"===s.type||"closure"===s.type||"entity-child"===s.type||"view"===s.type}).map(function(s){return e.createEntityMetadata(s)});return i.forEach(function(s){return e.computeParentEntityMetadata(i,s)}),i.forEach(function(s){s.childEntityMetadatas=i.filter(function(u){return s.target instanceof Function&&u.target instanceof Function&&ie.isInherited(u.target,s.target)})}),i.filter(function(s){return"entity-child"!==s.tableType}).forEach(function(s){return s.build()}),i.filter(function(s){return"entity-child"===s.tableType}).forEach(function(s){return s.build()}),i.filter(function(s){return"entity-child"!==s.tableType}).forEach(function(s){return e.computeEntityMetadataStep1(i,s)}),i.filter(function(s){return"entity-child"===s.tableType}).forEach(function(s){return e.computeEntityMetadataStep1(i,s)}),i.forEach(function(s){return e.computeEntityMetadataStep2(s)}),i.forEach(function(s){return e.computeInverseProperties(s,i)}),i.filter(function(s){return"entity-child"!==s.tableType}).forEach(function(s){s.relations.filter(function(u){return u.isOneToOne||u.isManyToOne}).forEach(function(u){var l=e.metadataArgsStorage.filterJoinColumns(u.target,u.propertyName),f=e.relationJoinColumnBuilder.build(l,u),b=f.foreignKey,w=f.columns,K=f.uniqueConstraint;if(b&&(u.registerForeignKeys(b),s.foreignKeys.push(b)),w&&u.registerJoinColumns(w),K)if(e.connection.driver instanceof C.p$||e.connection.driver instanceof C.xI||e.connection.driver instanceof C.Z0||e.connection.driver instanceof C.tU){var z=new Rt({entityMetadata:K.entityMetadata,columns:K.columns,args:{target:K.target,name:K.name,unique:!0,synchronize:!0}});e.connection.driver instanceof C.Z0&&(z.where=z.columns.map(function(te){return e.connection.driver.escape(te.databaseName)+" IS NOT NULL"}).join(" AND ")),u.embeddedMetadata?u.embeddedMetadata.indices.push(z):u.entityMetadata.ownIndices.push(z),e.computeEntityMetadataStep2(s)}else u.embeddedMetadata?u.embeddedMetadata.uniques.push(K):u.entityMetadata.ownUniques.push(K),e.computeEntityMetadataStep2(s);b&&e.connection.driver instanceof C.J1&&(z=new Rt({entityMetadata:u.entityMetadata,columns:b.columns,args:{target:u.entityMetadata.target,synchronize:!0}}),u.embeddedMetadata?u.embeddedMetadata.indices.push(z):u.entityMetadata.ownIndices.push(z),e.computeEntityMetadataStep2(s))}),s.relations.filter(function(u){return u.isManyToMany}).forEach(function(u){var l=e.metadataArgsStorage.findJoinTable(u.target,u.propertyName);if(l){var f=e.junctionEntityMetadataBuilder.build(u,l);u.registerForeignKeys.apply(u,(0,c.ev)([],(0,c.CR)(f.foreignKeys))),u.registerJoinColumns(f.ownIndices[0].columns,f.ownIndices[1].columns),u.registerJunctionEntityMetadata(f),e.computeEntityMetadataStep2(f),e.computeInverseProperties(f,i),i.push(f)}})}),i.forEach(function(s){s.relationsWithJoinColumns=s.relations.filter(function(u){return u.isWithJoinColumn}),s.hasNonNullableRelations=s.relationsWithJoinColumns.some(function(u){return!u.isNullable||u.isPrimary})}),i.filter(function(s){return"closure-table"===s.treeType}).forEach(function(s){var u=e.closureJunctionEntityMetadataBuilder.build(s);s.closureJunctionTable=u,e.computeEntityMetadataStep2(u),e.computeInverseProperties(u,i),i.push(u)}),i.filter(function(s){return"STI"===s.inheritancePattern&&s.discriminatorColumn}).forEach(function(s){return e.createKeysForTableInheritance(s)}),i.forEach(function(s){s.indices.forEach(function(u){return u.build(e.connection.namingStrategy)})}),i.forEach(function(s){s.uniques.forEach(function(u){return u.build(e.connection.namingStrategy)})}),i.forEach(function(s){s.checks.forEach(function(u){return u.build(e.connection.namingStrategy)})}),i.forEach(function(s){s.exclusions.forEach(function(u){return u.build(e.connection.namingStrategy)})}),i.filter(function(s){return s.target instanceof Function}).forEach(function(s){s.relations.filter(function(u){return u.isLazy}).forEach(function(u){e.connection.relationLoader.enableLazyLoad(u,s.target.prototype)})}),i.forEach(function(s){s.columns.forEach(function(u){var l=e.metadataArgsStorage.findGenerated(u.target,u.propertyName);l&&(u.isGenerated=!0,u.generationStrategy=l.strategy,u.type="uuid"===l.strategy?"uuid":"rowid"===l.strategy?"int":u.type||Number,u.build(e.connection),e.computeEntityMetadataStep2(s))})}),i},o.prototype.createEntityMetadata=function(t){var i,e=t.target instanceof Function?ie.getInheritanceTree(t.target):[t.target],n=this.metadataArgsStorage.findInheritanceType(t.target),r=this.metadataArgsStorage.findTree(t.target);return(n&&"STI"===n.pattern||"entity-child"===t.type)&&(i=this.metadataArgsStorage.filterSingleTableChildren(t.target).map(function(s){return s.target}).filter(function(s){return s instanceof Function}),e.push.apply(e,(0,c.ev)([],(0,c.CR)(i)))),new Vt.T({connection:this.connection,args:t,inheritanceTree:e,tableTree:r,inheritancePattern:n?n.pattern:void 0})},o.prototype.computeParentEntityMetadata=function(t,e){"entity-child"===e.tableType&&(e.parentEntityMetadata=t.find(function(n){return-1!==n.inheritanceTree.indexOf(e.target)&&"STI"===n.inheritancePattern}))},o.prototype.computeEntityMetadataStep1=function(t,e){var n,r,i,s=this,u=this.metadataArgsStorage.findInheritanceType(e.target),l=this.metadataArgsStorage.findDiscriminatorValue(e.target);if(e.discriminatorValue=void 0!==l?l.value:e.target.name,e.embeddeds=this.createEmbeddedsRecursively(e,this.metadataArgsStorage.filterEmbeddeds(e.inheritanceTree)).map(function(ue){return"STI"===e.inheritancePattern&&(ue.columns=ue.columns.map(function(pe){return pe.isNullable=!0,pe})),ue}),e.ownColumns=this.metadataArgsStorage.filterColumns(e.inheritanceTree).map(function(ue){if("entity-child"===e.tableType)return e.parentEntityMetadata.ownColumns.find(function(Te){return Te.propertyName===ue.propertyName});var pe=new wt({connection:s.connection,entityMetadata:e,args:ue});return t.find(function(Te){return"entity-child"===Te.tableType&&Te.target===ue.target})&&(pe.isNullable=!0),pe}),u&&u.column){var f=u.column&&u.column.name?u.column.name:"type",b=e.ownColumns.find(function(ue){return ue.propertyName===f});b?b.isDiscriminator=!0:((b=new wt({connection:this.connection,entityMetadata:e,args:{target:e.target,mode:"virtual",propertyName:f,options:u.column||{name:f,type:"varchar",nullable:!1}}})).isVirtual=!0,b.isDiscriminator=!0,e.ownColumns.push(b))}if("entity-child"===e.tableType){var w=e.parentEntityMetadata.ownColumns.find(function(ue){return ue.isDiscriminator});w&&!e.ownColumns.find(function(ue){return ue===w})&&e.ownColumns.push(w)}var K=this.connection.namingStrategy;if("materialized-path"===e.treeType)e.ownColumns.push(new wt({connection:this.connection,entityMetadata:e,materializedPath:!0,args:{target:e.target,mode:"virtual",propertyName:"mpath",options:{name:K.materializedPathColumnName,type:"varchar",nullable:!0,default:""}}}));else if("nested-set"===e.treeType){var z=K.nestedSetColumnNames,te=z.left,re=z.right;e.ownColumns.push(new wt({connection:this.connection,entityMetadata:e,nestedSetLeft:!0,args:{target:e.target,mode:"virtual",propertyName:te,options:{name:te,type:"integer",nullable:!1,default:1}}})),e.ownColumns.push(new wt({connection:this.connection,entityMetadata:e,nestedSetRight:!0,args:{target:e.target,mode:"virtual",propertyName:re,options:{name:re,type:"integer",nullable:!1,default:2}}}))}if(e.ownRelations=this.metadataArgsStorage.filterRelations(e.inheritanceTree).map(function(ue){if("entity-child"===e.tableType){var pe=e.parentEntityMetadata.ownRelations.find(function(Be){return Be.propertyName===ue.propertyName}),xe=ue.type instanceof Function?ue.type():ue.type;if(pe.type!==xe){var Te=Object.create(pe);return Te.type=xe,Te}return pe}return new Fn({entityMetadata:e,args:ue})}),e.relationIds=this.metadataArgsStorage.filterRelationIds(e.inheritanceTree).map(function(ue){return"entity-child"===e.tableType?e.parentEntityMetadata.relationIds.find(function(pe){return pe.propertyName===ue.propertyName}):new Ln({entityMetadata:e,args:ue})}),e.relationCounts=this.metadataArgsStorage.filterRelationCounts(e.inheritanceTree).map(function(ue){return"entity-child"===e.tableType?e.parentEntityMetadata.relationCounts.find(function(pe){return pe.propertyName===ue.propertyName}):new qn({entityMetadata:e,args:ue})}),e.ownListeners=this.metadataArgsStorage.filterListeners(e.inheritanceTree).map(function(ue){return new Jn({entityMetadata:e,args:ue})}),e.checks=this.metadataArgsStorage.filterChecks(e.inheritanceTree).map(function(ue){return new Dr({entityMetadata:e,args:ue})}),this.connection.driver instanceof C.U4&&(e.exclusions=this.metadataArgsStorage.filterExclusions(e.inheritanceTree).map(function(ue){return new Ir({entityMetadata:e,args:ue})})),this.connection.driver instanceof C.J1){e.ownIndices=this.metadataArgsStorage.filterIndices(e.inheritanceTree).filter(function(ue){return!ue.unique}).map(function(ue){return new Rt({entityMetadata:e,args:ue})});var fe=this.metadataArgsStorage.filterIndices(e.inheritanceTree).filter(function(ue){return ue.unique}).map(function(ue){return new cn({entityMetadata:e,args:{target:ue.target,name:ue.name,columns:ue.columns}})});(n=e.ownUniques).push.apply(n,(0,c.ev)([],(0,c.CR)(fe)))}else e.ownIndices=this.metadataArgsStorage.filterIndices(e.inheritanceTree).map(function(ue){return new Rt({entityMetadata:e,args:ue})});if(this.connection.driver instanceof C.p$||this.connection.driver instanceof C.xI||this.connection.driver instanceof C.tU){var de=this.metadataArgsStorage.filterUniques(e.inheritanceTree).map(function(ue){return new Rt({entityMetadata:e,args:{target:ue.target,name:ue.name,columns:ue.columns,unique:!0,synchronize:!0}})});(r=e.ownIndices).push.apply(r,(0,c.ev)([],(0,c.CR)(de)))}else fe=this.metadataArgsStorage.filterUniques(e.inheritanceTree).map(function(pe){return new cn({entityMetadata:e,args:pe})}),(i=e.ownUniques).push.apply(i,(0,c.ev)([],(0,c.CR)(fe)))},o.prototype.createEmbeddedsRecursively=function(t,e){var n=this;return e.map(function(r){var i=new Nr({entityMetadata:t,args:r}),s=ie.getInheritanceTree(i.type);return i.columns=n.metadataArgsStorage.filterColumns(s).map(function(u){return new wt({connection:n.connection,entityMetadata:t,embeddedMetadata:i,args:u})}),i.relations=n.metadataArgsStorage.filterRelations(s).map(function(u){return new Fn({entityMetadata:t,embeddedMetadata:i,args:u})}),i.listeners=n.metadataArgsStorage.filterListeners(s).map(function(u){return new Jn({entityMetadata:t,embeddedMetadata:i,args:u})}),i.indices=n.metadataArgsStorage.filterIndices(s).map(function(u){return new Rt({entityMetadata:t,embeddedMetadata:i,args:u})}),i.uniques=n.metadataArgsStorage.filterUniques(s).map(function(u){return new cn({entityMetadata:t,embeddedMetadata:i,args:u})}),i.relationIds=n.metadataArgsStorage.filterRelationIds(s).map(function(u){return new Ln({entityMetadata:t,args:u})}),i.relationCounts=n.metadataArgsStorage.filterRelationCounts(s).map(function(u){return new qn({entityMetadata:t,args:u})}),i.embeddeds=n.createEmbeddedsRecursively(t,n.metadataArgsStorage.filterEmbeddeds(s)),i.embeddeds.forEach(function(u){return u.parentEmbeddedMetadata=i}),t.allEmbeddeds.push(i),i})},o.prototype.computeEntityMetadataStep2=function(t){var e=this;t.embeddeds.forEach(function(n){return n.build(e.connection)}),t.embeddeds.forEach(function(n){n.columnsFromTree.forEach(function(r){return r.build(e.connection)}),n.relationsFromTree.forEach(function(r){return r.build()})}),t.ownColumns.forEach(function(n){return n.build(e.connection)}),t.ownRelations.forEach(function(n){return n.build()}),t.relations=t.embeddeds.reduce(function(n,r){return n.concat(r.relationsFromTree)},t.ownRelations),t.eagerRelations=t.relations.filter(function(n){return n.isEager}),t.lazyRelations=t.relations.filter(function(n){return n.isLazy}),t.oneToOneRelations=t.relations.filter(function(n){return n.isOneToOne}),t.oneToManyRelations=t.relations.filter(function(n){return n.isOneToMany}),t.manyToOneRelations=t.relations.filter(function(n){return n.isManyToOne}),t.manyToManyRelations=t.relations.filter(function(n){return n.isManyToMany}),t.ownerOneToOneRelations=t.relations.filter(function(n){return n.isOneToOneOwner}),t.ownerManyToManyRelations=t.relations.filter(function(n){return n.isManyToManyOwner}),t.treeParentRelation=t.relations.find(function(n){return n.isTreeParent}),t.treeChildrenRelation=t.relations.find(function(n){return n.isTreeChildren}),t.columns=t.embeddeds.reduce(function(n,r){return n.concat(r.columnsFromTree)},t.ownColumns),t.listeners=t.embeddeds.reduce(function(n,r){return n.concat(r.listenersFromTree)},t.ownListeners),t.afterLoadListeners=t.listeners.filter(function(n){return n.type===Zt.AFTER_LOAD}),t.afterInsertListeners=t.listeners.filter(function(n){return n.type===Zt.AFTER_INSERT}),t.afterUpdateListeners=t.listeners.filter(function(n){return n.type===Zt.AFTER_UPDATE}),t.afterRemoveListeners=t.listeners.filter(function(n){return n.type===Zt.AFTER_REMOVE}),t.beforeInsertListeners=t.listeners.filter(function(n){return n.type===Zt.BEFORE_INSERT}),t.beforeUpdateListeners=t.listeners.filter(function(n){return n.type===Zt.BEFORE_UPDATE}),t.beforeRemoveListeners=t.listeners.filter(function(n){return n.type===Zt.BEFORE_REMOVE}),t.indices=t.embeddeds.reduce(function(n,r){return n.concat(r.indicesFromTree)},t.ownIndices),t.uniques=t.embeddeds.reduce(function(n,r){return n.concat(r.uniquesFromTree)},t.ownUniques),t.primaryColumns=t.columns.filter(function(n){return n.isPrimary}),t.nonVirtualColumns=t.columns.filter(function(n){return!n.isVirtual}),t.ancestorColumns=t.columns.filter(function(n){return"ancestor"===n.closureType}),t.descendantColumns=t.columns.filter(function(n){return"descendant"===n.closureType}),t.hasMultiplePrimaryKeys=t.primaryColumns.length>1,t.generatedColumns=t.columns.filter(function(n){return n.isGenerated||n.isObjectId}),t.hasUUIDGeneratedColumns=t.columns.filter(function(n){return n.isGenerated||"uuid"===n.generationStrategy}).length>0,t.createDateColumn=t.columns.find(function(n){return n.isCreateDate}),t.updateDateColumn=t.columns.find(function(n){return n.isUpdateDate}),t.deleteDateColumn=t.columns.find(function(n){return n.isDeleteDate}),t.versionColumn=t.columns.find(function(n){return n.isVersion}),t.discriminatorColumn=t.columns.find(function(n){return n.isDiscriminator}),t.treeLevelColumn=t.columns.find(function(n){return n.isTreeLevel}),t.nestedSetLeftColumn=t.columns.find(function(n){return n.isNestedSetLeft}),t.nestedSetRightColumn=t.columns.find(function(n){return n.isNestedSetRight}),t.materializedPathColumn=t.columns.find(function(n){return n.isMaterializedPath}),t.objectIdColumn=t.columns.find(function(n){return n.isObjectId}),t.foreignKeys.forEach(function(n){return n.build(e.connection.namingStrategy)}),t.propertiesMap=t.createPropertiesMap(),t.relationIds.forEach(function(n){return n.build()}),t.relationCounts.forEach(function(n){return n.build()}),t.embeddeds.forEach(function(n){n.relationIdsFromTree.forEach(function(r){return r.build()}),n.relationCountsFromTree.forEach(function(r){return r.build()})})},o.prototype.computeInverseProperties=function(t,e){t.relations.forEach(function(n){var r=e.find(function(i){return i.target===n.type||"string"==typeof n.type&&(i.targetName===n.type||i.givenTableName===n.type)});if(!r)throw new O.K_("Entity metadata for "+t.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find(function(i){return i.propertyPath===n.inverseSidePropertyPath})})},o.prototype.createKeysForTableInheritance=function(t){t.indices.push(new Rt({entityMetadata:t,columns:[t.discriminatorColumn],args:{target:t.target,unique:!1}}))},o}(),_r=function(){function o(){}return o.prototype.transform=function(t){var e=new D;return t.forEach(function(n){var r=n.options;e.tables.push({target:r.target||r.name,name:r.tableName,database:r.database,schema:r.schema,type:r.type||"regular",orderBy:r.orderBy,synchronize:r.synchronize,expression:r.expression}),Object.keys(r.columns).forEach(function(s){var u=r.columns[s],l="regular";u.createDate&&(l="createDate"),u.updateDate&&(l="updateDate"),u.deleteDate&&(l="deleteDate"),u.version&&(l="version"),u.treeChildrenCount&&(l="treeChildrenCount"),u.treeLevel&&(l="treeLevel"),u.objectId&&(l="objectId"),e.columns.push({target:r.target||r.name,mode:l,propertyName:s,options:{type:u.type,name:u.objectId?"_id":u.name,length:u.length,width:u.width,nullable:u.nullable,readonly:u.readonly,update:u.update,select:u.select,insert:u.insert,primary:u.primary,unique:u.unique,comment:u.comment,default:u.default,onUpdate:u.onUpdate,precision:u.precision,scale:u.scale,zerofill:u.zerofill,unsigned:u.unsigned,charset:u.charset,collation:u.collation,enum:u.enum,asExpression:u.asExpression,generatedType:u.generatedType,hstoreType:u.hstoreType,array:u.array,transformer:u.transformer,spatialFeatureType:u.spatialFeatureType,srid:u.srid}}),u.generated&&e.generations.push({target:r.target||r.name,propertyName:s,strategy:"string"==typeof u.generated?u.generated:"increment"}),u.unique&&e.uniques.push({target:r.target||r.name,columns:[s]})}),r.relations&&Object.keys(r.relations).forEach(function(s){var u,l,f=r.relations[s];if(e.relations.push({target:r.target||r.name,propertyName:s,relationType:f.type,isLazy:f.lazy||!1,type:f.target,inverseSideProperty:f.inverseSide,isTreeParent:f.treeParent,isTreeChildren:f.treeChildren,options:{eager:f.eager||!1,cascade:f.cascade,nullable:f.nullable,onDelete:f.onDelete,onUpdate:f.onUpdate,deferrable:f.deferrable,primary:f.primary,persistence:f.persistence,orphanedRowAction:f.orphanedRowAction}}),f.joinColumn)if("boolean"==typeof f.joinColumn)e.joinColumns.push({target:r.target||r.name,propertyName:s});else{var K=Array.isArray(f.joinColumn)?f.joinColumn:[f.joinColumn];try{for(var z=(0,c.XA)(K),te=z.next();!te.done;te=z.next()){var re=te.value;e.joinColumns.push({target:r.target||r.name,propertyName:s,name:re.name,referencedColumnName:re.referencedColumnName})}}catch(de){u={error:de}}finally{try{te&&!te.done&&(l=z.return)&&l.call(z)}finally{if(u)throw u.error}}}f.joinTable&&e.joinTables.push("boolean"==typeof f.joinTable?{target:r.target||r.name,propertyName:s}:{target:r.target||r.name,propertyName:s,name:f.joinTable.name,database:f.joinTable.database,schema:f.joinTable.schema,joinColumns:f.joinTable.joinColumn?[f.joinTable.joinColumn]:f.joinTable.joinColumns,inverseJoinColumns:f.joinTable.inverseJoinColumn?[f.joinTable.inverseJoinColumn]:f.joinTable.inverseJoinColumns})}),r.indices&&r.indices.forEach(function(s){e.indices.push({target:r.target||r.name,name:s.name,unique:!0===s.unique,spatial:!0===s.spatial,fulltext:!0===s.fulltext,parser:s.parser,synchronize:!1!==s.synchronize,where:s.where,sparse:s.sparse,columns:s.columns})}),r.uniques&&r.uniques.forEach(function(s){e.uniques.push({target:r.target||r.name,name:s.name,columns:s.columns})}),r.checks&&r.checks.forEach(function(s){e.checks.push({target:r.target||r.name,name:s.name,expression:s.expression})}),r.exclusions&&r.exclusions.forEach(function(s){e.exclusions.push({target:r.target||r.name,name:s.name,expression:s.expression})})}),e},o}(),Br=function(){function o(t){this.connection=t}return o.prototype.buildMigrations=function(t){var e=(0,c.CR)(ce.s.splitClassesAndStrings(t),2);return(0,c.ev)((0,c.ev)([],(0,c.CR)(e[0])),(0,c.CR)(gn())).map(function(s){return bn(s)})},o.prototype.buildSubscribers=function(t){var e=(0,c.CR)(ce.s.splitClassesAndStrings(t||[]),2),i=(0,c.ev)((0,c.ev)([],(0,c.CR)(e[0])),(0,c.CR)(gn()));return yt().filterSubscribers(i).map(function(s){return bn(s.target)})},o.prototype.buildEntityMetadatas=function(t){var n=(0,c.CR)(ce.s.splitClassesAndStrings(t||[]),2)[0],i=n.filter(function(w){return!(w instanceof Pt.I)}),s=n.filter(function(w){return w instanceof Pt.I}),u=(0,c.ev)((0,c.ev)([],(0,c.CR)(i)),(0,c.CR)(gn()));u.forEach(function(w){w instanceof Pt.I&&s.push(w)});var l=new Qn(this.connection,yt()).build(u),f=(new _r).transform(s),b=new Qn(this.connection,f).build();return(0,c.ev)((0,c.ev)([],(0,c.CR)(l)),(0,c.CR)(b))},o}(),jn=h(5908),Ur=function(){function o(t){this.options=t}return o.prototype.logQuery=function(t,e,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=t+(e&&e.length?" -- PARAMETERS: "+this.stringifyParams(e):"");console.log("query: "+r)}},o.prototype.logQueryError=function(t,e,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=e+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",t)}},o.prototype.logQuerySlow=function(t,e,n,r){var i=e+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+t)},o.prototype.logSchemaBuild=function(t,e){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(t)},o.prototype.logMigration=function(t,e){console.log(t)},o.prototype.log=function(t,e,n){switch(t){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(e);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(e);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(e)}},o.prototype.stringifyParams=function(t){try{return JSON.stringify(t)}catch(e){return t}},o}(),Gn=function(){function o(t){this.options=t}return o.prototype.logQuery=function(t,e,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=t+(e&&e.length?" -- PARAMETERS: "+this.stringifyParams(e):"");A.logInfo("query:",A.highlightSql(r))}},o.prototype.logQueryError=function(t,e,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=e+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");A.logError("query failed:",A.highlightSql(i)),A.logError("error:",t)}},o.prototype.logQuerySlow=function(t,e,n,r){var i=e+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");A.logWarn("query is slow:",A.highlightSql(i)),A.logWarn("execution time:",t)},o.prototype.logSchemaBuild=function(t,e){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&A.log(t)},o.prototype.logMigration=function(t,e){A.log(t)},o.prototype.log=function(t,e,n){switch(t){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&A.log(e);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&A.logInfo("INFO:",e);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(A.warn(e))}},o.prototype.stringifyParams=function(t){try{return JSON.stringify(t)}catch(e){return t}},o}(),Lr=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return(0,c.ZT)(t,o),t}(function(){function o(){}return o.prototype.logQuery=function(){throw new Error("This logger is not applicable in a browser context")},o.prototype.logQueryError=function(){throw new Error("This logger is not applicable in a browser context")},o.prototype.logQuerySlow=function(){throw new Error("This logger is not applicable in a browser context")},o.prototype.logSchemaBuild=function(){throw new Error("This logger is not applicable in a browser context")},o.prototype.logMigration=function(){throw new Error("This logger is not applicable in a browser context")},o.prototype.log=function(){throw new Error("This logger is not applicable in a browser context")},o}()),qr=h(6996),Jt=h.n(qr),Jr=function(){function o(){this.debugQueryLog=Jt()("typeorm:query:log"),this.debugQueryError=Jt()("typeorm:query:error"),this.debugQuerySlow=Jt()("typeorm:query:slow"),this.debugSchemaBuild=Jt()("typeorm:schema"),this.debugMigration=Jt()("typeorm:migration"),this.debugLog=Jt()("typeorm:log"),this.debugInfo=Jt()("typeorm:info"),this.debugWarn=Jt()("typeorm:warn")}return o.prototype.logQuery=function(t,e,n){this.debugQueryLog.enabled&&(this.debugQueryLog(A.highlightSql(t)+";"),e&&e.length&&this.debugQueryLog("parameters:",e))},o.prototype.logQueryError=function(t,e,n,r){this.debugQueryError.enabled&&(this.debugQueryError(A.highlightSql(e)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",t))},o.prototype.logQuerySlow=function(t,e,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(A.highlightSql(e)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",t))},o.prototype.logSchemaBuild=function(t,e){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(t)},o.prototype.logMigration=function(t,e){this.debugMigration.enabled&&this.debugMigration(t)},o.prototype.log=function(t,e,n){switch(t){case"log":this.debugLog.enabled&&this.debugLog(e);break;case"info":this.debugInfo.enabled&&this.debugInfo(e);break;case"warn":this.debugWarn.enabled&&this.debugWarn(e)}},o}(),Qr=function(){function o(){}return o.prototype.create=function(t,e){if(t instanceof Object)return t;if(t)switch(t){case"simple-console":return new Ur(e);case"file":return new Lr(e);case"advanced-console":return new Gn(e);case"debug":return new Jr}return new Gn(e)},o}(),jr=function(){function o(t,e){this.connection=t,this.clientType=e,this.redis=this.loadRedis()}return o.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){var t;return(0,c.Jh)(this,function(e){if(t=this.connection.options.cache,"redis"===this.clientType)this.client=t&&t.options?this.redis.createClient(t.options):this.redis.createClient();else if("ioredis"===this.clientType)this.client=t&&t.port?t.options?new this.redis(t.port,t.options):new this.redis(t.port):t&&t.options?new this.redis(t.options):new this.redis;else if("ioredis/cluster"===this.clientType)if(t&&t.options&&Array.isArray(t.options))this.client=new this.redis.Cluster(t.options);else{if(!(t&&t.options&&t.options.startupNodes))throw new Se.K("options.startupNodes required for "+this.clientType+".");this.client=new this.redis.Cluster(t.options.startupNodes,t.options.options)}return[2]})})},o.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){var t=this;return(0,c.Jh)(this,function(e){return[2,new Promise(function(n,r){t.client.quit(function(i,s){if(i)return r(i);n(),t.client=void 0})})]})})},o.prototype.synchronize=function(t){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2]})})},o.prototype.getFromCache=function(t,e){var n=this;return new Promise(function(r,i){t.identifier?n.client.get(t.identifier,function(s,u){if(s)return i(s);r(JSON.parse(u))}):t.query?n.client.get(t.query,function(s,u){if(s)return i(s);r(JSON.parse(u))}):r(void 0)})},o.prototype.isExpired=function(t){return t.time+t.duration<(new Date).getTime()},o.prototype.storeInCache=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){var r=this;return(0,c.Jh)(this,function(i){return[2,new Promise(function(s,u){t.identifier?r.client.set(t.identifier,JSON.stringify(t),"PX",t.duration,function(l,f){if(l)return u(l);s()}):t.query&&r.client.set(t.query,JSON.stringify(t),"PX",t.duration,function(l,f){if(l)return u(l);s()})})]})})},o.prototype.clear=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e=this;return(0,c.Jh)(this,function(n){return[2,new Promise(function(r,i){e.client.flushdb(function(s,u){if(s)return i(s);r()})})]})})},o.prototype.remove=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n=this;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(i){return n.deleteKey(i)}))];case 1:return r.sent(),[2]}})})},o.prototype.deleteKey=function(t){var e=this;return new Promise(function(n,r){e.client.del(t,function(i,s){if(i)return r(i);n()})})},o.prototype.loadRedis=function(){try{return A.load("ioredis/cluster"===this.clientType?"ioredis":this.clientType)}catch(t){throw new Se.K("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},o}(),Gr=function(){function o(t){this.connection=t;var e=this.connection.driver.options.schema,n=this.connection.driver.database,i=("object"==typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheDatabase=n,this.queryResultCacheSchema=e,this.queryResultCacheTable=this.connection.driver.buildTableName(i,e,n)}return o.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){return[2]})})},o.prototype.disconnect=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){return[2]})})},o.prototype.synchronize=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return t=this.getQueryRunner(t),e=this.connection.driver,[4,t.hasTable(this.queryResultCacheTable)];case 1:return r.sent()?[2]:[4,t.createTable(new ee.i({database:this.queryResultCacheDatabase,schema:this.queryResultCacheSchema,name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:e.normalizeType({type:e.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:e.normalizeType({type:e.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:e.normalizeType({type:e.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:e.normalizeType({type:e.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:e.normalizeType({type:e.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:e.normalizeType({type:e.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return r.sent(),[2]}})})},o.prototype.getFromCache=function(t,e){e=this.getQueryRunner(e);var n=this.connection.createQueryBuilder(e).select().from(this.queryResultCacheTable,"cache");return t.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof C.Z0?new Q(t.identifier,"nvarchar"):t.identifier}).getRawOne():t.query?this.connection.driver instanceof C.XR?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:t.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof C.Z0?new Q(t.query,"nvarchar"):t.query}).getRawOne():Promise.resolve(void 0)},o.prototype.isExpired=function(t){var e="string"==typeof t.duration?parseInt(t.duration):t.duration;return("string"==typeof t.time?parseInt(t.time):t.time)+e<(new Date).getTime()},o.prototype.storeInCache=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){var r,i;return(0,c.Jh)(this,function(s){switch(s.label){case 0:return n=this.getQueryRunner(n),r=t,this.connection.driver instanceof C.Z0&&(r={identifier:new Q(t.identifier,"nvarchar"),time:new Q(t.time,"bigint"),duration:new Q(t.duration,"int"),query:new Q(t.query,"nvarchar"),result:new Q(t.result,"nvarchar")}),e&&e.identifier?((i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r)).where(i.escape("identifier")+" = :condition",{condition:r.identifier}),[4,i.execute()]):[3,2];case 1:return s.sent(),[3,6];case 2:return e&&e.query?((i=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(r)).where(this.connection.driver instanceof C.XR?'dbms_lob.compare("query", :condition) = 0':i.escape("query")+" = :condition",{condition:r.query}),[4,i.execute()]):[3,4];case 3:return s.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(r).execute()];case 5:s.sent(),s.label=6;case 6:return[2]}})})},o.prototype.clear=function(t){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){return[2,this.getQueryRunner(t).clearTable(this.queryResultCacheTable)]})})},o.prototype.remove=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){var n=this;return(0,c.Jh)(this,function(r){switch(r.label){case 0:return[4,Promise.all(t.map(function(i){var s=n.getQueryRunner(e).manager.createQueryBuilder();return s.delete().from(n.queryResultCacheTable).where(s.escape("identifier")+" = :identifier",{identifier:i}).execute()}))];case 1:return r.sent(),[2]}})})},o.prototype.getQueryRunner=function(t){return t||this.connection.createQueryRunner()},o}(),Kr=function(){function o(t){this.connection=t}return o.prototype.create=function(){if(!this.connection.options.cache)throw new Se.K("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");var t=this.connection.options.cache;return t.provider&&"function"==typeof t.provider?t.provider(this.connection):"redis"===t.type||"ioredis"===t.type||"ioredis/cluster"===t.type?new jr(this.connection,t.type):new Gr(this.connection)},o}(),Wr=function(){function o(t){this.connection=t}return o.prototype.load=function(t,e,n){return n&&n.isReleased&&(n=void 0),t.isManyToOne||t.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(t,e,n):t.isOneToMany||t.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(t,e,n):t.isManyToManyOwner?this.loadManyToManyOwner(t,e,n):this.loadManyToManyNotOwner(t,e,n)},o.prototype.loadManyToOneOrOneToOneOwner=function(t,e,n){var r=Array.isArray(e)?e:[e],i=t.entityMetadata.primaryColumns,u=(t.isOwning?t.joinColumns:t.inverseRelation.joinColumns).map(function(w){return t.entityMetadata.name+"."+w.propertyName+" = "+t.propertyName+"."+w.referencedColumn.propertyName}).join(" AND "),l=t.entityMetadata.name,f=this.connection.createQueryBuilder(n).select(t.propertyName).from(t.type,t.propertyName).innerJoin(t.entityMetadata.target,l,u);if(1===i.length)f.where(l+"."+i[0].propertyPath+" IN (:..."+l+"_"+i[0].propertyName+")"),f.setParameter(l+"_"+i[0].propertyName,r.map(function(w){return i[0].getEntityValue(w)}));else{var b=r.map(function(w,K){return i.map(function(z,te){var re=l+"_entity_"+K+"_"+te;return f.setParameter(re,z.getEntityValue(w)),l+"."+z.propertyPath+" = :"+re}).join(" AND ")}).map(function(w){return"("+w+")"}).join(" OR ");f.where(b)}return f.getMany()},o.prototype.loadOneToManyOrOneToOneNotOwner=function(t,e,n){var r=Array.isArray(e)?e:[e],i=t.propertyName,s=t.inverseRelation.joinColumns,u=this.connection.createQueryBuilder(n).select(i).from(t.inverseRelation.entityMetadata.target,i);if(1===s.length)u.where(i+"."+s[0].propertyPath+" IN (:..."+i+"_"+s[0].propertyName+")"),u.setParameter(i+"_"+s[0].propertyName,r.map(function(f){return s[0].referencedColumn.getEntityValue(f)}));else{var l=r.map(function(f,b){return s.map(function(w,K){var z=i+"_entity_"+b+"_"+K;return u.setParameter(z,w.referencedColumn.getEntityValue(f)),i+"."+w.propertyPath+" = :"+z}).join(" AND ")}).map(function(f){return"("+f+")"}).join(" OR ");u.where(l)}return u.getMany()},o.prototype.loadManyToManyOwner=function(t,e,n){var r=Array.isArray(e)?e:[e],i=t.propertyName,s=t.junctionEntityMetadata.tableName,u=t.joinColumns.map(function(b){return s+"."+b.propertyName+" IN (:..."+b.propertyName+")"}),l=t.inverseJoinColumns.map(function(b){return s+"."+b.propertyName+"="+i+"."+b.referencedColumn.propertyName}),f=t.joinColumns.reduce(function(b,w){return b[w.propertyName]=r.map(function(K){return w.referencedColumn.getEntityValue(K)}),b},{});return this.connection.createQueryBuilder(n).select(i).from(t.type,i).innerJoin(s,s,(0,c.ev)((0,c.ev)([],(0,c.CR)(u)),(0,c.CR)(l)).join(" AND ")).setParameters(f).getMany()},o.prototype.loadManyToManyNotOwner=function(t,e,n){var r=Array.isArray(e)?e:[e],i=t.propertyName,s=t.junctionEntityMetadata.tableName,u=t.inverseRelation.joinColumns.map(function(b){return s+"."+b.propertyName+" = "+i+"."+b.referencedColumn.propertyName}),l=t.inverseRelation.inverseJoinColumns.map(function(b){return s+"."+b.propertyName+" IN (:..."+b.propertyName+")"}),f=t.inverseRelation.inverseJoinColumns.reduce(function(b,w){return b[w.propertyName]=r.map(function(K){return w.referencedColumn.getEntityValue(K)}),b},{});return this.connection.createQueryBuilder(n).select(i).from(t.type,i).innerJoin(s,s,(0,c.ev)((0,c.ev)([],(0,c.CR)(u)),(0,c.CR)(l)).join(" AND ")).setParameters(f).getMany()},o.prototype.enableLazyLoad=function(t,e,n){var r=this,i="__"+t.propertyName+"__",s="__promise_"+t.propertyName+"__",u="__has_"+t.propertyName+"__",l=function(b,w){return b[i]=w,b[u]=!0,delete b[s],w},f=function(b,w){return delete b[u],delete b[i],b[s]=w,w.then(function(K){return b[s]===w?l(b,K):K}),w};Object.defineProperty(e,t.propertyName,{get:function(){if(!0===this[u]||void 0!==this[i])return Promise.resolve(this[i]);if(this[s])return this[s];var b=r.load(t,this,n).then(function(w){return t.isOneToOne||t.isManyToOne?0===w.length?null:w[0]:w});return f(this,b)},set:function(b){b instanceof Promise?f(this,b):l(this,b)},configurable:!0})},o}(),Zr=function(){function o(t){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=t.name||"default",this.options=t,this.logger=(new Qr).create(this.options.logger,this.options.logging),this.driver=(new Rr).create(this),this.manager=this.createEntityManager(),this.namingStrategy=t.namingStrategy||new F,this.queryResultCache=t.cache?new Kr(this).create():void 0,this.relationLoader=new Wr(this),this.isConnected=!1}return Object.defineProperty(o.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof C.$2))throw new Se.K("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof In))throw new Se.K("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!1,configurable:!0}),o.prototype.connect=function(){return(0,c.mG)(this,void 0,void 0,function(){var t;return(0,c.Jh)(this,function(e){switch(e.label){case 0:if(this.isConnected)throw new y.L(this.name);return[4,this.driver.connect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:e.sent(),e.label=3;case 3:Gt.g.assign(this,{isConnected:!0}),e.label=4;case 4:return e.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return e.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:e.sent(),e.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:e.sent(),e.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})]:[3,11];case 10:e.sent(),e.label=11;case 11:return[3,14];case 12:return t=e.sent(),[4,this.close()];case 13:throw e.sent(),t;case 14:return[2,this]}})})},o.prototype.close=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(t){switch(t.label){case 0:if(!this.isConnected)throw new I.$(this.name);return[4,this.driver.disconnect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:t.sent(),t.label=3;case 3:return Gt.g.assign(this,{isConnected:!1}),[2]}})})},o.prototype.synchronize=function(t){return void 0===t&&(t=!1),(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new I.$(this.name);return t?[4,this.dropDatabase()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return n.sent(),[2]}})})},o.prototype.dropDatabase=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e,n,r,s,u,l;return(0,c.Jh)(this,function(f){switch(f.label){case 0:t=this.createQueryRunner(),f.label=1;case 1:if(f.trys.push([1,,13,15]),!(this.driver instanceof C.Z0||this.driver instanceof C.p$||this.driver instanceof C.xI))return[3,10];e=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach(function(b){b.database&&-1===e.indexOf(b.database)&&e.push(b.database)}),f.label=2;case 2:f.trys.push([2,7,8,9]),n=(0,c.XA)(e),r=n.next(),f.label=3;case 3:return r.done?[3,6]:[4,t.clearDatabase(r.value)];case 4:f.sent(),f.label=5;case 5:return r=n.next(),[3,3];case 6:return[3,9];case 7:return s=f.sent(),u={error:s},[3,9];case 8:try{r&&!r.done&&(l=n.return)&&l.call(n)}finally{if(u)throw u.error}return[7];case 9:return[3,12];case 10:return[4,t.clearDatabase()];case 11:f.sent(),f.label=12;case 12:return[3,15];case 13:return[4,t.release()];case 14:return f.sent(),[7];case 15:return[2]}})})},o.prototype.runMigrations=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(r){switch(r.label){case 0:if(!this.isConnected)throw new I.$(this.name);return(e=new W(this)).transaction=t&&t.transaction||"all",[4,e.executePendingMigrations()];case 1:return[2,r.sent()]}})})},o.prototype.undoLastMigration=function(t){return(0,c.mG)(this,void 0,void 0,function(){var e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:if(!this.isConnected)throw new I.$(this.name);return(e=new W(this)).transaction=t&&t.transaction||"all",[4,e.undoLastMigration()];case 1:return n.sent(),[2]}})})},o.prototype.showMigrations=function(){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(e){switch(e.label){case 0:if(!this.isConnected)throw new I.$(this.name);return[4,new W(this).showMigrations()];case 1:return[2,e.sent()]}})})},o.prototype.hasMetadata=function(t){return!!this.findMetadata(t)},o.prototype.getMetadata=function(t){var e=this.findMetadata(t);if(!e)throw new E.t(t);return e},o.prototype.getRepository=function(t){return this.manager.getRepository(t)},o.prototype.getTreeRepository=function(t){return this.manager.getTreeRepository(t)},o.prototype.getMongoRepository=function(t){if(!(this.driver instanceof C.Qd))throw new Se.K("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(t)},o.prototype.getCustomRepository=function(t){return this.manager.getCustomRepository(t)},o.prototype.transaction=function(t,e){return(0,c.mG)(this,void 0,void 0,function(){return(0,c.Jh)(this,function(n){return[2,this.manager.transaction(t,e)]})})},o.prototype.query=function(t,e,n){return(0,c.mG)(this,void 0,void 0,function(){var r;return(0,c.Jh)(this,function(i){switch(i.label){case 0:if(this instanceof C.$2)throw new Se.K("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new Ae.i;r=n||this.createQueryRunner(),i.label=1;case 1:return i.trys.push([1,,3,6]),[4,r.query(t,e)];case 2:return[2,i.sent()];case 3:return n?[3,5]:[4,r.release()];case 4:i.sent(),i.label=5;case 5:return[7];case 6:return[2]}})})},o.prototype.createQueryBuilder=function(t,e,n){if(this instanceof C.$2)throw new Se.K("Query Builder is not supported by MongoDB.");if(e){var r=this.getMetadata(t);return new jn.Z(this,n).select(e).from(r.target,e)}return new jn.Z(this,t)},o.prototype.createQueryRunner=function(t){void 0===t&&(t="master");var e=this.driver.createQueryRunner(t),n=this.createEntityManager(e);return Object.assign(e,{manager:n}),e},o.prototype.getManyToManyMetadata=function(t,e){var n=this.getMetadata(t).findRelationWithPropertyPath(e);if(!n)throw new Se.K('Relation "'+e+'" was not found in '+t+" entity.");if(!n.isManyToMany)throw new Se.K('Relation "'+t+"#"+e+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},o.prototype.createEntityManager=function(t){return(new ur).create(this,t)},o.prototype.findMetadata=function(t){return this.entityMetadatas.find(function(e){return e.target===t||(t instanceof Pt.I?e.name===t.options.name:"string"==typeof t&&(-1!==t.indexOf(".")?e.tablePath===t:e.name===t||e.tableName===t))})},o.prototype.buildMetadatas=function(){var t=new Br(this),e=new Pe,n=t.buildSubscribers(this.options.subscribers||[]);Gt.g.assign(this,{subscribers:n});var r=t.buildEntityMetadatas(this.options.entities||[]);Gt.g.assign(this,{entityMetadatas:r});var i=t.buildMigrations(this.options.migrations||[]);Gt.g.assign(this,{migrations:i}),e.validateMany(this.entityMetadatas.filter(function(s){return"view"!==s.tableType}),this.driver)},o}(),Vr=h(4372),kr=h(6249),zr=function(){function o(){this.connectionMap=new Map}return Object.defineProperty(o.prototype,"connections",{get:function(){return Array.from(this.connectionMap.values())},enumerable:!1,configurable:!0}),o.prototype.has=function(t){return this.connectionMap.has(t)},o.prototype.get=function(t){void 0===t&&(t="default");var e=this.connectionMap.get(t);if(!e)throw new Vr.B(t);return e},o.prototype.create=function(t){var e=this.connectionMap.get(t.name||"default");if(e&&e.isConnected)throw new kr.n(t.name||"default");var n=new Zr(t);return this.connectionMap.set(n.name,n),n},o}();function yt(){var o=A.getGlobalVariable();return o.typeormMetadataArgsStorage||(o.typeormMetadataArgsStorage=new D),o.typeormMetadataArgsStorage}function Kn(o){return void 0===o&&(o="default"),bn(zr).get(o)}var Wn=h(4800);function Dt(o,t){return function(e,n){var r;"string"==typeof o||o instanceof Function?r=o:o&&(t=o,r=o.type),t||(t={});var i=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,n):void 0;if(!r&&i&&(r=i),!t.type&&r&&(t.type=r),"hstore"===t.type&&!t.hstoreType&&(t.hstoreType=i===Object?"object":"string"),o instanceof Function)yt().embeddeds.push({target:e.constructor,propertyName:n,isArray:i===Array||!0===t.array,prefix:void 0!==t.prefix?t.prefix:void 0,type:o});else{if(!t.type)throw new Wn.s(e,n);!0===t.unique&&yt().uniques.push({target:e.constructor,columns:[n]}),yt().columns.push({target:e.constructor,propertyName:n,mode:"regular",options:t}),t.generated&&yt().generations.push({target:e.constructor,propertyName:n,strategy:"string"==typeof t.generated?t.generated:"increment"})}}}function ln(o){return function(t,e){yt().columns.push({target:t.constructor,propertyName:e,mode:"createDate",options:o||{}})}}var $r=h(8990);function Xt(o,t){return function(e,n){var r;"string"==typeof o?r=o:t=Object.assign({},o),t||(t={});var i=Reflect&&Reflect.getMetadata?Reflect.getMetadata("design:type",e,n):void 0;if(!r&&i&&(r=i),!t.type&&r&&(t.type=r),!t.type)throw new Wn.s(e,n);if(t.nullable)throw new $r.I(e,n);t.primary=!0,yt().columns.push({target:e.constructor,propertyName:n,mode:"regular",options:t}),t.generated&&yt().generations.push({target:e.constructor,propertyName:n,strategy:"string"==typeof t.generated?t.generated:"increment"})}}function fn(o){return function(t,e){yt().columns.push({target:t.constructor,propertyName:e,mode:"updateDate",options:o||{}})}}function Tn(o){return function(t,e){(Array.isArray(o)?o:[o||{}]).forEach(function(r){yt().joinColumns.push({target:t.constructor,propertyName:e,name:r.name,referencedColumnName:r.referencedColumnName})})}}function Cn(o,t,e){var n;return"object"==typeof t?e=t:n=t,function(r,i){e||(e={});var s=e&&!0===e.lazy;if(!s&&Reflect&&Reflect.getMetadata){var u=Reflect.getMetadata("design:type",r,i);u&&"string"==typeof u.name&&"promise"===u.name.toLowerCase()&&(s=!0)}yt().relations.push({target:r.constructor,propertyName:i,relationType:"many-to-one",isLazy:s,type:o,inverseSideProperty:n,options:e})}}function wn(o,t,e){return function(n,r){e||(e={});var i=e&&!0===e.lazy;if(!i&&Reflect&&Reflect.getMetadata){var s=Reflect.getMetadata("design:type",n,r);s&&"string"==typeof s.name&&"promise"===s.name.toLowerCase()&&(i=!0)}yt().relations.push({target:n.constructor,propertyName:r,isLazy:i,relationType:"one-to-many",type:o,inverseSideProperty:t,options:e})}}function hn(o,t){var e=("object"==typeof o?o:t)||{},n="string"==typeof o?o:e.name;return function(r){yt().tables.push({target:r,name:n,type:"regular",orderBy:e.orderBy?e.orderBy:void 0,engine:e.engine?e.engine:void 0,database:e.database?e.database:void 0,schema:e.schema?e.schema:void 0,synchronize:e.synchronize,withoutRowid:e.withoutRowid})}}h(5349),h(8108),function(){function o(){}o.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},o.prototype.save=function(t){return this.constructor.getRepository().save(this,t)},o.prototype.remove=function(t){return this.constructor.getRepository().remove(this,t)},o.prototype.softRemove=function(t){return this.constructor.getRepository().softRemove(this,t)},o.prototype.recover=function(t){return this.constructor.getRepository().recover(this,t)},o.prototype.reload=function(){return(0,c.mG)(this,void 0,void 0,function(){var t,e;return(0,c.Jh)(this,function(n){switch(n.label){case 0:return[4,(t=this.constructor).getRepository().findOneOrFail(t.getId(this))];case 1:return e=n.sent(),Gt.g.assign(this,e),[2]}})})},o.useConnection=function(t){this.usedConnection=t},o.getRepository=function(){return(this.usedConnection||Kn()).getRepository(this)},Object.defineProperty(o,"target",{get:function(){return this.getRepository().target},enumerable:!1,configurable:!0}),o.hasId=function(t){return this.getRepository().hasId(t)},o.getId=function(t){return this.getRepository().getId(t)},o.createQueryBuilder=function(t){return this.getRepository().createQueryBuilder(t)},o.create=function(t){return this.getRepository().create(t)},o.merge=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return(e=this.getRepository()).merge.apply(e,(0,c.ev)([t],(0,c.CR)(n)))},o.preload=function(t){return this.getRepository().preload(t)},o.save=function(t,e){return this.getRepository().save(t,e)},o.remove=function(t,e){return this.getRepository().remove(t,e)},o.softRemove=function(t,e){return this.getRepository().softRemove(t,e)},o.insert=function(t,e){return this.getRepository().insert(t,e)},o.update=function(t,e,n){return this.getRepository().update(t,e,n)},o.delete=function(t,e){return this.getRepository().delete(t,e)},o.count=function(t){return this.getRepository().count(t)},o.find=function(t){return this.getRepository().find(t)},o.findAndCount=function(t){return this.getRepository().findAndCount(t)},o.findByIds=function(t,e){return this.getRepository().findByIds(t,e)},o.findOne=function(t,e){return this.getRepository().findOne(t,e)},o.findOneOrFail=function(t,e){return this.getRepository().findOneOrFail(t,e)},o.query=function(t,e){return this.getRepository().query(t,e)},o.clear=function(){return this.getRepository().clear()}}(),h(2161),h(1993),h(7225),h(2739),h(514),h(2967),h(7706),h(6111),h(8666);
/*!
     */
let xt=class{constructor(t){Object.assign(this,t)}};(0,c.gn)([Xt({type:"integer",name:"film_id"})],xt.prototype,"filmId",void 0),(0,c.gn)([Xt({type:"integer",name:"order"})],xt.prototype,"order",void 0),(0,c.gn)([Dt({type:"text",name:"role"})],xt.prototype,"role",void 0),(0,c.gn)([Dt({type:"text",name:"name"})],xt.prototype,"name",void 0),(0,c.gn)([Cn(o=>pt,o=>o.casts),Tn({name:"film_id",referencedColumnName:"id"})],xt.prototype,"film",void 0),(0,c.gn)([ln({type:"datetime",name:"created_at"})],xt.prototype,"createdAt",void 0),(0,c.gn)([fn({type:"datetime",name:"updated_at"})],xt.prototype,"updatedAt",void 0),xt=(0,c.gn)([hn("casts")],xt);let Nt=class{constructor(t){Object.assign(this,t)}};(0,c.gn)([Xt({type:"integer",name:"film_id"})],Nt.prototype,"filmId",void 0),(0,c.gn)([Xt({type:"integer",name:"order"})],Nt.prototype,"order",void 0),(0,c.gn)([Dt({type:"text",name:"role"})],Nt.prototype,"role",void 0),(0,c.gn)([Dt({type:"text",name:"name"})],Nt.prototype,"name",void 0),(0,c.gn)([Cn(o=>pt,o=>o.staffs),Tn({name:"film_id",referencedColumnName:"id"})],Nt.prototype,"film",void 0),(0,c.gn)([ln({type:"datetime",name:"created_at"})],Nt.prototype,"createdAt",void 0),(0,c.gn)([fn({type:"datetime",name:"updated_at"})],Nt.prototype,"updatedAt",void 0),Nt=(0,c.gn)([hn("staffs")],Nt);let It=class{constructor(t){Object.assign(this,t)}};(0,c.gn)([Xt({type:"integer",name:"film_id"})],It.prototype,"filmId",void 0),(0,c.gn)([Xt({type:"integer",name:"order"})],It.prototype,"order",void 0),(0,c.gn)([Dt({type:"text",name:"name"})],It.prototype,"name",void 0),(0,c.gn)([Cn(o=>pt,o=>o.tags),Tn({name:"film_id",referencedColumnName:"id"})],It.prototype,"film",void 0),(0,c.gn)([ln({type:"datetime",name:"created_at"})],It.prototype,"createdAt",void 0),(0,c.gn)([fn({type:"datetime",name:"updated_at"})],It.prototype,"updatedAt",void 0),It=(0,c.gn)([hn("tags")],It);let pt=class{constructor(t){Object.assign(this,t)}};var o,t,n,e;(0,c.gn)([(o={name:"id"},e={},o?("string"==typeof o&&(n=o),o instanceof Object&&(n="increment",Object.assign(e,o))):n="increment",t instanceof Object&&Object.assign(e,t),function(r,i){e.type||("increment"===n?e.type=Number:"uuid"===n?e.type="uuid":"rowid"===n&&(e.type="int")),e.primary=!0,yt().columns.push({target:r.constructor,propertyName:i,mode:"regular",options:e}),yt().generations.push({target:r.constructor,propertyName:i,strategy:n})})],pt.prototype,"id",void 0),(0,c.gn)([Dt({type:"integer",name:"published_year",nullable:!0})],pt.prototype,"publishedYear",void 0),(0,c.gn)([Dt({type:"text",name:"title"})],pt.prototype,"title",void 0),(0,c.gn)([Dt({type:"text",name:"japanese_title",nullable:!0})],pt.prototype,"japaneseTitle",void 0),(0,c.gn)([Dt({type:"text",name:"scenario",nullable:!0})],pt.prototype,"scenario",void 0),(0,c.gn)([Dt({type:"text",name:"review",nullable:!0})],pt.prototype,"review",void 0),(0,c.gn)([wn(o=>xt,o=>o.film)],pt.prototype,"casts",void 0),(0,c.gn)([wn(o=>Nt,o=>o.film)],pt.prototype,"staffs",void 0),(0,c.gn)([wn(o=>It,o=>o.film)],pt.prototype,"tags",void 0),(0,c.gn)([ln({type:"datetime",name:"created_at"})],pt.prototype,"createdAt",void 0),(0,c.gn)([fn({type:"datetime",name:"updated_at"})],pt.prototype,"updatedAt",void 0),pt=(0,c.gn)([hn("films")],pt);let dn=(()=>{class o{constructor(e){this.httpClient=e}find(e,n){var r=this;return(0,m.Z)(function*(){const i={};return e&&n&&(i.params={target_column:e,search_text:n}),yield r.httpClient.get(`${N.N.apiUrl}/films`,i).toPromise()})()}findById(e){var n=this;return(0,m.Z)(function*(){return yield n.httpClient.get(`${N.N.apiUrl}/films/${e}`).toPromise()})()}create(e){var n=this;return(0,m.Z)(function*(){return yield n.httpClient.post(`${N.N.apiUrl}/films`,e).toPromise()})()}save(e){var n=this;return(0,m.Z)(function*(){return yield n.httpClient.put(`${N.N.apiUrl}/films/${e.id}`,e).toPromise()})()}remove(e){var n=this;return(0,m.Z)(function*(){return yield n.httpClient.delete(`${N.N.apiUrl}/films/${e}`).toPromise()})()}exportToJson(){var e=this;return(0,m.Z)(function*(){return yield e.httpClient.post(`${N.N.apiUrl}/export-to-json`,null).toPromise()})()}}return o.\u0275fac=function(e){return new(e||o)(a.LFG(g.eN))},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})();var ei=h(6227);function ti(o,t){1&o&&(a.TgZ(0,"div",9),a._uU(1,"\u8aad\u8fbc\u4e2d\u2026"),a.qZA())}function ni(o,t){1&o&&(a.TgZ(0,"div",9),a._uU(1,"\u66f4\u65b0\u4e2d\u2026"),a.qZA())}function ri(o,t){1&o&&(a.TgZ(0,"div",10),a._uU(1,"Edit Film Meta"),a.qZA())}function ii(o,t){1&o&&(a.TgZ(0,"div",11),a._uU(1,"\u5909\u66f4\u3092\u7834\u68c4\u3057\u307e\u3059\u304b\uff1f"),a.qZA())}function ai(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"button",12),a.NdJ("click",function(){return a.CHM(e),a.oxw().isConfirmedToClose=!1}),a._uU(1,"Cancel"),a.qZA()}if(2&o){const e=a.oxw();a.Q6J("disabled",e.isLoading||e.isSubmitting)}}function si(o,t){1&o&&(a.ynx(0),a._uU(1,"\u30fb\u90a6\u984c"),a.BQk())}function oi(o,t){if(1&o&&(a.ynx(0),a._uU(1),a.BQk()),2&o){const e=a.oxw(2);a.xp6(1),a.hij(" ",e.film.japaneseTitle,"")}}function ui(o,t){if(1&o&&(a.ynx(0),a._uU(1),a.BQk()),2&o){const e=a.oxw(2);a.xp6(1),a.Oqu(e.film.scenario)}}function ci(o,t){1&o&&a._uU(0,"-")}function li(o,t){if(1&o&&(a.ynx(0),a._uU(1),a.BQk()),2&o){const e=a.oxw(2);a.xp6(1),a.Oqu(e.film.review)}}function fi(o,t){1&o&&a._uU(0,"-")}function hi(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"tr",35),a.TgZ(1,"td",20),a._UZ(2,"input",36),a.qZA(),a.TgZ(3,"td",21),a._UZ(4,"input",27),a.qZA(),a.TgZ(5,"td",22),a._UZ(6,"input",28),a.qZA(),a.TgZ(7,"td",23),a.TgZ(8,"div",37),a.TgZ(9,"button",38),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onUpCast(i)}),a._uU(10,"\u2191"),a.qZA(),a.TgZ(11,"button",39),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onDownCast(i)}),a._uU(12,"\u2193"),a.qZA(),a.TgZ(13,"button",40),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onRemoveCast(i)}),a._uU(14,"\xd7"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=t.index,n=t.count,r=a.oxw(2);a.Q6J("formGroupName",e),a.xp6(9),a.Q6J("disabled",r.isSubmitting||0===e),a.xp6(2),a.Q6J("disabled",r.isSubmitting||e===n-1),a.xp6(2),a.Q6J("disabled",r.isSubmitting)}}function di(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"tr",35),a.TgZ(1,"td",20),a._UZ(2,"input",36),a.qZA(),a.TgZ(3,"td",21),a._UZ(4,"input",31),a.qZA(),a.TgZ(5,"td",22),a._UZ(6,"input",28),a.qZA(),a.TgZ(7,"td",23),a.TgZ(8,"div",37),a.TgZ(9,"button",38),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onUpStaff(i)}),a._uU(10,"\u2191"),a.qZA(),a.TgZ(11,"button",39),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onDownStaff(i)}),a._uU(12,"\u2193"),a.qZA(),a.TgZ(13,"button",40),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onRemoveStaff(i)}),a._uU(14,"\xd7"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=t.index,n=t.count,r=a.oxw(2);a.Q6J("formGroupName",e),a.xp6(9),a.Q6J("disabled",r.isSubmitting||0===e),a.xp6(2),a.Q6J("disabled",r.isSubmitting||e===n-1),a.xp6(2),a.Q6J("disabled",r.isSubmitting)}}function pi(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"tr",35),a.TgZ(1,"td",20),a._UZ(2,"input",36),a.qZA(),a.TgZ(3,"td",22),a._UZ(4,"input",34),a.qZA(),a.TgZ(5,"td",23),a.TgZ(6,"div",37),a.TgZ(7,"button",38),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onUpTag(i)}),a._uU(8,"\u2191"),a.qZA(),a.TgZ(9,"button",39),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onDownTag(i)}),a._uU(10,"\u2193"),a.qZA(),a.TgZ(11,"button",40),a.NdJ("click",function(){const i=a.CHM(e).index;return a.oxw(2).onRemoveTag(i)}),a._uU(12,"\xd7"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=t.index,n=t.count,r=a.oxw(2);a.Q6J("formGroupName",e),a.xp6(7),a.Q6J("disabled",r.isSubmitting||0===e),a.xp6(2),a.Q6J("disabled",r.isSubmitting||e===n-1),a.xp6(2),a.Q6J("disabled",r.isSubmitting)}}function mi(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"form",13),a.TgZ(1,"dl"),a.TgZ(2,"dt"),a._uU(3,"\u516c\u958b\u5e74\u30fb\u539f\u984c"),a.YNc(4,si,2,0,"ng-container",14),a.qZA(),a.TgZ(5,"dd"),a._uU(6),a.YNc(7,oi,2,1,"ng-container",14),a.qZA(),a.TgZ(8,"dt"),a._uU(9,"\u3042\u3089\u3059\u3058"),a.qZA(),a.TgZ(10,"dd"),a.YNc(11,ui,2,1,"ng-container",15),a.YNc(12,ci,1,0,"ng-template",null,16,a.W1O),a.qZA(),a.TgZ(14,"dt"),a._uU(15,"\u611f\u60f3"),a.qZA(),a.TgZ(16,"dd"),a.YNc(17,li,2,1,"ng-container",15),a.YNc(18,fi,1,0,"ng-template",null,17,a.W1O),a.qZA(),a.qZA(),a.TgZ(20,"div",18),a.TgZ(21,"table",19),a.TgZ(22,"caption"),a._uU(23,"\u30ad\u30e3\u30b9\u30c8"),a.qZA(),a.TgZ(24,"thead"),a.TgZ(25,"tr"),a.TgZ(26,"th",20),a._uU(27,"No"),a.qZA(),a.TgZ(28,"th",21),a._uU(29,"\u5f79\u540d"),a.qZA(),a.TgZ(30,"th",22),a._uU(31,"\u540d\u524d"),a.qZA(),a.TgZ(32,"th",23),a._uU(33,"\u64cd\u4f5c"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(34,"tbody"),a.ynx(35,24),a.YNc(36,hi,15,4,"tr",25),a.BQk(),a.TgZ(37,"tr",26),a.TgZ(38,"td",20),a._uU(39,"-"),a.qZA(),a.TgZ(40,"td",21),a._UZ(41,"input",27),a.qZA(),a.TgZ(42,"td",22),a._UZ(43,"input",28),a.qZA(),a.TgZ(44,"td",23),a.TgZ(45,"button",5),a.NdJ("click",function(){return a.CHM(e),a.oxw().onAddNewCast()}),a._uU(46,"\u8ffd\u52a0"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(47,"div",18),a.TgZ(48,"table",19),a.TgZ(49,"caption"),a._uU(50,"\u30b9\u30bf\u30c3\u30d5"),a.qZA(),a.TgZ(51,"thead"),a.TgZ(52,"tr"),a.TgZ(53,"th",20),a._uU(54,"No"),a.qZA(),a.TgZ(55,"th",21),a._uU(56,"\u5f79\u8077\u540d"),a.qZA(),a.TgZ(57,"th",22),a._uU(58,"\u540d\u524d"),a.qZA(),a.TgZ(59,"th",23),a._uU(60,"\u64cd\u4f5c"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(61,"tbody"),a.ynx(62,29),a.YNc(63,di,15,4,"tr",25),a.BQk(),a.TgZ(64,"tr",30),a.TgZ(65,"td",20),a._uU(66,"-"),a.qZA(),a.TgZ(67,"td",21),a._UZ(68,"input",31),a.qZA(),a.TgZ(69,"td",22),a._UZ(70,"input",28),a.qZA(),a.TgZ(71,"td",23),a.TgZ(72,"button",5),a.NdJ("click",function(){return a.CHM(e),a.oxw().onAddNewStaff()}),a._uU(73,"\u8ffd\u52a0"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(74,"div",18),a.TgZ(75,"table",19),a.TgZ(76,"caption"),a._uU(77,"\u30bf\u30b0"),a.qZA(),a.TgZ(78,"thead"),a.TgZ(79,"tr"),a.TgZ(80,"th",20),a._uU(81,"No"),a.qZA(),a.TgZ(82,"th",22),a._uU(83,"\u30bf\u30b0\u540d"),a.qZA(),a.TgZ(84,"th",23),a._uU(85,"\u64cd\u4f5c"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(86,"tbody"),a.ynx(87,32),a.YNc(88,pi,13,4,"tr",25),a.BQk(),a.TgZ(89,"tr",33),a.TgZ(90,"td",20),a._uU(91,"-"),a.qZA(),a.TgZ(92,"td",22),a._UZ(93,"input",34),a.qZA(),a.TgZ(94,"td",23),a.TgZ(95,"button",5),a.NdJ("click",function(){return a.CHM(e),a.oxw().onAddNewTag()}),a._uU(96,"\u8ffd\u52a0"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=a.MAs(13),n=a.MAs(19),r=a.oxw();a.Q6J("formGroup",r.filmMetaForm),a.xp6(4),a.Q6J("ngIf",r.film.japaneseTitle),a.xp6(2),a.AsE("",r.film.publishedYear,"\u5e74 : ",r.film.title,""),a.xp6(1),a.Q6J("ngIf",r.film.japaneseTitle),a.xp6(4),a.Q6J("ngIf",r.film.scenario)("ngIfElse",e),a.xp6(6),a.Q6J("ngIf",r.film.review)("ngIfElse",n),a.xp6(19),a.Q6J("ngForOf",r.casts.controls),a.xp6(9),a.Q6J("disabled",r.filmMetaForm.controls.newCast.invalid||r.isSubmitting),a.xp6(18),a.Q6J("ngForOf",r.staffs.controls),a.xp6(9),a.Q6J("disabled",r.filmMetaForm.controls.newStaff.invalid||r.isSubmitting),a.xp6(16),a.Q6J("ngForOf",r.tags.controls),a.xp6(7),a.Q6J("disabled",r.filmMetaForm.controls.newTag.invalid||r.isSubmitting)}}function yi(o,t){1&o&&(a.TgZ(0,"div",9),a._uU(1,"\u66f4\u65b0\u4e2d\u2026"),a.qZA())}function vi(o,t){if(1&o&&(a.TgZ(0,"div",41),a._uU(1),a.qZA()),2&o){const e=a.oxw();a.xp6(1),a.Oqu(e.errorMessage)}}let gi=(()=>{class o{constructor(e,n){this.formBuilder=e,this.adminApiFilmsService=n,this.onClosed=new a.vpe,this.isLoading=!0,this.isSubmitting=!1,this.isEdited=!1,this.isConfirmedToClose=!1,this.errorMessage=""}ngOnInit(){var e=this;return(0,m.Z)(function*(){e.isLoading=!0,e.errorMessage="";try{const n=yield e.adminApiFilmsService.findById(e.film.id);e.film=n,e.filmMetaForm=e.formBuilder.group({filmId:[n.id,[B.kI.required]],casts:e.formBuilder.array(n.casts.map(r=>e.createCastFormGroup(r))),staffs:e.formBuilder.array(n.staffs.map(r=>e.createStaffFormGroup(r))),tags:e.formBuilder.array(n.tags.map(r=>e.createTagFormGroup(r))),newCast:e.createCastFormGroup(),newStaff:e.createStaffFormGroup(),newTag:e.createTagFormGroup()})}catch(n){console.error("Film Meta Component : On Init",n),e.errorMessage="Failed To Fetch Film Meta"}finally{e.isLoading=!1}})()}onClose(){this.filmMetaForm.pristine&&!this.isEdited||this.isConfirmedToClose?this.onClosed.emit():this.isConfirmedToClose=!0}onUpdate(){var e=this;return(0,m.Z)(function*(){if(!e.isSubmitting){e.isSubmitting=!0,e.errorMessage="",e.isConfirmedToClose=!1;try{e.film.casts=e.casts.value,e.film.staffs=e.staffs.value,e.film.tags=e.tags.value;const n=yield e.adminApiFilmsService.save(e.film);e.film=n,e.filmMetaForm=e.formBuilder.group({filmId:[e.film.id,[B.kI.required]],casts:e.formBuilder.array(n.casts.map(r=>e.createCastFormGroup(r))),staffs:e.formBuilder.array(n.staffs.map(r=>e.createStaffFormGroup(r))),tags:e.formBuilder.array(n.tags.map(r=>e.createTagFormGroup(r))),newCast:e.createCastFormGroup(),newStaff:e.createStaffFormGroup(),newTag:e.createTagFormGroup()}),e.isEdited=!1}catch(n){console.error("Film Meta Component : On Update",n),e.errorMessage="Failed To Update"}finally{e.isSubmitting=!1}}})()}isDisabledUpdateButton(){return!this.isEdited&&(this.casts.pristine&&this.staffs.pristine&&this.tags.pristine||this.casts.invalid||this.staffs.invalid||this.tags.invalid)}onAddNewCast(){const e=this.filmMetaForm.get("newCast"),n=new xt(e.value);n.order=this.casts.length+1;const r=this.createCastFormGroup(n);this.casts.push(r),e.reset({filmId:this.film.id,order:-1}),this.isConfirmedToClose=!1,this.isEdited=!0}onUpCast(e){this.swapFormArray(this.casts,e,e-1)}onDownCast(e){this.swapFormArray(this.casts,e,e+1)}onRemoveCast(e){this.removeFormArray(this.casts,e)}onAddNewStaff(){const e=this.filmMetaForm.get("newStaff"),n=new Nt(e.value);n.order=this.staffs.length+1;const r=this.createStaffFormGroup(n);this.staffs.push(r),e.reset({filmId:this.film.id,order:-1}),this.isConfirmedToClose=!1,this.isEdited=!0}onUpStaff(e){this.swapFormArray(this.staffs,e,e-1)}onDownStaff(e){this.swapFormArray(this.staffs,e,e+1)}onRemoveStaff(e){this.removeFormArray(this.staffs,e)}onAddNewTag(){const e=this.filmMetaForm.get("newTag"),n=new It(e.value);n.order=this.tags.length+1;const r=this.createTagFormGroup(n);this.tags.push(r),e.reset({filmId:this.film.id,order:-1}),this.isConfirmedToClose=!1,this.isEdited=!0}onUpTag(e){this.swapFormArray(this.tags,e,e-1)}onDownTag(e){this.swapFormArray(this.tags,e,e+1)}onRemoveTag(e){this.removeFormArray(this.tags,e)}get casts(){return this.filmMetaForm.get("casts")}get staffs(){return this.filmMetaForm.get("staffs")}get tags(){return this.filmMetaForm.get("tags")}createCastFormGroup(e){var n,r,i;return this.formBuilder.group({filmId:[this.film.id,[B.kI.required]],order:[null!==(n=null==e?void 0:e.order)&&void 0!==n?n:-1,[B.kI.required]],role:[null!==(r=null==e?void 0:e.role)&&void 0!==r?r:"",[B.kI.required]],name:[null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"",[B.kI.required]]})}createStaffFormGroup(e){var n,r,i;return this.formBuilder.group({filmId:[this.film.id,[B.kI.required]],order:[null!==(n=null==e?void 0:e.order)&&void 0!==n?n:-1,[B.kI.required]],role:[null!==(r=null==e?void 0:e.role)&&void 0!==r?r:"",[B.kI.required]],name:[null!==(i=null==e?void 0:e.name)&&void 0!==i?i:"",[B.kI.required]]})}createTagFormGroup(e){var n,r;return this.formBuilder.group({filmId:[this.film.id,[B.kI.required]],order:[null!==(n=null==e?void 0:e.order)&&void 0!==n?n:-1,[B.kI.required]],name:[null!==(r=null==e?void 0:e.name)&&void 0!==r?r:"",[B.kI.required]]})}swapFormArray(e,n,r){const i=e.at(n),s=e.at(r),u=Object.assign({},i.value),l=Object.assign({},s.value);u.order=s.value.order,l.order=i.value.order,e.at(r).setValue(u),e.at(n).setValue(l),this.isConfirmedToClose=!1,this.isEdited=!0}removeFormArray(e,n){e.removeAt(n),e.controls.forEach((r,i)=>{r.controls.order.setValue(i+1)}),this.isConfirmedToClose=!1,this.isEdited=!0}}return o.\u0275fac=function(e){return new(e||o)(a.Y36(B.qu),a.Y36(dn))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-film-meta"]],inputs:{film:"film"},outputs:{onClosed:"onClosed"},decls:18,vars:11,consts:[[1,"grid-2-columns"],["class","text-info",4,"ngIf"],["class","text-bold",4,"ngIf"],["class","text-warning",4,"ngIf"],["type","button","class","cancel-button",3,"disabled","click",4,"ngIf"],["type","button",3,"disabled","click"],[3,"formGroup",4,"ngIf"],[1,"grid-2-columns","footer-controllers"],["class","text-danger",4,"ngIf"],[1,"text-info"],[1,"text-bold"],[1,"text-warning"],["type","button",1,"cancel-button",3,"disabled","click"],[3,"formGroup"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["noScenario",""],["noReview",""],[1,"table-wrapper"],[1,"form-table"],[1,"column-order"],[1,"column-role"],[1,"column-name"],[1,"column-operation"],["formArrayName","casts"],["class","edit-row",3,"formGroupName",4,"ngFor","ngForOf"],["formGroupName","newCast"],["type","text","placeholder","\u5f79\u540d","formControlName","role","required",""],["type","text","placeholder","\u540d\u524d","formControlName","name","required",""],["formArrayName","staffs"],["formGroupName","newStaff"],["type","text","placeholder","\u5f79\u8077\u540d","formControlName","role","required",""],["formArrayName","tags"],["formGroupName","newTag"],["type","text","placeholder","\u30bf\u30b0\u540d","formControlName","name","required",""],[1,"edit-row",3,"formGroupName"],["type","text","placeholder","\u9806\u5e8f","formControlName","order","required","","readonly","","tabindex","-1"],[1,"grid-3-columns"],["type","button","title","\u4e0a\u3078",3,"disabled","click"],["type","button","title","\u4e0b\u3078",3,"disabled","click"],["type","button","title","\u524a\u9664",3,"disabled","click"],[1,"text-danger"]],template:function(e,n){1&e&&(a.TgZ(0,"div",0),a.TgZ(1,"div"),a.YNc(2,ti,2,0,"div",1),a.YNc(3,ni,2,0,"div",1),a.YNc(4,ri,2,0,"div",2),a.YNc(5,ii,2,0,"div",3),a.qZA(),a.TgZ(6,"div"),a.YNc(7,ai,2,1,"button",4),a.TgZ(8,"button",5),a.NdJ("click",function(){return n.onClose()}),a._uU(9),a.qZA(),a.qZA(),a.qZA(),a.YNc(10,mi,97,15,"form",6),a.TgZ(11,"div",7),a.TgZ(12,"div"),a.YNc(13,yi,2,0,"div",1),a.YNc(14,vi,2,1,"div",8),a.qZA(),a.TgZ(15,"div"),a.TgZ(16,"button",5),a.NdJ("click",function(){return n.onUpdate()}),a._uU(17,"\u66f4\u65b0"),a.qZA(),a.qZA(),a.qZA()),2&e&&(a.xp6(2),a.Q6J("ngIf",n.isLoading),a.xp6(1),a.Q6J("ngIf",!n.isLoading&&n.isSubmitting),a.xp6(1),a.Q6J("ngIf",!n.isLoading&&!n.isSubmitting&&!n.isConfirmedToClose),a.xp6(1),a.Q6J("ngIf",!n.isLoading&&!n.isSubmitting&&n.isConfirmedToClose),a.xp6(2),a.Q6J("ngIf",n.isConfirmedToClose),a.xp6(1),a.Q6J("disabled",n.isLoading||n.isSubmitting),a.xp6(1),a.Oqu(n.isConfirmedToClose?"Yes Close":"Close"),a.xp6(1),a.Q6J("ngIf",n.filmMetaForm),a.xp6(3),a.Q6J("ngIf",!n.isLoading&&n.isSubmitting),a.xp6(1),a.Q6J("ngIf",n.errorMessage),a.xp6(2),a.Q6J("disabled",n.isLoading||n.isSubmitting||n.isDisabledUpdateButton()))},directives:[G.O5,B._Y,B.JL,B.sg,B.CE,G.sg,B.x0,B.Fj,B.JJ,B.u,B.Q7],styles:[".cancel-button[_ngcontent-%COMP%]{margin-right:1rem}form[_ngcontent-%COMP%]{margin:0}dl[_ngcontent-%COMP%]{margin-top:1rem}dl[_ngcontent-%COMP%]   dt[_ngcontent-%COMP%]{margin:0}dl[_ngcontent-%COMP%]   dd[_ngcontent-%COMP%]{margin-top:0;margin-bottom:.5rem}table[_ngcontent-%COMP%]   caption[_ngcontent-%COMP%]{text-align:left}table[_ngcontent-%COMP%]   .column-order[_ngcontent-%COMP%]{min-width:3rem;width:1%;max-width:3rem}table[_ngcontent-%COMP%]   .column-order[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{text-align:right;cursor:default;pointer-events:none}table[_ngcontent-%COMP%]   .column-role[_ngcontent-%COMP%]{min-width:10rem;width:20%}table[_ngcontent-%COMP%]   .column-name[_ngcontent-%COMP%]{min-width:15rem;width:80%}table[_ngcontent-%COMP%]   .column-operation[_ngcontent-%COMP%]{min-width:7rem;width:1%;max-width:7rem}table[_ngcontent-%COMP%]   .column-operation[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}.footer-controllers[_ngcontent-%COMP%]{margin-top:var(--nn-space-default)}"]}),o})(),Ei=(()=>{class o{constructor(e){this.adminApiFilmsService=e,this.onClosed=new a.vpe,this.isSubmitting=!1,this.errorMessage=""}onCancel(){this.onClosed.emit(!1)}onRemove(){var e=this;return(0,m.Z)(function*(){e.isSubmitting=!0,e.errorMessage="";try{yield e.adminApiFilmsService.remove(e.film.id),e.onClosed.emit(!0)}catch(n){console.error("Film Remove Component : On Remove",n),e.errorMessage="Failed To Remove"}finally{e.isSubmitting=!1}})()}}return o.\u0275fac=function(e){return new(e||o)(a.Y36(dn))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-film-remove"]],inputs:{film:"film"},outputs:{onClosed:"onClosed"},decls:9,vars:4,consts:[[1,"text-bold"],[1,"grid-2-columns"],["type","button",3,"disabled","click"]],template:function(e,n){1&e&&(a.TgZ(0,"h2"),a._uU(1,"\u672c\u5f53\u306b\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"),a.qZA(),a.TgZ(2,"p",0),a._uU(3),a.qZA(),a.TgZ(4,"div",1),a.TgZ(5,"button",2),a.NdJ("click",function(){return n.onCancel()}),a._uU(6,"Cancel"),a.qZA(),a.TgZ(7,"button",2),a.NdJ("click",function(){return n.onRemove()}),a._uU(8,"Remove"),a.qZA(),a.qZA()),2&e&&(a.xp6(3),a.AsE("",n.film.publishedYear,"\u5e74 : ",n.film.title,""),a.xp6(2),a.Q6J("disabled",n.isSubmitting),a.xp6(2),a.Q6J("disabled",n.isSubmitting))},styles:[""]}),o})();function bi(o,t){1&o&&(a.TgZ(0,"p",8),a._uU(1,"\u8aad\u8fbc\u4e2d\u2026"),a.qZA())}function Ti(o,t){1&o&&(a.TgZ(0,"p",8),a._uU(1,"\u691c\u7d22\u4e2d\u2026"),a.qZA())}function Ci(o,t){1&o&&(a.TgZ(0,"p",8),a._uU(1,"\u767b\u9332\u4e2d\u2026"),a.qZA())}function wi(o,t){1&o&&(a.TgZ(0,"p",8),a._uU(1,"\u66f4\u65b0\u4e2d\u2026"),a.qZA())}function Ai(o,t){1&o&&(a.TgZ(0,"p",8),a._uU(1,"\u51fa\u529b\u4e2d\u2026"),a.qZA())}function Mi(o,t){1&o&&(a.TgZ(0,"p",9),a._uU(1,"Admin : Films"),a.qZA())}function Ri(o,t){if(1&o&&(a.TgZ(0,"p",10),a._uU(1),a.qZA()),2&o){const e=a.oxw();a.xp6(1),a.Oqu(e.errorMessage)}}function xi(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"tr",30),a.TgZ(1,"td",14),a.TgZ(2,"input",31),a.NdJ("blur",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a.qZA(),a.qZA(),a.TgZ(3,"td",15),a.TgZ(4,"input",32),a.NdJ("blur",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a.qZA(),a.qZA(),a.TgZ(5,"td",16),a.TgZ(6,"input",33),a.NdJ("blur",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a.qZA(),a.qZA(),a.TgZ(7,"td",17),a.TgZ(8,"input",34),a.NdJ("blur",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a.qZA(),a.qZA(),a.TgZ(9,"td",18),a.TgZ(10,"input",35),a.NdJ("blur",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a.qZA(),a.qZA(),a.TgZ(11,"td",19),a.TgZ(12,"div",36),a.TgZ(13,"button",37),a.NdJ("click",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onStartEditMeta(i)}),a._uU(14,"\u2192"),a.qZA(),a.TgZ(15,"button",38),a.NdJ("click",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onUpdate(i)}),a._uU(16,"\u25cb"),a.qZA(),a.TgZ(17,"button",39),a.NdJ("click",function(){const i=a.CHM(e).$implicit;return a.oxw(4).onStartRemove(i)}),a._uU(18,"\xd7"),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=t.$implicit,n=t.index,r=a.oxw(4);a.Q6J("formGroupName",n),a.xp6(13),a.Q6J("disabled",r.isDisabled()),a.xp6(2),a.Q6J("disabled",r.isDisabled()||e.pristine||e.invalid),a.xp6(2),a.Q6J("disabled",r.isDisabled())}}function Ni(o,t){if(1&o&&(a.ynx(0,28),a.YNc(1,xi,19,4,"tr",29),a.BQk()),2&o){const e=a.oxw(3);a.xp6(1),a.Q6J("ngForOf",e.films.controls)}}function Pi(o,t){1&o&&(a.ynx(0),a._uU(1,"1\u4ef6\u3082\u6620\u753b\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),a.BQk())}function Si(o,t){1&o&&(a.ynx(0),a._uU(1,"\u6761\u4ef6\u306b\u5408\u81f4\u3059\u308b\u6620\u753b\u306f\u3042\u308a\u307e\u305b\u3093"),a.BQk())}function Oi(o,t){if(1&o&&(a.TgZ(0,"tr"),a.TgZ(1,"td",40),a.YNc(2,Pi,2,0,"ng-container",41),a.YNc(3,Si,2,0,"ng-container",41),a.qZA(),a.qZA()),2&o){const e=a.oxw(3);a.xp6(2),a.Q6J("ngIf","loading"===e.currentState||"loaded"===e.currentState),a.xp6(1),a.Q6J("ngIf","searching"===e.currentState||"searched"===e.currentState)}}function Di(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"table",13),a.TgZ(1,"thead"),a.TgZ(2,"tr"),a.TgZ(3,"th",14),a._uU(4,"\u516c\u958b\u5e74"),a.qZA(),a.TgZ(5,"th",15),a._uU(6,"\u539f\u984c"),a.qZA(),a.TgZ(7,"th",16),a._uU(8,"\u90a6\u984c"),a.qZA(),a.TgZ(9,"th",17),a._uU(10,"\u3042\u3089\u3059\u3058"),a.qZA(),a.TgZ(11,"th",18),a._uU(12,"\u611f\u60f3"),a.qZA(),a.TgZ(13,"th",19),a._uU(14,"\u64cd\u4f5c"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(15,"tbody"),a.YNc(16,Ni,2,1,"ng-container",20),a.YNc(17,Oi,4,2,"ng-template",null,21,a.W1O),a.TgZ(19,"tr",22),a.TgZ(20,"td",14),a._UZ(21,"input",23),a.qZA(),a.TgZ(22,"td",15),a._UZ(23,"input",24),a.qZA(),a.TgZ(24,"td",16),a._UZ(25,"input",25),a.qZA(),a.TgZ(26,"td",17),a._UZ(27,"input",26),a.qZA(),a.TgZ(28,"td",18),a._UZ(29,"input",27),a.qZA(),a.TgZ(30,"td",19),a.TgZ(31,"button",6),a.NdJ("click",function(){return a.CHM(e),a.oxw(2).onCreate()}),a._uU(32,"\u767b\u9332"),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=a.MAs(18),n=a.oxw(2);a.xp6(16),a.Q6J("ngIf",n.films.controls.length>0)("ngIfElse",e),a.xp6(15),a.Q6J("disabled",n.isDisabled()||n.filmsForm.controls.newFilm.invalid)}}function Ii(o,t){if(1&o&&(a.TgZ(0,"form",11),a.YNc(1,Di,33,3,"table",12),a.qZA()),2&o){const e=a.oxw();a.Q6J("formGroup",e.filmsForm),a.xp6(1),a.Q6J("ngIf","modal"!==e.currentState)}}function _i(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"div",42),a.TgZ(1,"div",43),a.TgZ(2,"app-film-meta",44),a.NdJ("onClosed",function(){return a.CHM(e),a.oxw().onEndEditMeta()}),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=a.oxw();a.xp6(2),a.Q6J("film",e.editingFilm)}}function Bi(o,t){if(1&o){const e=a.EpF();a.TgZ(0,"div",42),a.TgZ(1,"div",43),a.TgZ(2,"app-film-remove",44),a.NdJ("onClosed",function(r){return a.CHM(e),a.oxw().onEndRemove(r)}),a.qZA(),a.qZA(),a.qZA()}if(2&o){const e=a.oxw();a.xp6(2),a.Q6J("film",e.removingFilm)}}const Ui=[{path:"login",component:U},{path:"films",component:(()=>{class o{constructor(e,n,r){this.formBuilder=e,this.authGuard=n,this.adminApiFilmsService=r,this.currentState="loading",this.errorMessage="",this.editingFilm=null,this.removingFilm=null,this.lastFindParams=void 0}ngOnInit(){var e=this;return(0,m.Z)(function*(){yield e.onSearch()})()}onSearch(e){var n=this;return(0,m.Z)(function*(){n.currentState=e?"searching":"loading",n.errorMessage="";try{const r=yield n.adminApiFilmsService.find(null==e?void 0:e.targetColumn,null==e?void 0:e.searchText);n.filmsForm=n.formBuilder.group({films:n.formBuilder.array(r.map(i=>n.createFormGroup(i))),newFilm:n.createFormGroup()})}catch(r){console.error("Admin Films Component : On Search",r),n.errorMessage="Failed To Search Films"}finally{n.currentState=e?"searched":"loaded",n.lastFindParams=e}})()}onUpdate(e){var n=this;return(0,m.Z)(function*(){if(!(e.pristine||e.invalid||["creating","updating","exporting"].includes(n.currentState))){n.currentState="updating",n.errorMessage="";try{const r=Object.values(e.controls).filter(i=>i.dirty);yield n.adminApiFilmsService.save(new pt(e.value)),r.forEach(i=>{i.markAsUntouched(),i.markAsPristine()})}catch(r){console.error("Admin Films Component : On Update",r),n.errorMessage="Failed To Update"}finally{n.currentState=""}}})()}onCreate(){var e=this;return(0,m.Z)(function*(){if(!["creating","updating","exporting"].includes(e.currentState)){e.currentState="creating",e.errorMessage="";try{const n=e.filmsForm.get("newFilm"),r=yield e.adminApiFilmsService.create(new pt(n.value));e.films.push(e.createFormGroup(r)),n.reset()}catch(n){console.error("Admin Films Component : On Create",n),e.errorMessage="Failed To Create"}finally{e.currentState=""}}})()}onStartEditMeta(e){null==this.editingFilm&&(this.editingFilm=new pt(e.value),this.currentState="modal")}onEndEditMeta(){this.editingFilm=null,this.currentState=""}onStartRemove(e){null==this.removingFilm&&(this.removingFilm=new pt(e.value),this.currentState="modal")}onEndRemove(e){var n=this;return(0,m.Z)(function*(){n.removingFilm=null,n.currentState="",e&&(yield n.onSearch(n.lastFindParams))})()}isDisabled(){return["loading","searching","creating","updating","exporting"].includes(this.currentState)}onExportToJson(){var e=this;return(0,m.Z)(function*(){e.currentState="exporting",e.errorMessage="";try{const n=yield e.adminApiFilmsService.exportToJson();if(console.log("Admin Films Component : On Export To JSON",n),n.error)throw n.error}catch(n){console.error("Admin Films Component : On Export To JSON",n),e.errorMessage="Failed To Export To JSON"}finally{e.currentState=""}})()}onLogout(){return this.authGuard.logout(!0)}get films(){return this.filmsForm.get("films")}createFormGroup(e){var n,r,i,s,u,l;return this.formBuilder.group({id:[null!==(n=null==e?void 0:e.id)&&void 0!==n?n:null],publishedYear:[null!==(r=null==e?void 0:e.publishedYear)&&void 0!==r?r:"",[B.kI.required,B.kI.minLength(4),B.kI.maxLength(4),B.kI.pattern("^[1-9][0-9]{3}$")]],title:[null!==(i=null==e?void 0:e.title)&&void 0!==i?i:"",[B.kI.required]],japaneseTitle:[null!==(s=null==e?void 0:e.japaneseTitle)&&void 0!==s?s:""],scenario:[null!==(u=null==e?void 0:e.scenario)&&void 0!==u?u:""],review:[null!==(l=null==e?void 0:e.review)&&void 0!==l?l:""]})}}return o.\u0275fac=function(e){return new(e||o)(a.Y36(B.qu),a.Y36(v),a.Y36(dn))},o.\u0275cmp=a.Xpm({type:o,selectors:[["app-admin-films"]],decls:17,vars:14,consts:[[3,"hidden","isDisabled","onSubmit"],["class","text-info",4,"ngIf"],["class","text-bold",4,"ngIf"],["class","text-danger",4,"ngIf"],["class","table-wrapper",3,"formGroup",4,"ngIf"],[1,"grid-2-columns"],["type","button",3,"disabled","click"],["class","modal-wrapper",4,"ngIf"],[1,"text-info"],[1,"text-bold"],[1,"text-danger"],[1,"table-wrapper",3,"formGroup"],["class","form-table",4,"ngIf"],[1,"form-table"],[1,"column-published-year"],[1,"column-title"],[1,"column-japanese-title"],[1,"column-scenario"],[1,"column-review"],[1,"column-operation"],["formArrayName","films",4,"ngIf","ngIfElse"],["notFound",""],["formGroupName","newFilm"],["type","text","placeholder","\u516c\u958b\u5e74","formControlName","publishedYear","required","","minlength","4","maxlength","4","pattern","^[1-9][0-9]{3}$"],["type","text","placeholder","\u539f\u984c","formControlName","title","required",""],["type","text","placeholder","\u90a6\u984c","formControlName","japaneseTitle"],["type","text","placeholder","\u3042\u3089\u3059\u3058","formControlName","scenario"],["type","text","placeholder","\u611f\u60f3","formControlName","review"],["formArrayName","films"],["class","edit-row",3,"formGroupName",4,"ngFor","ngForOf"],[1,"edit-row",3,"formGroupName"],["type","text","placeholder","\u516c\u958b\u5e74","formControlName","publishedYear","required","","minlength","4","maxlength","4","pattern","^[1-9][0-9]{3}$",3,"blur"],["type","text","placeholder","\u539f\u984c","formControlName","title","required","",3,"blur"],["type","text","placeholder","\u90a6\u984c","formControlName","japaneseTitle",3,"blur"],["type","text","placeholder","\u3042\u3089\u3059\u3058","formControlName","scenario",3,"blur"],["type","text","placeholder","\u611f\u60f3","formControlName","review",3,"blur"],[1,"grid-3-columns"],["type","button","title","\u8a73\u7d30",3,"disabled","click"],["type","button","title","\u66f4\u65b0",3,"disabled","click"],["type","button","title","\u524a\u9664",3,"disabled","click"],["colspan","6",1,"text-warning","not-found"],[4,"ngIf"],[1,"modal-wrapper"],[1,"modal-container"],[3,"film","onClosed"]],template:function(e,n){1&e&&(a.TgZ(0,"app-search-form",0),a.NdJ("onSubmit",function(i){return n.onSearch(i)}),a.qZA(),a.YNc(1,bi,2,0,"p",1),a.YNc(2,Ti,2,0,"p",1),a.YNc(3,Ci,2,0,"p",1),a.YNc(4,wi,2,0,"p",1),a.YNc(5,Ai,2,0,"p",1),a.YNc(6,Mi,2,0,"p",2),a.YNc(7,Ri,2,1,"p",3),a.YNc(8,Ii,2,2,"form",4),a._UZ(9,"hr"),a.TgZ(10,"div",5),a.TgZ(11,"button",6),a.NdJ("click",function(){return n.onExportToJson()}),a._uU(12,"Export To JSON"),a.qZA(),a.TgZ(13,"button",6),a.NdJ("click",function(){return n.onLogout()}),a._uU(14,"Logout"),a.qZA(),a.qZA(),a.YNc(15,_i,3,1,"div",7),a.YNc(16,Bi,3,1,"div",7)),2&e&&(a.Q6J("hidden","modal"===n.currentState)("isDisabled",n.isDisabled()),a.xp6(1),a.Q6J("ngIf","loading"===n.currentState),a.xp6(1),a.Q6J("ngIf","searching"===n.currentState),a.xp6(1),a.Q6J("ngIf","creating"===n.currentState),a.xp6(1),a.Q6J("ngIf","updating"===n.currentState),a.xp6(1),a.Q6J("ngIf","exporting"===n.currentState),a.xp6(1),a.Q6J("ngIf",""===n.currentState||"loaded"===n.currentState||"searched"===n.currentState),a.xp6(1),a.Q6J("ngIf",n.errorMessage),a.xp6(1),a.Q6J("ngIf",n.filmsForm),a.xp6(3),a.Q6J("disabled",n.isDisabled()),a.xp6(2),a.Q6J("disabled",n.isDisabled()),a.xp6(2),a.Q6J("ngIf",null!=n.editingFilm),a.xp6(1),a.Q6J("ngIf",null!=n.removingFilm))},directives:[ei.o,G.O5,B._Y,B.JL,B.sg,B.x0,B.Fj,B.JJ,B.u,B.Q7,B.wO,B.nD,B.c5,B.CE,G.sg,gi,Ei],styles:["p[_ngcontent-%COMP%], form[_ngcontent-%COMP%]{margin-top:1rem}table[_ngcontent-%COMP%]   .column-published-year[_ngcontent-%COMP%]{min-width:4.5rem;width:1%;max-width:4.5rem}table[_ngcontent-%COMP%]   .column-published-year[_ngcontent-%COMP%]   input[type=text][_ngcontent-%COMP%]{text-align:center}table[_ngcontent-%COMP%]   .column-title[_ngcontent-%COMP%]{min-width:12rem;width:15%}table[_ngcontent-%COMP%]   .column-japanese-title[_ngcontent-%COMP%]{min-width:10rem;width:15%}table[_ngcontent-%COMP%]   .column-scenario[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   .column-review[_ngcontent-%COMP%]{min-width:15rem;width:30%}table[_ngcontent-%COMP%]   .column-operation[_ngcontent-%COMP%]{min-width:7rem;width:1%;max-width:7rem}table[_ngcontent-%COMP%]   .column-operation[_ngcontent-%COMP%]   .grid-3-columns[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}table[_ngcontent-%COMP%]   .column-operation[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   .not-found[_ngcontent-%COMP%]{padding:1rem .5rem}.modal-wrapper[_ngcontent-%COMP%]{position:fixed;top:0;right:0;bottom:0;left:0;padding:1rem;background:rgba(0,0,0,.5)}.modal-wrapper[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]{overflow-y:auto;height:100%;border-radius:6px;padding:1rem;background:var(--nn-colour-white)}"]}),o})(),canActivate:[v]},{path:"",redirectTo:"/admin/films",pathMatch:"full"},{path:"**",redirectTo:"/admin/films"}];let Fi=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({imports:[[P.Bz.forChild(Ui)],P.Bz]}),o})();var Li=h(5319);class qi extends Li.w{constructor(t,e){super()}schedule(t,e=0){return this}}let Zn=(()=>{class o{constructor(e,n=o.now){this.SchedulerAction=e,this.now=n}schedule(e,n=0,r){return new this.SchedulerAction(this,e).schedule(r,n)}}return o.now=()=>Date.now(),o})();class Qt extends Zn{constructor(t,e=Zn.now){super(t,()=>Qt.delegate&&Qt.delegate!==this?Qt.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return Qt.delegate&&Qt.delegate!==this?Qt.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}const Vn=new Qt(class extends qi{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let r,n=!1;try{this.work(t)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}),Qi=(()=>{function o(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return o.prototype=Object.create(Error.prototype),o})();var An=h(5345);class Ki{constructor(t,e,n,r){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=r}call(t,e){return e.subscribe(new Mn(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))}}class Mn extends An.Ds{constructor(t,e,n,r,i){super(t),this.absoluteTimeout=e,this.waitFor=n,this.withObservable=r,this.scheduler=i,this.scheduleTimeout()}static dispatchTimeout(t){const{withObservable:e}=t;t._unsubscribeAndRecycle(),t.add((0,An.ft)(e,new An.IY(t)))}scheduleTimeout(){const{action:t}=this;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(Mn.dispatchTimeout,this.waitFor,this))}_next(t){this.absoluteTimeout||this.scheduleTimeout(),super._next(t)}_unsubscribe(){this.action=void 0,this.scheduler=null,this.withObservable=null}}var kn=h(7574);function Vi(o,t=Vn){return function(o,t,e=Vn){return n=>{let r=function(o){return o instanceof Date&&!isNaN(+o)}(o),i=r?+o-e.now():Math.abs(o);return n.lift(new Ki(i,r,t,e))}}(o,function(o,t){return new kn.y(e=>e.error(o))}(new Qi),t)}let ki=(()=>{class o{intercept(e,n){e=e.clone({withCredentials:!0});const r=window.localStorage.getItem("accessToken");return r&&(e=e.clone({headers:e.headers.set("Authorization",`Bearer ${r}`)})),n.handle(e).pipe(Vi(3e3))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=a.Yz7({token:o,factory:o.\u0275fac}),o})(),zi=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=a.oAB({type:o}),o.\u0275inj=a.cJS({providers:[{provide:g.TP,useClass:ki,multi:!0},v,dn],imports:[[_.m,Fi]]}),o})()},2748:()=>{},7125:(Ee,ne)=>{"use strict";ne.byteLength=function(Z){var ie=a(Z),A=ie[1];return 3*(ie[0]+A)/4-A},ne.toByteArray=function(Z){var ie,R,D=a(Z),A=D[0],T=D[1],x=new _(function(Z,ie,D){return 3*(ie+D)/4-D}(0,A,T)),X=0,Y=T>0?A-4:A;for(R=0;R<Y;R+=4)ie=g[Z.charCodeAt(R)]<<18|g[Z.charCodeAt(R+1)]<<12|g[Z.charCodeAt(R+2)]<<6|g[Z.charCodeAt(R+3)],x[X++]=ie>>16&255,x[X++]=ie>>8&255,x[X++]=255&ie;return 2===T&&(ie=g[Z.charCodeAt(R)]<<2|g[Z.charCodeAt(R+1)]>>4,x[X++]=255&ie),1===T&&(ie=g[Z.charCodeAt(R)]<<10|g[Z.charCodeAt(R+1)]<<4|g[Z.charCodeAt(R+2)]>>2,x[X++]=ie>>8&255,x[X++]=255&ie),x},ne.fromByteArray=function(Z){for(var ie,D=Z.length,A=D%3,T=[],x=16383,X=0,Y=D-A;X<Y;X+=x)T.push(U(Z,X,X+x>Y?Y:X+x));return 1===A?T.push(h[(ie=Z[D-1])>>2]+h[ie<<4&63]+"=="):2===A&&T.push(h[(ie=(Z[D-2]<<8)+Z[D-1])>>10]+h[ie>>4&63]+h[ie<<2&63]+"="),T.join("")};for(var h=[],g=[],_="undefined"!=typeof Uint8Array?Uint8Array:Array,P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",m=0,N=P.length;m<N;++m)h[m]=P[m],g[P.charCodeAt(m)]=m;function a(Z){var ie=Z.length;if(ie%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var D=Z.indexOf("=");return-1===D&&(D=ie),[D,D===ie?0:4-D%4]}function J(Z){return h[Z>>18&63]+h[Z>>12&63]+h[Z>>6&63]+h[63&Z]}function U(Z,ie,D){for(var T=[],x=ie;x<D;x+=3)T.push(J((Z[x]<<16&16711680)+(Z[x+1]<<8&65280)+(255&Z[x+2])));return T.join("")}g["-".charCodeAt(0)]=62,g["_".charCodeAt(0)]=63},8988:(Ee,ne,h)=>{"use strict";
/*!
     * The buffer module from node.js, for the browser.
     *
     * @author   Feross Aboukhadijeh <https://feross.org>
     * @license  MIT
     */const g=h(7125),_=h(5331),P="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;ne.Buffer=v,ne.SlowBuffer=function(M){return+M!=M&&(M=0),v.alloc(+M)},ne.INSPECT_MAX_BYTES=50;const m=2147483647;function a(M){if(M>m)throw new RangeError('The value "'+M+'" is invalid for option "size"');const d=new Uint8Array(M);return Object.setPrototypeOf(d,v.prototype),d}function v(M,d,p){if("number"==typeof M){if("string"==typeof d)throw new TypeError('The "string" argument must be of type string. Received type number');return U(M)}return B(M,d,p)}function B(M,d,p){if("string"==typeof M)return function(M,d){if(("string"!=typeof d||""===d)&&(d="utf8"),!v.isEncoding(d))throw new TypeError("Unknown encoding: "+d);const p=0|X(M,d);let q=a(p);const k=q.write(M,d);return k!==p&&(q=q.slice(0,k)),q}(M,d);if(ArrayBuffer.isView(M))return function(M){if(ze(M,Uint8Array)){const d=new Uint8Array(M);return D(d.buffer,d.byteOffset,d.byteLength)}return Z(M)}(M);if(null==M)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M);if(ze(M,ArrayBuffer)||M&&ze(M.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(ze(M,SharedArrayBuffer)||M&&ze(M.buffer,SharedArrayBuffer)))return D(M,d,p);if("number"==typeof M)throw new TypeError('The "value" argument must not be of type number. Received type number');const q=M.valueOf&&M.valueOf();if(null!=q&&q!==M)return v.from(q,d,p);const k=function(M){if(v.isBuffer(M)){const d=0|T(M.length),p=a(d);return 0===p.length||M.copy(p,0,0,d),p}return void 0!==M.length?"number"!=typeof M.length||ae(M.length)?a(0):Z(M):"Buffer"===M.type&&Array.isArray(M.data)?Z(M.data):void 0}(M);if(k)return k;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof M[Symbol.toPrimitive])return v.from(M[Symbol.toPrimitive]("string"),d,p);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof M)}function G(M){if("number"!=typeof M)throw new TypeError('"size" argument must be of type number');if(M<0)throw new RangeError('The value "'+M+'" is invalid for option "size"')}function U(M){return G(M),a(M<0?0:0|T(M))}function Z(M){const d=M.length<0?0:0|T(M.length),p=a(d);for(let q=0;q<d;q+=1)p[q]=255&M[q];return p}function D(M,d,p){if(d<0||M.byteLength<d)throw new RangeError('"offset" is outside of buffer bounds');if(M.byteLength<d+(p||0))throw new RangeError('"length" is outside of buffer bounds');let q;return q=void 0===d&&void 0===p?new Uint8Array(M):void 0===p?new Uint8Array(M,d):new Uint8Array(M,d,p),Object.setPrototypeOf(q,v.prototype),q}function T(M){if(M>=m)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+m.toString(16)+" bytes");return 0|M}function X(M,d){if(v.isBuffer(M))return M.length;if(ArrayBuffer.isView(M)||ze(M,ArrayBuffer))return M.byteLength;if("string"!=typeof M)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof M);const p=M.length,q=arguments.length>2&&!0===arguments[2];if(!q&&0===p)return 0;let k=!1;for(;;)switch(d){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":return Ke(M).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*p;case"hex":return p>>>1;case"base64":return nt(M).length;default:if(k)return q?-1:Ke(M).length;d=(""+d).toLowerCase(),k=!0}}function Y(M,d,p){let q=!1;if((void 0===d||d<0)&&(d=0),d>this.length||((void 0===p||p>this.length)&&(p=this.length),p<=0)||(p>>>=0)<=(d>>>=0))return"";for(M||(M="utf8");;)switch(M){case"hex":return W(this,d,p);case"utf8":case"utf-8":return E(this,d,p);case"ascii":return Q(this,d,p);case"latin1":case"binary":return O(this,d,p);case"base64":return y(this,d,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,d,p);default:if(q)throw new TypeError("Unknown encoding: "+M);M=(M+"").toLowerCase(),q=!0}}function R(M,d,p){const q=M[d];M[d]=M[p],M[p]=q}function L(M,d,p,q,k){if(0===M.length)return-1;if("string"==typeof p?(q=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),ae(p=+p)&&(p=k?0:M.length-1),p<0&&(p=M.length+p),p>=M.length){if(k)return-1;p=M.length-1}else if(p<0){if(!k)return-1;p=0}if("string"==typeof d&&(d=v.from(d,q)),v.isBuffer(d))return 0===d.length?-1:H(M,d,p,q,k);if("number"==typeof d)return d&=255,"function"==typeof Uint8Array.prototype.indexOf?k?Uint8Array.prototype.indexOf.call(M,d,p):Uint8Array.prototype.lastIndexOf.call(M,d,p):H(M,[d],p,q,k);throw new TypeError("val must be string, number or Buffer")}function H(M,d,p,q,k){let st,se=1,ce=M.length,Qe=d.length;if(void 0!==q&&("ucs2"===(q=String(q).toLowerCase())||"ucs-2"===q||"utf16le"===q||"utf-16le"===q)){if(M.length<2||d.length<2)return-1;se=2,ce/=2,Qe/=2,p/=2}function ot(ct,qe){return 1===se?ct[qe]:ct.readUInt16BE(qe*se)}if(k){let ct=-1;for(st=p;st<ce;st++)if(ot(M,st)===ot(d,-1===ct?0:st-ct)){if(-1===ct&&(ct=st),st-ct+1===Qe)return ct*se}else-1!==ct&&(st-=st-ct),ct=-1}else for(p+Qe>ce&&(p=ce-Qe),st=p;st>=0;st--){let ct=!0;for(let qe=0;qe<Qe;qe++)if(ot(M,st+qe)!==ot(d,qe)){ct=!1;break}if(ct)return st}return-1}function j(M,d,p,q){p=Number(p)||0;const k=M.length-p;q?(q=Number(q))>k&&(q=k):q=k;const se=d.length;let ce;for(q>se/2&&(q=se/2),ce=0;ce<q;++ce){const Qe=parseInt(d.substr(2*ce,2),16);if(ae(Qe))return ce;M[p+ce]=Qe}return ce}function $(M,d,p,q){return rt(Ke(d,M.length-p),M,p,q)}function ee(M,d,p,q){return rt(function(M){const d=[];for(let p=0;p<M.length;++p)d.push(255&M.charCodeAt(p));return d}(d),M,p,q)}function F(M,d,p,q){return rt(nt(d),M,p,q)}function I(M,d,p,q){return rt(function(M,d){let p,q,k;const se=[];for(let ce=0;ce<M.length&&!((d-=2)<0);++ce)p=M.charCodeAt(ce),q=p>>8,k=p%256,se.push(k),se.push(q);return se}(d,M.length-p),M,p,q)}function y(M,d,p){return g.fromByteArray(0===d&&p===M.length?M:M.slice(d,p))}function E(M,d,p){p=Math.min(M.length,p);const q=[];let k=d;for(;k<p;){const se=M[k];let ce=null,Qe=se>239?4:se>223?3:se>191?2:1;if(k+Qe<=p){let ot,st,ct,qe;switch(Qe){case 1:se<128&&(ce=se);break;case 2:ot=M[k+1],128==(192&ot)&&(qe=(31&se)<<6|63&ot,qe>127&&(ce=qe));break;case 3:ot=M[k+1],st=M[k+2],128==(192&ot)&&128==(192&st)&&(qe=(15&se)<<12|(63&ot)<<6|63&st,qe>2047&&(qe<55296||qe>57343)&&(ce=qe));break;case 4:ot=M[k+1],st=M[k+2],ct=M[k+3],128==(192&ot)&&128==(192&st)&&128==(192&ct)&&(qe=(15&se)<<18|(63&ot)<<12|(63&st)<<6|63&ct,qe>65535&&qe<1114112&&(ce=qe))}}null===ce?(ce=65533,Qe=1):ce>65535&&(ce-=65536,q.push(ce>>>10&1023|55296),ce=56320|1023&ce),q.push(ce),k+=Qe}return function(M){const d=M.length;if(d<=S)return String.fromCharCode.apply(String,M);let p="",q=0;for(;q<d;)p+=String.fromCharCode.apply(String,M.slice(q,q+=S));return p}(q)}ne.kMaxLength=m,!(v.TYPED_ARRAY_SUPPORT=function(){try{const M=new Uint8Array(1),d={foo:function(){return 42}};return Object.setPrototypeOf(d,Uint8Array.prototype),Object.setPrototypeOf(M,d),42===M.foo()}catch(M){return!1}}())&&"undefined"!=typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(v.prototype,"parent",{enumerable:!0,get:function(){if(v.isBuffer(this))return this.buffer}}),Object.defineProperty(v.prototype,"offset",{enumerable:!0,get:function(){if(v.isBuffer(this))return this.byteOffset}}),v.poolSize=8192,v.from=function(M,d,p){return B(M,d,p)},Object.setPrototypeOf(v.prototype,Uint8Array.prototype),Object.setPrototypeOf(v,Uint8Array),v.alloc=function(M,d,p){return function(M,d,p){return G(M),M<=0?a(M):void 0!==d?"string"==typeof p?a(M).fill(d,p):a(M).fill(d):a(M)}(M,d,p)},v.allocUnsafe=function(M){return U(M)},v.allocUnsafeSlow=function(M){return U(M)},v.isBuffer=function(d){return null!=d&&!0===d._isBuffer&&d!==v.prototype},v.compare=function(d,p){if(ze(d,Uint8Array)&&(d=v.from(d,d.offset,d.byteLength)),ze(p,Uint8Array)&&(p=v.from(p,p.offset,p.byteLength)),!v.isBuffer(d)||!v.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(d===p)return 0;let q=d.length,k=p.length;for(let se=0,ce=Math.min(q,k);se<ce;++se)if(d[se]!==p[se]){q=d[se],k=p[se];break}return q<k?-1:k<q?1:0},v.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},v.concat=function(d,p){if(!Array.isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(0===d.length)return v.alloc(0);let q;if(void 0===p)for(p=0,q=0;q<d.length;++q)p+=d[q].length;const k=v.allocUnsafe(p);let se=0;for(q=0;q<d.length;++q){let ce=d[q];if(ze(ce,Uint8Array))se+ce.length>k.length?(v.isBuffer(ce)||(ce=v.from(ce)),ce.copy(k,se)):Uint8Array.prototype.set.call(k,ce,se);else{if(!v.isBuffer(ce))throw new TypeError('"list" argument must be an Array of Buffers');ce.copy(k,se)}se+=ce.length}return k},v.byteLength=X,v.prototype._isBuffer=!0,v.prototype.swap16=function(){const d=this.length;if(d%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<d;p+=2)R(this,p,p+1);return this},v.prototype.swap32=function(){const d=this.length;if(d%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<d;p+=4)R(this,p,p+3),R(this,p+1,p+2);return this},v.prototype.swap64=function(){const d=this.length;if(d%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<d;p+=8)R(this,p,p+7),R(this,p+1,p+6),R(this,p+2,p+5),R(this,p+3,p+4);return this},v.prototype.toLocaleString=v.prototype.toString=function(){const d=this.length;return 0===d?"":0===arguments.length?E(this,0,d):Y.apply(this,arguments)},v.prototype.equals=function(d){if(!v.isBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d||0===v.compare(this,d)},v.prototype.inspect=function(){let d="";const p=ne.INSPECT_MAX_BYTES;return d=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(d+=" ... "),"<Buffer "+d+">"},P&&(v.prototype[P]=v.prototype.inspect),v.prototype.compare=function(d,p,q,k,se){if(ze(d,Uint8Array)&&(d=v.from(d,d.offset,d.byteLength)),!v.isBuffer(d))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof d);if(void 0===p&&(p=0),void 0===q&&(q=d?d.length:0),void 0===k&&(k=0),void 0===se&&(se=this.length),p<0||q>d.length||k<0||se>this.length)throw new RangeError("out of range index");if(k>=se&&p>=q)return 0;if(k>=se)return-1;if(p>=q)return 1;if(this===d)return 0;let ce=(se>>>=0)-(k>>>=0),Qe=(q>>>=0)-(p>>>=0);const ot=Math.min(ce,Qe),st=this.slice(k,se),ct=d.slice(p,q);for(let qe=0;qe<ot;++qe)if(st[qe]!==ct[qe]){ce=st[qe],Qe=ct[qe];break}return ce<Qe?-1:Qe<ce?1:0},v.prototype.includes=function(d,p,q){return-1!==this.indexOf(d,p,q)},v.prototype.indexOf=function(d,p,q){return L(this,d,p,q,!0)},v.prototype.lastIndexOf=function(d,p,q){return L(this,d,p,q,!1)},v.prototype.write=function(d,p,q,k){if(void 0===p)k="utf8",q=this.length,p=0;else if(void 0===q&&"string"==typeof p)k=p,q=this.length,p=0;else{if(!isFinite(p))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");p>>>=0,isFinite(q)?(q>>>=0,void 0===k&&(k="utf8")):(k=q,q=void 0)}const se=this.length-p;if((void 0===q||q>se)&&(q=se),d.length>0&&(q<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");k||(k="utf8");let ce=!1;for(;;)switch(k){case"hex":return j(this,d,p,q);case"utf8":case"utf-8":return $(this,d,p,q);case"ascii":case"latin1":case"binary":return ee(this,d,p,q);case"base64":return F(this,d,p,q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,d,p,q);default:if(ce)throw new TypeError("Unknown encoding: "+k);k=(""+k).toLowerCase(),ce=!0}},v.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const S=4096;function Q(M,d,p){let q="";p=Math.min(M.length,p);for(let k=d;k<p;++k)q+=String.fromCharCode(127&M[k]);return q}function O(M,d,p){let q="";p=Math.min(M.length,p);for(let k=d;k<p;++k)q+=String.fromCharCode(M[k]);return q}function W(M,d,p){const q=M.length;(!d||d<0)&&(d=0),(!p||p<0||p>q)&&(p=q);let k="";for(let se=d;se<p;++se)k+=le[M[se]];return k}function V(M,d,p){const q=M.slice(d,p);let k="";for(let se=0;se<q.length-1;se+=2)k+=String.fromCharCode(q[se]+256*q[se+1]);return k}function oe(M,d,p){if(M%1!=0||M<0)throw new RangeError("offset is not uint");if(M+d>p)throw new RangeError("Trying to access beyond buffer length")}function me(M,d,p,q,k,se){if(!v.isBuffer(M))throw new TypeError('"buffer" argument must be a Buffer instance');if(d>k||d<se)throw new RangeError('"value" argument is out of bounds');if(p+q>M.length)throw new RangeError("Index out of range")}function he(M,d,p,q,k){He(d,q,k,M,p,7);let se=Number(d&BigInt(4294967295));M[p++]=se,se>>=8,M[p++]=se,se>>=8,M[p++]=se,se>>=8,M[p++]=se;let ce=Number(d>>BigInt(32)&BigInt(4294967295));return M[p++]=ce,ce>>=8,M[p++]=ce,ce>>=8,M[p++]=ce,ce>>=8,M[p++]=ce,p}function be(M,d,p,q,k){He(d,q,k,M,p,7);let se=Number(d&BigInt(4294967295));M[p+7]=se,se>>=8,M[p+6]=se,se>>=8,M[p+5]=se,se>>=8,M[p+4]=se;let ce=Number(d>>BigInt(32)&BigInt(4294967295));return M[p+3]=ce,ce>>=8,M[p+2]=ce,ce>>=8,M[p+1]=ce,ce>>=8,M[p]=ce,p+8}function Me(M,d,p,q,k,se){if(p+q>M.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function Ne(M,d,p,q,k){return d=+d,p>>>=0,k||Me(M,0,p,4),_.write(M,d,p,q,23,4),p+4}function Pe(M,d,p,q,k){return d=+d,p>>>=0,k||Me(M,0,p,8),_.write(M,d,p,q,52,8),p+8}v.prototype.slice=function(d,p){const q=this.length;(d=~~d)<0?(d+=q)<0&&(d=0):d>q&&(d=q),(p=void 0===p?q:~~p)<0?(p+=q)<0&&(p=0):p>q&&(p=q),p<d&&(p=d);const k=this.subarray(d,p);return Object.setPrototypeOf(k,v.prototype),k},v.prototype.readUintLE=v.prototype.readUIntLE=function(d,p,q){d>>>=0,p>>>=0,q||oe(d,p,this.length);let k=this[d],se=1,ce=0;for(;++ce<p&&(se*=256);)k+=this[d+ce]*se;return k},v.prototype.readUintBE=v.prototype.readUIntBE=function(d,p,q){d>>>=0,p>>>=0,q||oe(d,p,this.length);let k=this[d+--p],se=1;for(;p>0&&(se*=256);)k+=this[d+--p]*se;return k},v.prototype.readUint8=v.prototype.readUInt8=function(d,p){return d>>>=0,p||oe(d,1,this.length),this[d]},v.prototype.readUint16LE=v.prototype.readUInt16LE=function(d,p){return d>>>=0,p||oe(d,2,this.length),this[d]|this[d+1]<<8},v.prototype.readUint16BE=v.prototype.readUInt16BE=function(d,p){return d>>>=0,p||oe(d,2,this.length),this[d]<<8|this[d+1]},v.prototype.readUint32LE=v.prototype.readUInt32LE=function(d,p){return d>>>=0,p||oe(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+16777216*this[d+3]},v.prototype.readUint32BE=v.prototype.readUInt32BE=function(d,p){return d>>>=0,p||oe(d,4,this.length),16777216*this[d]+(this[d+1]<<16|this[d+2]<<8|this[d+3])},v.prototype.readBigUInt64LE=ve(function(d){Se(d>>>=0,"offset");const p=this[d],q=this[d+7];(void 0===p||void 0===q)&&it(d,this.length-8);const k=p+256*this[++d]+65536*this[++d]+this[++d]*2**24,se=this[++d]+256*this[++d]+65536*this[++d]+q*2**24;return BigInt(k)+(BigInt(se)<<BigInt(32))}),v.prototype.readBigUInt64BE=ve(function(d){Se(d>>>=0,"offset");const p=this[d],q=this[d+7];(void 0===p||void 0===q)&&it(d,this.length-8);const k=p*2**24+65536*this[++d]+256*this[++d]+this[++d],se=this[++d]*2**24+65536*this[++d]+256*this[++d]+q;return(BigInt(k)<<BigInt(32))+BigInt(se)}),v.prototype.readIntLE=function(d,p,q){d>>>=0,p>>>=0,q||oe(d,p,this.length);let k=this[d],se=1,ce=0;for(;++ce<p&&(se*=256);)k+=this[d+ce]*se;return se*=128,k>=se&&(k-=Math.pow(2,8*p)),k},v.prototype.readIntBE=function(d,p,q){d>>>=0,p>>>=0,q||oe(d,p,this.length);let k=p,se=1,ce=this[d+--k];for(;k>0&&(se*=256);)ce+=this[d+--k]*se;return se*=128,ce>=se&&(ce-=Math.pow(2,8*p)),ce},v.prototype.readInt8=function(d,p){return d>>>=0,p||oe(d,1,this.length),128&this[d]?-1*(255-this[d]+1):this[d]},v.prototype.readInt16LE=function(d,p){d>>>=0,p||oe(d,2,this.length);const q=this[d]|this[d+1]<<8;return 32768&q?4294901760|q:q},v.prototype.readInt16BE=function(d,p){d>>>=0,p||oe(d,2,this.length);const q=this[d+1]|this[d]<<8;return 32768&q?4294901760|q:q},v.prototype.readInt32LE=function(d,p){return d>>>=0,p||oe(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},v.prototype.readInt32BE=function(d,p){return d>>>=0,p||oe(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},v.prototype.readBigInt64LE=ve(function(d){Se(d>>>=0,"offset");const p=this[d],q=this[d+7];return(void 0===p||void 0===q)&&it(d,this.length-8),(BigInt(this[d+4]+256*this[d+5]+65536*this[d+6]+(q<<24))<<BigInt(32))+BigInt(p+256*this[++d]+65536*this[++d]+this[++d]*2**24)}),v.prototype.readBigInt64BE=ve(function(d){Se(d>>>=0,"offset");const p=this[d],q=this[d+7];(void 0===p||void 0===q)&&it(d,this.length-8);const k=(p<<24)+65536*this[++d]+256*this[++d]+this[++d];return(BigInt(k)<<BigInt(32))+BigInt(this[++d]*2**24+65536*this[++d]+256*this[++d]+q)}),v.prototype.readFloatLE=function(d,p){return d>>>=0,p||oe(d,4,this.length),_.read(this,d,!0,23,4)},v.prototype.readFloatBE=function(d,p){return d>>>=0,p||oe(d,4,this.length),_.read(this,d,!1,23,4)},v.prototype.readDoubleLE=function(d,p){return d>>>=0,p||oe(d,8,this.length),_.read(this,d,!0,52,8)},v.prototype.readDoubleBE=function(d,p){return d>>>=0,p||oe(d,8,this.length),_.read(this,d,!1,52,8)},v.prototype.writeUintLE=v.prototype.writeUIntLE=function(d,p,q,k){d=+d,p>>>=0,q>>>=0,k||me(this,d,p,q,Math.pow(2,8*q)-1,0);let se=1,ce=0;for(this[p]=255&d;++ce<q&&(se*=256);)this[p+ce]=d/se&255;return p+q},v.prototype.writeUintBE=v.prototype.writeUIntBE=function(d,p,q,k){d=+d,p>>>=0,q>>>=0,k||me(this,d,p,q,Math.pow(2,8*q)-1,0);let se=q-1,ce=1;for(this[p+se]=255&d;--se>=0&&(ce*=256);)this[p+se]=d/ce&255;return p+q},v.prototype.writeUint8=v.prototype.writeUInt8=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,1,255,0),this[p]=255&d,p+1},v.prototype.writeUint16LE=v.prototype.writeUInt16LE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,2,65535,0),this[p]=255&d,this[p+1]=d>>>8,p+2},v.prototype.writeUint16BE=v.prototype.writeUInt16BE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,2,65535,0),this[p]=d>>>8,this[p+1]=255&d,p+2},v.prototype.writeUint32LE=v.prototype.writeUInt32LE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,4,4294967295,0),this[p+3]=d>>>24,this[p+2]=d>>>16,this[p+1]=d>>>8,this[p]=255&d,p+4},v.prototype.writeUint32BE=v.prototype.writeUInt32BE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,4,4294967295,0),this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=255&d,p+4},v.prototype.writeBigUInt64LE=ve(function(d,p=0){return he(this,d,p,BigInt(0),BigInt("0xffffffffffffffff"))}),v.prototype.writeBigUInt64BE=ve(function(d,p=0){return be(this,d,p,BigInt(0),BigInt("0xffffffffffffffff"))}),v.prototype.writeIntLE=function(d,p,q,k){if(d=+d,p>>>=0,!k){const ot=Math.pow(2,8*q-1);me(this,d,p,q,ot-1,-ot)}let se=0,ce=1,Qe=0;for(this[p]=255&d;++se<q&&(ce*=256);)d<0&&0===Qe&&0!==this[p+se-1]&&(Qe=1),this[p+se]=(d/ce>>0)-Qe&255;return p+q},v.prototype.writeIntBE=function(d,p,q,k){if(d=+d,p>>>=0,!k){const ot=Math.pow(2,8*q-1);me(this,d,p,q,ot-1,-ot)}let se=q-1,ce=1,Qe=0;for(this[p+se]=255&d;--se>=0&&(ce*=256);)d<0&&0===Qe&&0!==this[p+se+1]&&(Qe=1),this[p+se]=(d/ce>>0)-Qe&255;return p+q},v.prototype.writeInt8=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,1,127,-128),d<0&&(d=255+d+1),this[p]=255&d,p+1},v.prototype.writeInt16LE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,2,32767,-32768),this[p]=255&d,this[p+1]=d>>>8,p+2},v.prototype.writeInt16BE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,2,32767,-32768),this[p]=d>>>8,this[p+1]=255&d,p+2},v.prototype.writeInt32LE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,4,2147483647,-2147483648),this[p]=255&d,this[p+1]=d>>>8,this[p+2]=d>>>16,this[p+3]=d>>>24,p+4},v.prototype.writeInt32BE=function(d,p,q){return d=+d,p>>>=0,q||me(this,d,p,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=255&d,p+4},v.prototype.writeBigInt64LE=ve(function(d,p=0){return he(this,d,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),v.prototype.writeBigInt64BE=ve(function(d,p=0){return be(this,d,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),v.prototype.writeFloatLE=function(d,p,q){return Ne(this,d,p,!0,q)},v.prototype.writeFloatBE=function(d,p,q){return Ne(this,d,p,!1,q)},v.prototype.writeDoubleLE=function(d,p,q){return Pe(this,d,p,!0,q)},v.prototype.writeDoubleBE=function(d,p,q){return Pe(this,d,p,!1,q)},v.prototype.copy=function(d,p,q,k){if(!v.isBuffer(d))throw new TypeError("argument should be a Buffer");if(q||(q=0),!k&&0!==k&&(k=this.length),p>=d.length&&(p=d.length),p||(p=0),k>0&&k<q&&(k=q),k===q||0===d.length||0===this.length)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(q<0||q>=this.length)throw new RangeError("Index out of range");if(k<0)throw new RangeError("sourceEnd out of bounds");k>this.length&&(k=this.length),d.length-p<k-q&&(k=d.length-p+q);const se=k-q;return this===d&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(p,q,k):Uint8Array.prototype.set.call(d,this.subarray(q,k),p),se},v.prototype.fill=function(d,p,q,k){if("string"==typeof d){if("string"==typeof p?(k=p,p=0,q=this.length):"string"==typeof q&&(k=q,q=this.length),void 0!==k&&"string"!=typeof k)throw new TypeError("encoding must be a string");if("string"==typeof k&&!v.isEncoding(k))throw new TypeError("Unknown encoding: "+k);if(1===d.length){const ce=d.charCodeAt(0);("utf8"===k&&ce<128||"latin1"===k)&&(d=ce)}}else"number"==typeof d?d&=255:"boolean"==typeof d&&(d=Number(d));if(p<0||this.length<p||this.length<q)throw new RangeError("Out of range index");if(q<=p)return this;let se;if(p>>>=0,q=void 0===q?this.length:q>>>0,d||(d=0),"number"==typeof d)for(se=p;se<q;++se)this[se]=d;else{const ce=v.isBuffer(d)?d:v.from(d,k),Qe=ce.length;if(0===Qe)throw new TypeError('The value "'+d+'" is invalid for argument "value"');for(se=0;se<q-p;++se)this[se+p]=ce[se%Qe]}return this};const Ae={};function Oe(M,d,p){Ae[M]=class extends p{constructor(){super(),Object.defineProperty(this,"message",{value:d.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${M}]`,delete this.name}get code(){return M}set code(k){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:k,writable:!0})}toString(){return`${this.name} [${M}]: ${this.message}`}}}function Je(M){let d="",p=M.length;const q="-"===M[0]?1:0;for(;p>=q+4;p-=3)d=`_${M.slice(p-3,p)}${d}`;return`${M.slice(0,p)}${d}`}function He(M,d,p,q,k,se){if(M>p||M<d){const ce="bigint"==typeof d?"n":"";let Qe;throw Qe=se>3?0===d||d===BigInt(0)?`>= 0${ce} and < 2${ce} ** ${8*(se+1)}${ce}`:`>= -(2${ce} ** ${8*(se+1)-1}${ce}) and < 2 ** ${8*(se+1)-1}${ce}`:`>= ${d}${ce} and <= ${p}${ce}`,new Ae.ERR_OUT_OF_RANGE("value",Qe,M)}!function(M,d,p){Se(d,"offset"),(void 0===M[d]||void 0===M[d+p])&&it(d,M.length-(p+1))}(q,k,se)}function Se(M,d){if("number"!=typeof M)throw new Ae.ERR_INVALID_ARG_TYPE(d,"number",M)}function it(M,d,p){throw Math.floor(M)!==M?(Se(M,p),new Ae.ERR_OUT_OF_RANGE(p||"offset","an integer",M)):d<0?new Ae.ERR_BUFFER_OUT_OF_BOUNDS:new Ae.ERR_OUT_OF_RANGE(p||"offset",`>= ${p?1:0} and <= ${d}`,M)}Oe("ERR_BUFFER_OUT_OF_BOUNDS",function(M){return M?`${M} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Oe("ERR_INVALID_ARG_TYPE",function(M,d){return`The "${M}" argument must be of type number. Received type ${typeof d}`},TypeError),Oe("ERR_OUT_OF_RANGE",function(M,d,p){let q=`The value of "${M}" is out of range.`,k=p;return Number.isInteger(p)&&Math.abs(p)>2**32?k=Je(String(p)):"bigint"==typeof p&&(k=String(p),(p>BigInt(2)**BigInt(32)||p<-(BigInt(2)**BigInt(32)))&&(k=Je(k)),k+="n"),q+=` It must be ${d}. Received ${k}`,q},RangeError);const Ge=/[^+/0-9A-Za-z-_]/g;function Ke(M,d){let p;d=d||1/0;const q=M.length;let k=null;const se=[];for(let ce=0;ce<q;++ce){if(p=M.charCodeAt(ce),p>55295&&p<57344){if(!k){if(p>56319){(d-=3)>-1&&se.push(239,191,189);continue}if(ce+1===q){(d-=3)>-1&&se.push(239,191,189);continue}k=p;continue}if(p<56320){(d-=3)>-1&&se.push(239,191,189),k=p;continue}p=65536+(k-55296<<10|p-56320)}else k&&(d-=3)>-1&&se.push(239,191,189);if(k=null,p<128){if((d-=1)<0)break;se.push(p)}else if(p<2048){if((d-=2)<0)break;se.push(p>>6|192,63&p|128)}else if(p<65536){if((d-=3)<0)break;se.push(p>>12|224,p>>6&63|128,63&p|128)}else{if(!(p<1114112))throw new Error("Invalid code point");if((d-=4)<0)break;se.push(p>>18|240,p>>12&63|128,p>>6&63|128,63&p|128)}}return se}function nt(M){return g.toByteArray(function(M){if((M=(M=M.split("=")[0]).trim().replace(Ge,"")).length<2)return"";for(;M.length%4!=0;)M+="=";return M}(M))}function rt(M,d,p,q){let k;for(k=0;k<q&&!(k+p>=d.length||k>=M.length);++k)d[k+p]=M[k];return k}function ze(M,d){return M instanceof d||null!=M&&null!=M.constructor&&null!=M.constructor.name&&M.constructor.name===d.name}function ae(M){return M!=M}const le=function(){const M="0123456789abcdef",d=new Array(256);for(let p=0;p<16;++p){const q=16*p;for(let k=0;k<16;++k)d[q+k]=M[p]+M[k]}return d}();function ve(M){return"undefined"==typeof BigInt?Ce:M}function Ce(){throw new Error("BigInt not supported")}},5331:(Ee,ne)=>{
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
ne.read=function(h,g,_,P,m){var N,a,v=8*m-P-1,B=(1<<v)-1,G=B>>1,J=-7,U=_?m-1:0,c=_?-1:1,Z=h[g+U];for(U+=c,N=Z&(1<<-J)-1,Z>>=-J,J+=v;J>0;N=256*N+h[g+U],U+=c,J-=8);for(a=N&(1<<-J)-1,N>>=-J,J+=P;J>0;a=256*a+h[g+U],U+=c,J-=8);if(0===N)N=1-G;else{if(N===B)return a?NaN:1/0*(Z?-1:1);a+=Math.pow(2,P),N-=G}return(Z?-1:1)*a*Math.pow(2,N-P)},ne.write=function(h,g,_,P,m,N){var a,v,B,G=8*N-m-1,J=(1<<G)-1,U=J>>1,c=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,Z=P?0:N-1,ie=P?1:-1,D=g<0||0===g&&1/g<0?1:0;for(g=Math.abs(g),isNaN(g)||g===1/0?(v=isNaN(g)?1:0,a=J):(a=Math.floor(Math.log(g)/Math.LN2),g*(B=Math.pow(2,-a))<1&&(a--,B*=2),(g+=a+U>=1?c/B:c*Math.pow(2,1-U))*B>=2&&(a++,B/=2),a+U>=J?(v=0,a=J):a+U>=1?(v=(g*B-1)*Math.pow(2,m),a+=U):(v=g*Math.pow(2,U-1)*Math.pow(2,m),a=0));m>=8;h[_+Z]=255&v,Z+=ie,v/=256,m-=8);for(a=a<<m|v,G+=m;G>0;h[_+Z]=255&a,Z+=ie,a/=256,G-=8);h[_+Z-ie]|=128*D}},9988:Ee=>{Ee.exports="function"==typeof Object.create?function(h,g){h.super_=g,h.prototype=Object.create(g.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}})}:function(h,g){h.super_=g;var _=function(){};_.prototype=g.prototype,h.prototype=new _,h.prototype.constructor=h}},8482:()=>{
/*! *****************************************************************************
    Copyright (C) Microsoft. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0
    
    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.
    
    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var Ee,ne;ne=Ee||(Ee={}),function(h){var g="object"==typeof global?global:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),_=P(ne);function P(m,N){return function(a,v){"function"!=typeof m[a]&&Object.defineProperty(m,a,{configurable:!0,writable:!0,value:v}),N&&N(a,v)}}void 0===g.Reflect?g.Reflect=ne:_=P(g.Reflect,_),function(h){var g=Object.prototype.hasOwnProperty,_="function"==typeof Symbol,P=_&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",m=_&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",N="function"==typeof Object.create,a={__proto__:[]}instanceof Array,v=!N&&!a,B={create:N?function(){return ze(Object.create(null))}:a?function(){return ze({__proto__:null})}:function(){return ze({})},has:v?function(ae,le){return g.call(ae,le)}:function(ae,le){return le in ae},get:v?function(ae,le){return g.call(ae,le)?ae[le]:void 0}:function(ae,le){return ae[le]}},G=Object.getPrototypeOf(Function),J="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,U=J||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var ae={},le=[],ve=function(){function p(q,k,se){this._index=0,this._keys=q,this._values=k,this._selector=se}return p.prototype["@@iterator"]=function(){return this},p.prototype[m]=function(){return this},p.prototype.next=function(){var q=this._index;if(q>=0&&q<this._keys.length){var k=this._selector(this._keys[q],this._values[q]);return q+1>=this._keys.length?(this._index=-1,this._keys=le,this._values=le):this._index++,{value:k,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(q){throw this._index>=0&&(this._index=-1,this._keys=le,this._values=le),q},p.prototype.return=function(q){return this._index>=0&&(this._index=-1,this._keys=le,this._values=le),{value:q,done:!0}},p}();return function(){function p(){this._keys=[],this._values=[],this._cacheKey=ae,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(q){return this._find(q,!1)>=0},p.prototype.get=function(q){var k=this._find(q,!1);return k>=0?this._values[k]:void 0},p.prototype.set=function(q,k){var se=this._find(q,!0);return this._values[se]=k,this},p.prototype.delete=function(q){var k=this._find(q,!1);if(k>=0){for(var se=this._keys.length,ce=k+1;ce<se;ce++)this._keys[ce-1]=this._keys[ce],this._values[ce-1]=this._values[ce];return this._keys.length--,this._values.length--,q===this._cacheKey&&(this._cacheKey=ae,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=ae,this._cacheIndex=-2},p.prototype.keys=function(){return new ve(this._keys,this._values,Ce)},p.prototype.values=function(){return new ve(this._keys,this._values,M)},p.prototype.entries=function(){return new ve(this._keys,this._values,d)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[m]=function(){return this.entries()},p.prototype._find=function(q,k){return this._cacheKey!==q&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=q)),this._cacheIndex<0&&k&&(this._cacheIndex=this._keys.length,this._keys.push(q),this._values.push(void 0)),this._cacheIndex},p}();function Ce(p,q){return p}function M(p,q){return q}function d(p,q){return[p,q]}}():Map,c=J||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function ae(){this._map=new U}return Object.defineProperty(ae.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),ae.prototype.has=function(le){return this._map.has(le)},ae.prototype.add=function(le){return this._map.set(le,le),this},ae.prototype.delete=function(le){return this._map.delete(le)},ae.prototype.clear=function(){this._map.clear()},ae.prototype.keys=function(){return this._map.keys()},ae.prototype.values=function(){return this._map.values()},ae.prototype.entries=function(){return this._map.entries()},ae.prototype["@@iterator"]=function(){return this.keys()},ae.prototype[m]=function(){return this.keys()},ae}():Set,ie=new(J||"function"!=typeof WeakMap?function(){var le=B.create(),ve=Ce();return function(){function k(){this._key=Ce()}return k.prototype.has=function(se){var ce=M(se,!1);return void 0!==ce&&B.has(ce,this._key)},k.prototype.get=function(se){var ce=M(se,!1);return void 0!==ce?B.get(ce,this._key):void 0},k.prototype.set=function(se,ce){return M(se,!0)[this._key]=ce,this},k.prototype.delete=function(se){var ce=M(se,!1);return void 0!==ce&&delete ce[this._key]},k.prototype.clear=function(){this._key=Ce()},k}();function Ce(){var k;do{k="@@WeakMap@@"+q()}while(B.has(le,k));return le[k]=!0,k}function M(k,se){if(!g.call(k,ve)){if(!se)return;Object.defineProperty(k,ve,{value:B.create()})}return k[ve]}function d(k,se){for(var ce=0;ce<se;++ce)k[ce]=255*Math.random()|0;return k}function q(){var k=function(k){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(k)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(k)):d(new Uint8Array(k),k):d(new Array(k),k)}(16);k[6]=79&k[6]|64,k[8]=191&k[8]|128;for(var se="",ce=0;ce<16;++ce){var Qe=k[ce];(4===ce||6===ce||8===ce)&&(se+="-"),Qe<16&&(se+="0"),se+=Qe.toString(16).toLowerCase()}return se}}():WeakMap);function F(ae,le,ve){var Ce=ie.get(ae);if(V(Ce)){if(!ve)return;Ce=new U,ie.set(ae,Ce)}var M=Ce.get(le);if(V(M)){if(!ve)return;M=new U,Ce.set(le,M)}return M}function I(ae,le,ve){if(y(ae,le,ve))return!0;var M=tt(le);return!oe(M)&&I(ae,M,ve)}function y(ae,le,ve){var Ce=F(le,ve,!1);return!V(Ce)&&function(ae){return!!ae}(Ce.has(ae))}function E(ae,le,ve){if(y(ae,le,ve))return S(ae,le,ve);var M=tt(le);return oe(M)?void 0:E(ae,M,ve)}function S(ae,le,ve){var Ce=F(le,ve,!1);if(!V(Ce))return Ce.get(ae)}function C(ae,le,ve,Ce){F(ve,Ce,!0).set(ae,le)}function Q(ae,le){var ve=O(ae,le),Ce=tt(ae);if(null===Ce)return ve;var M=Q(Ce,le);if(M.length<=0)return ve;if(ve.length<=0)return M;for(var d=new c,p=[],q=0,k=ve;q<k.length;q++)d.has(se=k[q])||(d.add(se),p.push(se));for(var Qe=0,ot=M;Qe<ot.length;Qe++){var se;d.has(se=ot[Qe])||(d.add(se),p.push(se))}return p}function O(ae,le){var ve=[],Ce=F(ae,le,!1);if(V(Ce))return ve;for(var d=function(ae){var le=Se(ae,m);if(!Je(le))throw new TypeError;var ve=le.call(ae);if(!he(ve))throw new TypeError;return ve}(Ce.keys()),p=0;;){var q=Le(d);if(!q)return ve.length=p,ve;var k=Ge(q);try{ve[p]=k}catch(se){try{Ke(d)}finally{throw se}}p++}}function W(ae){if(null===ae)return 1;switch(typeof ae){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===ae?1:6;default:return 6}}function V(ae){return void 0===ae}function oe(ae){return null===ae}function he(ae){return"object"==typeof ae?null!==ae:"function"==typeof ae}function be(ae,le){switch(W(ae)){case 0:case 1:case 2:case 3:case 4:case 5:return ae}var ve=3===le?"string":5===le?"number":"default",Ce=Se(ae,P);if(void 0!==Ce){var M=Ce.call(ae,ve);if(he(M))throw new TypeError;return M}return function(ae,le){if("string"===le){var ve=ae.toString;if(Je(ve)&&!he(Ce=ve.call(ae)))return Ce;if(Je(M=ae.valueOf)&&!he(Ce=M.call(ae)))return Ce}else{var M;if(Je(M=ae.valueOf)&&!he(Ce=M.call(ae)))return Ce;var Ce,d=ae.toString;if(Je(d)&&!he(Ce=d.call(ae)))return Ce}throw new TypeError}(ae,"default"===ve?"number":ve)}function Ae(ae){var le=be(ae,3);return function(ae){return"symbol"==typeof ae}(le)?le:function(ae){return""+ae}(le)}function Oe(ae){return Array.isArray?Array.isArray(ae):ae instanceof Object?ae instanceof Array:"[object Array]"===Object.prototype.toString.call(ae)}function Je(ae){return"function"==typeof ae}function je(ae){return"function"==typeof ae}function Se(ae,le){var ve=ae[le];if(null!=ve){if(!Je(ve))throw new TypeError;return ve}}function Ge(ae){return ae.value}function Le(ae){var le=ae.next();return!le.done&&le}function Ke(ae){var le=ae.return;le&&le.call(ae)}function tt(ae){var le=Object.getPrototypeOf(ae);if("function"!=typeof ae||ae===G||le!==G)return le;var ve=ae.prototype,Ce=ve&&Object.getPrototypeOf(ve);if(null==Ce||Ce===Object.prototype)return le;var M=Ce.constructor;return"function"!=typeof M||M===ae?le:M}function ze(ae){return ae.__=void 0,delete ae.__,ae}h("decorate",function(ae,le,ve,Ce){if(V(ve)){if(!Oe(ae))throw new TypeError;if(!je(le))throw new TypeError;return function(ae,le){for(var ve=ae.length-1;ve>=0;--ve){var M=(0,ae[ve])(le);if(!V(M)&&!oe(M)){if(!je(M))throw new TypeError;le=M}}return le}(ae,le)}if(!Oe(ae))throw new TypeError;if(!he(le))throw new TypeError;if(!he(Ce)&&!V(Ce)&&!oe(Ce))throw new TypeError;return oe(Ce)&&(Ce=void 0),function(ae,le,ve,Ce){for(var M=ae.length-1;M>=0;--M){var p=(0,ae[M])(le,ve,Ce);if(!V(p)&&!oe(p)){if(!he(p))throw new TypeError;Ce=p}}return Ce}(ae,le,ve=Ae(ve),Ce)}),h("metadata",function(ae,le){return function(Ce,M){if(!he(Ce))throw new TypeError;if(!V(M)&&!function(ae){switch(W(ae)){case 3:case 4:return!0;default:return!1}}(M))throw new TypeError;C(ae,le,Ce,M)}}),h("defineMetadata",function(ae,le,ve,Ce){if(!he(ve))throw new TypeError;return V(Ce)||(Ce=Ae(Ce)),C(ae,le,ve,Ce)}),h("hasMetadata",function(ae,le,ve){if(!he(le))throw new TypeError;return V(ve)||(ve=Ae(ve)),I(ae,le,ve)}),h("hasOwnMetadata",function(ae,le,ve){if(!he(le))throw new TypeError;return V(ve)||(ve=Ae(ve)),y(ae,le,ve)}),h("getMetadata",function(ae,le,ve){if(!he(le))throw new TypeError;return V(ve)||(ve=Ae(ve)),E(ae,le,ve)}),h("getOwnMetadata",function(ae,le,ve){if(!he(le))throw new TypeError;return V(ve)||(ve=Ae(ve)),S(ae,le,ve)}),h("getMetadataKeys",function(ae,le){if(!he(ae))throw new TypeError;return V(le)||(le=Ae(le)),Q(ae,le)}),h("getOwnMetadataKeys",function(ae,le){if(!he(ae))throw new TypeError;return V(le)||(le=Ae(le)),O(ae,le)}),h("deleteMetadata",function(ae,le,ve){if(!he(le))throw new TypeError;V(ve)||(ve=Ae(ve));var Ce=F(le,ve,!1);if(V(Ce)||!Ce.delete(ae))return!1;if(Ce.size>0)return!0;var M=ie.get(le);return M.delete(ve),M.size>0||ie.delete(le),!0})}(_)}()},3419:(Ee,ne,h)=>{
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var g=h(8988),_=g.Buffer;function P(N,a){for(var v in N)a[v]=N[v]}function m(N,a,v){return _(N,a,v)}_.from&&_.alloc&&_.allocUnsafe&&_.allocUnsafeSlow?Ee.exports=g:(P(g,ne),ne.Buffer=m),m.prototype=Object.create(_.prototype),P(_,m),m.from=function(N,a,v){if("number"==typeof N)throw new TypeError("Argument must not be a number");return _(N,a,v)},m.alloc=function(N,a,v){if("number"!=typeof N)throw new TypeError("Argument must be a number");var B=_(N);return void 0!==a?"string"==typeof v?B.fill(a,v):B.fill(a):B.fill(0),B},m.allocUnsafe=function(N){if("number"!=typeof N)throw new TypeError("Argument must be a number");return _(N)},m.allocUnsafeSlow=function(N){if("number"!=typeof N)throw new TypeError("Argument must be a number");return g.SlowBuffer(N)}},1133:(Ee,ne,h)=>{var g=h(3419).Buffer;function _(P,m){this._block=g.alloc(P),this._finalSize=m,this._blockSize=P,this._len=0}_.prototype.update=function(P,m){"string"==typeof P&&(P=g.from(P,m=m||"utf8"));for(var N=this._block,a=this._blockSize,v=P.length,B=this._len,G=0;G<v;){for(var J=B%a,U=Math.min(v-G,a-J),c=0;c<U;c++)N[J+c]=P[G+c];G+=U,(B+=U)%a==0&&this._update(N)}return this._len+=v,this},_.prototype.digest=function(P){var m=this._len%this._blockSize;this._block[m]=128,this._block.fill(0,m+1),m>=this._finalSize&&(this._update(this._block),this._block.fill(0));var N=8*this._len;if(N<=4294967295)this._block.writeUInt32BE(N,this._blockSize-4);else{var a=(4294967295&N)>>>0;this._block.writeUInt32BE((N-a)/4294967296,this._blockSize-8),this._block.writeUInt32BE(a,this._blockSize-4)}this._update(this._block);var B=this._hash();return P?B.toString(P):B},_.prototype._update=function(){throw new Error("_update must be implemented by subclass")},Ee.exports=_},6790:(Ee,ne,h)=>{var g=Ee.exports=function(P){P=P.toLowerCase();var m=g[P];if(!m)throw new Error(P+" is not supported (we accept pull requests)");return new m};g.sha=h(2652),g.sha1=h(2823),g.sha224=h(9294),g.sha256=h(8323),g.sha384=h(5707),g.sha512=h(9059)},2652:(Ee,ne,h)=>{var g=h(9988),_=h(1133),P=h(3419).Buffer,m=[1518500249,1859775393,-1894007588,-899497514],N=new Array(80);function a(){this.init(),this._w=N,_.call(this,64,56)}function v(J){return J<<5|J>>>27}function B(J){return J<<30|J>>>2}function G(J,U,c,Z){return 0===J?U&c|~U&Z:2===J?U&c|U&Z|c&Z:U^c^Z}g(a,_),a.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},a.prototype._update=function(J){for(var U=this._w,c=0|this._a,Z=0|this._b,ie=0|this._c,D=0|this._d,A=0|this._e,T=0;T<16;++T)U[T]=J.readInt32BE(4*T);for(;T<80;++T)U[T]=U[T-3]^U[T-8]^U[T-14]^U[T-16];for(var x=0;x<80;++x){var X=~~(x/20),Y=v(c)+G(X,Z,ie,D)+A+U[x]+m[X]|0;A=D,D=ie,ie=B(Z),Z=c,c=Y}this._a=c+this._a|0,this._b=Z+this._b|0,this._c=ie+this._c|0,this._d=D+this._d|0,this._e=A+this._e|0},a.prototype._hash=function(){var J=P.allocUnsafe(20);return J.writeInt32BE(0|this._a,0),J.writeInt32BE(0|this._b,4),J.writeInt32BE(0|this._c,8),J.writeInt32BE(0|this._d,12),J.writeInt32BE(0|this._e,16),J},Ee.exports=a},2823:(Ee,ne,h)=>{var g=h(9988),_=h(1133),P=h(3419).Buffer,m=[1518500249,1859775393,-1894007588,-899497514],N=new Array(80);function a(){this.init(),this._w=N,_.call(this,64,56)}function v(U){return U<<1|U>>>31}function B(U){return U<<5|U>>>27}function G(U){return U<<30|U>>>2}function J(U,c,Z,ie){return 0===U?c&Z|~c&ie:2===U?c&Z|c&ie|Z&ie:c^Z^ie}g(a,_),a.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},a.prototype._update=function(U){for(var c=this._w,Z=0|this._a,ie=0|this._b,D=0|this._c,A=0|this._d,T=0|this._e,x=0;x<16;++x)c[x]=U.readInt32BE(4*x);for(;x<80;++x)c[x]=v(c[x-3]^c[x-8]^c[x-14]^c[x-16]);for(var X=0;X<80;++X){var Y=~~(X/20),R=B(Z)+J(Y,ie,D,A)+T+c[X]+m[Y]|0;T=A,A=D,D=G(ie),ie=Z,Z=R}this._a=Z+this._a|0,this._b=ie+this._b|0,this._c=D+this._c|0,this._d=A+this._d|0,this._e=T+this._e|0},a.prototype._hash=function(){var U=P.allocUnsafe(20);return U.writeInt32BE(0|this._a,0),U.writeInt32BE(0|this._b,4),U.writeInt32BE(0|this._c,8),U.writeInt32BE(0|this._d,12),U.writeInt32BE(0|this._e,16),U},Ee.exports=a},9294:(Ee,ne,h)=>{var g=h(9988),_=h(8323),P=h(1133),m=h(3419).Buffer,N=new Array(64);function a(){this.init(),this._w=N,P.call(this,64,56)}g(a,_),a.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},a.prototype._hash=function(){var v=m.allocUnsafe(28);return v.writeInt32BE(this._a,0),v.writeInt32BE(this._b,4),v.writeInt32BE(this._c,8),v.writeInt32BE(this._d,12),v.writeInt32BE(this._e,16),v.writeInt32BE(this._f,20),v.writeInt32BE(this._g,24),v},Ee.exports=a},8323:(Ee,ne,h)=>{var g=h(9988),_=h(1133),P=h(3419).Buffer,m=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],N=new Array(64);function a(){this.init(),this._w=N,_.call(this,64,56)}function v(Z,ie,D){return D^Z&(ie^D)}function B(Z,ie,D){return Z&ie|D&(Z|ie)}function G(Z){return(Z>>>2|Z<<30)^(Z>>>13|Z<<19)^(Z>>>22|Z<<10)}function J(Z){return(Z>>>6|Z<<26)^(Z>>>11|Z<<21)^(Z>>>25|Z<<7)}function U(Z){return(Z>>>7|Z<<25)^(Z>>>18|Z<<14)^Z>>>3}function c(Z){return(Z>>>17|Z<<15)^(Z>>>19|Z<<13)^Z>>>10}g(a,_),a.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},a.prototype._update=function(Z){for(var ie=this._w,D=0|this._a,A=0|this._b,T=0|this._c,x=0|this._d,X=0|this._e,Y=0|this._f,R=0|this._g,L=0|this._h,H=0;H<16;++H)ie[H]=Z.readInt32BE(4*H);for(;H<64;++H)ie[H]=c(ie[H-2])+ie[H-7]+U(ie[H-15])+ie[H-16]|0;for(var j=0;j<64;++j){var $=L+J(X)+v(X,Y,R)+m[j]+ie[j]|0,ee=G(D)+B(D,A,T)|0;L=R,R=Y,Y=X,X=x+$|0,x=T,T=A,A=D,D=$+ee|0}this._a=D+this._a|0,this._b=A+this._b|0,this._c=T+this._c|0,this._d=x+this._d|0,this._e=X+this._e|0,this._f=Y+this._f|0,this._g=R+this._g|0,this._h=L+this._h|0},a.prototype._hash=function(){var Z=P.allocUnsafe(32);return Z.writeInt32BE(this._a,0),Z.writeInt32BE(this._b,4),Z.writeInt32BE(this._c,8),Z.writeInt32BE(this._d,12),Z.writeInt32BE(this._e,16),Z.writeInt32BE(this._f,20),Z.writeInt32BE(this._g,24),Z.writeInt32BE(this._h,28),Z},Ee.exports=a},5707:(Ee,ne,h)=>{var g=h(9988),_=h(9059),P=h(1133),m=h(3419).Buffer,N=new Array(160);function a(){this.init(),this._w=N,P.call(this,128,112)}g(a,_),a.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},a.prototype._hash=function(){var v=m.allocUnsafe(48);function B(G,J,U){v.writeInt32BE(G,U),v.writeInt32BE(J,U+4)}return B(this._ah,this._al,0),B(this._bh,this._bl,8),B(this._ch,this._cl,16),B(this._dh,this._dl,24),B(this._eh,this._el,32),B(this._fh,this._fl,40),v},Ee.exports=a},9059:(Ee,ne,h)=>{var g=h(9988),_=h(1133),P=h(3419).Buffer,m=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],N=new Array(160);function a(){this.init(),this._w=N,_.call(this,128,112)}function v(A,T,x){return x^A&(T^x)}function B(A,T,x){return A&T|x&(A|T)}function G(A,T){return(A>>>28|T<<4)^(T>>>2|A<<30)^(T>>>7|A<<25)}function J(A,T){return(A>>>14|T<<18)^(A>>>18|T<<14)^(T>>>9|A<<23)}function U(A,T){return(A>>>1|T<<31)^(A>>>8|T<<24)^A>>>7}function c(A,T){return(A>>>1|T<<31)^(A>>>8|T<<24)^(A>>>7|T<<25)}function Z(A,T){return(A>>>19|T<<13)^(T>>>29|A<<3)^A>>>6}function ie(A,T){return(A>>>19|T<<13)^(T>>>29|A<<3)^(A>>>6|T<<26)}function D(A,T){return A>>>0<T>>>0?1:0}g(a,_),a.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},a.prototype._update=function(A){for(var T=this._w,x=0|this._ah,X=0|this._bh,Y=0|this._ch,R=0|this._dh,L=0|this._eh,H=0|this._fh,j=0|this._gh,$=0|this._hh,ee=0|this._al,F=0|this._bl,I=0|this._cl,y=0|this._dl,E=0|this._el,S=0|this._fl,C=0|this._gl,Q=0|this._hl,O=0;O<32;O+=2)T[O]=A.readInt32BE(4*O),T[O+1]=A.readInt32BE(4*O+4);for(;O<160;O+=2){var W=T[O-30],V=T[O-30+1],oe=U(W,V),me=c(V,W),he=Z(W=T[O-4],V=T[O-4+1]),be=ie(V,W),Pe=T[O-32],Ae=T[O-32+1],Oe=me+T[O-14+1]|0,Je=oe+T[O-14]+D(Oe,me)|0;Je=(Je=Je+he+D(Oe=Oe+be|0,be)|0)+Pe+D(Oe=Oe+Ae|0,Ae)|0,T[O]=Je,T[O+1]=Oe}for(var je=0;je<160;je+=2){Je=T[je],Oe=T[je+1];var He=B(x,X,Y),Se=B(ee,F,I),it=G(x,ee),Ge=G(ee,x),Le=J(L,E),Ke=J(E,L),tt=m[je],lt=m[je+1],nt=v(L,H,j),rt=v(E,S,C),ze=Q+Ke|0,ae=$+Le+D(ze,Q)|0;ae=(ae=(ae=ae+nt+D(ze=ze+rt|0,rt)|0)+tt+D(ze=ze+lt|0,lt)|0)+Je+D(ze=ze+Oe|0,Oe)|0;var le=Ge+Se|0,ve=it+He+D(le,Ge)|0;$=j,Q=C,j=H,C=S,H=L,S=E,L=R+ae+D(E=y+ze|0,y)|0,R=Y,y=I,Y=X,I=F,X=x,F=ee,x=ae+ve+D(ee=ze+le|0,ze)|0}this._al=this._al+ee|0,this._bl=this._bl+F|0,this._cl=this._cl+I|0,this._dl=this._dl+y|0,this._el=this._el+E|0,this._fl=this._fl+S|0,this._gl=this._gl+C|0,this._hl=this._hl+Q|0,this._ah=this._ah+x+D(this._al,ee)|0,this._bh=this._bh+X+D(this._bl,F)|0,this._ch=this._ch+Y+D(this._cl,I)|0,this._dh=this._dh+R+D(this._dl,y)|0,this._eh=this._eh+L+D(this._el,E)|0,this._fh=this._fh+H+D(this._fl,S)|0,this._gh=this._gh+j+D(this._gl,C)|0,this._hh=this._hh+$+D(this._hl,Q)|0},a.prototype._hash=function(){var A=P.allocUnsafe(64);function T(x,X,Y){A.writeInt32BE(x,Y),A.writeInt32BE(X,Y+4)}return T(this._ah,this._al,0),T(this._bh,this._bl,8),T(this._ch,this._cl,16),T(this._dh,this._dl,24),T(this._eh,this._el,32),T(this._fh,this._fl,40),T(this._gh,this._gl,48),T(this._hh,this._hl,56),A},Ee.exports=a},3092:(Ee,ne,h)=>{"use strict";h.d(ne,{z:()=>P});var g=h(5081),_=h(3252),P=function(){function m(){}return m.buildDriverOptions=function(N,a){var v,B;if(N.url){var G=this.parseConnectionUrl(N.url);a&&a.useSid&&G.database&&(G.sid=G.database);try{for(var J=(0,g.XA)(Object.keys(G)),U=J.next();!U.done;U=J.next()){var c=U.value;void 0===G[c]&&delete G[c]}}catch(Z){v={error:Z}}finally{try{U&&!U.done&&(B=J.return)&&B.call(J)}finally{if(v)throw v.error}}return Object.assign({},N,G)}return Object.assign({},N)},m.buildMongoDBDriverOptions=function(N,a){var v,B;if(N.url){var G=this.parseMongoDBConnectionUrl(N.url);a&&a.useSid&&G.database&&(G.sid=G.database);try{for(var J=(0,g.XA)(Object.keys(G)),U=J.next();!U.done;U=J.next()){var c=U.value;void 0===G[c]&&delete G[c]}}catch(Z){v={error:Z}}finally{try{U&&!U.done&&(B=J.return)&&B.call(J)}finally{if(v)throw v.error}}return Object.assign({},N,G)}return Object.assign({},N)},m.buildAlias=function(N,a){for(var v=N.maxAliasLength,B=[],G=2;G<arguments.length;G++)B[G-2]=arguments[G];"string"==typeof a?(B.unshift(a),a={shorten:!1,joiner:"_"}):a=Object.assign({shorten:!1,joiner:"_"},a);var J=1===B.length?B[0]:B.join(a.joiner);if(v&&v>0&&J.length>v){if(!0===a.shorten){var U=(0,_.OV)(J);if(U.length<v)return U}return(0,_.vp)(J,{length:v})}return J},m.buildColumnAlias=function(N,a){for(var v=N.maxAliasLength,B=[],G=2;G<arguments.length;G++)B[G-2]=arguments[G];return this.buildAlias.apply(this,(0,g.ev)([{maxAliasLength:v},a],(0,g.CR)(B)))},m.parseConnectionUrl=function(N){var a=N.split(":")[0],v=N.indexOf("//"),B=N.substr(v+2),G=B.indexOf("/"),J=-1!==G?B.substr(0,G):B,U=-1!==G?B.substr(G+1):void 0;U&&-1!==U.indexOf("?")&&(U=U.substr(0,U.indexOf("?")));var c=J.lastIndexOf("@"),Z=J.substr(0,c),ie=J.substr(c+1),D=Z,A="",T=Z.indexOf(":");-1!==T&&(D=Z.substr(0,T),A=Z.substr(T+1));var x=(0,g.CR)(ie.split(":"),2),Y=x[1];return{type:a,host:x[0],username:decodeURIComponent(D),password:decodeURIComponent(A),port:Y?parseInt(Y):void 0,database:U||void 0}},m.parseMongoDBConnectionUrl=function(N){var a,v,B,L,H,G=N.split(":")[0],J=N.indexOf("//"),U=N.substr(J+2),c=U.indexOf("/"),Z=-1!==c?U.substr(0,c):U,ie=-1!==c?U.substr(c+1):void 0,A=void 0,T=void 0,x=void 0,X=void 0,Y={};ie&&-1!==ie.indexOf("?")&&(ie.substr(ie.indexOf("?")+1,ie.length).split("&").forEach(function(V){L=V.split("=")[0],H=V.split("=")[1],Y[L]=H}),X=Y.replicaSet,ie=ie.substr(0,ie.indexOf("?")));var j=Z.lastIndexOf("@"),$=Z.substr(0,j),ee=Z.substr(j+1),F=$,I="",y=$.indexOf(":");-1!==y&&(F=$.substr(0,y),I=$.substr(y+1)),X?x=ee:(A=(a=(0,g.CR)(ee.split(":"),2))[0],T=a[1]);var E={type:G,host:A,hostReplicaSet:x,username:decodeURIComponent(F),password:decodeURIComponent(I),port:T?parseInt(T):void 0,database:ie||void 0};try{for(var S=(0,g.XA)(Object.entries(Y)),C=S.next();!C.done;C=S.next()){var Q=(0,g.CR)(C.value,2);E[Q[0]]=Q[1]}}catch(V){v={error:V}}finally{try{C&&!C.done&&(B=S.return)&&B.call(S)}finally{if(v)throw v.error}}return E},m}()},5746:(Ee,ne,h)=>{"use strict";h.d(ne,{w:()=>X});var g=h(5081),_=h(4205),P=h(9145),m=h(2588),N=h(7915),a=h(7170),v=h(3664),B=h(1328),G=h(7529),J=h(6176),U=h(890),c=h(2373),Z=function(){function Y(R){this.connection=R}return Y.prototype.build=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,$=this;return(0,g.Jh)(this,function(ee){switch(ee.label){case 0:return this.queryRunner=this.connection.createQueryRunner(),(R=!(this.connection.driver instanceof P.J1)&&"none"!==this.connection.options.migrationsTransactionMode)?[4,this.queryRunner.startTransaction()]:[3,2];case 1:ee.sent(),ee.label=2;case 2:return ee.trys.push([2,12,18,20]),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,4];case 3:ee.sent(),ee.label=4;case 4:return L=this.entityToSyncMetadatas.map(function(F){return $.getTablePath(F)}),[4,this.queryRunner.getTables(L)];case 5:return ee.sent(),[4,this.queryRunner.getViews([])];case 6:return ee.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:return ee.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,9];case 8:ee.sent(),ee.label=9;case 9:return R?[4,this.queryRunner.commitTransaction()]:[3,11];case 10:ee.sent(),ee.label=11;case 11:return[3,20];case 12:H=ee.sent(),ee.label=13;case 13:return ee.trys.push([13,16,,17]),R?[4,this.queryRunner.rollbackTransaction()]:[3,15];case 14:ee.sent(),ee.label=15;case 15:return[3,17];case 16:return ee.sent(),[3,17];case 17:throw H;case 18:return[4,this.queryRunner.release()];case 19:return ee.sent(),[7];case 20:return[2]}})})},Y.prototype.log=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L=this;return(0,g.Jh)(this,function(H){switch(H.label){case 0:this.queryRunner=this.connection.createQueryRunner(),H.label=1;case 1:return H.trys.push([1,,9,11]),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,3];case 2:H.sent(),H.label=3;case 3:return R=this.entityToSyncMetadatas.map(function(j){return L.getTablePath(j)}),[4,this.queryRunner.getTables(R)];case 4:return H.sent(),[4,this.queryRunner.getViews([])];case 5:return H.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return H.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:H.sent(),H.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return H.sent(),[7];case 11:return[2]}})})},Object.defineProperty(Y.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(R){return R.synchronize&&"entity-child"!==R.tableType&&"view"!==R.tableType})},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"viewEntityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter(function(R){return"view"===R.tableType&&R.synchronize})},enumerable:!1,configurable:!0}),Y.prototype.executeSchemaSyncOperationsInProperOrder=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(R){switch(R.label){case 0:return[4,this.dropOldViews()];case 1:return R.sent(),[4,this.dropOldForeignKeys()];case 2:return R.sent(),[4,this.dropOldIndices()];case 3:return R.sent(),[4,this.dropOldChecks()];case 4:return R.sent(),[4,this.dropOldExclusions()];case 5:return R.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return R.sent(),[4,this.renameColumns()];case 7:return R.sent(),[4,this.createNewTables()];case 8:return R.sent(),[4,this.dropRemovedColumns()];case 9:return R.sent(),[4,this.addNewColumns()];case 10:return R.sent(),[4,this.updatePrimaryKeys()];case 11:return R.sent(),[4,this.updateExistColumns()];case 12:return R.sent(),[4,this.createNewIndices()];case 13:return R.sent(),[4,this.createNewChecks()];case 14:return R.sent(),[4,this.createNewExclusions()];case 15:return R.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return R.sent(),[4,this.createForeignKeys()];case 17:return R.sent(),[4,this.createViews()];case 18:return R.sent(),[2]}})})},Y.prototype.getTablePath=function(R){return R instanceof m.i?R.name:R instanceof a.U?R.referencedTableName:R.tablePath},Y.prototype.dropOldForeignKeys=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=C.foreignKeys.filter(function(W){var V=S.foreignKeys.find(function(oe){return W.name===oe.name&&y.getTablePath(W)===y.getTablePath(oe.referencedEntityMetadata)});return!V||V.onDelete&&V.onDelete!==W.onDelete||V.onUpdate&&V.onUpdate!==W.onUpdate})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("dropping old foreign keys of "+C.name+": "+Q.map(function(W){return W.name}).join(", ")),[4,L.queryRunner.dropForeignKeys(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.renameTables=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(R){return[2]})})},Y.prototype.renameColumns=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q,O,W;return(0,g.Jh)(this,function(V){switch(V.label){case 0:return(C=L.queryRunner.loadedTables.find(function(oe){return y.getTablePath(oe)===y.getTablePath(S)}))?S.columns.length!==C.columns.length||0===(Q=S.columns.filter(function(oe){return!C.columns.find(function(me){return me.name===oe.databaseName&&me.type===y.connection.driver.normalizeType(oe)&&me.isNullable===oe.isNullable&&me.isUnique===y.connection.driver.normalizeIsUnique(oe)})})).length||Q.length>1||0===(O=C.columns.filter(function(oe){return!S.columns.find(function(me){return me.databaseName===oe.name&&y.connection.driver.normalizeType(me)===oe.type&&me.isNullable===oe.isNullable&&y.connection.driver.normalizeIsUnique(me)===oe.isUnique})})).length||O.length>1?[2,"continue"]:((W=O[0].clone()).name=Q[0].databaseName,L.connection.logger.logSchemaBuild('renaming column "'+O[0].name+'" in to "'+W.name+'"'),[4,L.queryRunner.renameColumn(C,O[0],W)]):[2,"continue"];case 1:return V.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropOldIndices=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?(Q=C.indices.filter(function(W){var V=S.indices.find(function(oe){return oe.name===W.name});return!V||!1!==V.synchronize&&(!!(V.isUnique!==W.isUnique||V.isSpatial!==W.isSpatial||y.connection.driver.isFullTextColumnTypeSupported()&&V.isFulltext!==W.isFulltext||V.columns.length!==W.columnNames.length)||!V.columns.every(function(oe){return-1!==W.columnNames.indexOf(oe.databaseName)}))}).map(function(W){return(0,g.mG)(y,void 0,void 0,function(){return(0,g.Jh)(this,function(V){switch(V.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+W.name+'" from table '+C.name),[4,this.queryRunner.dropIndex(C,W)];case 1:return V.sent(),[2]}})})}),[4,Promise.all(Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropOldChecks=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:if(this.connection.driver instanceof P.p$||this.connection.driver instanceof P.xI)return[2];R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=C.checks.filter(function(W){return!S.checks.find(function(V){return V.name===W.name})})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("dropping old check constraint: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' from table "'+C.name+'"'),[4,L.queryRunner.dropCheckConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropCompositeUniqueConstraints=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=C.uniques.filter(function(W){return W.columnNames.length>1&&!S.uniques.find(function(V){return V.name===W.name})})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("dropping old unique constraint: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' from table "'+C.name+'"'),[4,L.queryRunner.dropUniqueConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropOldExclusions=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:if(!(this.connection.driver instanceof P.U4))return[2];R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=C.exclusions.filter(function(W){return!S.exclusions.find(function(V){return V.name===W.name})})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' from table "'+C.name+'"'),[4,L.queryRunner.dropExclusionConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createNewTables=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,$,F,I,y,E=this;return(0,g.Jh)(this,function(S){switch(S.label){case 0:return[4,this.queryRunner.getCurrentSchema()];case 1:R=S.sent(),L=function(C){var O;return(0,g.Jh)(this,function(W){switch(W.label){case 0:return H.queryRunner.loadedTables.find(function(V){var me=C.schema||E.connection.driver.options.schema,he=E.connection.driver.buildTableName(C.tableName,me=me===R?void 0:me,C.database&&C.database!==E.connection.driver.database?C.database:void 0);return V.name===he})?[2,"continue"]:(H.connection.logger.logSchemaBuild("creating a new table: "+H.getTablePath(C)),O=m.i.create(C,H.connection.driver),[4,H.queryRunner.createTable(O,!1,!1)]);case 1:return W.sent(),H.queryRunner.loadedTables.push(O),[2]}})},H=this,S.label=2;case 2:S.trys.push([2,7,8,9]),j=(0,g.XA)(this.entityToSyncMetadatas),$=j.next(),S.label=3;case 3:return $.done?[3,6]:[5,L($.value)];case 4:S.sent(),S.label=5;case 5:return $=j.next(),[3,3];case 6:return[3,9];case 7:return F=S.sent(),I={error:F},[3,9];case 8:try{$&&!$.done&&(y=j.return)&&y.call(j)}finally{if(I)throw I.error}return[7];case 9:return[2]}})})},Y.prototype.createViews=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return L.queryRunner.loadedViews.find(function(W){var me=y.connection.driver.buildTableName(S.tableName,S.schema||y.connection.driver.options.schema,S.database&&S.database!==y.connection.driver.database?S.database:void 0),he="string"==typeof W.expression?W.expression.trim():W.expression(y.connection).getQuery(),be="string"==typeof S.expression?S.expression.trim():S.expression(y.connection).getQuery();return W.name===me&&he===be})?[2,"continue"]:(L.connection.logger.logSchemaBuild("creating a new view: "+L.getTablePath(S)),Q=c.G.create(S,L.connection.driver),[4,L.queryRunner.createView(Q)]);case 1:return O.sent(),L.queryRunner.loadedViews.push(Q),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.viewEntityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropOldViews=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,$,F,I,y,E=this;return(0,g.Jh)(this,function(S){switch(S.label){case 0:R=new Set,L=function(C){return(0,g.Jh)(this,function(O){switch(O.label){case 0:return H.viewEntityToSyncMetadatas.find(function(W){var me=E.connection.driver.buildTableName(W.tableName,W.schema||E.connection.driver.options.schema,W.database&&W.database!==E.connection.driver.database?W.database:void 0),he="string"==typeof C.expression?C.expression.trim():C.expression(E.connection).getQuery(),be="string"==typeof W.expression?W.expression.trim():W.expression(E.connection).getQuery();return C.name===me&&he===be})?[2,"continue"]:(H.connection.logger.logSchemaBuild("dropping an old view: "+C.name),[4,H.queryRunner.dropView(C)]);case 1:return O.sent(),R.add(C),[2]}})},H=this,S.label=1;case 1:S.trys.push([1,6,7,8]),j=(0,g.XA)(this.queryRunner.loadedViews),$=j.next(),S.label=2;case 2:return $.done?[3,5]:[5,L($.value)];case 3:S.sent(),S.label=4;case 4:return $=j.next(),[3,2];case 5:return[3,8];case 6:return F=S.sent(),I={error:F},[3,8];case 7:try{$&&!$.done&&(y=j.return)&&y.call(j)}finally{if(I)throw I.error}return[7];case 8:return this.queryRunner.loadedViews=this.queryRunner.loadedViews.filter(function(C){return!R.has(C)}),[2]}})})},Y.prototype.dropRemovedColumns=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=C.columns.filter(function(W){return!S.columns.find(function(V){return V.databaseName===W.name})})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("columns dropped in "+C.name+": "+Q.map(function(W){return W.name}).join(", ")),[4,L.queryRunner.dropColumns(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.addNewColumns=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q,O,W;return(0,g.Jh)(this,function(V){switch(V.label){case 0:return(C=L.queryRunner.loadedTables.find(function(oe){return y.getTablePath(oe)===y.getTablePath(S)}))?0===(Q=S.columns.filter(function(oe){return!C.columns.find(function(me){return me.name===oe.databaseName})})).length?[2,"continue"]:(O=L.metadataColumnsToTableColumnOptions(Q),0===(W=O.map(function(oe){return new N.D(oe)})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("new columns added: "+Q.map(function(oe){return oe.databaseName}).join(", ")),[4,L.queryRunner.addColumns(C,W)])):[2,"continue"];case 1:return V.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.updatePrimaryKeys=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q,W;return(0,g.Jh)(this,function(V){switch(V.label){case 0:return(C=L.queryRunner.loadedTables.find(function(oe){return y.getTablePath(oe)===y.getTablePath(S)}))?(Q=S.columns.filter(function(oe){return oe.isPrimary}),C.columns.filter(function(oe){return oe.isPrimary}).length!==Q.length&&Q.length>1?(W=Q.map(function(oe){return new N.D(B.P.createTableColumnOptions(oe,y.connection.driver))}),[4,L.queryRunner.updatePrimaryKeys(C,W)]):[3,2]):[2,"continue"];case 1:V.sent(),V.label=2;case 2:return[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.updateExistColumns=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q,O,W,oe,me,he,be,Me,Ne,V,Pe,Ae,Oe,Je,je,He,Se,it;return(0,g.Jh)(this,function(Ge){switch(Ge.label){case 0:if(!(C=L.queryRunner.loadedTables.find(function(Le){return y.getTablePath(Le)===y.getTablePath(S)})))return[2,"continue"];if(0===(Q=L.connection.driver.findChangedColumns(C.columns,S.columns)).length)return[2,"continue"];Ge.label=1;case 1:Ge.trys.push([1,6,7,8]),Oe=void 0,O=(0,g.XA)(Q),W=O.next(),Ge.label=2;case 2:return W.done?[3,5]:(V=W.value,[4,L.dropColumnReferencedForeignKeys(L.getTablePath(S),V.databaseName)]);case 3:Ge.sent(),Ge.label=4;case 4:return W=O.next(),[3,2];case 5:return[3,8];case 6:return oe=Ge.sent(),Oe={error:oe},[3,8];case 7:try{W&&!W.done&&(Je=O.return)&&Je.call(O)}finally{if(Oe)throw Oe.error}return[7];case 8:Ge.trys.push([8,13,14,15]),je=void 0,me=(0,g.XA)(Q),he=me.next(),Ge.label=9;case 9:return he.done?[3,12]:(V=he.value,[4,L.dropColumnCompositeIndices(L.getTablePath(S),V.databaseName)]);case 10:Ge.sent(),Ge.label=11;case 11:return he=me.next(),[3,9];case 12:return[3,15];case 13:return be=Ge.sent(),je={error:be},[3,15];case 14:try{he&&!he.done&&(He=me.return)&&He.call(me)}finally{if(je)throw je.error}return[7];case 15:if(L.connection.driver instanceof P.p$||L.connection.driver instanceof P.xI)return[3,23];Ge.label=16;case 16:Ge.trys.push([16,21,22,23]),Se=void 0,Me=(0,g.XA)(Q),Ne=Me.next(),Ge.label=17;case 17:return Ne.done?[3,20]:(V=Ne.value,[4,L.dropColumnCompositeUniques(L.getTablePath(S),V.databaseName)]);case 18:Ge.sent(),Ge.label=19;case 19:return Ne=Me.next(),[3,17];case 20:return[3,23];case 21:return Pe=Ge.sent(),Se={error:Pe},[3,23];case 22:try{Ne&&!Ne.done&&(it=Me.return)&&it.call(Me)}finally{if(Se)throw Se.error}return[7];case 23:return 0===(Ae=Q.map(function(Le){var Ke=C.columns.find(function(nt){return nt.name===Le.databaseName}),tt=B.P.createTableColumnOptions(Le,y.connection.driver);return{oldColumn:Ke,newColumn:new N.D(tt)}})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild('columns changed in "'+C.name+'". updating: '+Q.map(function(Le){return Le.databaseName}).join(", ")),[4,L.queryRunner.changeColumns(C,Ae)]);case 24:return Ge.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createNewIndices=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=S.indices.filter(function(W){return!C.indices.find(function(V){return V.name===W.name})&&!0===W.synchronize}).map(function(W){return v.s.create(W)})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("adding new indices "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' in table "'+C.name+'"'),[4,L.queryRunner.createIndices(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createNewChecks=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:if(this.connection.driver instanceof P.p$||this.connection.driver instanceof P.xI)return[2];R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=S.checks.filter(function(W){return!C.checks.find(function(V){return V.name===W.name})}).map(function(W){return J.r.create(W)})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("adding new check constraints: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' in table "'+C.name+'"'),[4,L.queryRunner.createCheckConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createCompositeUniqueConstraints=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=S.uniques.filter(function(W){return W.columns.length>1&&!C.uniques.find(function(V){return V.name===W.name})}).map(function(W){return G.v.create(W)})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("adding new unique constraints: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' in table "'+C.name+'"'),[4,L.queryRunner.createUniqueConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createNewExclusions=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:if(!(this.connection.driver instanceof P.U4))return[2];R=function(S){var C,Q;return(0,g.Jh)(this,function(O){switch(O.label){case 0:return(C=L.queryRunner.loadedTables.find(function(W){return y.getTablePath(W)===y.getTablePath(S)}))?0===(Q=S.exclusions.filter(function(W){return!C.exclusions.find(function(V){return V.name===W.name})}).map(function(W){return U.N.create(W)})).length?[2,"continue"]:(L.connection.logger.logSchemaBuild("adding new exclusion constraints: "+Q.map(function(W){return'"'+W.name+'"'}).join(", ")+' in table "'+C.name+'"'),[4,L.queryRunner.createExclusionConstraints(C,Q)]):[2,"continue"];case 1:return O.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.createForeignKeys=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H,j,ee,F,I,y=this;return(0,g.Jh)(this,function(E){switch(E.label){case 0:R=function(S){var C,Q,O;return(0,g.Jh)(this,function(W){switch(W.label){case 0:return(C=L.queryRunner.loadedTables.find(function(V){return y.getTablePath(V)===y.getTablePath(S)}))?0===(Q=S.foreignKeys.filter(function(V){return!C.foreignKeys.find(function(oe){return oe.name===V.name&&y.getTablePath(oe)===y.getTablePath(V.referencedEntityMetadata)})})).length?[2,"continue"]:(O=Q.map(function(V){return a.U.create(V,y.connection.driver)}),L.connection.logger.logSchemaBuild("creating a foreign keys: "+Q.map(function(V){return V.name}).join(", ")+' on table "'+C.name+'"'),[4,L.queryRunner.createForeignKeys(C,O)]):[2,"continue"];case 1:return W.sent(),[2]}})},L=this,E.label=1;case 1:E.trys.push([1,6,7,8]),H=(0,g.XA)(this.entityToSyncMetadatas),j=H.next(),E.label=2;case 2:return j.done?[3,5]:[5,R(j.value)];case 3:E.sent(),E.label=4;case 4:return j=H.next(),[3,2];case 5:return[3,8];case 6:return ee=E.sent(),F={error:ee},[3,8];case 7:try{j&&!j.done&&(I=H.return)&&I.call(H)}finally{if(F)throw F.error}return[7];case 8:return[2]}})})},Y.prototype.dropColumnReferencedForeignKeys=function(R,L){return(0,g.mG)(this,void 0,void 0,function(){var H,j,$,ee,F,I,y,S,C,Q,O,W,V,oe,me,he=this;return(0,g.Jh)(this,function(be){switch(be.label){case 0:if(!(H=this.queryRunner.loadedTables.find(function(Me){return he.getTablePath(Me)===R})))return[2];j=[],($=H.foreignKeys.find(function(Me){return-1!==Me.columnNames.indexOf(L)}))&&((ee=H.clone()).foreignKeys=[$],j.push(ee),H.removeForeignKey($)),F=function(Me){var Ne=Me.foreignKeys.filter(function(Ae){return he.getTablePath(Ae)===R&&-1!==Ae.referencedColumnNames.indexOf(L)});if(Ne.length>0){var Pe=Me.clone();Pe.foreignKeys=Ne,j.push(Pe),Ne.forEach(function(Ae){return Me.removeForeignKey(Ae)})}};try{for(I=(0,g.XA)(this.queryRunner.loadedTables),y=I.next();!y.done;y=I.next())F(y.value)}catch(Me){W={error:Me}}finally{try{y&&!y.done&&(V=I.return)&&V.call(I)}finally{if(W)throw W.error}}if(!(j.length>0))return[3,8];be.label=1;case 1:be.trys.push([1,6,7,8]),S=(0,g.XA)(j),C=S.next(),be.label=2;case 2:return C.done?[3,5]:(this.connection.logger.logSchemaBuild("dropping related foreign keys of "+(Q=C.value).name+": "+Q.foreignKeys.map(function(Me){return Me.name}).join(", ")),[4,this.queryRunner.dropForeignKeys(Q,Q.foreignKeys)]);case 3:be.sent(),be.label=4;case 4:return C=S.next(),[3,2];case 5:return[3,8];case 6:return O=be.sent(),oe={error:O},[3,8];case 7:try{C&&!C.done&&(me=S.return)&&me.call(S)}finally{if(oe)throw oe.error}return[7];case 8:return[2]}})})},Y.prototype.dropColumnCompositeIndices=function(R,L){return(0,g.mG)(this,void 0,void 0,function(){var H,j,$=this;return(0,g.Jh)(this,function(ee){switch(ee.label){case 0:return(H=this.queryRunner.loadedTables.find(function(F){return $.getTablePath(F)===R}))?0===(j=H.indices.filter(function(F){return F.columnNames.length>1&&-1!==F.columnNames.indexOf(L)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of "'+R+'"."'+L+'": '+j.map(function(F){return F.name}).join(", ")),[4,this.queryRunner.dropIndices(H,j)]):[2];case 1:return ee.sent(),[2]}})})},Y.prototype.dropColumnCompositeUniques=function(R,L){return(0,g.mG)(this,void 0,void 0,function(){var H,j,$=this;return(0,g.Jh)(this,function(ee){switch(ee.label){case 0:return(H=this.queryRunner.loadedTables.find(function(F){return $.getTablePath(F)===R}))?0===(j=H.uniques.filter(function(F){return F.columnNames.length>1&&-1!==F.columnNames.indexOf(L)})).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+R+'"."'+L+'": '+j.map(function(F){return F.name}).join(", ")),[4,this.queryRunner.dropUniqueConstraints(H,j)]):[2];case 1:return ee.sent(),[2]}})})},Y.prototype.metadataColumnsToTableColumnOptions=function(R){var L=this;return R.map(function(H){return B.P.createTableColumnOptions(H,L.connection.driver)})},Y.prototype.createTypeormMetadataTable=function(){return(0,g.mG)(this,void 0,void 0,function(){var R,L,H;return(0,g.Jh)(this,function(j){switch(j.label){case 0:return H=this.connection.driver.buildTableName("typeorm_metadata",R=this.connection.driver.options.schema,L=this.connection.driver.database),[4,this.queryRunner.createTable(new m.i({database:L,schema:R,name:H,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return j.sent(),[2]}})})},Y}(),ie=h(4138),D=h(1018),A=h(9100),T=h(3092),x=h(4455),X=function(){function Y(R){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=["real","double","double precision","float","real","numeric","decimal","date","time","datetime"],this.withScaleColumnTypes=["real","double","double precision","float","real","numeric","decimal"],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.connection=R,this.options=R.options,this.database=T.z.buildDriverOptions(this.options).database}return Y.prototype.connect=function(){return(0,g.mG)(this,void 0,void 0,function(){var R;return(0,g.Jh)(this,function(L){switch(L.label){case 0:return R=this,[4,this.createDatabaseConnection()];case 1:return R.databaseConnection=L.sent(),[2]}})})},Y.prototype.afterConnect=function(){return Promise.resolve()},Y.prototype.disconnect=function(){return(0,g.mG)(this,void 0,void 0,function(){var R=this;return(0,g.Jh)(this,function(L){return[2,new Promise(function(H,j){R.queryRunner=void 0,R.databaseConnection.close(function($){return $?j($):H()})})]})})},Y.prototype.createSchemaBuilder=function(){return new Z(this.connection)},Y.prototype.preparePersistentValue=function(R,L){return L.transformer&&(R=A.A.transformTo(L.transformer,R)),null==R?R:L.type===Boolean||"boolean"===L.type?!0===R?1:0:"date"===L.type?_.E.mixedDateToDateString(R):"time"===L.type?_.E.mixedDateToTimeString(R):"datetime"===L.type||L.type===Date?_.E.mixedDateToUtcDatetimeString(R):"simple-array"===L.type?_.E.simpleArrayToString(R):"simple-json"===L.type?_.E.simpleJsonToString(R):"simple-enum"===L.type?_.E.simpleEnumToString(R):R},Y.prototype.prepareHydratedValue=function(R,L){return null==R?L.transformer?A.A.transformFrom(L.transformer,R):R:(L.type===Boolean||"boolean"===L.type?R=!!R:"datetime"===L.type||L.type===Date?(R&&"string"==typeof R&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(R)&&(R=R.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(R)&&(R+="Z")),R=_.E.normalizeHydratedDate(R)):"date"===L.type?R=_.E.mixedDateToDateString(R):"time"===L.type?R=_.E.mixedTimeToString(R):"simple-array"===L.type?R=_.E.stringToSimpleArray(R):"simple-json"===L.type?R=_.E.stringToSimpleJson(R):"simple-enum"===L.type&&(R=_.E.stringToSimpleEnum(R,L)),L.transformer&&(R=A.A.transformFrom(L.transformer,R)),R)},Y.prototype.escapeQueryWithParameters=function(R,L,H){var j=this,$=Object.keys(H).map(function(ee){return"boolean"==typeof H[ee]?!0===H[ee]?1:0:H[ee]});return L&&Object.keys(L).length?[R=R.replace(/:(\.\.\.)?([A-Za-z0-9_.]+)/g,function(ee,F,I){if(!L.hasOwnProperty(I))return ee;var y=L[I];return F?y.map(function(E){return $.push(E),j.createParameter(I,$.length-1)}).join(", "):y instanceof Function?y():($.push(y),j.createParameter(I,$.length-1))}),$]:[R,$]},Y.prototype.escape=function(R){return'"'+R+'"'},Y.prototype.buildTableName=function(R,L,H){return R},Y.prototype.parseTableName=function(R){var L=this.database,H=void 0;if(R instanceof m.i||R instanceof c.G){var j=this.parseTableName(R.name);return{database:R.database||j.database||L,schema:R.schema||j.schema||H,tableName:j.tableName}}if(R instanceof a.U)return j=this.parseTableName(R.referencedTableName),{database:R.referencedDatabase||j.database||L,schema:R.referencedSchema||j.schema||H,tableName:j.tableName};if(R instanceof ie.T)return{database:R.database||L,schema:R.schema||H,tableName:R.tableName};var $=R.split(".");return 3===$.length?{database:$[0]||L,schema:$[1]||H,tableName:$[2]}:2===$.length?{database:L,schema:$[0],tableName:$[1]}:{database:L,schema:H,tableName:R}},Y.prototype.normalizeType=function(R){return R.type===Number||"int"===R.type?"integer":R.type===String?"varchar":R.type===Date?"datetime":R.type===Boolean?"boolean":"uuid"===R.type?"varchar":"simple-array"===R.type||"simple-json"===R.type?"text":"simple-enum"===R.type?"varchar":R.type||""},Y.prototype.normalizeDefault=function(R){var L=R.default;return"number"==typeof L?""+L:"boolean"==typeof L?L?"1":"0":"function"==typeof L?L():"string"==typeof L?"'"+L+"'":null!=L?""+L:void 0},Y.prototype.normalizeIsUnique=function(R){return R.entityMetadata.uniques.some(function(L){return 1===L.columns.length&&L.columns[0]===R})},Y.prototype.getColumnLength=function(R){return R.length?R.length.toString():""},Y.prototype.createFullType=function(R){var L=R.type;return R.enum?"varchar":(R.length?L+="("+R.length+")":null!=R.precision&&null!=R.scale?L+="("+R.precision+","+R.scale+")":null!=R.precision&&(L+="("+R.precision+")"),R.isArray&&(L+=" array"),L)},Y.prototype.obtainMasterConnection=function(){return Promise.resolve()},Y.prototype.obtainSlaveConnection=function(){return Promise.resolve()},Y.prototype.createGeneratedMap=function(R,L,H,j){var $=R.generatedColumns.reduce(function(ee,F){var I;return"increment"===F.generationStrategy&&L&&(I=L-j+H+1),I?D.s.mergeDeep(ee,F.createValueMap(I)):ee},{});return Object.keys($).length>0?$:void 0},Y.prototype.findChangedColumns=function(R,L){var H=this;return L.filter(function(j){var $=R.find(function(ee){return ee.name===j.databaseName});return!!$&&($.name!==j.databaseName||$.type!==H.normalizeType(j)||$.length!==j.length||$.precision!==j.precision||$.scale!==j.scale||H.normalizeDefault(j)!==$.default||$.isPrimary!==j.isPrimary||$.isNullable!==j.isNullable||$.isUnique!==H.normalizeIsUnique(j)||"uuid"!==j.generationStrategy&&$.isGenerated!==j.isGenerated)})},Y.prototype.isReturningSqlSupported=function(){return!1},Y.prototype.isUUIDGenerationSupported=function(){return!1},Y.prototype.isFullTextColumnTypeSupported=function(){return!1},Y.prototype.createParameter=function(R,L){return"?"},Y.prototype.createDatabaseConnection=function(){throw new x.K_("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},Y.prototype.loadDependencies=function(){},Y}()},5526:(Ee,ne,h)=>{"use strict";h.d(ne,{I:()=>g});var g=function(P){this.options=P}},6249:(Ee,ne,h)=>{"use strict";h.d(ne,{n:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Cannot create a new connection named "'+a+'", because connection with such name already exist and it now has an active connection session.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},8369:(Ee,ne,h)=>{"use strict";h.d(ne,{a:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Cannot attach entity "'+a+'" to its parent. Please make sure parent is saved in the database before saving children nodes.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},2925:(Ee,ne,h)=>{"use strict";h.d(ne,{L:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Cannot create a "'+a+'" connection because connection to the database already established.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},9878:(Ee,ne,h)=>{"use strict";h.d(ne,{d:()=>P});var g=h(5081),P=function(m){function N(a,v){var B=m.call(this)||this,G=a.primaryColumns.reduce(function(J,U,c){return U.setEntityValue(J,c+1),J},{});return B.message='Cannot use given entity id "'+v+'" because "'+a.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(G)+" as an id.",B}return(0,g.ZT)(N,m),N}(h(5797).K)},6812:(Ee,ne,h)=>{"use strict";h.d(ne,{c:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Cannot "+a+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4116:(Ee,ne,h)=>{"use strict";h.d(ne,{$:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Cannot execute operation on "'+a+'" connection because connection is not yet established.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5349:(Ee,ne,h)=>{"use strict";var m,g=h(5081);m=h(5797).K,(0,g.ZT)(function(a,v){return m.call(this,'Cannot get reflected type for a "'+v+'" method\'s parameter of "'+a.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.')||this},m)},173:(Ee,ne,h)=>{"use strict";h.d(ne,{u:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Circular relations detected: "+a+". To resolve this issue you need to set nullable: true somewhere in this dependency structure.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4800:(Ee,ne,h)=>{"use strict";h.d(ne,{s:()=>P});var g=h(5081),P=function(m){function N(a,v){return m.call(this,"Column type for "+a.constructor.name+"#"+v+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4372:(Ee,ne,h)=>{"use strict";h.d(ne,{B:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Connection "'+a+'" was not found.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},6454:(Ee,ne,h)=>{"use strict";h.d(ne,{R:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Custom entity repository "+(a instanceof Function?a.name:a.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},6661:(Ee,ne,h)=>{"use strict";h.d(ne,{b:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Custom repository "+(a instanceof Function?a.name:a.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5998:(Ee,ne,h)=>{"use strict";h.d(ne,{n:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Custom repository "+(a instanceof Function?a.name:a.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4314:(Ee,ne,h)=>{"use strict";h.d(ne,{q:()=>P});var g=h(5081),P=function(m){function N(a,v,B){var G=m.call(this)||this;return G.message='Data type "'+("string"==typeof v?v:v.name)+'" in "'+a.entityMetadata.targetName+"."+a.propertyName+'" is not supported by "'+B+'" database.',G}return(0,g.ZT)(N,m),N}(h(5797).K)},1482:(Ee,ne,h)=>{"use strict";h.d(ne,{f:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Driver option ("+a+") is not set. Please set it to perform connection to the database.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},7292:(Ee,ne,h)=>{"use strict";h.d(ne,{z:()=>P});var g=h(5081),P=function(m){function N(a,v){return m.call(this,a+" package has not been found installed. Try to install it: npm install "+v+" --save")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},6157:(Ee,ne,h)=>{"use strict";h.d(ne,{n:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'No entity column "'+a+'" was found.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},2427:(Ee,ne,h)=>{"use strict";h.d(ne,{t:()=>m});var g=h(5081),_=h(5526),m=function(N){function a(v){var B=N.call(this)||this;return B.message='No metadata for "'+B.stringifyTarget(v)+'" was found.',B}return(0,g.ZT)(a,N),a.prototype.stringifyTarget=function(v){return v instanceof _.I?v.options.name:"function"==typeof v||"object"==typeof v&&"name"in v?v.name:v},a}(h(5797).K)},4906:(Ee,ne,h)=>{"use strict";h.d(ne,{E:()=>m});var g=h(5081),_=h(5526),m=function(N){function a(v,B){var G=N.call(this)||this;return G.message='Could not find any entity of type "'+G.stringifyTarget(v)+'" matching: '+G.stringifyCriteria(B),G}return(0,g.ZT)(a,N),a.prototype.stringifyTarget=function(v){return v instanceof _.I?v.options.name:"function"==typeof v||"object"==typeof v&&"name"in v?v.name:v},a.prototype.stringifyCriteria=function(v){try{return JSON.stringify(v,null,4)}catch(B){}return""+v},a}(h(5797).K)},5368:(Ee,ne,h)=>{"use strict";h.d(ne,{P:()=>P});var g=h(5081),P=function(m){function N(a){var v=m.call(this)||this;return v.message=1===a.length?'Relation "'+a[0]+'" was not found; please check if it is correct and really exists in your entity.':"Relations "+a.map(function(B){return'"'+B+'"'}).join(", ")+" were not found; please check if relations are correct and they exist in your entities.",v}return(0,g.ZT)(N,m),N}(h(5797).K)},8293:(Ee,ne,h)=>{"use strict";h.d(ne,{j:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+a.entityMetadata.targetName+"#"+a.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},7002:(Ee,ne,h)=>{"use strict";h.d(ne,{D:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,'Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},6719:(Ee,ne,h)=>{"use strict";h.d(ne,{T:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Your database does not support LIMIT on UPDATE statements.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},8489:(Ee,ne,h)=>{"use strict";h.d(ne,{A:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Locking not supported on given driver.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},7141:(Ee,ne,h)=>{"use strict";h.d(ne,{d:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Entity "'+a.name+'" does not have delete date columns.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4015:(Ee,ne,h)=>{"use strict";h.d(ne,{R:()=>P});var g=h(5081),P=function(m){function N(a,v){return void 0===v&&(v=[]),m.call(this,'Wrong driver: "'+a+'" given. Supported drivers are: '+v.map(function(B){return'"'+B+'"'}).join(", ")+".")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},7129:(Ee,ne,h)=>{"use strict";h.d(ne,{H:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Entity "'+a.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},3908:(Ee,ne,h)=>{"use strict";h.d(ne,{B:()=>P});var g=h(5081),P=function(m){function N(a,v){return m.call(this,"Cannot "+a+', given value must be an entity, instead "'+v+'" is given.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},867:(Ee,ne,h)=>{"use strict";h.d(ne,{H:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Option "'+a+'" is not set in your connection options, please define "'+a+'" option in your connection options or ormconfig.json')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},6496:(Ee,ne,h)=>{"use strict";h.d(ne,{r:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},2836:(Ee,ne,h)=>{"use strict";h.d(ne,{f:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Entity "+a+" does not have version or update date columns.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},1438:(Ee,ne,h)=>{"use strict";h.d(ne,{G:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},2592:(Ee,ne,h)=>{"use strict";h.d(ne,{Y:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"The optimistic lock can be used only with getOne() method.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5529:(Ee,ne,h)=>{"use strict";h.d(ne,{Z:()=>P});var g=h(5081),P=function(m){function N(a,v,B){return m.call(this,"The optimistic lock on entity "+a+" failed, version "+v+" was expected, but is actually "+B+".")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},7665:(Ee,ne,h)=>{"use strict";h.d(ne,{G:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"An open transaction is required for pessimistic lock.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},8990:(Ee,ne,h)=>{"use strict";h.d(ne,{I:()=>P});var g=h(5081),P=function(m){function N(a,v){return m.call(this,"Primary column "+a.constructor.name+"#"+v+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4469:(Ee,ne,h)=>{"use strict";h.d(ne,{O:()=>m});var g=h(5081),_=h(2183),m=function(N){function a(v,B,G){var J=N.call(this,G.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""))||this;if(J.query=v,J.parameters=B,J.driverError=G,G){var c=(0,g._T)(G,["name"]);_.g.assign(J,(0,g.pi)({},c))}return J}return(0,g.ZT)(a,N),a}(h(5797).K)},6235:(Ee,ne,h)=>{"use strict";h.d(ne,{Y:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Query runner already released. Cannot run queries anymore.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5737:(Ee,ne,h)=>{"use strict";h.d(ne,{i:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},2111:(Ee,ne,h)=>{"use strict";h.d(ne,{V:()=>m});var g=h(5081),_=h(5526),m=function(N){function a(v,B){var G=N.call(this)||this;return G.message='No repository for "'+(B instanceof _.I?B.options.name:"function"==typeof B||"object"==typeof B&&"name"in B?B.name:B)+'" was found. Looks like this entity is not registered in current "'+v+'" connection?',G}return(0,g.ZT)(a,N),a}(h(5797).K)},2095:(Ee,ne,h)=>{"use strict";h.d(ne,{c:()=>m});var g=h(5081),_=h(5526),m=function(N){function a(v){var B=N.call(this)||this;return B.message='Repository of the "'+(v instanceof _.I?v.options.name:"function"==typeof v||"object"==typeof v&&"name"in v?v.name:v)+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',B}return(0,g.ZT)(a,N),a}(h(5797).K)},191:(Ee,ne,h)=>{"use strict";h.d(ne,{y:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5714:(Ee,ne,h)=>{"use strict";h.d(ne,{B:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,'Removed entity "'+a.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},9387:(Ee,ne,h)=>{"use strict";h.d(ne,{H:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Internal error. Subject "+a.metadata.targetName+" must have an identifier to perform operation.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},326:(Ee,ne,h)=>{"use strict";h.d(ne,{S:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Transaction already started for the given connection, commit current transaction before starting a new one.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},8637:(Ee,ne,h)=>{"use strict";h.d(ne,{W:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,"Transaction is not started yet, start transaction before committing or rolling it back.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},3546:(Ee,ne,h)=>{"use strict";h.d(ne,{A:()=>P});var g=h(5081),P=function(m){function N(a){return m.call(this,"Tree repositories are not supported in "+a.options.type+" driver.")||this}return(0,g.ZT)(N,m),N}(h(5797).K)},5797:(Ee,ne,h)=>{"use strict";h.d(ne,{K:()=>_});var g=h(5081),_=function(P){function m(N){var a=this.constructor,v=P.call(this,N)||this;return Object.setPrototypeOf?Object.setPrototypeOf(v,a.prototype):v.__proto__=a.prototype,v}return(0,g.ZT)(m,P),Object.defineProperty(m.prototype,"name",{get:function(){return this.constructor.name},enumerable:!1,configurable:!0}),m}(Error)},8080:(Ee,ne,h)=>{"use strict";h.d(ne,{y:()=>P});var g=h(5081),P=function(m){function N(){return m.call(this,'Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.')||this}return(0,g.ZT)(N,m),N}(h(5797).K)},4455:(Ee,ne,h)=>{"use strict";h.d(ne,{fd:()=>Pe.f,zm:()=>V.z,PI:()=>Ae.P,K_:()=>v.K}),h(5349),h(6249),h(9387),h(2925),h(8489);var d,a=h(5081),v=h(5797),V=((0,a.ZT)(function(q){return d.call(this,"Connection with "+q+" database is not established. Check connection configuration.")||this},d=v.K),h(9878),function(d){(0,a.ZT)(function(q,k,se){return d.call(this,q+" metadata already exists for the class constructor "+JSON.stringify(k)+(se?" on property "+se:". If you previously renamed or moved entity class, make sure that compiled version of old entity class source wasn't left in the compiler output directory."))||this},d)}(v.K),h(6812),h(8080),h(3546),h(5998),h(8637),h(326),h(4906),h(2427),h(3908),h(5529),h(6719),h(8990),h(6454),h(5737),h(8369),h(6661),h(7141),function(d){(0,a.ZT)(function(q){return d.call(this,'Cannot get a Repository for "'+q+" connection, because connection with the database is not established yet. Call connection#connect method to establish connection.")||this},d)}(v.K),h(173),h(191),function(d){(0,a.ZT)(function(q,k){return d.call(this,"Using JoinTable on "+q.name+"#"+k.propertyName+" is wrong. "+q.name+"#"+k.propertyName+" has "+k.relationType+" relation, however you can use JoinTable only on many-to-many relations.")||this},d)}(v.K),function(d){(0,a.ZT)(function(q,k){var se=d.call(this)||this;return se.message=k.inverseRelation?"JoinColumn is missing on both sides of "+q.name+"#"+k.propertyName+" and "+k.inverseEntityMetadata.name+"#"+k.inverseRelation.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on one of the sides.":"JoinColumn is missing on "+q.name+"#"+k.propertyName+" one-to-one relationship. You need to put JoinColumn decorator on it.",se},d)}(v.K),h(7129),h(6157),h(4015),h(7292)),Pe=(function(d){(0,a.ZT)(function(q){return d.call(this,'Cannot get entity manager for "'+q+'" connection because connection is not yet established.')||this},d)}(v.K),h(4372),h(2836),h(7002),h(2592),function(d){(0,a.ZT)(function(q,k){return d.call(this,q+" metadata with such name "+k+" already exists. Do you apply decorator twice? Or maybe try to change a name?")||this},d)}(v.K),h(1482)),Ae=h(5368);h(2111),function(d){(0,a.ZT)(function(q,k){var se=d.call(this)||this;return se.message='Naming strategy "'+(q instanceof Function?q.name:q)+'" was not found. Looks like this naming strategy does not exist or it was not registered in current "'+k+'" connection?',se},d)}(v.K),h(7665),h(2095),h(4314),h(8293),function(d){(0,a.ZT)(function(q,k){var se=d.call(this)||this;return se.message=k.inverseRelation?"JoinTable is missing on both sides of "+q.name+"#"+k.propertyName+" and "+k.inverseEntityMetadata.name+"#"+k.inverseRelation.propertyName+" many-to-many relationship. You need to put decorator decorator on one of the sides.":"JoinTable is missing on "+q.name+"#"+k.propertyName+" many-to-many relationship. You need to put JoinTable decorator on it.",se},d)}(v.K),h(4469),h(6496),function(d){(0,a.ZT)(function(q,k){return d.call(this,"Using JoinColumn is allowed only on one side of the one-to-one relationship. Both "+q.name+"#"+k.propertyName+" and "+k.inverseEntityMetadata.name+"#"+k.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinTable decorator only on it.")||this},d)}(v.K),function(d){(0,a.ZT)(function(q,k){return d.call(this,"Using JoinTable is allowed only on one side of the many-to-many relationship. Both "+q.name+"#"+k.propertyName+" and "+k.inverseEntityMetadata.name+"#"+k.inverseRelation.propertyName+" has JoinTable decorators. Choose one of them and left JoinColumn decorator only on it.")||this},d)}(v.K),h(5714),function(d){(0,a.ZT)(function(){return d.call(this,"Internal error. Persisted entity was not found in the list of prepared operated entities.")||this},d)}(v.K),function(d){(0,a.ZT)(function(q,k){return d.call(this,"Using JoinColumn on "+q.name+"#"+k.propertyName+" is wrong. You can use JoinColumn only on one-to-one and many-to-one relations.")||this},d)}(v.K),h(4800),h(6235),h(1438),h(4116),h(867)},2446:(Ee,ne,h)=>{"use strict";h.d(ne,{J:()=>g});var g=function(){function _(P,m,N,a,v,B){void 0===N&&(N=!0),void 0===a&&(a=!1),this._type=P,this._value=m,this._useParameter=N,this._multipleParameters=a,this._getSql=v,this._objectLiteralParameters=B}return Object.defineProperty(_.prototype,"useParameter",{get:function(){return this._value instanceof _?this._value.useParameter:this._useParameter},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"multipleParameters",{get:function(){return this._value instanceof _?this._value.multipleParameters:this._multipleParameters},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"value",{get:function(){return this._value instanceof _?this._value.value:this._value},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"objectLiteralParameters",{get:function(){return this._value instanceof _?this._value.objectLiteralParameters:this._objectLiteralParameters},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"child",{get:function(){if(this._value instanceof _)return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"getSql",{get:function(){return this._value instanceof _?this._value.getSql:this._getSql},enumerable:!1,configurable:!0}),_}()},8108:(Ee,ne,h)=>{"use strict";h.d(ne,{In:()=>_});var g=h(2446);function _(P){return new g.J("in",P,!0,!0)}},4138:(Ee,ne,h)=>{"use strict";h.d(ne,{T:()=>N});var g=h(5081),_=h(9878),P=h(1018),m=h(3252),N=function(){function a(v){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isAlwaysUsingConstructor=!0,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=v.connection,this.inheritanceTree=v.inheritanceTree||[],this.inheritancePattern=v.inheritancePattern,this.treeType=v.tableTree?v.tableTree.type:void 0,this.treeOptions=v.tableTree?v.tableTree.options:void 0,this.parentClosureEntityMetadata=v.parentClosureEntityMetadata,this.tableMetadataArgs=v.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return a.prototype.create=function(v,B){var J,G=this;if(this.target instanceof Function)return J=!(null==B?void 0:B.fromDeserializer)||this.isAlwaysUsingConstructor?new this.target:Object.create(this.target.prototype),this.lazyRelations.forEach(function(c){return G.connection.relationLoader.enableLazyLoad(c,J,v)}),J;var U={};return this.lazyRelations.forEach(function(c){return G.connection.relationLoader.enableLazyLoad(c,U,v)}),U},a.prototype.hasId=function(v){return!!v&&this.primaryColumns.every(function(B){var G=B.getEntityValue(v);return null!=G&&""!==G})},a.prototype.hasAllPrimaryKeys=function(v){return this.primaryColumns.every(function(B){return null!=B.getEntityValue(v)})},a.prototype.ensureEntityIdMap=function(v){if(v instanceof Object)return v;if(this.hasMultiplePrimaryKeys)throw new _.d(this,v);return this.primaryColumns[0].createValueMap(v)},a.prototype.getEntityIdMap=function(v){if(v)return a.getValueMap(v,this.primaryColumns,{skipNulls:!0})},a.prototype.getEntityIdMixedMap=function(v){if(!v)return v;var B=this.getEntityIdMap(v);return this.hasMultiplePrimaryKeys?B:B&&this.primaryColumns[0].getEntityValue(B)},a.prototype.compareEntities=function(v,B){var G=this.getEntityIdMap(v);if(!G)return!1;var J=this.getEntityIdMap(B);return!!J&&P.s.compareIds(G,J)},a.prototype.findColumnWithPropertyName=function(v){return this.columns.find(function(B){return B.propertyName===v})},a.prototype.findColumnWithDatabaseName=function(v){return this.columns.find(function(B){return B.databaseName===v})},a.prototype.hasColumnWithPropertyPath=function(v){return this.columns.some(function(G){return G.propertyPath===v})||this.hasRelationWithPropertyPath(v)},a.prototype.findColumnWithPropertyPath=function(v){var B=this.columns.find(function(J){return J.propertyPath===v});if(B)return B;var G=this.relations.find(function(J){return J.propertyPath===v});return G&&1===G.joinColumns.length?G.joinColumns[0]:void 0},a.prototype.findColumnsWithPropertyPath=function(v){var B=this.columns.find(function(J){return J.propertyPath===v});if(B)return[B];var G=this.findRelationWithPropertyPath(v);return G&&G.joinColumns?G.joinColumns:[]},a.prototype.hasRelationWithPropertyPath=function(v){return this.relations.some(function(B){return B.propertyPath===v})},a.prototype.findRelationWithPropertyPath=function(v){return this.relations.find(function(B){return B.propertyPath===v})},a.prototype.hasEmbeddedWithPropertyPath=function(v){return this.allEmbeddeds.some(function(B){return B.propertyPath===v})},a.prototype.findEmbeddedWithPropertyPath=function(v){return this.allEmbeddeds.find(function(B){return B.propertyPath===v})},a.prototype.extractRelationValuesFromEntity=function(v,B){var G=this,J=[];return B.forEach(function(U){var c=U.getEntityValue(v);Array.isArray(c)?c.forEach(function(Z){return J.push([U,Z,G.getInverseEntityMetadata(Z,U)])}):c&&J.push([U,c,G.getInverseEntityMetadata(c,U)])}),J},a.prototype.getInverseEntityMetadata=function(v,B){return B.inverseEntityMetadata.childEntityMetadatas.find(function(J){return J.target===v.constructor})||B.inverseEntityMetadata},a.createPropertyPath=function(v,B,G){var J=this;void 0===G&&(G="");var U=[];return Object.keys(B).forEach(function(c){var Z=G?G+"."+c:c;if(v.hasEmbeddedWithPropertyPath(Z)){var ie=J.createPropertyPath(v,B[c],Z);U.push.apply(U,(0,g.ev)([],(0,g.CR)(ie)))}else U.push(G?G+"."+c:c)}),U},a.difference=function(v,B){return v.filter(function(G){return!B.find(function(J){return P.s.compareIds(G,J)})})},a.getValueMap=function(v,B,G){return B.reduce(function(J,U){var c=U.getEntityValueMap(v,G);if(void 0!==J&&null!=c)return P.s.mergeDeep(J,c)},{})},a.prototype.build=function(){var v,B=this.connection.namingStrategy,G=this.connection.options.entityPrefix,J=this.connection.options.entitySkipConstructor;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:(null===(v=this.connection.options)||void 0===v?void 0:v.hasOwnProperty("schema"))&&(this.schema=this.connection.options.schema),this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=B.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=B.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=B.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=(0,m.OV)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=G?B.prefixTableName(G,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.connection.driver.buildTableName(this.tableName,this.schema,this.database),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,void 0!==J&&(this.isAlwaysUsingConstructor=!J),this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},a.prototype.registerColumn=function(v){-1===this.ownColumns.indexOf(v)&&(this.ownColumns.push(v),this.columns=this.embeddeds.reduce(function(B,G){return B.concat(G.columnsFromTree)},this.ownColumns),this.primaryColumns=this.columns.filter(function(B){return B.isPrimary}),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter(function(B){return B.isGenerated||"uuid"===B.generationStrategy}).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach(function(B){return B.registerColumn(v)}))},a.prototype.createPropertiesMap=function(){var v={};return this.columns.forEach(function(B){return P.s.mergeDeep(v,B.createValueMap(B.propertyPath))}),this.relations.forEach(function(B){return P.s.mergeDeep(v,B.createValueMap(B.propertyPath))}),v},a}()},9145:(Ee,ne,h)=>{"use strict";h.d(ne,{Qd:()=>g,En:()=>_,$2:()=>P,yX:()=>m,U4:()=>N,xI:()=>a,J1:()=>v,Z0:()=>G,tU:()=>J,p$:()=>U,XR:()=>c,Z7:()=>Z,R4:()=>ie});var g=function(){},_=function(){},P=function(){},m=function(){},N=function(){},a=function(){},v=function(){},G=function(){},J=function(){},U=function(){},c=function(){},Z=function(){},ie=function(){}},2967:(Ee,ne,h)=>{"use strict";h.d(ne,{D:()=>g});var g=function(P){this.whereFactory=P}},1993:(Ee,ne,h)=>{"use strict";h.d(ne,{T:()=>B});var g=h(5081),_=h(9145),P=h(2161),m=h(8666),N=h(191),a=h(9535),v=h(5526),B=function(G){function J(U,c){var Z=G.call(this,U,c)||this;return Z.expressionMap.aliasNamePrefixingEnabled=!1,Z}return(0,g.ZT)(J,G),J.prototype.getQuery=function(){var U=this.createComment();return(U+=this.createDeleteExpression()).trim()},J.prototype.execute=function(){return(0,g.mG)(this,void 0,void 0,function(){var U,c,Z,ie,D,T,x,A,X;return(0,g.Jh)(this,function(R){switch(R.label){case 0:U=(0,g.CR)(this.getQueryAndParameters(),2),c=U[0],Z=U[1],ie=this.obtainQueryRunner(),D=!1,R.label=1;case 1:return R.trys.push([1,11,16,19]),!0===this.expressionMap.useTransaction&&!1===ie.isTransactionActive?[4,ie.startTransaction()]:[3,3];case 2:R.sent(),D=!0,R.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(A=new a.D,ie.broadcaster.broadcastBeforeRemoveEvent(A,this.expressionMap.mainAlias.metadata),A.promises.length>0?[4,Promise.all(A.promises)]:[3,5]):[3,5];case 4:R.sent(),R.label=5;case 5:return[4,ie.query(c,Z,!0)];case 6:return T=R.sent(),x=m.y.from(T),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(A=new a.D,ie.broadcaster.broadcastAfterRemoveEvent(A,this.expressionMap.mainAlias.metadata),A.promises.length>0?[4,Promise.all(A.promises)]:[3,8]):[3,8];case 7:R.sent(),R.label=8;case 8:return D?[4,ie.commitTransaction()]:[3,10];case 9:R.sent(),R.label=10;case 10:return[2,x];case 11:if(X=R.sent(),!D)return[3,15];R.label=12;case 12:return R.trys.push([12,14,,15]),[4,ie.rollbackTransaction()];case 13:case 14:return R.sent(),[3,15];case 15:throw X;case 16:return ie===this.queryRunner?[3,18]:[4,ie.release()];case 17:R.sent(),R.label=18;case 18:return[7];case 19:return[2]}})})},J.prototype.from=function(U,c){var Z=this.createFromAlias(U=U instanceof v.I?U.options.name:U,c);return this.expressionMap.setMainAlias(Z),this},J.prototype.where=function(U,c){this.expressionMap.wheres=[];var Z=this.getWhereCondition(U);return Z&&(this.expressionMap.wheres=[{type:"simple",condition:Z}]),c&&this.setParameters(c),this},J.prototype.andWhere=function(U,c){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(U)}),c&&this.setParameters(c),this},J.prototype.orWhere=function(U,c){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(U)}),c&&this.setParameters(c),this},J.prototype.whereInIds=function(U){return this.where(this.getWhereInIdsCondition(U))},J.prototype.andWhereInIds=function(U){return this.andWhere(this.getWhereInIdsCondition(U))},J.prototype.orWhereInIds=function(U){return this.orWhere(this.getWhereInIdsCondition(U))},J.prototype.output=function(U){return this.returning(U)},J.prototype.returning=function(U){if(!this.connection.driver.isReturningSqlSupported())throw new N.y;return this.expressionMap.returning=U,this},J.prototype.createDeleteExpression=function(){var U=this.getTableName(this.getMainTableName()),c=this.createWhereExpression(),Z=this.createReturningExpression();return Z&&(this.connection.driver instanceof _.U4||this.connection.driver instanceof _.J1)?"DELETE FROM "+U+c+" RETURNING "+Z:""!==Z&&this.connection.driver instanceof _.Z0?"DELETE FROM "+U+" OUTPUT "+Z+c:"DELETE FROM "+U+c},J}(P.z)},7225:(Ee,ne,h)=>{"use strict";h.d(ne,{O:()=>c});var g=h(5081),_=h(9145),P=h(2161),m=h(2221),N=h(7706),a=h(191),v=h(7002),B=h(5418),G=h(5746),J=h(9535),U=h(5526),c=function(Z){function ie(){return null!==Z&&Z.apply(this,arguments)||this}return(0,g.ZT)(ie,Z),ie.prototype.getQuery=function(){var D=this.createComment();return(D+=this.createInsertExpression()).trim()},ie.prototype.execute=function(){return(0,g.mG)(this,void 0,void 0,function(){var D,A,T,x,X,Y,R,L,H,j,ee,I,E,S,C,Q,O,V,oe,me=this;return(0,g.Jh)(this,function(he){switch(he.label){case 0:if(0===(D=this.getValueSets()).length)return[2,new N.t];A=this.obtainQueryRunner(),T=!1,he.label=1;case 1:return he.trys.push([1,13,18,21]),!0===this.expressionMap.useTransaction&&!1===A.isTransactionActive?[4,A.startTransaction()]:[3,3];case 2:he.sent(),T=!0,he.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(x=new J.D,D.forEach(function(be){A.broadcaster.broadcastBeforeInsertEvent(x,me.expressionMap.mainAlias.metadata,be)}),x.promises.length>0?[4,Promise.all(x.promises)]:[3,5]):[3,5];case 4:he.sent(),he.label=5;case 5:if(X=null,Y=null,R=new B.v(A,this.expressionMap),L=[],Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)try{for(H=(0,g.XA)(this.expressionMap.returning),j=H.next();!j.done;j=H.next())L.push.apply(L,(0,g.ev)([],(0,g.CR)(this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(j.value))))}catch(be){V={error:be}}finally{try{j&&!j.done&&(oe=H.return)&&oe.call(H)}finally{if(V)throw V.error}}return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(D.length>1&&this.connection.driver instanceof _.XR||(this.expressionMap.extraReturningColumns=R.getInsertionReturningColumns()),L.push.apply(L,(0,g.ev)([],(0,g.CR)(this.expressionMap.extraReturningColumns.filter(function(be){return!L.includes(be)}))))),L.length>0&&this.connection.driver instanceof _.Z0&&(X=this.connection.driver.buildTableVariableDeclaration("@OutputTable",L),Y="SELECT * FROM @OutputTable"),ee=(0,g.CR)(this.getQueryAndParameters(),2),I=ee[1],E=[X,ee[0],Y].filter(function(be){return null!=be}).join(";\n\n"),[4,A.query(E,I,!0)];case 6:return S=he.sent(),C=N.t.from(S),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,R.insert(C,D)]:[3,8];case 7:he.sent(),he.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(Q=new J.D,D.forEach(function(be){A.broadcaster.broadcastAfterInsertEvent(Q,me.expressionMap.mainAlias.metadata,be)}),Q.promises.length>0?[4,Promise.all(Q.promises)]:[3,10]):[3,10];case 9:he.sent(),he.label=10;case 10:return T?[4,A.commitTransaction()]:[3,12];case 11:he.sent(),he.label=12;case 12:return[2,C];case 13:if(O=he.sent(),!T)return[3,17];he.label=14;case 14:return he.trys.push([14,16,,17]),[4,A.rollbackTransaction()];case 15:case 16:return he.sent(),[3,17];case 17:throw O;case 18:return A===this.queryRunner?[3,20]:[4,A.release()];case 19:he.sent(),he.label=20;case 20:return[7];case 21:return[2]}})})},ie.prototype.into=function(D,A){var T=this.createFromAlias(D=D instanceof U.I?D.options.name:D);return this.expressionMap.setMainAlias(T),this.expressionMap.insertColumns=A||[],this},ie.prototype.values=function(D){return this.expressionMap.valuesSet=D,this},ie.prototype.output=function(D){return this.returning(D)},ie.prototype.returning=function(D){if(!this.connection.driver.isReturningSqlSupported())throw new a.y;return this.expressionMap.returning=D,this},ie.prototype.updateEntity=function(D){return this.expressionMap.updateEntity=D,this},ie.prototype.onConflict=function(D){return this.expressionMap.onConflict=D,this},ie.prototype.orIgnore=function(D){return void 0===D&&(D=!0),this.expressionMap.onIgnore=!!D,this},ie.prototype.orUpdate=function(D,A){return Array.isArray(D)?(this.expressionMap.onUpdate={overwrite:D,conflict:A},this):(this.expressionMap.onUpdate={conflict:null==D?void 0:D.conflict_target,columns:null==D?void 0:D.columns,overwrite:null==D?void 0:D.overwrite},this)},ie.prototype.createInsertExpression=function(){var D=this,A=this.getTableName(this.getMainTableName()),T=this.createValuesExpression(),x=this.connection.driver instanceof _.XR&&this.getValueSets().length>1?null:this.createReturningExpression(),X=this.createColumnNamesExpression(),Y="INSERT ";if((this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI)&&(Y+=this.expressionMap.onIgnore?" IGNORE ":""),Y+="INTO "+A,X?Y+="("+X+")":!T&&(this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI)&&(Y+="()"),x&&this.connection.driver instanceof _.Z0&&(Y+=" OUTPUT "+x),T?this.connection.driver instanceof _.XR&&this.getValueSets().length>1?Y+=" "+T:Y+=" VALUES "+T:Y+=this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI?" VALUES ()":" DEFAULT VALUES",this.connection.driver instanceof _.U4||this.connection.driver instanceof G.w||this.connection.driver instanceof _.J1)if(this.expressionMap.onIgnore)Y+=" ON CONFLICT DO NOTHING ";else if(this.expressionMap.onConflict)Y+=" ON CONFLICT "+this.expressionMap.onConflict+" ";else if(this.expressionMap.onUpdate){var R=this.expressionMap.onUpdate,L=R.overwrite,H=R.columns,j=R.conflict,$="ON CONFLICT";Array.isArray(j)?$+=" ( "+j.map(function(F){return D.escape(F)}).join(", ")+" )":j&&($+=" ON CONSTRAINT "+this.escape(j)),Array.isArray(L)?(Y+=" "+$+" DO UPDATE SET ",Y+=null==L?void 0:L.map(function(F){return D.escape(F)+" = EXCLUDED."+D.escape(F)}).join(", "),Y+=" "):H&&(Y+=" "+$+" DO UPDATE SET ",Y+=H.map(function(F){return D.escape(F)+" = :"+F}).join(", "),Y+=" ")}if((this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI)&&this.expressionMap.onUpdate){var ee=this.expressionMap.onUpdate;L=ee.overwrite,H=ee.columns,Array.isArray(L)?(Y+=" ON DUPLICATE KEY UPDATE ",Y+=L.map(function(y){return D.escape(y)+" = VALUES("+D.escape(y)+")"}).join(", "),Y+=" "):Array.isArray(H)&&(Y+=" ON DUPLICATE KEY UPDATE ",Y+=H.map(function(y){return D.escape(y)+" = :"+y}).join(", "),Y+=" ")}return x&&(this.connection.driver instanceof _.U4||this.connection.driver instanceof _.XR||this.connection.driver instanceof _.J1)&&(Y+=" RETURNING "+x),this.connection.driver instanceof _.Z0&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.mainAlias.metadata.columns.filter(function(F){return D.expressionMap.insertColumns.length>0?-1!==D.expressionMap.insertColumns.indexOf(F.propertyPath):F.isInsert}).some(function(F){return D.isOverridingAutoIncrementBehavior(F)})&&(Y="SET IDENTITY_INSERT "+A+" ON; "+Y+"; SET IDENTITY_INSERT "+A+" OFF"),Y},ie.prototype.getInsertedColumns=function(){var D=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter(function(A){return D.expressionMap.insertColumns.length?-1!==D.expressionMap.insertColumns.indexOf(A.propertyPath):!(!A.isInsert||A.isGenerated&&"increment"===A.generationStrategy&&!(D.connection.driver instanceof _.XR)&&!(D.connection.driver instanceof G.w)&&!(D.connection.driver instanceof _.p$)&&!(D.connection.driver instanceof _.xI)&&!(D.connection.driver instanceof _.Z0&&D.isOverridingAutoIncrementBehavior(A)))}):[]},ie.prototype.createColumnNamesExpression=function(){var D=this,A=this.getInsertedColumns();if(A.length>0)return A.map(function(x){return D.escape(x.databaseName)}).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var T=this.getValueSets();if(1===T.length)return Object.keys(T[0]).map(function(x){return D.escape(x)}).join(", ")}return this.expressionMap.insertColumns.map(function(x){return D.escape(x)}).join(", ")},ie.prototype.createValuesExpression=function(){var D=this,A=this.getValueSets(),T=this.getInsertedColumns();if(T.length>0){var x="";return A.forEach(function(Y,R){T.forEach(function(L,H){0===H&&(x+=D.connection.driver instanceof _.XR&&A.length>1?" SELECT ":"(");var j=L.getEntityValue(Y);if(j instanceof Function||(j=D.connection.driver.preparePersistentValue(j,L)),L.isVersion&&void 0===j)x+="1";else if(L.isDiscriminator)x+=D.createParameter(D.expressionMap.mainAlias.metadata.discriminatorValue);else if(L.isGenerated&&"uuid"===L.generationStrategy&&!D.connection.driver.isUUIDGenerationSupported()&&void 0===j)j=m.f.uuid4(),x+=D.createParameter(j),R in D.expressionMap.locallyGenerated||(D.expressionMap.locallyGenerated[R]={}),L.setEntityValue(D.expressionMap.locallyGenerated[R],j);else if(void 0===j)x+=D.connection.driver instanceof _.XR&&A.length>1||D.connection.driver instanceof G.w||D.connection.driver instanceof _.tU?null!=L.default?D.connection.driver.normalizeDefault(L):"NULL":"DEFAULT";else if(j instanceof Function)x+=j();else{D.connection.driver instanceof _.Z0&&(j=D.connection.driver.parametrizeValue(L,j));var $=D.createParameter(j);if((D.connection.driver instanceof _.p$||D.connection.driver instanceof _.xI)&&-1!==D.connection.driver.spatialTypes.indexOf(L.type)){var F=D.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";x+=null!=L.srid?F+"("+$+", "+L.srid+")":F+"("+$+")"}else D.connection.driver instanceof _.U4&&-1!==D.connection.driver.spatialTypes.indexOf(L.type)?x+=null!=L.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+$+"), "+L.srid+")::"+L.type:"ST_GeomFromGeoJSON("+$+")::"+L.type:D.connection.driver instanceof _.Z0&&-1!==D.connection.driver.spatialTypes.indexOf(L.type)?x+=L.type+"::STGeomFromText("+$+", "+(L.srid||"0")+")":x+=$}x+=H===T.length-1?R===A.length-1?D.connection.driver instanceof _.XR&&A.length>1?" FROM DUAL ":")":D.connection.driver instanceof _.XR&&A.length>1?" FROM DUAL UNION ALL ":"), ":", "})}),"()"===x?"":x}var X="";return A.forEach(function(Y,R){Object.keys(Y).forEach(function(H,j){0===j&&(X+="(");var $=Y[H];X+=$ instanceof Function?$():void 0===$?D.connection.driver instanceof G.w||D.connection.driver instanceof _.tU?"NULL":"DEFAULT":D.createParameter($),j===Object.keys(Y).length-1?X+=R===A.length-1?")":"), ":X+=", "})}),"()"===X?"":X},ie.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet))return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new v.D},ie.prototype.isOverridingAutoIncrementBehavior=function(D){return D.isPrimary&&D.isGenerated&&"increment"===D.generationStrategy&&this.getValueSets().some(function(A){return void 0!==D.getEntityValue(A)&&null!==D.getEntityValue(A)})},ie}(P.z)},5095:(Ee,ne,h)=>{"use strict";h.d(ne,{k:()=>N});var g=h(5081),_=h(1534),P=h(2183),m=h(4455),N=function(){function a(v,B,G){this.connection=v,this.queryExpressionMap=B,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,P.g.assign(this,G||{})}return Object.defineProperty(a.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isSelected",{get:function(){var v=this;return this.isSelectedEvaluated||(this.isSelectedCache=function(){var G,J,U=function(A){return A.selection===v.alias.name||v.metadata&&v.metadata.columns.find(function(T){return A.selection===v.alias.name+"."+T.propertyPath})?{value:!0}:void 0};try{for(var c=(0,g.XA)(v.queryExpressionMap.selects),Z=c.next();!Z.done;Z=c.next()){var D=U(Z.value);if("object"==typeof D)return D.value}}catch(A){G={error:A}}finally{try{Z&&!Z.done&&(J=c.return)&&J.call(c)}finally{if(G)throw G.error}}return!1}(),this.isSelectedEvaluated=!0),this.isSelectedCache},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"parentAlias",{get:function(){if(_.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relationPropertyPath",{get:function(){if(_.G.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relation",{get:function(){var v=this;return this.relationEvaluated||(this.relationCache=function(){if(_.G.isAliasProperty(v.entityOrProperty)){var G=v.queryExpressionMap.findAliasByName(v.parentAlias),J=G.metadata.findRelationWithPropertyPath(v.relationPropertyPath);if(J||G.metadata.parentEntityMetadata&&(J=G.metadata.parentEntityMetadata.findRelationWithPropertyPath(v.relationPropertyPath)))return J;throw new m.K_("Relation with property path "+v.relationPropertyPath+" in entity was not found.")}}.bind(this)(),this.relationEvaluated=!0),this.relationCache},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new m.K_("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!1,configurable:!0}),a}()},2161:(Ee,ne,h)=>{"use strict";h.d(ne,{z:()=>D});var g=h(5081),_=h(2183),P=h(4455),m=function(){function A(T){_.g.assign(this,T||{})}return Object.defineProperty(A.prototype,"target",{get:function(){return this.metadata.target},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"metadata",{get:function(){if(!this._metadata)throw new P.K_('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(T){this._metadata=T},enumerable:!1,configurable:!0}),A}(),N=h(5095),a=h(2756),v=h(5627),B=function(){function A(T){this.connection=T,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.maxExecutionTime=0,this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={},this.locallyGenerated={}}return Object.defineProperty(A.prototype,"allOrderBys",{get:function(){var T=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var x=this.mainAlias.metadata.orderBy||{};return Object.keys(x).reduce(function(X,Y){return X[T.mainAlias.name+"."+Y]=x[Y],X},{})}return this.orderBys},enumerable:!1,configurable:!0}),A.prototype.setMainAlias=function(T){return this.mainAlias=T,T},A.prototype.createAlias=function(T){var x=T.name;!x&&T.tablePath&&(x=T.tablePath),!x&&T.target instanceof Function&&(x=T.target.name),!x&&"string"==typeof T.target&&(x=T.target);var X=new m;return X.type=T.type,x&&(X.name=x),T.metadata&&(X.metadata=T.metadata),T.target&&!X.hasMetadata&&(X.metadata=this.connection.getMetadata(T.target)),T.tablePath&&(X.tablePath=T.tablePath),T.subQuery&&(X.subQuery=T.subQuery),this.aliases.push(X),X},A.prototype.findAliasByName=function(T){var x=this.aliases.find(function(X){return X.name===T});if(!x)throw new P.K_('"'+T+'" alias was not found. Maybe you forgot to join it?');return x},A.prototype.findColumnByAliasExpression=function(T){var x=(0,g.CR)(T.split("."),2),Y=x[1];return this.findAliasByName(x[0]).metadata.findColumnWithPropertyName(Y)},Object.defineProperty(A.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new P.K_("Entity to work with is not specified!");var T=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!T)throw new P.K_("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return T},enumerable:!1,configurable:!0}),A.prototype.clone=function(){var T=this,x=new A(this.connection);return x.queryType=this.queryType,x.selects=this.selects.map(function(X){return X}),x.maxExecutionTime=this.maxExecutionTime,x.selectDistinct=this.selectDistinct,x.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach(function(X){return x.aliases.push(new m(X))}),x.mainAlias=this.mainAlias,x.valuesSet=this.valuesSet,x.returning=this.returning,x.onConflict=this.onConflict,x.onIgnore=this.onIgnore,x.onUpdate=this.onUpdate,x.joinAttributes=this.joinAttributes.map(function(X){return new N.k(T.connection,T,X)}),x.relationIdAttributes=this.relationIdAttributes.map(function(X){return new a.b(T,X)}),x.relationCountAttributes=this.relationCountAttributes.map(function(X){return new v.$(T,X)}),x.wheres=this.wheres.map(function(X){return(0,g.pi)({},X)}),x.havings=this.havings.map(function(X){return(0,g.pi)({},X)}),x.orderBys=Object.assign({},this.orderBys),x.groupBys=this.groupBys.map(function(X){return X}),x.limit=this.limit,x.offset=this.offset,x.skip=this.skip,x.take=this.take,x.lockMode=this.lockMode,x.lockVersion=this.lockVersion,x.lockTables=this.lockTables,x.withDeleted=this.withDeleted,x.parameters=Object.assign({},this.parameters),x.disableEscaping=this.disableEscaping,x.enableRelationIdValues=this.enableRelationIdValues,x.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,x.subQuery=this.subQuery,x.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,x.cache=this.cache,x.cacheId=this.cacheId,x.cacheDuration=this.cacheDuration,x.relationPropertyPath=this.relationPropertyPath,x.of=this.of,x.insertColumns=this.insertColumns,x.whereEntities=this.whereEntities,x.updateEntity=this.updateEntity,x.callListeners=this.callListeners,x.useTransaction=this.useTransaction,x.nativeParameters=Object.assign({},this.nativeParameters),x.comment=this.comment,x},A}(),G=h(2967),J=h(9145),U=h(5526),c=h(2446),Z=h(8108),ie=h(6157),D=function(){function A(T,x){this.parameterIndex=0,T instanceof A?(this.connection=T.connection,this.queryRunner=T.queryRunner,this.expressionMap=T.expressionMap.clone()):(this.connection=T,this.queryRunner=x,this.expressionMap=new B(this.connection))}return Object.defineProperty(A.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new P.K_("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!1,configurable:!0}),A.prototype.select=function(T,x){this.expressionMap.queryType="select",Array.isArray(T)?this.expressionMap.selects=T.map(function(Y){return{selection:Y}}):T&&(this.expressionMap.selects=[{selection:T,aliasName:x}]);var X=h(5908).Z;return this instanceof X?this:new X(this)},A.prototype.insert=function(){this.expressionMap.queryType="insert";var T=h(7225).O;return this instanceof T?this:new T(this)},A.prototype.update=function(T,x){var X=x||T;if((T=T instanceof U.I?T.options.name:T)instanceof Function||"string"==typeof T){var Y=this.createFromAlias(T);this.expressionMap.setMainAlias(Y)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=X;var R=h(2739).T;return this instanceof R?this:new R(this)},A.prototype.delete=function(){this.expressionMap.queryType="delete";var T=h(1993).T;return this instanceof T?this:new T(this)},A.prototype.softDelete=function(){this.expressionMap.queryType="soft-delete";var T=h(3328).B;return this instanceof T?this:new T(this)},A.prototype.restore=function(){this.expressionMap.queryType="restore";var T=h(3328).B;return this instanceof T?this:new T(this)},A.prototype.relation=function(T,x){var X=2===arguments.length?T:void 0,Y=2===arguments.length?x:T;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=Y,X){var R=this.createFromAlias(X);this.expressionMap.setMainAlias(R)}var L=h(514).K;return this instanceof L?this:new L(this)},A.prototype.hasRelation=function(T,x){var X=this.connection.getMetadata(T);return(Array.isArray(x)?x:[x]).every(function(R){return!!X.findRelationWithPropertyPath(R)})},A.prototype.hasParameter=function(T){var x;return(null===(x=this.parentQueryBuilder)||void 0===x?void 0:x.hasParameter(T))||T in this.expressionMap.parameters},A.prototype.setParameter=function(T,x){if(x instanceof Function)throw new P.K_("Function parameter isn't supported in the parameters. Please check \""+T+'" parameter.');if(!T.match(/^([A-Za-z0-9_.]+)$/))throw new P.K_("QueryBuilder parameter keys may only contain numbers, letters, underscores, or periods.");return this.parentQueryBuilder&&this.parentQueryBuilder.setParameter(T,x),this.expressionMap.parameters[T]=x,this},A.prototype.setParameters=function(T){var x,X;try{for(var Y=(0,g.XA)(Object.entries(T)),R=Y.next();!R.done;R=Y.next()){var L=(0,g.CR)(R.value,2);this.setParameter(L[0],L[1])}}catch($){x={error:$}}finally{try{R&&!R.done&&(X=Y.return)&&X.call(Y)}finally{if(x)throw x.error}}return this},A.prototype.createParameter=function(T){var x;do{x="orm_param_"+this.parameterIndex++}while(this.hasParameter(x));return this.setParameter(x,T),":"+x},A.prototype.setNativeParameters=function(T){var x=this;return this.parentQueryBuilder&&this.parentQueryBuilder.setNativeParameters(T),Object.keys(T).forEach(function(X){x.expressionMap.nativeParameters[X]=T[X]}),this},A.prototype.getParameters=function(){var T=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var x=this.expressionMap.mainAlias.metadata;if(x.discriminatorColumn&&x.parentEntityMetadata){var X=x.childEntityMetadatas.filter(function(Y){return Y.discriminatorColumn}).map(function(Y){return Y.discriminatorValue});X.push(x.discriminatorValue),T.discriminatorColumnValues=X}}return T},A.prototype.printSql=function(){var T=(0,g.CR)(this.getQueryAndParameters(),2);return this.connection.logger.logQuery(T[0],T[1]),this},A.prototype.getSql=function(){return this.getQueryAndParameters()[0]},A.prototype.getQueryAndParameters=function(){var T=this.getQuery(),x=this.getParameters();return this.connection.driver.escapeQueryWithParameters(T,x,this.expressionMap.nativeParameters)},A.prototype.execute=function(){return(0,g.mG)(this,void 0,void 0,function(){var T,x,X,Y;return(0,g.Jh)(this,function(R){switch(R.label){case 0:T=(0,g.CR)(this.getQueryAndParameters(),2),x=T[0],X=T[1],Y=this.obtainQueryRunner(),R.label=1;case 1:return R.trys.push([1,,3,6]),[4,Y.query(x,X)];case 2:return[2,R.sent()];case 3:return Y===this.queryRunner?[3,5]:[4,Y.release()];case 4:R.sent(),R.label=5;case 5:return[7];case 6:return[2]}})})},A.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},A.prototype.clone=function(){return new this.constructor(this)},A.prototype.comment=function(T){return this.expressionMap.comment=T,this},A.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},A.prototype.escape=function(T){return this.expressionMap.disableEscaping?this.connection.driver.escape(T):T},A.prototype.setQueryRunner=function(T){return this.queryRunner=T,this},A.prototype.callListeners=function(T){return this.expressionMap.callListeners=T,this},A.prototype.useTransaction=function(T){return this.expressionMap.useTransaction=T,this},A.prototype.getTableName=function(T){var x=this;return T.split(".").map(function(X){return""===X?X:x.escape(X)}).join(".")},A.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new P.K_('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},A.prototype.createFromAlias=function(T,x){if(this.connection.hasMetadata(T)){var X=this.connection.getMetadata(T);return this.expressionMap.createAlias({type:"from",name:x,metadata:this.connection.getMetadata(T),tablePath:X.tablePath})}if("string"==typeof T){var Y="("===T.substr(0,1)&&")"===T.substr(-1);return this.expressionMap.createAlias({type:"from",name:x,tablePath:Y?void 0:T,subQuery:Y?T:void 0})}var R=T(this.subQuery());this.setParameters(R.getParameters());var L=R.getQuery();return this.expressionMap.createAlias({type:"from",name:x,subQuery:L})},A.prototype.replacePropertyNames=function(T){var x,X,Y=this,R=function(F){return F.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")},L=function(F){var I,y,E,S,C,Q,O,W,V,oe,me,he;if(!F.hasMetadata)return"continue";var be=H.expressionMap.aliasNamePrefixingEnabled?F.name+".":"",Me=H.expressionMap.aliasNamePrefixingEnabled?H.escape(F.name)+".":"",Ne={};try{for(var Pe=(I=void 0,(0,g.XA)(F.metadata.relations)),Ae=Pe.next();!Ae.done;Ae=Pe.next())(Oe=Ae.value).joinColumns.length>0&&(Ne[Oe.propertyPath]=Oe.joinColumns[0].databaseName)}catch(le){I={error:le}}finally{try{Ae&&!Ae.done&&(y=Pe.return)&&y.call(Pe)}finally{if(I)throw I.error}}try{for(var Je=(E=void 0,(0,g.XA)(F.metadata.relations)),je=Je.next();!je.done;je=Je.next()){var Oe=je.value;try{for(var He=(C=void 0,(0,g.XA)((0,g.ev)((0,g.ev)([],(0,g.CR)(Oe.joinColumns)),(0,g.CR)(Oe.inverseJoinColumns)))),Se=He.next();!Se.done;Se=He.next()){var it=Se.value;Ne[Oe.propertyPath+"."+it.referencedColumn.propertyPath]=it.databaseName}}catch(ve){C={error:ve}}finally{try{Se&&!Se.done&&(Q=He.return)&&Q.call(He)}finally{if(C)throw C.error}}}}catch(le){E={error:le}}finally{try{je&&!je.done&&(S=Je.return)&&S.call(Je)}finally{if(E)throw E.error}}try{for(var Le=(O=void 0,(0,g.XA)(F.metadata.columns)),Ke=Le.next();!Ke.done;Ke=Le.next())Ne[(tt=Ke.value).databaseName]=tt.databaseName}catch(le){O={error:le}}finally{try{Ke&&!Ke.done&&(W=Le.return)&&W.call(Le)}finally{if(O)throw O.error}}try{for(var lt=(V=void 0,(0,g.XA)(F.metadata.columns)),nt=lt.next();!nt.done;nt=lt.next())Ne[(tt=nt.value).propertyName]=tt.databaseName}catch(le){V={error:le}}finally{try{nt&&!nt.done&&(oe=lt.return)&&oe.call(lt)}finally{if(V)throw V.error}}try{for(var rt=(me=void 0,(0,g.XA)(F.metadata.columns)),ze=rt.next();!ze.done;ze=rt.next()){var tt;Ne[(tt=ze.value).propertyPath]=tt.databaseName}}catch(le){me={error:le}}finally{try{ze&&!ze.done&&(he=rt.return)&&he.call(rt)}finally{if(me)throw me.error}}var ae=Object.keys(Ne);ae.length&&(T=T.replace(new RegExp("([ =(]|^.{0})"+R(be)+"("+ae.map(R).join("|")+")(?=[ =),]|.{0}$)","gm"),function(le,ve,Ce){return""+ve+Me+Y.escape(Ne[Ce])}))},H=this;try{for(var j=(0,g.XA)(this.expressionMap.aliases),$=j.next();!$.done;$=j.next())L($.value)}catch(F){x={error:F}}finally{try{$&&!$.done&&(X=j.return)&&X.call(j)}finally{if(x)throw x.error}}return T},A.prototype.createComment=function(){return this.expressionMap.comment?"/* "+this.expressionMap.comment.replace("*/","")+" */ ":""},A.prototype.createWhereExpression=function(){var T=[],x=this.createWhereClausesExpression(this.expressionMap.wheres);if(x.length>0&&"1=1"!==x&&T.push(this.replacePropertyNames(x)),this.expressionMap.mainAlias.hasMetadata){var X=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&X.deleteDateColumn){var R=this.replacePropertyNames(this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+X.deleteDateColumn.propertyName:X.deleteDateColumn.propertyName)+" IS NULL";T.push(R)}X.discriminatorColumn&&X.parentEntityMetadata&&(R=this.replacePropertyNames(this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+X.discriminatorColumn.databaseName:X.discriminatorColumn.databaseName)+" IN (:...discriminatorColumnValues)",T.push(R))}return this.expressionMap.extraAppendedAndWhereCondition&&(R=this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition),T.push(R)),T.length?1===T.length?" WHERE "+T[0]:" WHERE ( "+T.join(" ) AND ( ")+" )":""},A.prototype.createReturningExpression=function(){var T=this,x=this.getReturningColumns(),X=this.connection.driver;if("string"!=typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&X.isReturningSqlSupported()&&x.push.apply(x,(0,g.ev)([],(0,g.CR)(this.expressionMap.extraReturningColumns.filter(function(R){return-1===x.indexOf(R)})))),x.length){var Y=x.map(function(R){var L=T.escape(R.databaseName);return X instanceof J.Z0?"insert"===T.expressionMap.queryType||"update"===T.expressionMap.queryType||"soft-delete"===T.expressionMap.queryType||"restore"===T.expressionMap.queryType?"INSERTED."+L:T.escape(T.getMainTableName())+"."+L:L}).join(", ");return X instanceof J.XR&&(Y+=" INTO "+x.map(function(R){return T.createParameter({type:X.columnTypeToNativeParameter(R.type),dir:X.oracle.BIND_OUT})}).join(", ")),X instanceof J.Z0&&("insert"===this.expressionMap.queryType||"update"===this.expressionMap.queryType)&&(Y+=" INTO @OutputTable"),Y}return"string"==typeof this.expressionMap.returning?this.expressionMap.returning:""},A.prototype.getReturningColumns=function(){var T=this,x=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach(function(X){T.expressionMap.mainAlias.hasMetadata&&x.push.apply(x,(0,g.ev)([],(0,g.CR)(T.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(X))))}),x},A.prototype.createWhereClausesExpression=function(T){var x=this;return T.map(function(X,Y){var R=x.createWhereConditionExpression(X.condition);switch(X.type){case"and":return(Y>0?"AND ":"")+R;case"or":return(Y>0?"OR ":"")+R}return R}).join(" ").trim()},A.prototype.createWhereConditionExpression=function(T,x){if(void 0===x&&(x=!1),"string"==typeof T)return T;if(Array.isArray(T))return 0===T.length?"1=1":1!==T.length||x?"("+this.createWhereClausesExpression(T)+")":this.createWhereClausesExpression(T);var X=this.connection.driver;switch(T.operator){case"lessThan":return T.parameters[0]+" < "+T.parameters[1];case"lessThanOrEqual":return T.parameters[0]+" <= "+T.parameters[1];case"moreThan":return T.parameters[0]+" > "+T.parameters[1];case"moreThanOrEqual":return T.parameters[0]+" >= "+T.parameters[1];case"notEqual":return T.parameters[0]+" != "+T.parameters[1];case"equal":return T.parameters[0]+" = "+T.parameters[1];case"ilike":return X instanceof J.U4||X instanceof J.J1?T.parameters[0]+" ILIKE "+T.parameters[1]:"UPPER("+T.parameters[0]+") LIKE UPPER("+T.parameters[1]+")";case"like":return T.parameters[0]+" LIKE "+T.parameters[1];case"between":return T.parameters[0]+" BETWEEN "+T.parameters[1]+" AND "+T.parameters[2];case"in":return T.parameters.length<=1?"0=1":T.parameters[0]+" IN ("+T.parameters.slice(1).join(", ")+")";case"any":return T.parameters[0]+" = ANY("+T.parameters[1]+")";case"isNull":return T.parameters[0]+" IS NULL";case"not":return"NOT("+this.createWhereConditionExpression(T.condition)+")";case"brackets":return""+this.createWhereConditionExpression(T.condition,!0)}throw new TypeError("Unsupported FindOperator "+c.J.constructor.name)},A.prototype.getWhereInIdsCondition=function(T){var x,X=this.expressionMap.mainAlias.metadata,Y=(Array.isArray(T)?T:[T]).map(function(L){return X.ensureEntityIdMap(L)});if(!X.hasMultiplePrimaryKeys){var R=X.primaryColumns[0];if(!R.transformer&&!R.relationMetadata&&!R.embeddedMetadata)return(x={})[R.propertyName]=(0,Z.In)(Y.map(function(L){return R.getEntityValue(L,!1)})),x}return new G.D(function(L){var H,j,$=function(y){L.orWhere(new G.D(function(E){return E.where(y)}))};try{for(var ee=(0,g.XA)(Y),F=ee.next();!F.done;F=ee.next())$(F.value)}catch(y){H={error:y}}finally{try{F&&!F.done&&(j=ee.return)&&j.call(ee)}finally{if(H)throw H.error}}})},A.prototype.findColumnsForPropertyPath=function(T){for(var x=this.expressionMap.mainAlias,X=[],Y=T.split("."),R=function(){var ee=Y[0];if(!(null==x?void 0:x.hasMetadata))return"break";if(x.metadata.hasEmbeddedWithPropertyPath(ee))return Y.unshift(Y.shift()+"."+Y.shift()),"continue";if(x.metadata.hasRelationWithPropertyPath(ee)){var F=L.expressionMap.joinAttributes.find(function(y){return y.relationPropertyPath===ee});if(!(null==F?void 0:F.alias)){var I=X.length>0?X.join(".")+"."+ee:ee;throw new Error("Cannot find alias for relation at "+I)}return x=F.alias,X.push.apply(X,(0,g.ev)([],(0,g.CR)(ee.split(".")))),Y.shift(),"continue"}return"break"},L=this;Y.length>1&&"break"!==R(););if(!x)throw new Error("Cannot find alias for property "+T);var j=Y.join("."),$=x.metadata.findColumnsWithPropertyPath(j);if(!$.length)throw new ie.n(T);return[x,X,$]},A.prototype.createPropertyPath=function(T,x,X){var Y,R;void 0===X&&(X="");var L=[],H=function(I){var y=X?X+"."+I:I;if(null===x[I]||"object"!=typeof x[I]||x[I]instanceof c.J)return L.push(y),"continue";if(T.hasEmbeddedWithPropertyPath(y)){var E=j.createPropertyPath(T,x[I],y);return L.push.apply(L,(0,g.ev)([],(0,g.CR)(E))),"continue"}if(T.hasRelationWithPropertyPath(y)){var S=T.findRelationWithPropertyPath(y);if("one-to-one"===S.relationType||"many-to-one"===S.relationType){var C=S.joinColumns.map(function(me){return me.referencedColumn}).filter(function(me){return!!me});if(C.length>0&&C.every(function(me){return me.getEntityValue(x[I],!1)}))return L.push(y),"continue"}if("one-to-many"===S.relationType||"many-to-many"===S.relationType)throw new Error("Cannot query across "+S.relationType+" for property "+y);var O=S.inverseEntityMetadata.primaryColumns;if(O.length>0&&O.every(function(me){return me.getEntityValue(x[I],!1)})){var V=O.map(function(me){return y+"."+me.propertyPath});return L.push.apply(L,(0,g.ev)([],(0,g.CR)(V))),"continue"}return E=j.createPropertyPath(S.inverseEntityMetadata,x[I]).map(function(me){return y+"."+me}),L.push.apply(L,(0,g.ev)([],(0,g.CR)(E))),"continue"}L.push(y)},j=this;try{for(var $=(0,g.XA)(Object.keys(x)),ee=$.next();!ee.done;ee=$.next())H(ee.value)}catch(I){Y={error:I}}finally{try{ee&&!ee.done&&(R=$.return)&&R.call($)}finally{if(Y)throw Y.error}}return L},A.prototype.getPredicates=function(T){var x,X,Y,L,H,j,$,ee,F,I,y,E,S,C,W,V,oe,me,he,O,Q,be,Me,Ne,Pe,Ae,Oe,Je,je,He;return(0,g.Jh)(this,function(Se){switch(Se.label){case 0:if(!this.expressionMap.mainAlias.hasMetadata)return[3,15];x=this.createPropertyPath(this.expressionMap.mainAlias.metadata,T),Se.label=1;case 1:Se.trys.push([1,12,13,14]),X=(0,g.XA)(x),Y=X.next(),Se.label=2;case 2:if(Y.done)return[3,11];L=(0,g.CR)(this.findColumnsForPropertyPath(Y.value),3),H=L[0],j=L[1],$=L[2],Se.label=3;case 3:Se.trys.push([3,8,9,10]),Pe=void 0,ee=(0,g.XA)($),F=ee.next(),Se.label=4;case 4:if(F.done)return[3,7];I=F.value,y=T;try{for(Oe=void 0,E=(0,g.XA)(j),S=E.next();!S.done;S=E.next()){if(C=S.value,!y||!(C in y)){y={};break}y=y[C]}}catch(it){Oe={error:it}}finally{try{S&&!S.done&&(Je=E.return)&&Je.call(E)}finally{if(Oe)throw Oe.error}}return Q=this.expressionMap.aliasNamePrefixingEnabled?H.name+"."+I.propertyPath:I.propertyPath,O=I.getEntityValue(y,!0),[4,[Q,O]];case 5:Se.sent(),Se.label=6;case 6:return F=ee.next(),[3,4];case 7:return[3,10];case 8:return W=Se.sent(),Pe={error:W},[3,10];case 9:try{F&&!F.done&&(Ae=ee.return)&&Ae.call(ee)}finally{if(Pe)throw Pe.error}return[7];case 10:return Y=X.next(),[3,2];case 11:return[3,14];case 12:return V=Se.sent(),Me={error:V},[3,14];case 13:try{Y&&!Y.done&&(Ne=X.return)&&Ne.call(X)}finally{if(Me)throw Me.error}return[7];case 14:return[3,22];case 15:Se.trys.push([15,20,21,22]),oe=(0,g.XA)(Object.keys(T)),me=oe.next(),Se.label=16;case 16:return me.done?[3,19]:(he=me.value,[4,[Q=this.expressionMap.aliasNamePrefixingEnabled?this.alias+"."+he:he,O=T[he]]]);case 17:Se.sent(),Se.label=18;case 18:return me=oe.next(),[3,16];case 19:return[3,22];case 20:return be=Se.sent(),je={error:be},[3,22];case 21:try{me&&!me.done&&(He=oe.return)&&He.call(oe)}finally{if(je)throw je.error}return[7];case 22:return[2]}})},A.prototype.getWherePredicateCondition=function(T,x){var X,Y;if(x instanceof c.J){var R=[];if(x.useParameter)if(x.objectLiteralParameters)this.setParameters(x.objectLiteralParameters);else if(x.multipleParameters)try{for(var L=(0,g.XA)(x.value),H=L.next();!H.done;H=L.next())R.push(this.createParameter(H.value))}catch($){X={error:$}}finally{try{H&&!H.done&&(Y=L.return)&&Y.call(L)}finally{if(X)throw X.error}}else R.push(this.createParameter(x.value));return"raw"===x.type?x.getSql?x.getSql(T):{operator:"equal",parameters:[T,x.value]}:"not"===x.type?x.child?{operator:x.type,condition:this.getWherePredicateCondition(T,x.child)}:{operator:"notEqual",parameters:(0,g.ev)([T],(0,g.CR)(R))}:{operator:x.type,parameters:(0,g.ev)([T],(0,g.CR)(R))}}return null===x?{operator:"isNull",parameters:[T]}:{operator:"equal",parameters:[T,this.createParameter(x)]}},A.prototype.getWhereCondition=function(T){var x,X,Y,R;if("string"==typeof T)return T;if(T instanceof G.D){var L=this.createQueryBuilder();return L.parentQueryBuilder=this,L.expressionMap.mainAlias=this.expressionMap.mainAlias,L.expressionMap.aliasNamePrefixingEnabled=this.expressionMap.aliasNamePrefixingEnabled,L.expressionMap.parameters=this.expressionMap.parameters,L.expressionMap.nativeParameters=this.expressionMap.nativeParameters,L.expressionMap.wheres=[],T.whereFactory(L),{operator:"brackets",condition:L.expressionMap.wheres}}if(T instanceof Function)return T(this);var H=Array.isArray(T)?T:[T],j=[];try{for(var $=(0,g.XA)(H),ee=$.next();!ee.done;ee=$.next()){var F=ee.value,I=[];try{for(var y=(Y=void 0,(0,g.XA)(this.getPredicates(F))),E=y.next();!E.done;E=y.next()){var S=(0,g.CR)(E.value,2);I.push({type:"and",condition:this.getWherePredicateCondition(S[0],S[1])})}}catch(O){Y={error:O}}finally{try{E&&!E.done&&(R=y.return)&&R.call(y)}finally{if(Y)throw Y.error}}j.push({type:"or",condition:I})}}catch(O){x={error:O}}finally{try{ee&&!ee.done&&(X=$.return)&&X.call($)}finally{if(x)throw x.error}}return 1===j.length?j[0].condition:j},A.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner()},A}()},1534:(Ee,ne,h)=>{"use strict";h.d(ne,{G:()=>_});var g=h(5081),_=function(){function P(){}return P.isAliasProperty=function(m){if("string"!=typeof m||-1===m.indexOf("."))return!1;var N=(0,g.CR)(m.split("."),2);return!(!N[0]||!N[1]||-1!==m.indexOf("(")||-1!==m.indexOf(")"))},P}()},514:(Ee,ne,h)=>{"use strict";h.d(ne,{K:()=>v});var g=h(5081),_=h(2161),P=h(9145),m=h(4455),N=function(){function B(G,J){this.queryBuilder=G,this.expressionMap=J}return B.prototype.update=function(G){return(0,g.mG)(this,void 0,void 0,function(){var J,c,ie,D,A,T,U,x,Z,X,R,L,H=this;return(0,g.Jh)(this,function(j){switch(j.label){case 0:return(J=this.expressionMap.relationMetadata).isManyToOne||J.isOneToOneOwner?(U=J.joinColumns.reduce(function($,ee){var F=G instanceof Object?ee.referencedColumn.getEntityValue(G):G;return ee.setEntityValue($,F),$},{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(J.entityMetadata.target).set(U).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return j.sent(),[3,10];case 2:return(J.isOneToOneNotOwner||J.isOneToMany)&&null===G?(c={},J.inverseRelation.joinColumns.forEach(function($){c[$.propertyName]=null}),Z=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],ie={},D=[],Z.forEach(function($,ee){J.inverseRelation.joinColumns.map(function(F,I){var y="joinColumn_"+ee+"_"+I;ie[y]=$ instanceof Object?F.referencedColumn.getEntityValue($):$,D.push(F.propertyPath+" = :"+y)})}),(A=D.map(function($){return"("+$+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(J.inverseEntityMetadata.target).set(c).where(A).setParameters(ie).execute()]:[2]):[3,4];case 3:return j.sent(),[3,10];case 4:if(!J.isOneToOneNotOwner&&!J.isOneToMany)return[3,6];if(Array.isArray(this.expressionMap.of))throw new m.K_("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return T=this.expressionMap.of,U=J.inverseRelation.joinColumns.reduce(function($,ee){var F=T instanceof Object?ee.referencedColumn.getEntityValue(T):T;return ee.setEntityValue($,F),$},{}),!G||Array.isArray(G)&&!G.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(J.inverseEntityMetadata.target).set(U).whereInIds(G).execute()];case 5:return j.sent(),[3,10];case 6:return x=J.junctionEntityMetadata,Z=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],X=Array.isArray(G)?G:[G],R=J.isManyToManyOwner?X:Z,L=[],(J.isManyToManyOwner?Z:X).forEach(function($){R.forEach(function(ee){var F={};x.ownerColumns.forEach(function(I){F[I.databaseName]=$ instanceof Object?I.referencedColumn.getEntityValue($):$}),x.inverseColumns.forEach(function(I){F[I.databaseName]=ee instanceof Object?I.referencedColumn.getEntityValue(ee):ee}),L.push(F)})}),L.length?this.queryBuilder.connection.driver instanceof P.XR||this.queryBuilder.connection.driver instanceof P.tU?[4,Promise.all(L.map(function($){return H.queryBuilder.createQueryBuilder().insert().into(x.tableName).values($).execute()}))]:[3,8]:[2];case 7:return j.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(x.tableName).values(L).execute()];case 9:j.sent(),j.label=10;case 10:return[2]}})})},B}(),a=function(){function B(G,J){this.queryBuilder=G,this.expressionMap=J}return B.prototype.remove=function(G){return(0,g.mG)(this,void 0,void 0,function(){var J,c,Z,ie,D,T,U,x,Y,R,L,A;return(0,g.Jh)(this,function(H){switch(H.label){case 0:return(J=this.expressionMap.relationMetadata).isOneToMany?(U=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],c=Array.isArray(G)?G:[G],Z={},J.inverseRelation.joinColumns.forEach(function(j){Z[j.propertyName]=null}),ie={},D=[],U.forEach(function(j,$){D.push.apply(D,(0,g.ev)([],(0,g.CR)(c.map(function(ee,F){return(0,g.ev)((0,g.ev)([],(0,g.CR)(J.inverseRelation.joinColumns.map(function(I,y){var E="joinColumn_"+$+"_"+F+"_"+y;return ie[E]=j instanceof Object?I.referencedColumn.getEntityValue(j):j,I.propertyPath+" = :"+E}))),(0,g.CR)(J.inverseRelation.entityMetadata.primaryColumns.map(function(I,y){var E="primaryColumn_"+F+"_"+F+"_"+y;return ie[E]=ee instanceof Object?I.getEntityValue(ee):ee,I.propertyPath+" = :"+E}))).join(" AND ")}))))}),(A=D.map(function(j){return"("+j+")"}).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(J.inverseEntityMetadata.target).set(Z).where(A).setParameters(ie).execute()]:[2]):[3,2];case 1:return H.sent(),[3,4];case 2:return T=J.junctionEntityMetadata,U=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],x=Array.isArray(G)?G:[G],Y=J.isManyToManyOwner?x:U,R={},L=[],(J.isManyToManyOwner?U:x).forEach(function(j,$){L.push.apply(L,(0,g.ev)([],(0,g.CR)(Y.map(function(ee,F){return(0,g.ev)((0,g.ev)([],(0,g.CR)(T.ownerColumns.map(function(I,y){var E="firstValue_"+$+"_"+F+"_"+y;return R[E]=j instanceof Object?I.referencedColumn.getEntityValue(j):j,I.databaseName+" = :"+E}))),(0,g.CR)(T.inverseColumns.map(function(I,y){var E="secondValue_"+$+"_"+F+"_"+y;return R[E]=ee instanceof Object?I.referencedColumn.getEntityValue(ee):ee,I.databaseName+" = :"+E}))).join(" AND ")}))))}),A=L.map(function(j){return"("+j+")"}).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(T.tableName).where(A).setParameters(R).execute()];case 3:H.sent(),H.label=4;case 4:return[2]}})})},B}(),v=function(B){function G(){return null!==B&&B.apply(this,arguments)||this}return(0,g.ZT)(G,B),G.prototype.getQuery=function(){return""},G.prototype.of=function(J){return this.expressionMap.of=J,this},G.prototype.set=function(J){return(0,g.mG)(this,void 0,void 0,function(){var U;return(0,g.Jh)(this,function(Z){if(U=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new m.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(U.isManyToMany||U.isOneToMany)throw new m.K_('Set operation is only supported for many-to-one and one-to-one relations. However given "'+U.propertyPath+'" has '+U.relationType+" relation. Use .add() method instead.");if(U.joinColumns&&U.joinColumns.length>1&&(!(J instanceof Object)||Object.keys(J).length<U.joinColumns.length))throw new m.K_('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new N(this,this.expressionMap).update(J)]})})},G.prototype.add=function(J){return(0,g.mG)(this,void 0,void 0,function(){var U;return(0,g.Jh)(this,function(Z){if(Array.isArray(J)&&0===J.length)return[2];if(U=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new m.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(U.isManyToOne||U.isOneToOne)throw new m.K_('Add operation is only supported for many-to-many and one-to-many relations. However given "'+U.propertyPath+'" has '+U.relationType+" relation. Use .set() method instead.");if(U.joinColumns&&U.joinColumns.length>1&&(!(J instanceof Object)||Object.keys(J).length<U.joinColumns.length))throw new m.K_('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new N(this,this.expressionMap).update(J)]})})},G.prototype.remove=function(J){return(0,g.mG)(this,void 0,void 0,function(){var U;return(0,g.Jh)(this,function(Z){if(Array.isArray(J)&&0===J.length)return[2];if(U=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new m.K_("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(U.isManyToOne||U.isOneToOne)throw new m.K_('Add operation is only supported for many-to-many and one-to-many relations. However given "'+U.propertyPath+'" has '+U.relationType+" relation. Use .set(null) method instead.");return[2,new a(this,this.expressionMap).remove(J)]})})},G.prototype.addAndRemove=function(J,U){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(c){switch(c.label){case 0:return[4,this.remove(U)];case 1:return c.sent(),[4,this.add(J)];case 2:return c.sent(),[2]}})})},G.prototype.loadOne=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(J){return[2,this.loadMany().then(function(U){return U[0]})]})})},G.prototype.loadMany=function(){return(0,g.mG)(this,void 0,void 0,function(){var J,U;return(0,g.Jh)(this,function(c){if(!((J=this.expressionMap.of)instanceof Object)){if((U=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new m.K_("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");J=U.primaryColumns[0].createValueMap(J)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,J,this.queryRunner)]})})},G}(_.z)},5418:(Ee,ne,h)=>{"use strict";h.d(ne,{v:()=>m});var g=h(5081),_=h(9145),P=h(4455),m=function(){function N(a,v){this.queryRunner=a,this.expressionMap=v}return N.prototype.update=function(a,v){return(0,g.mG)(this,void 0,void 0,function(){var B,G=this;return(0,g.Jh)(this,function(J){switch(J.label){case 0:return B=this.expressionMap.mainAlias.metadata,[4,Promise.all(v.map(function(U,c){return(0,g.mG)(G,void 0,void 0,function(){var Z,ie,A,T,x=this;return(0,g.Jh)(this,function(X){switch(X.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof _.XR&&Array.isArray(a.raw)&&this.expressionMap.extraReturningColumns.length>0&&(a.raw=a.raw.reduce(function(Y,R,L){return Y[x.expressionMap.extraReturningColumns[L].databaseName]=R[0],Y},{})),Z=Array.isArray(a.raw)?a.raw[c]:a.raw,(ie=this.queryRunner.connection.driver.createGeneratedMap(B,Z))&&(this.queryRunner.manager.merge(B.target,U,ie),a.generatedMaps.push(ie)),[3,3]):[3,1];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(A=this.expressionMap.mainAlias.metadata.getEntityIdMap(U)))throw new P.K_("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(B.primaryColumns.map(function(Y){return B.targetName+"."+Y.propertyPath})).addSelect(this.getUpdationReturningColumns().map(function(Y){return B.targetName+"."+Y.propertyPath})).from(B.target,B.targetName).where(A).setOption("create-pojo").getOne()];case 2:(T=X.sent())&&(this.queryRunner.manager.merge(B.target,U,T),a.generatedMaps.push(T)),X.label=3;case 3:return[2]}})})}))];case 1:return J.sent(),[2]}})})},N.prototype.insert=function(a,v){return(0,g.mG)(this,void 0,void 0,function(){var B,G,J,U,c,Z=this;return(0,g.Jh)(this,function(ie){switch(ie.label){case 0:return B=this.expressionMap.mainAlias.metadata,G=this.getInsertionReturningColumns(),J=v.map(function(D,A){Z.queryRunner.connection.driver instanceof _.XR&&Array.isArray(a.raw)&&Z.expressionMap.extraReturningColumns.length>0&&(a.raw=a.raw.reduce(function(X,Y,R){return X[Z.expressionMap.extraReturningColumns[R].databaseName]=Y[0],X},{}));var T=Array.isArray(a.raw)?a.raw[A]:a.raw,x=Z.queryRunner.connection.driver.createGeneratedMap(B,T,A,v.length)||{};return A in Z.expressionMap.locallyGenerated&&Z.queryRunner.manager.merge(B.target,x,Z.expressionMap.locallyGenerated[A]),Z.queryRunner.manager.merge(B.target,D,x),x}),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&G.length>0?(U=v.map(function(D){var A=B.getEntityIdMap(D);if(!A)throw new P.K_("Cannot update entity because entity id is not set in the entity.");return A}),[4,this.queryRunner.manager.createQueryBuilder().select(B.primaryColumns.map(function(D){return B.targetName+"."+D.propertyPath})).addSelect(G.map(function(D){return B.targetName+"."+D.propertyPath})).from(B.target,B.targetName).where(U).setOption("create-pojo").getMany()]):[3,2];case 1:c=ie.sent(),v.forEach(function(D,A){Z.queryRunner.manager.merge(B.target,J[A],c[A]),Z.queryRunner.manager.merge(B.target,D,c[A])}),ie.label=2;case 2:return v.forEach(function(D,A){var T=B.getEntityIdMap(D);a.identifiers.push(T),a.generatedMaps.push(J[A])}),[2]}})})},N.prototype.getInsertionReturningColumns=function(){var a=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter(function(v){return void 0!==v.default||a&&v.isGenerated||v.isCreateDate||v.isUpdateDate||v.isDeleteDate||v.isVersion})},N.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter(function(a){return a.isUpdateDate||a.isVersion})},N}()},5908:(Ee,ne,h)=>{"use strict";h.d(ne,{Z:()=>ee});var g=h(5081),_=h(9145),P=h(1018),m=h(3092),N=function(){function F(I,y,E,S,C){this.expressionMap=I,this.driver=y,this.rawRelationIdResults=E,this.rawRelationCountResults=S,this.queryRunner=C}return F.prototype.transform=function(I,y){var E=this,S=this.group(I,y),C=[];return S.forEach(function(Q){var O=E.transformRawResultsGroup(Q,y);void 0!==O&&!Object.values(O).every(function(W){return null===W})&&C.push(O)}),C},F.prototype.group=function(I,y){var E=this,S=new Map,C=[];return C.push.apply(C,(0,g.ev)([],(0,g.CR)("view"===y.metadata.tableType?y.metadata.columns.map(function(Q){return m.z.buildAlias(E.driver,y.name,Q.databaseName)}):y.metadata.primaryColumns.map(function(Q){return m.z.buildAlias(E.driver,y.name,Q.databaseName)})))),I.forEach(function(Q){var O=C.map(function(V){var oe=Q[V];return Buffer.isBuffer(oe)?oe.toString("hex"):"object"==typeof oe?JSON.stringify(oe):oe}).join("_"),W=S.get(O);W?W.push(Q):S.set(O,[Q])}),S},F.prototype.transformRawResultsGroup=function(I,y){var E=this,S=y.metadata;if(S.discriminatorColumn){var C=I.map(function(be){return be[m.z.buildAlias(E.driver,y.name,y.metadata.discriminatorColumn.databaseName)]}),Q=S.childEntityMetadatas.find(function(be){return void 0!==C.find(function(Me){return Me===be.discriminatorValue})});Q&&(S=Q)}var O=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:S.create(this.queryRunner,{fromDeserializer:!0}),W=this.transformColumns(I,y,O,S),V=this.transformJoins(I,O,y,S),oe=this.transformRelationIds(I,y,O,S),me=this.transformRelationCounts(I,y,O);return W||0===S.primaryColumns.filter(function(be){return!1===be.isVirtual}).length&&(V||oe||me)?O:void 0},F.prototype.transformColumns=function(I,y,E,S){var C=this,Q=!1;return S.columns.forEach(function(O){if(!(S.childEntityMetadatas.length>0&&-1!==S.childEntityMetadatas.map(function(V){return V.target}).indexOf(O.target))){var W=I[0][m.z.buildAlias(C.driver,y.name,O.databaseName)];void 0===W||O.isVirtual||!C.expressionMap.selects.find(function(V){return V.selection===y.name||V.selection===y.name+"."+O.propertyPath})||(O.setEntityValue(E,C.driver.prepareHydratedValue(W,O)),null!==W&&(Q=!0))}}),Q},F.prototype.transformJoins=function(I,y,E,S){var C=this,Q=!1;return this.expressionMap.joinAttributes.forEach(function(O){if(O.metadata&&O.isSelected){if(O.relation){var W=S.relations.find(function(oe){return oe.propertyPath===O.relation.propertyPath});if(!W)return;W.inverseEntityMetadata&&(O.alias.metadata=W.inverseEntityMetadata)}if(O.mapToProperty){if(O.mapToPropertyParentAlias!==E.name)return}else if(!O.relation||O.parentAlias!==E.name||O.relationPropertyPath!==O.relation.propertyPath)return;var V=C.transform(I,O.alias);V=O.isMany?V:V[0],void 0!==(V=O.isMany||void 0!==V?V:null)&&(O.mapToPropertyPropertyName?y[O.mapToPropertyPropertyName]=V:O.relation.setEntityValue(y,V),Q=!0)}}),Q},F.prototype.transformRelationIds=function(I,y,E,S){var C=this,Q=!1;return this.rawRelationIdResults.forEach(function(O){if(O.relationIdAttribute.parentAlias===y.name){var W=O.relationIdAttribute.relation,V=C.createValueMapFromJoinColumns(W,O.relationIdAttribute.parentAlias,I);if(null!=V){var oe=O.results.map(function(be){var Me=C.extractEntityPrimaryIds(W,be);if(!1!==P.s.compareIds(Me,V)){var Ne,Pe=(Ne=W.isManyToOne||W.isOneToOneOwner?W.joinColumns.map(function(Ae){return Ae}):W.isOneToMany||W.isOneToOneNotOwner?W.inverseEntityMetadata.primaryColumns.map(function(Ae){return Ae}):W.isOwning?W.inverseJoinColumns.map(function(Ae){return Ae}):W.inverseRelation.joinColumns.map(function(Ae){return Ae})).reduce(function(Ae,Oe){var Je=be[Oe.databaseName];return W.isOneToMany||W.isOneToOneNotOwner?(Oe.isVirtual&&Oe.referencedColumn&&Oe.referencedColumn.propertyName!==Oe.propertyName&&(Je=Oe.referencedColumn.createValueMap(Je)),P.s.mergeDeep(Ae,Oe.createValueMap(Je))):(Oe.referencedColumn.referencedColumn&&(Je=Oe.referencedColumn.referencedColumn.createValueMap(Je)),P.s.mergeDeep(Ae,Oe.referencedColumn.createValueMap(Je)))},{});return 1===Ne.length&&!1===O.relationIdAttribute.disableMixedMap?W.isOneToMany||W.isOneToOneNotOwner?Ne[0].getEntityValue(Pe):Ne[0].referencedColumn.getEntityValue(Pe):Pe}}).filter(function(be){return void 0!==be}),me=O.relationIdAttribute.mapToPropertyPropertyPath.split("."),he=function(be,Me,Ne){var Pe=be.shift();return Pe&&0===be.length?(Me[Pe]=Ne,Me):Pe&&be.length>0?void he(be,Me[Pe],Ne):Me};W.isOneToOne||W.isManyToOne?void 0!==oe[0]&&(he(me,E,oe[0]),Q=!0):(he(me,E,oe),oe.length>0&&(Q=!0))}}}),Q},F.prototype.transformRelationCounts=function(I,y,E){var S=this,C=!1;return this.rawRelationCountResults.filter(function(Q){return Q.relationCountAttribute.parentAlias===y.name}).forEach(function(Q){var O=Q.relationCountAttribute.relation,V=I[0][m.z.buildAlias(S.driver,y.name,O.isOneToMany?O.inverseRelation.joinColumns[0].referencedColumn.databaseName:O.isOwning?O.joinColumns[0].referencedColumn.databaseName:O.inverseRelation.joinColumns[0].referencedColumn.databaseName)];null!=V&&(E[Q.relationCountAttribute.mapToPropertyPropertyName]=0,Q.results.filter(function(oe){return oe.parentId===V}).forEach(function(oe){E[Q.relationCountAttribute.mapToPropertyPropertyName]=parseInt(oe.cnt),C=!0}))}),C},F.prototype.createValueMapFromJoinColumns=function(I,y,E){var S=this;return(I.isManyToOne||I.isOneToOneOwner?I.entityMetadata.primaryColumns.map(function(Q){return Q}):I.isOneToMany||I.isOneToOneNotOwner?I.inverseRelation.joinColumns.map(function(Q){return Q}):I.isOwning?I.joinColumns.map(function(Q){return Q}):I.inverseRelation.inverseJoinColumns.map(function(Q){return Q})).reduce(function(Q,O){return E.forEach(function(W){Q[O.databaseName]=S.driver.prepareHydratedValue(I.isManyToOne||I.isOneToOneOwner?W[m.z.buildAlias(S.driver,y,O.databaseName)]:W[m.z.buildAlias(S.driver,y,O.referencedColumn.databaseName)],O)}),Q},{})},F.prototype.extractEntityPrimaryIds=function(I,y){return(I.isManyToOne||I.isOneToOneOwner?I.entityMetadata.primaryColumns.map(function(S){return S}):I.isOneToMany||I.isOneToOneNotOwner?I.inverseRelation.joinColumns.map(function(S){return S}):I.isOwning?I.joinColumns.map(function(S){return S}):I.inverseRelation.inverseJoinColumns.map(function(S){return S})).reduce(function(S,C){return S[C.databaseName]=y[C.databaseName],S},{})},F}(),a=h(7665),v=h(2836),B=h(5529),G=h(2592),J=h(5095),U=h(2756),c=h(5627),Z=h(5797),ie=function(){function F(I,y,E){this.connection=I,this.queryRunner=y,this.relationIdAttributes=E}return F.prototype.load=function(I){return(0,g.mG)(this,void 0,void 0,function(){var y,E=this;return(0,g.Jh)(this,function(S){return y=this.relationIdAttributes.map(function(C){return(0,g.mG)(E,void 0,void 0,function(){var Q,W,V,oe,me,he,be,Me,Pe,Ae,Oe,Je,je,He,Se,it,Ge,Le,Ke,tt,lt,Ne,nt,O,rt=this;return(0,g.Jh)(this,function(ze){switch(ze.label){case 0:if(!C.relation.isManyToOne&&!C.relation.isOneToOneOwner)return[3,1];if(C.queryBuilderFactory)throw new Z.K("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return Q=[],O=I.map(function(ae){var le={},ve=[];C.relation.joinColumns.forEach(function(M){le[M.databaseName]=rt.connection.driver.prepareHydratedValue(ae[m.z.buildAlias(rt.connection.driver,C.parentAlias,M.databaseName)],M.referencedColumn);var d=M.databaseName+":"+le[M.databaseName];-1===ve.indexOf(d)&&ve.push(d)}),C.relation.entityMetadata.primaryColumns.forEach(function(M){le[M.databaseName]=rt.connection.driver.prepareHydratedValue(ae[m.z.buildAlias(rt.connection.driver,C.parentAlias,M.databaseName)],M);var d=M.databaseName+":"+le[M.databaseName];-1===ve.indexOf(d)&&ve.push(d)}),ve.sort();var Ce=ve.join("::");return-1!==Q.indexOf(Ce)?null:(Q.push(Ce),le)}).filter(function(ae){return ae}),[2,{relationIdAttribute:C,results:O}];case 1:return C.relation.isOneToMany||C.relation.isOneToOneNotOwner?(V=(W=C.relation).isOwning?W.joinColumns:W.inverseRelation.joinColumns,oe=W.inverseEntityMetadata.target,me=W.inverseEntityMetadata.tableName,he=C.alias||me,be=[],Me={},(Ne=I.map(function(ae,le){var ve=[],Ce={},M=V.map(function(p){var q=p.databaseName+le,k=ae[m.z.buildAlias(rt.connection.driver,C.parentAlias,p.referencedColumn.databaseName)],se=he+":"+p.propertyPath+":"+k;return-1!==ve.indexOf(se)?"":(ve.push(se),Ce[q]=k,he+"."+p.propertyPath+" = :"+q)}).filter(function(p){return p}).join(" AND ");ve.sort();var d=ve.join("::");return-1!==be.indexOf(d)?"":(be.push(d),Object.assign(Me,Ce),M)}).filter(function(ae){return ae}).map(function(ae){return"("+ae+")"}).join(" OR "))?(Pe=this.connection.createQueryBuilder(this.queryRunner),V.forEach(function(ae){Pe.addSelect(he+"."+ae.propertyPath,ae.databaseName)}),W.inverseRelation.entityMetadata.primaryColumns.forEach(function(ae){Pe.addSelect(he+"."+ae.propertyPath,ae.databaseName)}),Pe.from(oe,he).where("("+Ne+")").setParameters(Me),C.queryBuilderFactory&&C.queryBuilderFactory(Pe),[4,Pe.getRawMany()]):[2,{relationIdAttribute:C,results:[]}]):[3,3];case 2:return(O=ze.sent()).forEach(function(ae){V.forEach(function(le){ae[le.databaseName]=rt.connection.driver.prepareHydratedValue(ae[le.databaseName],le.referencedColumn)}),W.inverseRelation.entityMetadata.primaryColumns.forEach(function(le){ae[le.databaseName]=rt.connection.driver.prepareHydratedValue(ae[le.databaseName],le)})}),[2,{relationIdAttribute:C,results:O}];case 3:return Oe=(Ae=C.relation).isOwning?Ae.joinColumns:Ae.inverseRelation.inverseJoinColumns,Je=Ae.isOwning?Ae.inverseJoinColumns:Ae.inverseRelation.joinColumns,je=C.junctionAlias,He=C.joinInverseSideMetadata.tableName,Se=C.alias||He,it=Ae.isOwning?Ae.junctionEntityMetadata.tableName:Ae.inverseRelation.junctionEntityMetadata.tableName,0===(Ge=I.map(function(ae){return Oe.reduce(function(le,ve){return le[ve.propertyPath]=ae[m.z.buildAlias(rt.connection.driver,C.parentAlias,ve.referencedColumn.databaseName)],le},{})})).length?[2,{relationIdAttribute:C,results:[]}]:(Le={},Ke=[],tt=Ge.map(function(ae,le){var ve=[],Ce={},M=Object.keys(ae).map(function(p){var q=p+le,k=ae[p],se=je+":"+p+":"+k;return-1!==ve.indexOf(se)?"":(ve.push(se),Ce[q]=k,je+"."+p+" = :"+q)}).filter(function(p){return p}).join(" AND ");ve.sort();var d=ve.join("::");return-1!==Ke.indexOf(d)?"":(Ke.push(d),Object.assign(Le,Ce),M)}).filter(function(ae){return ae}),lt=Je.map(function(ae){return je+"."+ae.propertyPath+" = "+Se+"."+ae.referencedColumn.propertyPath}).join(" AND "),Ne=tt.map(function(ae){return"("+ae+" AND "+lt+")"}).join(" OR "),nt=this.connection.createQueryBuilder(this.queryRunner),Je.forEach(function(ae){nt.addSelect(je+"."+ae.propertyPath,ae.databaseName).addOrderBy(je+"."+ae.propertyPath)}),Oe.forEach(function(ae){nt.addSelect(je+"."+ae.propertyPath,ae.databaseName).addOrderBy(je+"."+ae.propertyPath)}),nt.from(He,Se).innerJoin(it,je,Ne).setParameters(Le),C.queryBuilderFactory&&C.queryBuilderFactory(nt),[4,nt.getRawMany()]);case 4:return(O=ze.sent()).forEach(function(ae){(0,g.ev)((0,g.ev)([],(0,g.CR)(Oe)),(0,g.CR)(Je)).forEach(function(le){ae[le.databaseName]=rt.connection.driver.prepareHydratedValue(ae[le.databaseName],le.referencedColumn)})}),[2,{relationIdAttribute:C,results:O}]}})})}),[2,Promise.all(y)]})})},F}(),D=function(){function F(I){this.expressionMap=I}return F.prototype.transform=function(){var I=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach(function(y){var E=I.metadataToAttribute(I.expressionMap.mainAlias.name,y);I.expressionMap.relationIdAttributes.push(E)}),this.expressionMap.joinAttributes.forEach(function(y){!y.metadata||y.metadata.isJunction||y.metadata.relationIds.forEach(function(E){var S=I.metadataToAttribute(y.alias.name,E);I.expressionMap.relationIdAttributes.push(S)})})},F.prototype.metadataToAttribute=function(I,y){return new U.b(this.expressionMap,{relationName:I+"."+y.relation.propertyName,mapToProperty:I+"."+y.propertyName,alias:y.alias,queryBuilderFactory:y.queryBuilderFactory})},F}(),A=function(){function F(I,y,E){this.connection=I,this.queryRunner=y,this.relationCountAttributes=E}return F.prototype.load=function(I){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S=this;return(0,g.Jh)(this,function(C){return y=function(Q,O,W){return W.indexOf(Q)===O},E=this.relationCountAttributes.map(function(Q){return(0,g.mG)(S,void 0,void 0,function(){var O,W,V,oe,be,Pe,Ae,Oe,Je,Me,je,me,he,He,Se,Ne,it,Ge;return(0,g.Jh)(this,function(Le){switch(Le.label){case 0:return Q.relation.isOneToMany?(V=(W=(O=Q.relation).inverseRelation).joinColumns[0].referencedColumn.propertyName,oe=O.inverseEntityMetadata.target,me=O.inverseEntityMetadata.tableName,he=Q.alias||me,be=W.propertyName,0===(Me=(Me=I.map(function(Ke){return Ke[Q.parentAlias+"_"+V]}).filter(function(Ke){return!!Ke})).filter(y)).length?[2,{relationCountAttribute:Q,results:[]}]:((Ne=this.connection.createQueryBuilder(this.queryRunner)).select(he+"."+be,"parentId").addSelect("COUNT(*)","cnt").from(oe,he).where(he+"."+be+" IN (:...ids)").addGroupBy(he+"."+be).setParameter("ids",Me),Q.queryBuilderFactory&&Q.queryBuilderFactory(Ne),it={relationCountAttribute:Q},[4,Ne.getRawMany()])):[3,2];case 1:return[2,(it.results=Le.sent(),it)];case 2:return Ae=void 0,Oe=void 0,Je=void 0,Q.relation.isOwning?(Pe=Q.relation.joinColumns[0].referencedColumn.databaseName,Ae=Q.relation.inverseJoinColumns[0].referencedColumn.databaseName,Oe=Q.relation.junctionEntityMetadata.columns[0],Je=Q.relation.junctionEntityMetadata.columns[1]):(Pe=Q.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,Ae=Q.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,Oe=Q.relation.junctionEntityMetadata.columns[1],Je=Q.relation.junctionEntityMetadata.columns[0]),0===(Me=(Me=I.map(function(Ke){return Ke[Q.parentAlias+"_"+Pe]}).filter(function(Ke){return!!Ke})).filter(y)).length?[2,{relationCountAttribute:Q,results:[]}]:(me=Q.joinInverseSideMetadata.tableName,he=Q.alias||me,He=Q.relation.junctionEntityMetadata.tableName,Se=(je=Q.junctionAlias)+"."+Oe.propertyName+" IN ("+Me.map(function(Ke){return isNaN(Ke)?"'"+Ke+"'":Ke})+") AND "+je+"."+Je.propertyName+" = "+he+"."+Ae,(Ne=this.connection.createQueryBuilder(this.queryRunner)).select(je+"."+Oe.propertyName,"parentId").addSelect("COUNT("+Ne.escape(he)+"."+Ne.escape(Ae)+")","cnt").from(me,he).innerJoin(He,je,Se).addGroupBy(je+"."+Oe.propertyName),Q.queryBuilderFactory&&Q.queryBuilderFactory(Ne),Ge={relationCountAttribute:Q},[4,Ne.getRawMany()]);case 3:return[2,(Ge.results=Le.sent(),Ge)]}})})}),[2,Promise.all(E)]})})},F}(),T=function(){function F(I){this.expressionMap=I}return F.prototype.transform=function(){var I=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach(function(y){var E=I.metadataToAttribute(I.expressionMap.mainAlias.name,y);I.expressionMap.relationCountAttributes.push(E)}),this.expressionMap.joinAttributes.forEach(function(y){!y.metadata||y.metadata.isJunction||y.metadata.relationCounts.forEach(function(E){var S=I.metadataToAttribute(y.alias.name,E);I.expressionMap.relationCountAttributes.push(S)})})},F.prototype.metadataToAttribute=function(I,y){return new c.$(this.expressionMap,{relationName:I+"."+y.relation.propertyName,mapToProperty:I+"."+y.propertyName,alias:y.alias,queryBuilderFactory:y.queryBuilderFactory})},F}(),x=h(2161),X=h(8489),Y=h(5746),R=h(1438),L=h(9535),H=h(2183),j=h(4906),$=h(4455),ee=function(F){function I(){return null!==F&&F.apply(this,arguments)||this}return(0,g.ZT)(I,F),I.prototype.getQuery=function(){var y=this.createComment();return y+=this.createSelectExpression(),y+=this.createJoinExpression(),y+=this.createWhereExpression(),y+=this.createGroupByExpression(),y+=this.createHavingExpression(),y+=this.createOrderByExpression(),y+=this.createLimitOffsetExpression(),y=(y+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(y="("+y+")"),y},I.prototype.subQuery=function(){var y=this.createQueryBuilder();return y.expressionMap.subQuery=!0,y.parentQueryBuilder=this,y},I.prototype.select=function(y,E){if(this.expressionMap.queryType="select",Array.isArray(y))this.expressionMap.selects=y.map(function(C){return{selection:C}});else if(y instanceof Function){var S=y(this.subQuery());this.setParameters(S.getParameters()),this.expressionMap.selects.push({selection:S.getQuery(),aliasName:E})}else y&&(this.expressionMap.selects=[{selection:y,aliasName:E}]);return this},I.prototype.addSelect=function(y,E){if(!y)return this;if(Array.isArray(y))this.expressionMap.selects=this.expressionMap.selects.concat(y.map(function(C){return{selection:C}}));else if(y instanceof Function){var S=y(this.subQuery());this.setParameters(S.getParameters()),this.expressionMap.selects.push({selection:S.getQuery(),aliasName:E})}else y&&this.expressionMap.selects.push({selection:y,aliasName:E});return this},I.prototype.maxExecutionTime=function(y){return this.expressionMap.maxExecutionTime=y,this},I.prototype.distinct=function(y){return void 0===y&&(y=!0),this.expressionMap.selectDistinct=y,this},I.prototype.distinctOn=function(y){return this.expressionMap.selectDistinctOn=y,this},I.prototype.from=function(y,E){var S=this.createFromAlias(y,E);return this.expressionMap.setMainAlias(S),this},I.prototype.addFrom=function(y,E){var S=this.createFromAlias(y,E);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(S),this},I.prototype.innerJoin=function(y,E,S,C){return this.join("INNER",y,E,S,C),this},I.prototype.leftJoin=function(y,E,S,C){return this.join("LEFT",y,E,S,C),this},I.prototype.innerJoinAndSelect=function(y,E,S,C){return this.addSelect(E),this.innerJoin(y,E,S,C),this},I.prototype.leftJoinAndSelect=function(y,E,S,C){return this.addSelect(E),this.leftJoin(y,E,S,C),this},I.prototype.innerJoinAndMapMany=function(y,E,S,C,Q){return this.addSelect(S),this.join("INNER",E,S,C,Q,y,!0),this},I.prototype.innerJoinAndMapOne=function(y,E,S,C,Q){return this.addSelect(S),this.join("INNER",E,S,C,Q,y,!1),this},I.prototype.leftJoinAndMapMany=function(y,E,S,C,Q){return this.addSelect(S),this.join("LEFT",E,S,C,Q,y,!0),this},I.prototype.leftJoinAndMapOne=function(y,E,S,C,Q){return this.addSelect(S),this.join("LEFT",E,S,C,Q,y,!1),this},I.prototype.loadRelationIdAndMap=function(y,E,S,C){var Q=new U.b(this.expressionMap);return Q.mapToProperty=y,Q.relationName=E,"string"==typeof S&&(Q.alias=S),S instanceof Object&&S.disableMixedMap&&(Q.disableMixedMap=!0),Q.queryBuilderFactory=C,this.expressionMap.relationIdAttributes.push(Q),Q.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:Q.junctionAlias,metadata:Q.relation.junctionEntityMetadata}),this},I.prototype.loadRelationCountAndMap=function(y,E,S,C){var Q=new c.$(this.expressionMap);return Q.mapToProperty=y,Q.relationName=E,Q.alias=S,Q.queryBuilderFactory=C,this.expressionMap.relationCountAttributes.push(Q),this.expressionMap.createAlias({type:"other",name:Q.junctionAlias}),Q.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:Q.junctionAlias,metadata:Q.relation.junctionEntityMetadata}),this},I.prototype.loadAllRelationIds=function(y){var E=this;return this.expressionMap.mainAlias.metadata.relations.forEach(function(S){void 0!==y&&void 0!==y.relations&&-1===y.relations.indexOf(S.propertyPath)||E.loadRelationIdAndMap(E.expressionMap.mainAlias.name+"."+S.propertyPath,E.expressionMap.mainAlias.name+"."+S.propertyPath,y)}),this},I.prototype.where=function(y,E){this.expressionMap.wheres=[];var S=this.getWhereCondition(y);return S&&(this.expressionMap.wheres=[{type:"simple",condition:S}]),E&&this.setParameters(E),this},I.prototype.andWhere=function(y,E){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(y)}),E&&this.setParameters(E),this},I.prototype.orWhere=function(y,E){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(y)}),E&&this.setParameters(E),this},I.prototype.whereInIds=function(y){return this.where(this.getWhereInIdsCondition(y))},I.prototype.andWhereInIds=function(y){return this.andWhere(this.getWhereInIdsCondition(y))},I.prototype.orWhereInIds=function(y){return this.orWhere(this.getWhereInIdsCondition(y))},I.prototype.having=function(y,E){return this.expressionMap.havings.push({type:"simple",condition:y}),E&&this.setParameters(E),this},I.prototype.andHaving=function(y,E){return this.expressionMap.havings.push({type:"and",condition:y}),E&&this.setParameters(E),this},I.prototype.orHaving=function(y,E){return this.expressionMap.havings.push({type:"or",condition:y}),E&&this.setParameters(E),this},I.prototype.groupBy=function(y){return this.expressionMap.groupBys=y?[y]:[],this},I.prototype.addGroupBy=function(y){return this.expressionMap.groupBys.push(y),this},I.prototype.orderBy=function(y,E,S){var C,Q;if(void 0===E&&(E="ASC"),void 0!==E&&"ASC"!==E&&"DESC"!==E)throw new $.K_('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==S&&"NULLS FIRST"!==S&&"NULLS LAST"!==S)throw new $.K_('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=y?y instanceof Object?y:S?((C={})[y]={order:E,nulls:S},C):((Q={})[y]=E,Q):{},this},I.prototype.addOrderBy=function(y,E,S){if(void 0===E&&(E="ASC"),void 0!==E&&"ASC"!==E&&"DESC"!==E)throw new $.K_('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==S&&"NULLS FIRST"!==S&&"NULLS LAST"!==S)throw new $.K_('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[y]=S?{order:E,nulls:S}:E,this},I.prototype.limit=function(y){if(this.expressionMap.limit=this.normalizeNumber(y),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new $.K_('Provided "limit" value is not a number. Please provide a numeric value.');return this},I.prototype.offset=function(y){if(this.expressionMap.offset=this.normalizeNumber(y),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new $.K_('Provided "offset" value is not a number. Please provide a numeric value.');return this},I.prototype.take=function(y){if(this.expressionMap.take=this.normalizeNumber(y),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new $.K_('Provided "take" value is not a number. Please provide a numeric value.');return this},I.prototype.skip=function(y){if(this.expressionMap.skip=this.normalizeNumber(y),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new $.K_('Provided "skip" value is not a number. Please provide a numeric value.');return this},I.prototype.setLock=function(y,E,S){return this.expressionMap.lockMode=y,this.expressionMap.lockVersion=E,this.expressionMap.lockTables=S,this},I.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},I.prototype.getRawOne=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(y){switch(y.label){case 0:return[4,this.getRawMany()];case 1:return[2,y.sent()[0]]}})})},I.prototype.getRawMany=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C;return(0,g.Jh)(this,function(O){switch(O.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new G.Y;this.expressionMap.queryEntity=!1,y=this.obtainQueryRunner(),E=!1,O.label=1;case 1:return O.trys.push([1,7,12,15]),!0===this.expressionMap.useTransaction&&!1===y.isTransactionActive?[4,y.startTransaction()]:[3,3];case 2:O.sent(),E=!0,O.label=3;case 3:return[4,this.loadRawResults(y)];case 4:return S=O.sent(),E?[4,y.commitTransaction()]:[3,6];case 5:O.sent(),O.label=6;case 6:return[2,S];case 7:if(C=O.sent(),!E)return[3,11];O.label=8;case 8:return O.trys.push([8,10,,11]),[4,y.rollbackTransaction()];case 9:case 10:return O.sent(),[3,11];case 11:throw C;case 12:return y===this.queryRunner?[3,14]:[4,y.release()];case 13:O.sent(),O.label=14;case 14:return[7];case 15:return[2]}})})},I.prototype.getRawAndEntities=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C;return(0,g.Jh)(this,function(O){switch(O.label){case 0:y=this.obtainQueryRunner(),E=!1,O.label=1;case 1:return O.trys.push([1,7,12,15]),!0===this.expressionMap.useTransaction&&!1===y.isTransactionActive?[4,y.startTransaction()]:[3,3];case 2:O.sent(),E=!0,O.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(y)];case 4:return S=O.sent(),E?[4,y.commitTransaction()]:[3,6];case 5:O.sent(),O.label=6;case 6:return[2,S];case 7:if(C=O.sent(),!E)return[3,11];O.label=8;case 8:return O.trys.push([8,10,,11]),[4,y.rollbackTransaction()];case 9:case 10:return O.sent(),[3,11];case 11:throw C;case 12:return y===this.queryRunner?[3,14]:[4,y.release()];case 13:O.sent(),O.label=14;case 14:return[7];case 15:return[2]}})})},I.prototype.getOne=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C;return(0,g.Jh)(this,function(Q){switch(Q.label){case 0:return[4,this.getRawAndEntities()];case 1:if(y=Q.sent(),(E=y.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(S=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((C=S.updateDateColumn.getEntityValue(E)).getTime()!==this.expressionMap.lockVersion.getTime())throw new B.Z(S.name,this.expressionMap.lockVersion,C)}else if((C=S.versionColumn.getEntityValue(E))!==this.expressionMap.lockVersion)throw new B.Z(S.name,this.expressionMap.lockVersion,C);return[2,E]}})})},I.prototype.getOneOrFail=function(){return(0,g.mG)(this,void 0,void 0,function(){var y;return(0,g.Jh)(this,function(E){switch(E.label){case 0:return[4,this.getOne()];case 1:if(!(y=E.sent()))throw new j.E(this.expressionMap.mainAlias.target,this);return[2,y]}})})},I.prototype.getMany=function(){return(0,g.mG)(this,void 0,void 0,function(){return(0,g.Jh)(this,function(E){switch(E.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new G.Y;return[4,this.getRawAndEntities()];case 1:return[2,E.sent().entities]}})})},I.prototype.getCount=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C;return(0,g.Jh)(this,function(O){switch(O.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new G.Y;y=this.obtainQueryRunner(),E=!1,O.label=1;case 1:return O.trys.push([1,7,12,15]),!0===this.expressionMap.useTransaction&&!1===y.isTransactionActive?[4,y.startTransaction()]:[3,3];case 2:O.sent(),E=!0,O.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(y)];case 4:return S=O.sent(),E?[4,y.commitTransaction()]:[3,6];case 5:O.sent(),O.label=6;case 6:return[2,S];case 7:if(C=O.sent(),!E)return[3,11];O.label=8;case 8:return O.trys.push([8,10,,11]),[4,y.rollbackTransaction()];case 9:case 10:return O.sent(),[3,11];case 11:throw C;case 12:return y===this.queryRunner?[3,14]:[4,y.release()];case 13:O.sent(),O.label=14;case 14:return[7];case 15:return[2]}})})},I.prototype.getManyAndCount=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C,Q,O;return(0,g.Jh)(this,function(V){switch(V.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new G.Y;y=this.obtainQueryRunner(),E=!1,V.label=1;case 1:return V.trys.push([1,8,13,16]),!0===this.expressionMap.useTransaction&&!1===y.isTransactionActive?[4,y.startTransaction()]:[3,3];case 2:V.sent(),E=!0,V.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(y)];case 4:return S=V.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(y)];case 5:return C=V.sent(),Q=[S.entities,C],E?[4,y.commitTransaction()]:[3,7];case 6:V.sent(),V.label=7;case 7:return[2,Q];case 8:if(O=V.sent(),!E)return[3,12];V.label=9;case 9:return V.trys.push([9,11,,12]),[4,y.rollbackTransaction()];case 10:case 11:return V.sent(),[3,12];case 12:throw O;case 13:return y===this.queryRunner?[3,15]:[4,y.release()];case 14:V.sent(),V.label=15;case 15:return[7];case 16:return[2]}})})},I.prototype.stream=function(){return(0,g.mG)(this,void 0,void 0,function(){var y,E,S,C,Q,O,W,V,me=this;return(0,g.Jh)(this,function(he){switch(he.label){case 0:this.expressionMap.queryEntity=!1,y=(0,g.CR)(this.getQueryAndParameters(),2),E=y[0],S=y[1],C=this.obtainQueryRunner(),Q=!1,he.label=1;case 1:return he.trys.push([1,6,,11]),!0===this.expressionMap.useTransaction&&!1===C.isTransactionActive?[4,C.startTransaction()]:[3,3];case 2:he.sent(),Q=!0,he.label=3;case 3:return O=function(){if(C!==me.queryRunner)return C.release()},W=C.stream(E,S,O,O),Q?[4,C.commitTransaction()]:[3,5];case 4:he.sent(),he.label=5;case 5:return[2,W];case 6:if(V=he.sent(),!Q)return[3,10];he.label=7;case 7:return he.trys.push([7,9,,10]),[4,C.rollbackTransaction()];case 8:case 9:return he.sent(),[3,10];case 10:throw V;case 11:return[2]}})})},I.prototype.cache=function(y,E){return"boolean"==typeof y?this.expressionMap.cache=y:"number"==typeof y?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=y):("string"==typeof y||"number"==typeof y)&&(this.expressionMap.cache=!0,this.expressionMap.cacheId=y),E&&(this.expressionMap.cacheDuration=E),this},I.prototype.setOption=function(y){return this.expressionMap.options.push(y),this},I.prototype.join=function(y,E,S,C,Q,O,W){this.setParameters(Q||{});var V=new J.k(this.connection,this.expressionMap);if(V.direction=y,V.mapToProperty=O,V.isMappingMany=W,V.entityOrProperty=E,V.condition=C||void 0,this.expressionMap.joinAttributes.push(V),V.metadata){if(V.metadata.deleteDateColumn&&!this.expressionMap.withDeleted){var oe=S+"."+V.metadata.deleteDateColumn.propertyName+" IS NULL";V.condition=V.condition?" "+V.condition+" AND "+oe:""+oe}V.alias=this.expressionMap.createAlias({type:"join",name:S,metadata:V.metadata}),V.relation&&V.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:V.junctionAlias,metadata:V.relation.junctionEntityMetadata})}else{var me="";if(E instanceof Function){var he=E(this.subQuery());this.setParameters(he.getParameters()),me=he.getQuery()}else me=E;var be=E instanceof Function||"("===E.substr(0,1)&&")"===E.substr(-1);V.alias=this.expressionMap.createAlias({type:"join",name:S,tablePath:!1===be?E:void 0,subQuery:!0===be?me:void 0})}},I.prototype.createSelectExpression=function(){var y=this;if(!this.expressionMap.mainAlias)throw new $.K_("Cannot build query because main alias is not set (call qb#from method)");var E=[],S=[];if(this.expressionMap.mainAlias.hasMetadata){var C=this.expressionMap.mainAlias.metadata;E.push.apply(E,(0,g.ev)([],(0,g.CR)(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,C)))),S.push.apply(S,(0,g.ev)([],(0,g.CR)(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,C))))}this.expressionMap.joinAttributes.forEach(function(oe){if(oe.metadata)E.push.apply(E,(0,g.ev)([],(0,g.CR)(y.buildEscapedEntityColumnSelects(oe.alias.name,oe.metadata)))),S.push.apply(S,(0,g.ev)([],(0,g.CR)(y.findEntityColumnSelects(oe.alias.name,oe.metadata))));else if(y.expressionMap.selects.some(function(be){return be.selection===oe.alias.name})){E.push({selection:y.escape(oe.alias.name)+".*"});var he=y.expressionMap.selects.find(function(be){return be.selection===oe.alias.name});S.push(he)}}),this.expressionMap.selects.filter(function(oe){return-1===S.indexOf(oe)}).forEach(function(oe){return E.push({selection:y.replacePropertyNames(oe.selection),aliasName:oe.aliasName})}),0===E.length&&E.push({selection:"*"});var Q="";if(this.connection.driver instanceof _.Z0)switch(this.expressionMap.lockMode){case"pessimistic_read":Q=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":Q=" WITH (UPDLOCK, ROWLOCK)";break;case"dirty_read":Q=" WITH (NOLOCK)"}var O=this.expressionMap.aliases.filter(function(oe){return"from"===oe.type&&(oe.tablePath||oe.subQuery)}).map(function(oe){return oe.subQuery?oe.subQuery+" "+y.escape(oe.name):y.getTableName(oe.tablePath)+" "+y.escape(oe.name)});return this.createSelectDistinctExpression()+E.map(function(oe){return oe.selection+(oe.aliasName?" AS "+y.escape(oe.aliasName):"")}).join(", ")+" FROM "+O.join(", ")+Q},I.prototype.createSelectDistinctExpression=function(){var y=this,E=this.expressionMap,S=E.selectDistinct,C=E.selectDistinctOn,O=this.connection.driver,W="SELECT ";return E.maxExecutionTime>0&&O instanceof _.p$&&(W+="/*+ MAX_EXECUTION_TIME("+this.expressionMap.maxExecutionTime+") */ "),O instanceof _.U4&&C.length>0?W="SELECT DISTINCT ON ("+C.map(function(oe){return y.replacePropertyNames(oe)}).join(", ")+") ":S&&(W="SELECT DISTINCT "),W},I.prototype.createJoinExpression=function(){var y=this;return this.expressionMap.joinAttributes.map(function(S){var C=S.relation,Q=S.tablePath,O=S.alias.name,W=S.condition?" AND ("+S.condition+")":"",V=S.parentAlias;if(!V||!C){var oe=S.alias.subQuery?S.alias.subQuery:y.getTableName(Q);return" "+S.direction+" JOIN "+oe+" "+y.escape(O)+(S.condition?" ON "+y.replacePropertyNames(S.condition):"")}if(C.isManyToOne||C.isOneToOneOwner){var me=C.joinColumns.map(function(Pe){return O+"."+Pe.referencedColumn.propertyPath+"="+V+"."+C.propertyPath+"."+Pe.referencedColumn.propertyPath}).join(" AND ");return" "+S.direction+" JOIN "+y.getTableName(Q)+" "+y.escape(O)+" ON "+y.replacePropertyNames(me+W)}if(C.isOneToMany||C.isOneToOneNotOwner)return me=C.inverseRelation.joinColumns.map(function(Ae){return"entity-child"===C.inverseEntityMetadata.tableType&&C.inverseEntityMetadata.discriminatorColumn&&(W+=" AND "+O+"."+C.inverseEntityMetadata.discriminatorColumn.databaseName+"='"+C.inverseEntityMetadata.discriminatorValue+"'"),O+"."+C.inverseRelation.propertyPath+"."+Ae.referencedColumn.propertyPath+"="+V+"."+Ae.referencedColumn.propertyPath}).join(" AND ")," "+S.direction+" JOIN "+y.getTableName(Q)+" "+y.escape(O)+" ON "+y.replacePropertyNames(me+W);var he=C.junctionEntityMetadata.tablePath,be=S.junctionAlias,Me="",Ne="";return C.isOwning?(Me=C.joinColumns.map(function(Pe){return be+"."+Pe.propertyPath+"="+V+"."+Pe.referencedColumn.propertyPath}).join(" AND "),Ne=C.inverseJoinColumns.map(function(Pe){return O+"."+Pe.referencedColumn.propertyPath+"="+be+"."+Pe.propertyPath}).join(" AND ")):(Me=C.inverseRelation.inverseJoinColumns.map(function(Pe){return be+"."+Pe.propertyPath+"="+V+"."+Pe.referencedColumn.propertyPath}).join(" AND "),Ne=C.inverseRelation.joinColumns.map(function(Pe){return O+"."+Pe.referencedColumn.propertyPath+"="+be+"."+Pe.propertyPath}).join(" AND "))," "+S.direction+" JOIN "+y.getTableName(he)+" "+y.escape(be)+" ON "+y.replacePropertyNames(Me)+" "+S.direction+" JOIN "+y.getTableName(Q)+" "+y.escape(O)+" ON "+y.replacePropertyNames(Ne+W)}).join(" ")},I.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},I.prototype.createOrderByExpression=function(){var y=this,E=this.expressionMap.allOrderBys;return Object.keys(E).length>0?" ORDER BY "+Object.keys(E).map(function(S){return"string"==typeof E[S]?y.replacePropertyNames(S)+" "+E[S]:y.replacePropertyNames(S)+" "+E[S].order+" "+E[S].nulls}).join(", "):""},I.prototype.createLimitOffsetExpression=function(){var y=this.expressionMap.offset,E=this.expressionMap.limit;if(!y&&!E&&0===this.expressionMap.joinAttributes.length&&(y=this.expressionMap.skip,E=this.expressionMap.take),this.connection.driver instanceof _.Z0){var S="";if((E||y)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(S=" ORDER BY (SELECT NULL)"),E&&y)return S+" OFFSET "+y+" ROWS FETCH NEXT "+E+" ROWS ONLY";if(E)return S+" OFFSET 0 ROWS FETCH NEXT "+E+" ROWS ONLY";if(y)return S+" OFFSET "+y+" ROWS"}else if(this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI||this.connection.driver instanceof _.tU){if(E&&y)return" LIMIT "+E+" OFFSET "+y;if(E)return" LIMIT "+E;if(y)throw new R.G}else if(this.connection.driver instanceof Y.w){if(E&&y)return" LIMIT "+E+" OFFSET "+y;if(E)return" LIMIT "+E;if(y)return" LIMIT -1 OFFSET "+y}else if(this.connection.driver instanceof _.XR){if(E&&y)return" OFFSET "+y+" ROWS FETCH NEXT "+E+" ROWS ONLY";if(E)return" FETCH NEXT "+E+" ROWS ONLY";if(y)return" OFFSET "+y+" ROWS"}else{if(E&&y)return" LIMIT "+E+" OFFSET "+y;if(E)return" LIMIT "+E;if(y)return" OFFSET "+y}return""},I.prototype.createLockExpression=function(){var y=this.connection.driver,E="";if(this.expressionMap.lockTables){if(!(y instanceof _.U4))throw new $.K_("Lock tables not supported in selected driver");if(this.expressionMap.lockTables.length<1)throw new $.K_("lockTables cannot be an empty array");E=" OF "+this.expressionMap.lockTables.join(", ")}switch(this.expressionMap.lockMode){case"pessimistic_read":if(y instanceof _.p$||y instanceof _.xI)return" LOCK IN SHARE MODE";if(y instanceof _.U4)return" FOR SHARE"+E;if(y instanceof _.XR)return" FOR UPDATE";if(y instanceof _.Z0)return"";throw new X.A;case"pessimistic_write":if(y instanceof _.p$||y instanceof _.xI||y instanceof _.XR)return" FOR UPDATE";if(y instanceof _.U4)return" FOR UPDATE"+E;if(y instanceof _.Z0)return"";throw new X.A;case"pessimistic_partial_write":if(y instanceof _.U4)return" FOR UPDATE"+E+" SKIP LOCKED";if(y instanceof _.p$)return" FOR UPDATE SKIP LOCKED";throw new X.A;case"pessimistic_write_or_fail":if(y instanceof _.U4)return" FOR UPDATE"+E+" NOWAIT";if(y instanceof _.p$)return" FOR UPDATE NOWAIT";throw new X.A;case"for_no_key_update":if(y instanceof _.U4)return" FOR NO KEY UPDATE"+E;throw new X.A;default:return""}},I.prototype.createHavingExpression=function(){var y=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var E=this.expressionMap.havings.map(function(S,C){switch(S.type){case"and":return(C>0?"AND ":"")+y.replacePropertyNames(S.condition);case"or":return(C>0?"OR ":"")+y.replacePropertyNames(S.condition);default:return y.replacePropertyNames(S.condition)}}).join(" ");return E.length?" HAVING "+E:""},I.prototype.buildEscapedEntityColumnSelects=function(y,E){var S=this,C=this.expressionMap.selects.some(function(V){return V.selection===y}),Q=[];if(C&&Q.push.apply(Q,(0,g.ev)([],(0,g.CR)(E.columns.filter(function(V){return!0===V.isSelect})))),Q.push.apply(Q,(0,g.ev)([],(0,g.CR)(E.columns.filter(function(V){return S.expressionMap.selects.some(function(oe){return oe.selection===y+"."+V.propertyPath})})))),0===Q.length)return[];var O=this.expressionMap.queryEntity?E.primaryColumns.filter(function(V){return-1===Q.indexOf(V)}):[];return(0,g.ev)((0,g.ev)([],(0,g.CR)(Q)),(0,g.CR)(O)).map(function(V){var oe=S.expressionMap.selects.find(function(Me){return Me.selection===y+"."+V.propertyPath}),me=S.escape(y)+"."+S.escape(V.databaseName);return-1!==S.connection.driver.spatialTypes.indexOf(V.type)&&((S.connection.driver instanceof _.p$||S.connection.driver instanceof _.xI)&&(me=(S.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText")+"("+me+")"),S.connection.driver instanceof _.U4&&(me=V.precision?"ST_AsGeoJSON("+me+", "+V.precision+")::json":"ST_AsGeoJSON("+me+")::json"),S.connection.driver instanceof _.Z0&&(me+=".ToString()")),{selection:me,aliasName:oe&&oe.aliasName?oe.aliasName:m.z.buildAlias(S.connection.driver,y,V.databaseName),virtual:oe?!0===oe.virtual:!C}})},I.prototype.findEntityColumnSelects=function(y,E){var S=this.expressionMap.selects.find(function(C){return C.selection===y});return S?[S]:this.expressionMap.selects.filter(function(C){return E.columns.some(function(Q){return C.selection===y+"."+Q.propertyPath})})},I.prototype.computeCountExpression=function(){var y=this,C=this.expressionMap.mainAlias.metadata.primaryColumns,Q=this.escape(this.expressionMap.mainAlias.name);if(0===this.expressionMap.joinAttributes.length&&0===this.expressionMap.relationIdAttributes.length&&0===this.expressionMap.relationCountAttributes.length)return"COUNT(1)";if(this.connection.driver instanceof _.J1||this.connection.driver instanceof _.U4)return"COUNT(DISTINCT("+C.map(function(W){return Q+"."+y.escape(W.databaseName)}).join(", ")+"))";if(this.connection.driver instanceof _.p$)return"COUNT(DISTINCT "+C.map(function(W){return Q+"."+y.escape(W.databaseName)}).join(", ")+")";if(this.connection.driver instanceof _.Z0){var O=C.map(function(W){return Q+"."+y.escape(W.databaseName)}).join(", '|;|', ");return 1===C.length?"COUNT(DISTINCT("+O+"))":"COUNT(DISTINCT(CONCAT("+O+")))"}return"COUNT(DISTINCT("+C.map(function(W){return Q+"."+y.escape(W.databaseName)}).join(" || '|;|' || ")+"))"},I.prototype.executeCountQuery=function(y){return(0,g.mG)(this,void 0,void 0,function(){var E,S;return(0,g.Jh)(this,function(C){switch(C.label){case 0:return E=this.computeCountExpression(),[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(E,"cnt").setOption("disable-global-order").loadRawResults(y)];case 1:return(S=C.sent())&&S[0]&&S[0].cnt?[2,parseInt(S[0].cnt)]:[2,0]}})})},I.prototype.executeEntitiesAndRawResults=function(y){return(0,g.mG)(this,void 0,void 0,function(){var E,S,C,W,V,oe,me,he,be,Me,Ne,Pe,Ae,Oe,Je,He,Se,it,Ge,Le=this;return(0,g.Jh)(this,function(Ke){switch(Ke.label){case 0:if(!this.expressionMap.mainAlias)throw new $.K_('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode)&&!y.isTransactionActive)throw new a.G;if("optimistic"===this.expressionMap.lockMode&&!(E=this.expressionMap.mainAlias.metadata).versionColumn&&!E.updateDateColumn)throw new v.f(E.name);return S=new ie(this.connection,y,this.expressionMap.relationIdAttributes),C=new A(this.connection,y,this.expressionMap.relationCountAttributes),new D(this.expressionMap).transform(),new T(this.expressionMap).transform(),W=[],V=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(oe=(0,g.CR)(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2),me=oe[0],he=oe[1],Me=this.expressionMap.mainAlias.name,Ne=(be=this.expressionMap.mainAlias.metadata).primaryColumns.map(function(tt){var lt=Le.escape("distinctAlias"),nt=Le.escape(m.z.buildAlias(Le.connection.driver,Me,tt.databaseName));return he[nt]||(he[nt]="ASC"),lt+"."+nt+' as "'+m.z.buildAlias(Le.connection.driver,"ids_"+Me,tt.databaseName)+'"'}),[4,new I(this.connection,y).select("DISTINCT "+Ne.join(", ")).addSelect(me).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(he).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(W=Ke.sent()).length>0?(Pe="",Ae={},be.hasMultiplePrimaryKeys?Pe=W.map(function(tt,lt){return be.primaryColumns.map(function(nt){var rt="orm_distinct_ids_"+lt+"_"+nt.databaseName;return Ae[rt]=tt["ids_"+Me+"_"+nt.databaseName],Me+"."+nt.propertyPath+"=:"+rt}).join(" AND ")}).join(" OR "):(Oe=m.z.buildAlias(this.connection.driver,"ids_"+Me,be.primaryColumns[0].databaseName),(Je=W.map(function(tt){return tt[Oe]})).every(function(tt){return"number"==typeof tt})?Pe=Me+"."+be.primaryColumns[0].propertyPath+" IN ("+Je.join(", ")+")":(Ae.orm_distinct_ids=Je,Pe=Me+"."+be.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:Pe}).setParameters(Ae).loadRawResults(y)]):[3,3];case 2:W=Ke.sent(),Ke.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(y)];case 5:W=Ke.sent(),Ke.label=6;case 6:return W.length>0?[4,S.load(W)]:[3,10];case 7:return He=Ke.sent(),[4,C.load(W)];case 8:return Se=Ke.sent(),it=new N(this.expressionMap,this.connection.driver,He,Se,this.queryRunner),V=it.transform(W,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(Ge=new L.D,y.broadcaster.broadcastLoadEventsForAll(Ge,this.expressionMap.mainAlias.metadata,V),Ge.promises.length>0?[4,Promise.all(Ge.promises)]:[3,10]):[3,10];case 9:Ke.sent(),Ke.label=10;case 10:return[2,{raw:W,entities:V}]}})})},I.prototype.createOrderByCombinedWithSelectExpression=function(y){var E=this,S=this.expressionMap.allOrderBys,C=Object.keys(S).map(function(O){if(-1!==O.indexOf(".")){var W=O.split("."),V=W[0],oe=W.slice(1).join("."),he=E.expressionMap.findAliasByName(V).metadata.findColumnWithPropertyPath(oe);return E.escape(y)+"."+E.escape(m.z.buildAlias(E.connection.driver,V,he.databaseName))}return E.expressionMap.selects.find(function(be){return be.selection===O||be.aliasName===O})?E.escape(y)+"."+O:""}).join(", "),Q={};return Object.keys(S).forEach(function(O){if(-1!==O.indexOf(".")){var W=O.split("."),V=W[0],oe=W.slice(1).join("."),he=E.expressionMap.findAliasByName(V).metadata.findColumnWithPropertyPath(oe);Q[E.escape(y)+"."+E.escape(m.z.buildAlias(E.connection.driver,V,he.databaseName))]=S[O]}else E.expressionMap.selects.find(function(be){return be.selection===O||be.aliasName===O})?Q[E.escape(y)+"."+O]=S[O]:Q[O]=S[O]}),[C,Q]},I.prototype.loadRawResults=function(y){return(0,g.mG)(this,void 0,void 0,function(){var E,S,C,Q,O,W,V,oe,me,he;return(0,g.Jh)(this,function(be){switch(be.label){case 0:if(E=(0,g.CR)(this.getQueryAndParameters(),2),C=E[1],Q=(S=E[0])+" -- PARAMETERS: "+JSON.stringify(C),O="object"==typeof this.connection.options.cache?this.connection.options.cache:{},W=void 0,V=!1,!this.connection.queryResultCache||!this.expressionMap.cache&&!O.alwaysEnabled)return[3,4];be.label=1;case 1:return be.trys.push([1,3,,4]),[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:Q,duration:this.expressionMap.cacheDuration||O.duration||1e3},y)];case 2:return(W=be.sent())&&!this.connection.queryResultCache.isExpired(W)?[2,JSON.parse(W.result)]:[3,4];case 3:if(oe=be.sent(),!O.ignoreErrors)throw oe;return V=!0,[3,4];case 4:return[4,y.query(S,C,!0)];case 5:if(me=be.sent(),V||!this.connection.queryResultCache||!this.expressionMap.cache&&!O.alwaysEnabled)return[3,9];be.label=6;case 6:return be.trys.push([6,8,,9]),[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:Q,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||O.duration||1e3,result:JSON.stringify(me.records)},W,y)];case 7:return be.sent(),[3,9];case 8:if(he=be.sent(),!O.ignoreErrors)throw he;return[3,9];case 9:return[2,me.records]}})})},I.prototype.mergeExpressionMap=function(y){return H.g.assign(this.expressionMap,y),this},I.prototype.normalizeNumber=function(y){return"number"==typeof y||null==y?y:Number(y)},I.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},I}(x.z)},3328:(Ee,ne,h)=>{"use strict";h.d(ne,{B:()=>Z});var g=h(5081),_=h(9145),P=h(2161),m=h(6111),N=h(191),a=h(5418),v=h(9535),B=h(6719),G=h(7141),J=h(8080),U=h(5526),c=h(4455),Z=function(ie){function D(A,T){var x=ie.call(this,A,T)||this;return x.expressionMap.aliasNamePrefixingEnabled=!1,x}return(0,g.ZT)(D,ie),D.prototype.getQuery=function(){var A=this.createUpdateExpression();return A+=this.createOrderByExpression(),(A+=this.createLimitExpression()).trim()},D.prototype.execute=function(){return(0,g.mG)(this,void 0,void 0,function(){var A,T,X,Y,H,j,x,$;return(0,g.Jh)(this,function(F){switch(F.label){case 0:A=this.obtainQueryRunner(),T=!1,F.label=1;case 1:return F.trys.push([1,13,18,21]),!0===this.expressionMap.useTransaction&&!1===A.isTransactionActive?[4,A.startTransaction()]:[3,3];case 2:F.sent(),T=!0,F.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(x=new v.D,A.broadcaster.broadcastBeforeUpdateEvent(x,this.expressionMap.mainAlias.metadata),x.promises.length>0?[4,Promise.all(x.promises)]:[3,5]):[3,5];case 4:F.sent(),F.label=5;case 5:return X=new a.v(A,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=X.getUpdationReturningColumns()),Y=(0,g.CR)(this.getQueryAndParameters(),2),[4,A.query(Y[0],Y[1],!0)];case 6:return H=F.sent(),j=m.s.from(H),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,X.update(j,this.expressionMap.whereEntities)]:[3,8];case 7:F.sent(),F.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(x=new v.D,A.broadcaster.broadcastAfterUpdateEvent(x,this.expressionMap.mainAlias.metadata),x.promises.length>0?[4,Promise.all(x.promises)]:[3,10]):[3,10];case 9:F.sent(),F.label=10;case 10:return T?[4,A.commitTransaction()]:[3,12];case 11:F.sent(),F.label=12;case 12:return[2,j];case 13:if($=F.sent(),!T)return[3,17];F.label=14;case 14:return F.trys.push([14,16,,17]),[4,A.rollbackTransaction()];case 15:case 16:return F.sent(),[3,17];case 17:throw $;case 18:return A===this.queryRunner?[3,20]:[4,A.release()];case 19:F.sent(),F.label=20;case 20:return[7];case 21:return[2]}})})},D.prototype.from=function(A,T){var x=this.createFromAlias(A=A instanceof U.I?A.options.name:A,T);return this.expressionMap.setMainAlias(x),this},D.prototype.where=function(A,T){this.expressionMap.wheres=[];var x=this.getWhereCondition(A);return x&&(this.expressionMap.wheres=[{type:"simple",condition:x}]),T&&this.setParameters(T),this},D.prototype.andWhere=function(A,T){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(A)}),T&&this.setParameters(T),this},D.prototype.orWhere=function(A,T){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(A)}),T&&this.setParameters(T),this},D.prototype.whereInIds=function(A){return this.where(this.getWhereInIdsCondition(A))},D.prototype.andWhereInIds=function(A){return this.andWhere(this.getWhereInIdsCondition(A))},D.prototype.orWhereInIds=function(A){return this.orWhere(this.getWhereInIdsCondition(A))},D.prototype.output=function(A){return this.returning(A)},D.prototype.returning=function(A){if(!this.connection.driver.isReturningSqlSupported())throw new N.y;return this.expressionMap.returning=A,this},D.prototype.orderBy=function(A,T,x){var X,Y;return void 0===T&&(T="ASC"),this.expressionMap.orderBys=A?A instanceof Object?A:x?((X={})[A]={order:T,nulls:x},X):((Y={})[A]=T,Y):{},this},D.prototype.addOrderBy=function(A,T,x){return void 0===T&&(T="ASC"),this.expressionMap.orderBys[A]=x?{order:T,nulls:x}:T,this},D.prototype.limit=function(A){return this.expressionMap.limit=A,this},D.prototype.whereEntity=function(A){var T=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new c.K_(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var x=Array.isArray(A)?A:[A];return x.forEach(function(X){var Y=T.expressionMap.mainAlias.metadata.getEntityIdMap(X);if(!Y)throw new c.K_("Provided entity does not have ids set, cannot perform operation.");T.orWhereInIds(Y)}),this.expressionMap.whereEntities=x,this},D.prototype.updateEntity=function(A){return this.expressionMap.updateEntity=A,this},D.prototype.createUpdateExpression=function(){var A=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!A)throw new c.K_('Cannot get entity metadata for the given alias "'+this.expressionMap.mainAlias+'"');if(!A.deleteDateColumn)throw new G.d(A);var T=[];switch(this.expressionMap.queryType){case"soft-delete":T.push(this.escape(A.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":T.push(this.escape(A.deleteDateColumn.databaseName)+" = NULL");break;default:throw new c.K_('The queryType must be "soft-delete" or "restore"')}if(A.versionColumn&&T.push(this.escape(A.versionColumn.databaseName)+" = "+this.escape(A.versionColumn.databaseName)+" + 1"),A.updateDateColumn&&T.push(this.escape(A.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),T.length<=0)throw new J.y;var x=this.createWhereExpression(),X=this.createReturningExpression();return X&&(this.connection.driver instanceof _.U4||this.connection.driver instanceof _.XR||this.connection.driver instanceof _.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+T.join(", ")+x+" RETURNING "+X:X&&this.connection.driver instanceof _.Z0?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+T.join(", ")+" OUTPUT "+X+x:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+T.join(", ")+x},D.prototype.createOrderByExpression=function(){var A=this,T=this.expressionMap.orderBys;return Object.keys(T).length>0?" ORDER BY "+Object.keys(T).map(function(x){return"string"==typeof T[x]?A.replacePropertyNames(x)+" "+T[x]:A.replacePropertyNames(x)+" "+T[x].order+" "+T[x].nulls}).join(", "):""},D.prototype.createLimitExpression=function(){var A=this.expressionMap.limit;if(A){if(this.connection.driver instanceof _.p$)return" LIMIT "+A;throw new B.T}return""},D}(P.z)},2739:(Ee,ne,h)=>{"use strict";h.d(ne,{T:()=>c});var g=h(5081),_=h(9145),P=h(2161),m=h(6111),N=h(191),a=h(5418),v=h(9535),B=h(6719),G=h(8080),J=h(6157),U=h(4455),c=function(Z){function ie(D,A){var T=Z.call(this,D,A)||this;return T.expressionMap.aliasNamePrefixingEnabled=!1,T}return(0,g.ZT)(ie,Z),ie.prototype.getQuery=function(){var D=this.createComment();return D+=this.createUpdateExpression(),D+=this.createOrderByExpression(),(D+=this.createLimitExpression()).trim()},ie.prototype.execute=function(){return(0,g.mG)(this,void 0,void 0,function(){var D,A,x,X,Y,R,L,H,$,F,y,E,T,S,Q,O;return(0,g.Jh)(this,function(W){switch(W.label){case 0:D=this.obtainQueryRunner(),A=!1,W.label=1;case 1:return W.trys.push([1,13,18,21]),!0===this.expressionMap.useTransaction&&!1===D.isTransactionActive?[4,D.startTransaction()]:[3,3];case 2:W.sent(),A=!0,W.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(T=new v.D,D.broadcaster.broadcastBeforeUpdateEvent(T,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),T.promises.length>0?[4,Promise.all(T.promises)]:[3,5]):[3,5];case 4:W.sent(),W.label=5;case 5:if(x=null,X=null,Y=new a.v(D,this.expressionMap),R=[],Array.isArray(this.expressionMap.returning)&&this.expressionMap.mainAlias.hasMetadata)try{for(L=(0,g.XA)(this.expressionMap.returning),H=L.next();!H.done;H=L.next())R.push.apply(R,(0,g.ev)([],(0,g.CR)(this.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(H.value))))}catch(V){Q={error:V}}finally{try{H&&!H.done&&(O=L.return)&&O.call(L)}finally{if(Q)throw Q.error}}return!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=Y.getUpdationReturningColumns(),R.push.apply(R,(0,g.ev)([],(0,g.CR)(this.expressionMap.extraReturningColumns.filter(function(V){return!R.includes(V)}))))),R.length>0&&this.connection.driver instanceof _.Z0&&(x=this.connection.driver.buildTableVariableDeclaration("@OutputTable",R),X="SELECT * FROM @OutputTable"),$=(0,g.CR)(this.getQueryAndParameters(),2),F=$[1],[4,D.query([x,$[0],X].filter(function(V){return null!=V}).join(";\n\n"),F,!0)];case 6:return y=W.sent(),E=m.s.from(y),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,Y.update(E,this.expressionMap.whereEntities)]:[3,8];case 7:W.sent(),W.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(T=new v.D,D.broadcaster.broadcastAfterUpdateEvent(T,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),T.promises.length>0?[4,Promise.all(T.promises)]:[3,10]):[3,10];case 9:W.sent(),W.label=10;case 10:return A?[4,D.commitTransaction()]:[3,12];case 11:W.sent(),W.label=12;case 12:return[2,E];case 13:if(S=W.sent(),!A)return[3,17];W.label=14;case 14:return W.trys.push([14,16,,17]),[4,D.rollbackTransaction()];case 15:case 16:return W.sent(),[3,17];case 17:throw S;case 18:return D===this.queryRunner?[3,20]:[4,D.release()];case 19:W.sent(),W.label=20;case 20:return[7];case 21:return[2]}})})},ie.prototype.set=function(D){return this.expressionMap.valuesSet=D,this},ie.prototype.where=function(D,A){this.expressionMap.wheres=[];var T=this.getWhereCondition(D);return T&&(this.expressionMap.wheres=[{type:"simple",condition:T}]),A&&this.setParameters(A),this},ie.prototype.andWhere=function(D,A){return this.expressionMap.wheres.push({type:"and",condition:this.getWhereCondition(D)}),A&&this.setParameters(A),this},ie.prototype.orWhere=function(D,A){return this.expressionMap.wheres.push({type:"or",condition:this.getWhereCondition(D)}),A&&this.setParameters(A),this},ie.prototype.whereInIds=function(D){return this.where(this.getWhereInIdsCondition(D))},ie.prototype.andWhereInIds=function(D){return this.andWhere(this.getWhereInIdsCondition(D))},ie.prototype.orWhereInIds=function(D){return this.orWhere(this.getWhereInIdsCondition(D))},ie.prototype.output=function(D){return this.returning(D)},ie.prototype.returning=function(D){if(!this.connection.driver.isReturningSqlSupported())throw new N.y;return this.expressionMap.returning=D,this},ie.prototype.orderBy=function(D,A,T){var x,X;return void 0===A&&(A="ASC"),this.expressionMap.orderBys=D?D instanceof Object?D:T?((x={})[D]={order:A,nulls:T},x):((X={})[D]=A,X):{},this},ie.prototype.addOrderBy=function(D,A,T){return void 0===A&&(A="ASC"),this.expressionMap.orderBys[D]=T?{order:A,nulls:T}:A,this},ie.prototype.limit=function(D){return this.expressionMap.limit=D,this},ie.prototype.whereEntity=function(D){var A=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new U.K_(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var T=Array.isArray(D)?D:[D];return T.forEach(function(x){var X=A.expressionMap.mainAlias.metadata.getEntityIdMap(x);if(!X)throw new U.K_("Provided entity does not have ids set, cannot perform operation.");A.orWhereInIds(X)}),this.expressionMap.whereEntities=T,this},ie.prototype.updateEntity=function(D){return this.expressionMap.updateEntity=D,this},ie.prototype.createUpdateExpression=function(){var D=this,A=this.getValueSet(),T=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,x=[],X=[];if(T?(this.createPropertyPath(T,A).forEach(function(L){var H=T.findColumnsWithPropertyPath(L);if(H.length<=0)throw new J.n(L);H.forEach(function(j){if(j.isUpdate){X.push(j);var $=j.getEntityValue(A);if(j.referencedColumn&&$ instanceof Object&&!($ instanceof Buffer)?$=j.referencedColumn.getEntityValue($):$ instanceof Function||($=D.connection.driver.preparePersistentValue($,j)),$ instanceof Function)x.push(D.escape(j.databaseName)+" = "+$());else if(D.connection.driver instanceof _.tU&&null===$)x.push(D.escape(j.databaseName)+" = NULL");else{D.connection.driver instanceof _.Z0&&($=D.connection.driver.parametrizeValue(j,$));var ee=D.createParameter($),F=null;if((D.connection.driver instanceof _.p$||D.connection.driver instanceof _.xI)&&-1!==D.connection.driver.spatialTypes.indexOf(j.type)){var y=D.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";F=null!=j.srid?y+"("+ee+", "+j.srid+")":y+"("+ee+")"}else F=D.connection.driver instanceof _.U4&&-1!==D.connection.driver.spatialTypes.indexOf(j.type)?null!=j.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+ee+"), "+j.srid+")::"+j.type:"ST_GeomFromGeoJSON("+ee+")::"+j.type:D.connection.driver instanceof _.Z0&&-1!==D.connection.driver.spatialTypes.indexOf(j.type)?j.type+"::STGeomFromText("+ee+", "+(j.srid||"0")+")":ee;x.push(D.escape(j.databaseName)+" = "+F)}}})}),T.versionColumn&&-1===X.indexOf(T.versionColumn)&&x.push(this.escape(T.versionColumn.databaseName)+" = "+this.escape(T.versionColumn.databaseName)+" + 1"),T.updateDateColumn&&-1===X.indexOf(T.updateDateColumn)&&x.push(this.escape(T.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(A).map(function(L){var H=A[L];if(H instanceof Function)x.push(D.escape(L)+" = "+H());else if(D.connection.driver instanceof _.tU&&null===H)x.push(D.escape(L)+" = NULL");else{var j=D.createParameter(H);x.push(D.escape(L)+" = "+j)}}),x.length<=0)throw new G.y;var Y=this.createWhereExpression(),R=this.createReturningExpression();return R&&(this.connection.driver instanceof _.U4||this.connection.driver instanceof _.XR||this.connection.driver instanceof _.J1)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+x.join(", ")+Y+" RETURNING "+R:R&&this.connection.driver instanceof _.Z0?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+x.join(", ")+" OUTPUT "+R+Y:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+x.join(", ")+Y},ie.prototype.createOrderByExpression=function(){var D=this,A=this.expressionMap.orderBys;return Object.keys(A).length>0?" ORDER BY "+Object.keys(A).map(function(T){return"string"==typeof A[T]?D.replacePropertyNames(T)+" "+A[T]:D.replacePropertyNames(T)+" "+A[T].order+" "+A[T].nulls}).join(", "):""},ie.prototype.createLimitExpression=function(){var D=this.expressionMap.limit;if(D){if(this.connection.driver instanceof _.p$||this.connection.driver instanceof _.xI)return" LIMIT "+D;throw new B.T}return""},ie.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new G.y},ie}(P.z)},5627:(Ee,ne,h)=>{"use strict";h.d(ne,{$:()=>N});var g=h(5081),_=h(1534),P=h(2183),m=h(5797),N=function(){function a(v,B){this.expressionMap=v,P.g.assign(this,B||{})}return Object.defineProperty(a.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"parentAlias",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relationProperty",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"junctionAlias",{get:function(){var v=(0,g.CR)(this.relationName.split("."),2);return v[0]+"_"+v[1]+"_rc"},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relation",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value is a string representation of alias property");var v=(0,g.CR)(this.relationName.split("."),2),G=v[1],U=this.expressionMap.findAliasByName(v[0]).metadata.findRelationWithPropertyPath(G);if(!U)throw new m.K("Relation with property path "+G+" in entity was not found.");return U},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"metadata",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value is a string representation of alias property");var v=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(v).metadata},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!1,configurable:!0}),a}()},2756:(Ee,ne,h)=>{"use strict";h.d(ne,{b:()=>N});var g=h(5081),_=h(1534),P=h(2183),m=h(5797),N=function(){function a(v,B){this.queryExpressionMap=v,this.disableMixedMap=!1,P.g.assign(this,B||{})}return Object.defineProperty(a.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"parentAlias",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relationPropertyPath",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"relation",{get:function(){if(!_.G.isAliasProperty(this.relationName))throw new m.K("Given value must be a string representation of alias property");var B=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!B)throw new m.K("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return B},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"junctionAlias",{get:function(){var v=(0,g.CR)(this.relationName.split("."),2);return v[0]+"_"+v[1]+"_rid"},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!1,configurable:!0}),a}()},8666:(Ee,ne,h)=>{"use strict";h.d(ne,{y:()=>g});var g=function(){function _(){}return _.from=function(P){var m=new this;return m.raw=P.records,m.affected=P.affected,m},_}()},7706:(Ee,ne,h)=>{"use strict";h.d(ne,{t:()=>g});var g=function(){function _(){this.identifiers=[],this.generatedMaps=[]}return _.from=function(P){var m=new this;return m.raw=P.raw,m},_}()},6111:(Ee,ne,h)=>{"use strict";h.d(ne,{s:()=>g});var g=function(){function _(){this.generatedMaps=[]}return _.from=function(P){var m=new this;return m.raw=P.records,m.affected=P.affected,m},_}()},2588:(Ee,ne,h)=>{"use strict";h.d(ne,{i:()=>G});var g=h(5081),_=h(7915),P=h(3664),m=h(7170),N=h(1328),a=h(7529),v=h(6176),B=h(890),G=function(){function J(U){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,U&&(this.database=U.database,this.schema=U.schema,this.name=U.name,U.columns&&(this.columns=U.columns.map(function(c){return new _.D(c)})),U.indices&&(this.indices=U.indices.map(function(c){return new P.s(c)})),U.foreignKeys&&(this.foreignKeys=U.foreignKeys.map(function(c){return new m.U((0,g.pi)((0,g.pi)({},c),{referencedDatabase:(null==c?void 0:c.referencedDatabase)||U.database,referencedSchema:(null==c?void 0:c.referencedSchema)||U.schema}))})),U.uniques&&(this.uniques=U.uniques.map(function(c){return new a.v(c)})),U.checks&&(this.checks=U.checks.map(function(c){return new v.r(c)})),U.exclusions&&(this.exclusions=U.exclusions.map(function(c){return new B.N(c)})),void 0!==U.justCreated&&(this.justCreated=U.justCreated),this.engine=U.engine)}return Object.defineProperty(J.prototype,"primaryColumns",{get:function(){return this.columns.filter(function(U){return U.isPrimary})},enumerable:!1,configurable:!0}),J.prototype.clone=function(){return new J({schema:this.schema,database:this.database,name:this.name,columns:this.columns.map(function(U){return U.clone()}),indices:this.indices.map(function(U){return U.clone()}),foreignKeys:this.foreignKeys.map(function(U){return U.clone()}),uniques:this.uniques.map(function(U){return U.clone()}),checks:this.checks.map(function(U){return U.clone()}),exclusions:this.exclusions.map(function(U){return U.clone()}),justCreated:this.justCreated,engine:this.engine})},J.prototype.addColumn=function(U){this.columns.push(U)},J.prototype.removeColumn=function(U){var c=this.columns.find(function(Z){return Z.name===U.name});c&&this.columns.splice(this.columns.indexOf(c),1)},J.prototype.addUniqueConstraint=function(U){if(this.uniques.push(U),1===U.columnNames.length){var c=this.columns.find(function(Z){return Z.name===U.columnNames[0]});c&&(c.isUnique=!0)}},J.prototype.removeUniqueConstraint=function(U){var c=this.uniques.find(function(ie){return ie.name===U.name});if(c&&(this.uniques.splice(this.uniques.indexOf(c),1),1===c.columnNames.length)){var Z=this.columns.find(function(ie){return ie.name===c.columnNames[0]});Z&&(Z.isUnique=!1)}},J.prototype.addCheckConstraint=function(U){this.checks.push(U)},J.prototype.removeCheckConstraint=function(U){var c=this.checks.find(function(Z){return Z.name===U.name});c&&this.checks.splice(this.checks.indexOf(c),1)},J.prototype.addExclusionConstraint=function(U){this.exclusions.push(U)},J.prototype.removeExclusionConstraint=function(U){var c=this.exclusions.find(function(Z){return Z.name===U.name});c&&this.exclusions.splice(this.exclusions.indexOf(c),1)},J.prototype.addForeignKey=function(U){this.foreignKeys.push(U)},J.prototype.removeForeignKey=function(U){var c=this.foreignKeys.find(function(Z){return Z.name===U.name});c&&this.foreignKeys.splice(this.foreignKeys.indexOf(c),1)},J.prototype.addIndex=function(U,c){if(void 0===c&&(c=!1),this.indices.push(U),1===U.columnNames.length&&U.isUnique&&c){var Z=this.columns.find(function(ie){return ie.name===U.columnNames[0]});Z&&(Z.isUnique=!0)}},J.prototype.removeIndex=function(U,c){void 0===c&&(c=!1);var Z=this.indices.find(function(D){return D.name===U.name});if(Z&&(this.indices.splice(this.indices.indexOf(Z),1),1===Z.columnNames.length&&Z.isUnique&&c)){var ie=this.columns.find(function(D){return D.name===Z.columnNames[0]});ie&&(ie.isUnique=this.indices.some(function(D){return 1===D.columnNames.length&&D.columnNames[0]===ie.name&&!!Z.isUnique}))}},J.prototype.findColumnByName=function(U){return this.columns.find(function(c){return c.name===U})},J.prototype.findColumnIndices=function(U){return this.indices.filter(function(c){return!!c.columnNames.find(function(Z){return Z===U.name})})},J.prototype.findColumnForeignKeys=function(U){return this.foreignKeys.filter(function(c){return!!c.columnNames.find(function(Z){return Z===U.name})})},J.prototype.findColumnUniques=function(U){return this.uniques.filter(function(c){return!!c.columnNames.find(function(Z){return Z===U.name})})},J.prototype.findColumnChecks=function(U){return this.checks.filter(function(c){return!!c.columnNames.find(function(Z){return Z===U.name})})},J.create=function(U,c){return new J({database:U.database,schema:U.schema,name:c.buildTableName(U.tableName,U.schema===c.options.schema?void 0:U.schema,U.database===c.database?void 0:U.database),engine:U.engine,columns:U.columns.filter(function(A){return A}).map(function(A){return N.P.createTableColumnOptions(A,c)}),indices:U.indices.filter(function(A){return!0===A.synchronize}).map(function(A){return P.s.create(A)}),uniques:U.uniques.map(function(A){return a.v.create(A)}),checks:U.checks.map(function(A){return v.r.create(A)}),exclusions:U.exclusions.map(function(A){return B.N.create(A)})})},J}()},6176:(Ee,ne,h)=>{"use strict";h.d(ne,{r:()=>_});var g=h(5081),_=function(){function P(m){this.columnNames=[],this.name=m.name,this.columnNames=m.columnNames,this.expression=m.expression}return P.prototype.clone=function(){return new P({name:this.name,columnNames:this.columnNames?(0,g.ev)([],(0,g.CR)(this.columnNames)):[],expression:this.expression})},P.create=function(m){return new P({name:m.name,expression:m.expression})},P}()},7915:(Ee,ne,h)=>{"use strict";h.d(ne,{D:()=>g});var g=function(){function _(P){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,P&&(this.name=P.name,this.type=P.type||"",this.length=P.length||"",this.width=P.width,this.charset=P.charset,this.collation=P.collation,this.precision=P.precision,this.scale=P.scale,this.zerofill=P.zerofill||!1,this.unsigned=!!this.zerofill||P.unsigned||!1,this.default=P.default,this.onUpdate=P.onUpdate,this.isNullable=P.isNullable||!1,this.isGenerated=P.isGenerated||!1,this.generationStrategy=P.generationStrategy,this.isPrimary=P.isPrimary||!1,this.isUnique=P.isUnique||!1,this.isArray=P.isArray||!1,this.comment=P.comment,this.enum=P.enum,this.enumName=P.enumName,this.asExpression=P.asExpression,this.generatedType=P.generatedType,this.spatialFeatureType=P.spatialFeatureType,this.srid=P.srid)}return _.prototype.clone=function(){return new _({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},_}()},890:(Ee,ne,h)=>{"use strict";h.d(ne,{N:()=>g});var g=function(){function _(P){this.name=P.name,this.expression=P.expression}return _.prototype.clone=function(){return new _({name:this.name,expression:this.expression})},_.create=function(P){return new _({name:P.name,expression:P.expression})},_}()},7170:(Ee,ne,h)=>{"use strict";h.d(ne,{U:()=>_});var g=h(5081),_=function(){function P(m){this.columnNames=[],this.referencedColumnNames=[],this.name=m.name,this.columnNames=m.columnNames,this.referencedColumnNames=m.referencedColumnNames,this.referencedDatabase=m.referencedDatabase,this.referencedSchema=m.referencedSchema,this.referencedTableName=m.referencedTableName,this.onDelete=m.onDelete,this.onUpdate=m.onUpdate,this.deferrable=m.deferrable}return P.prototype.clone=function(){return new P({name:this.name,columnNames:(0,g.ev)([],(0,g.CR)(this.columnNames)),referencedColumnNames:(0,g.ev)([],(0,g.CR)(this.referencedColumnNames)),referencedDatabase:this.referencedDatabase,referencedSchema:this.referencedSchema,referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},P.create=function(m,N){return new P({name:m.name,columnNames:m.columnNames,referencedColumnNames:m.referencedColumnNames,referencedDatabase:m.referencedEntityMetadata.database,referencedSchema:m.referencedEntityMetadata.schema,referencedTableName:m.referencedTablePath,onDelete:m.onDelete,onUpdate:m.onUpdate,deferrable:m.deferrable})},P}()},3664:(Ee,ne,h)=>{"use strict";h.d(ne,{s:()=>_});var g=h(5081),_=function(){function P(m){this.columnNames=[],this.name=m.name,this.columnNames=m.columnNames,this.isUnique=!!m.isUnique,this.isSpatial=!!m.isSpatial,this.isFulltext=!!m.isFulltext,this.parser=m.parser,this.where=m.where?m.where:""}return P.prototype.clone=function(){return new P({name:this.name,columnNames:(0,g.ev)([],(0,g.CR)(this.columnNames)),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},P.create=function(m){return new P({name:m.name,columnNames:m.columns.map(function(N){return N.databaseName}),isUnique:m.isUnique,isSpatial:m.isSpatial,isFulltext:m.isFulltext,parser:m.parser,where:m.where})},P}()},7529:(Ee,ne,h)=>{"use strict";h.d(ne,{v:()=>_});var g=h(5081),_=function(){function P(m){this.columnNames=[],this.name=m.name,this.columnNames=m.columnNames}return P.prototype.clone=function(){return new P({name:this.name,columnNames:(0,g.ev)([],(0,g.CR)(this.columnNames))})},P.create=function(m){return new P({name:m.name,columnNames:m.columns.map(function(N){return N.databaseName})})},P}()},1328:(Ee,ne,h)=>{"use strict";h.d(ne,{P:()=>g});var g=function(){function _(){}return _.createTableColumnOptions=function(P,m){return{name:P.databaseName,length:m.getColumnLength(P),width:P.width,charset:P.charset,collation:P.collation,precision:P.precision,scale:P.scale,zerofill:P.zerofill,unsigned:P.unsigned,asExpression:P.asExpression,generatedType:P.generatedType,default:m.normalizeDefault(P),onUpdate:P.onUpdate,comment:P.comment,isGenerated:P.isGenerated,generationStrategy:P.generationStrategy,isNullable:P.isNullable,type:m.normalizeType(P),isPrimary:P.isPrimary,isUnique:m.normalizeIsUnique(P),isArray:P.isArray||!1,enum:P.enum?P.enum.map(function(N){return N+""}):P.enum,enumName:P.enumName,spatialFeatureType:P.spatialFeatureType,srid:P.srid}},_}()},2373:(Ee,ne,h)=>{"use strict";h.d(ne,{G:()=>g});var g=function(){function _(P){P&&(this.database=P.database,this.schema=P.schema,this.name=P.name,this.expression=P.expression,this.materialized=!!P.materialized)}return _.prototype.clone=function(){return new _({database:this.database,schema:this.schema,name:this.name,expression:this.expression,materialized:this.materialized})},_.create=function(P,m){return new _({database:P.database,schema:P.schema,name:m.buildTableName(P.tableName,P.schema,P.database),expression:P.expression,materialized:P.tableMetadataArgs.materialized})},_}()},9535:(Ee,ne,h)=>{"use strict";h.d(ne,{D:()=>g});var g=function(){this.count=0,this.promises=[]}},9100:(Ee,ne,h)=>{"use strict";h.d(ne,{A:()=>g});var g=function(){function _(){}return _.transformFrom=function(P,m){return Array.isArray(P)?P.slice().reverse().reduce(function(a,v){return v.from(a)},m):P.from(m)},_.transformTo=function(P,m){return Array.isArray(P)?P.reduce(function(N,a){return a.to(N)},m):P.to(m)},_}()},4205:(Ee,ne,h)=>{"use strict";h.d(ne,{E:()=>_});var g=h(5081),_=function(){function P(){}return P.normalizeHydratedDate=function(m){return m&&("string"==typeof m?new Date(m):m)},P.mixedDateToDateString=function(m){return m instanceof Date?this.formatZerolessValue(m.getFullYear())+"-"+this.formatZerolessValue(m.getMonth()+1)+"-"+this.formatZerolessValue(m.getDate()):m},P.mixedDateToDate=function(m,N,a){void 0===N&&(N=!1),void 0===a&&(a=!0);var v="string"==typeof m?new Date(m):m;return N&&(v=new Date(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate(),v.getUTCHours(),v.getUTCMinutes(),v.getUTCSeconds(),v.getUTCMilliseconds())),a||v.setUTCMilliseconds(0),v},P.mixedDateToTimeString=function(m,N){return void 0===N&&(N=!1),m instanceof Date?this.formatZerolessValue(m.getHours())+":"+this.formatZerolessValue(m.getMinutes())+(N?"":":"+this.formatZerolessValue(m.getSeconds())):m},P.mixedTimeToDate=function(m){if("string"==typeof m){var N=(0,g.CR)(m.split(":"),3),a=N[0],v=N[1],B=N[2],G=new Date;return a&&G.setHours(parseInt(a)),v&&G.setMinutes(parseInt(v)),B&&G.setSeconds(parseInt(B)),G}return m},P.mixedTimeToString=function(m,N){return void 0===N&&(N=!1),"string"==typeof(m=m instanceof Date?m.getHours()+":"+m.getMinutes()+(N?"":":"+m.getSeconds()):m)?m.split(":").map(function(a){return 1===a.length?"0"+a:a}).join(":"):m},P.mixedDateToDatetimeString=function(m,N){if("string"==typeof m&&(m=new Date(m)),m instanceof Date){var a=this.formatZerolessValue(m.getFullYear())+"-"+this.formatZerolessValue(m.getMonth()+1)+"-"+this.formatZerolessValue(m.getDate())+" "+this.formatZerolessValue(m.getHours())+":"+this.formatZerolessValue(m.getMinutes())+":"+this.formatZerolessValue(m.getSeconds());N&&(a+="."+this.formatMilliseconds(m.getMilliseconds())),m=a}return m},P.mixedDateToUtcDatetimeString=function(m){return"string"==typeof m&&(m=new Date(m)),m instanceof Date?this.formatZerolessValue(m.getUTCFullYear())+"-"+this.formatZerolessValue(m.getUTCMonth()+1)+"-"+this.formatZerolessValue(m.getUTCDate())+" "+this.formatZerolessValue(m.getUTCHours())+":"+this.formatZerolessValue(m.getUTCMinutes())+":"+this.formatZerolessValue(m.getUTCSeconds())+"."+this.formatMilliseconds(m.getUTCMilliseconds()):m},P.simpleArrayToString=function(m){return Array.isArray(m)?m.map(function(N){return String(N)}).join(","):m},P.stringToSimpleArray=function(m){return m instanceof String||"string"==typeof m?m.length>0?m.split(","):[]:m},P.simpleJsonToString=function(m){return JSON.stringify(m)},P.stringToSimpleJson=function(m){return"string"==typeof m?JSON.parse(m):m},P.simpleEnumToString=function(m){return""+m},P.stringToSimpleEnum=function(m,N){return N.enum&&!isNaN(m)&&N.enum.indexOf(parseInt(m))>=0&&(m=parseInt(m)),m},P.formatZerolessValue=function(m){return m<10?"0"+m:String(m)},P.formatMilliseconds=function(m){return m<10?"00"+m:m<100?"0"+m:String(m)},P}()},2183:(Ee,ne,h)=>{"use strict";h.d(ne,{g:()=>_});var g=h(5081),_=function(){function P(){}return P.assign=function(m){for(var N,a,v,B,G=[],J=1;J<arguments.length;J++)G[J-1]=arguments[J];try{for(var U=(0,g.XA)(G),c=U.next();!c.done;c=U.next()){var Z=c.value;try{for(var ie=(v=void 0,(0,g.XA)(Object.getOwnPropertyNames(Z))),D=ie.next();!D.done;D=ie.next()){var A=D.value;m[A]=Z[A]}}catch(T){v={error:T}}finally{try{D&&!D.done&&(B=ie.return)&&B.call(ie)}finally{if(v)throw v.error}}}}catch(T){N={error:T}}finally{try{c&&!c.done&&(a=U.return)&&a.call(U)}finally{if(N)throw N.error}}},P}()},1018:(Ee,ne,h)=>{"use strict";h.d(ne,{s:()=>_});var g=h(5081),_=function(){function P(){}return P.chunk=function(m,N){return Array.from(Array(Math.ceil(m.length/N)),function(a,v){return m.slice(v*N,v*N+N)})},P.splitClassesAndStrings=function(m){return[m.filter(function(N){return"string"!=typeof N}),m.filter(function(N){return"string"==typeof N})]},P.groupBy=function(m,N){return m.reduce(function(a,v){var B=N(v),G=a.find(function(J){return J.id===B});return G||a.push(G={id:B,items:[]}),G.items.push(v),a},[])},P.uniq=function(m,N){return m.reduce(function(a,v){var B=!1;if(N instanceof Function){var G=N(v);B=!!a.find(function(J){return N(J)===G})}else B="string"==typeof N?!!a.find(function(J){return J[N]===v[N]}):-1!==a.indexOf(v);return B||a.push(v),a},[])},P.isPlainObject=function(m){return null!=m&&(!m.constructor||m.constructor===Object)},P.mergeArrayKey=function(m,N,a,v){if(v.has(a))m[N]=v.get(a);else if(!(a instanceof Promise)){if(!this.isPlainObject(a)&&!Array.isArray(a))return void(m[N]=a);m[N]||(m[N]=Array.isArray(a)?[]:{}),v.set(a,m[N]),this.merge(m[N],a,v),v.delete(a)}},P.mergeObjectKey=function(m,N,a,v){var B,G,J;if(v.has(a))Object.assign(m,((B={})[N]=v.get(a),B));else if(!(a instanceof Promise)){if(!this.isPlainObject(a)&&!Array.isArray(a))return void Object.assign(m,(G={},G[N]=a,G));m[N]||Object.assign(m,((J={})[N]=Array.isArray(a)?[]:{},J)),v.set(a,m[N]),this.merge(m[N],a,v),v.delete(a)}},P.merge=function(m,N,a){var v,B;if(void 0===a&&(a=new Map),this.isPlainObject(m)&&this.isPlainObject(N))try{for(var G=(0,g.XA)(Object.keys(N)),J=G.next();!J.done;J=G.next())this.mergeObjectKey(m,U=J.value,N[U],a)}catch(c){v={error:c}}finally{try{J&&!J.done&&(B=G.return)&&B.call(G)}finally{if(v)throw v.error}}if(Array.isArray(m)&&Array.isArray(N))for(var U=0;U<N.length;U++)this.mergeArrayKey(m,U,N[U],a)},P.mergeDeep=function(m){for(var N,a,v=[],B=1;B<arguments.length;B++)v[B-1]=arguments[B];if(!v.length)return m;try{for(var G=(0,g.XA)(v),J=G.next();!J.done;J=G.next()){var U=J.value;P.merge(m,U)}}catch(c){N={error:c}}finally{try{J&&!J.done&&(a=G.return)&&a.call(G)}finally{if(N)throw N.error}}return m},P.deepCompare=function(){for(var m=[],N=0;N<arguments.length;N++)m[N]=arguments[N];var a,v;if(arguments.length<1)return!0;for(a=1,v=arguments.length;a<v;a++)if(!this.compare2Objects([],[],arguments[0],arguments[a]))return!1;return!0},P.compareIds=function(m,N){return null!=m&&null!=N&&(("string"==typeof m.id&&"string"==typeof N.id||"number"==typeof m.id&&"number"==typeof N.id)&&1===Object.keys(m).length&&1===Object.keys(N).length?m.id===N.id:P.deepCompare(m,N))},P.toBoolean=function(m){return"boolean"==typeof m?m:"string"==typeof m?"true"===m||"1"===m:"number"==typeof m&&m>0},P.zipObject=function(m,N){return m.reduce(function(a,v,B){return a[v]=N[B],a},{})},P.isArraysEqual=function(m,N){return m.length===N.length&&m.every(function(a){return-1!==N.indexOf(a)})},P.compare2Objects=function(m,N,a,v){var B;if(Number.isNaN(a)&&Number.isNaN(v)||a===v)return!0;if(null===a||null===v||void 0===a||void 0===v)return!1;if(("function"==typeof a.equals||a.equals instanceof Function)&&a.equals(v))return!0;if("function"==typeof a&&"function"==typeof v||a instanceof Date&&v instanceof Date||a instanceof RegExp&&v instanceof RegExp||a instanceof String&&v instanceof String||a instanceof Number&&v instanceof Number)return a.toString()===v.toString();if(!(a instanceof Object&&v instanceof Object)||a.isPrototypeOf(v)||v.isPrototypeOf(a)||a.constructor!==v.constructor||a.prototype!==v.prototype||m.indexOf(a)>-1||N.indexOf(v)>-1)return!1;for(B in v){if(v.hasOwnProperty(B)!==a.hasOwnProperty(B))return!1;if(typeof v[B]!=typeof a[B])return!1}for(B in a){if(v.hasOwnProperty(B)!==a.hasOwnProperty(B))return!1;if(typeof v[B]!=typeof a[B])return!1;switch(typeof a[B]){case"object":case"function":if(m.push(a),N.push(v),!this.compare2Objects(m,N,a[B],v[B]))return!1;m.pop(),N.pop();break;default:if(a[B]!==v[B])return!1}}return!0},P}()},2221:(Ee,ne,h)=>{"use strict";h.d(ne,{f:()=>g});var g=function(){function _(){}return _.sha1=function(P){var a,v,B,D,A,T,x,X,Y,m=function(H,j){return H<<j|H>>>32-j},N=function(H){var $,j="";for($=7;$>=0;$--)j+=(H>>>4*$&15).toString(16);return j},G=new Array(80),J=1732584193,U=4023233417,c=2562383102,Z=271733878,ie=3285377520,R=(P=encodeURIComponent(P)).length,L=[];for(v=0;v<R-3;v+=4)B=P.charCodeAt(v)<<24|P.charCodeAt(v+1)<<16|P.charCodeAt(v+2)<<8|P.charCodeAt(v+3),L.push(B);switch(R%4){case 0:v=2147483648;break;case 1:v=P.charCodeAt(R-1)<<24|8388608;break;case 2:v=P.charCodeAt(R-2)<<24|P.charCodeAt(R-1)<<16|32768;break;case 3:v=P.charCodeAt(R-3)<<24|P.charCodeAt(R-2)<<16|P.charCodeAt(R-1)<<8|128}for(L.push(v);L.length%16!=14;)L.push(0);for(L.push(R>>>29),L.push(R<<3&4294967295),a=0;a<L.length;a+=16){for(v=0;v<16;v++)G[v]=L[a+v];for(v=16;v<=79;v++)G[v]=m(G[v-3]^G[v-8]^G[v-14]^G[v-16],1);for(D=J,A=U,T=c,x=Z,X=ie,v=0;v<=19;v++)Y=m(D,5)+(A&T|~A&x)+X+G[v]+1518500249&4294967295,X=x,x=T,T=m(A,30),A=D,D=Y;for(v=20;v<=39;v++)Y=m(D,5)+(A^T^x)+X+G[v]+1859775393&4294967295,X=x,x=T,T=m(A,30),A=D,D=Y;for(v=40;v<=59;v++)Y=m(D,5)+(A&T|A&x|T&x)+X+G[v]+2400959708&4294967295,X=x,x=T,T=m(A,30),A=D,D=Y;for(v=60;v<=79;v++)Y=m(D,5)+(A^T^x)+X+G[v]+3395469782&4294967295,X=x,x=T,T=m(A,30),A=D,D=Y;J=J+D&4294967295,U=U+A&4294967295,c=c+T&4294967295,Z=Z+x&4294967295,ie=ie+X&4294967295}return(Y=N(J)+N(U)+N(c)+N(Z)+N(ie)).toLowerCase()},_.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(P){var m=16*Math.random()|0;return("x"===P?m:3&m|8).toString(16)})},_}()},3252:(Ee,ne,h)=>{"use strict";h.d(ne,{eV:()=>P,fu:()=>m,Qs:()=>N,OV:()=>v,vp:()=>B});var g=h(6790),_=h.n(g);function P(G,J){return void 0===J&&(J=!1),G.replace(/^([A-Z])|[\s-_](\w)/g,function(U,c,Z,ie){return!0===J&&0===ie?c:Z?Z.toUpperCase():c.toLowerCase()})}function m(G){return G.replace(/([A-Z])([A-Z])([a-z])/g,"$1_$2$3").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}function N(G){return G.replace(/\w\S*/g,function(J){return J.charAt(0).toUpperCase()+J.substr(1).toLowerCase()})}function v(G,J){void 0===J&&(J={});var U=J.segmentLength,c=void 0===U?4:U,Z=J.separator,ie=void 0===Z?"__":Z,D=J.termLength,A=void 0===D?2:D;return G.split(ie).reduce(function(X,Y){var R=Y.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),L=R.length>1?A:c,H=R.map(function(j){return j.substr(0,L)}).join("");return X.push(H),X},[]).join(ie)}function B(G,J){void 0===J&&(J={});var U=_()("sha256");U.update(G,"utf8");var c=U.digest("hex");return J.length?c.slice(0,J.length):c}},6996:(Ee,ne,h)=>{ne.formatArgs=function(v){if(v[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+v[0]+(this.useColors?"%c ":" ")+"+"+Ee.exports.humanize(this.diff),!this.useColors)return;const B="color: "+this.color;v.splice(1,0,B,"color: inherit");let G=0,J=0;v[0].replace(/%[a-zA-Z%]/g,U=>{"%%"!==U&&(G++,"%c"===U&&(J=G))}),v.splice(J,0,B)},ne.save=function(v){try{v?ne.storage.setItem("debug",v):ne.storage.removeItem("debug")}catch(B){}},ne.load=function(){let v;try{v=ne.storage.getItem("debug")}catch(B){}return!v&&"undefined"!=typeof process&&"env"in process&&(v=process.env.DEBUG),v},ne.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},ne.storage=function(){try{return localStorage}catch(v){}}(),ne.destroy=(()=>{let v=!1;return()=>{v||(v=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),ne.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],ne.log=console.debug||console.log||(()=>{}),Ee.exports=h(7662)(ne);const{formatters:a}=Ee.exports;a.j=function(v){try{return JSON.stringify(v)}catch(B){return"[UnexpectedJSONParseError]: "+B.message}}},7662:(Ee,ne,h)=>{Ee.exports=function(_){function m(c){let Z,D,A,ie=null;function T(...x){if(!T.enabled)return;const X=T,Y=Number(new Date);X.diff=Y-(Z||Y),X.prev=Z,X.curr=Y,Z=Y,x[0]=m.coerce(x[0]),"string"!=typeof x[0]&&x.unshift("%O");let L=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(j,$)=>{if("%%"===j)return"%";L++;const ee=m.formatters[$];return"function"==typeof ee&&(j=ee.call(X,x[L]),x.splice(L,1),L--),j}),m.formatArgs.call(X,x),(X.log||m.log).apply(X,x)}return T.namespace=c,T.useColors=m.useColors(),T.color=m.selectColor(c),T.extend=N,T.destroy=m.destroy,Object.defineProperty(T,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==ie?ie:(D!==m.namespaces&&(D=m.namespaces,A=m.enabled(c)),A),set:x=>{ie=x}}),"function"==typeof m.init&&m.init(T),T}function N(c,Z){const ie=m(this.namespace+(void 0===Z?":":Z)+c);return ie.log=this.log,ie}function G(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}return m.debug=m,m.default=m,m.coerce=function(c){return c instanceof Error?c.stack||c.message:c},m.disable=function(){const c=[...m.names.map(G),...m.skips.map(G).map(Z=>"-"+Z)].join(",");return m.enable(""),c},m.enable=function(c){let Z;m.save(c),m.namespaces=c,m.names=[],m.skips=[];const ie=("string"==typeof c?c:"").split(/[\s,]+/),D=ie.length;for(Z=0;Z<D;Z++)!ie[Z]||("-"===(c=ie[Z].replace(/\*/g,".*?"))[0]?m.skips.push(new RegExp("^"+c.substr(1)+"$")):m.names.push(new RegExp("^"+c+"$")))},m.enabled=function(c){if("*"===c[c.length-1])return!0;let Z,ie;for(Z=0,ie=m.skips.length;Z<ie;Z++)if(m.skips[Z].test(c))return!1;for(Z=0,ie=m.names.length;Z<ie;Z++)if(m.names[Z].test(c))return!0;return!1},m.humanize=h(4733),m.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(_).forEach(c=>{m[c]=_[c]}),m.names=[],m.skips=[],m.formatters={},m.selectColor=function(c){let Z=0;for(let ie=0;ie<c.length;ie++)Z=(Z<<5)-Z+c.charCodeAt(ie),Z|=0;return m.colors[Math.abs(Z)%m.colors.length]},m.enable(m.load()),m}},4733:Ee=>{var ne=1e3,h=6e4,g=60*h,_=24*g;function B(G,J,U,c){var Z=J>=1.5*U;return Math.round(G/U)+" "+c+(Z?"s":"")}Ee.exports=function(G,J){J=J||{};var U=typeof G;if("string"===U&&G.length>0)return function(G){if(!((G=String(G)).length>100)){var J=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(G);if(J){var U=parseFloat(J[1]);switch((J[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*U;case"weeks":case"week":case"w":return 6048e5*U;case"days":case"day":case"d":return U*_;case"hours":case"hour":case"hrs":case"hr":case"h":return U*g;case"minutes":case"minute":case"mins":case"min":case"m":return U*h;case"seconds":case"second":case"secs":case"sec":case"s":return U*ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return U;default:return}}}}(G);if("number"===U&&isFinite(G))return J.long?function(G){var J=Math.abs(G);return J>=_?B(G,J,_,"day"):J>=g?B(G,J,g,"hour"):J>=h?B(G,J,h,"minute"):J>=ne?B(G,J,ne,"second"):G+" ms"}(G):function(G){var J=Math.abs(G);return J>=_?Math.round(G/_)+"d":J>=g?Math.round(G/g)+"h":J>=h?Math.round(G/h)+"m":J>=ne?Math.round(G/ne)+"s":G+"ms"}(G);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(G))}},5081:(Ee,ne,h)=>{"use strict";h.d(ne,{ZT:()=>_,pi:()=>P,_T:()=>m,gn:()=>N,mG:()=>B,Jh:()=>G,XA:()=>c,CR:()=>Z,ev:()=>A});
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.
    
    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.
    
    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var g=function(F,I){return(g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(y,E){y.__proto__=E}||function(y,E){for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(y[S]=E[S])})(F,I)};function _(F,I){if("function"!=typeof I&&null!==I)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function y(){this.constructor=F}g(F,I),F.prototype=null===I?Object.create(I):(y.prototype=I.prototype,new y)}var P=function(){return(P=Object.assign||function(I){for(var y,E=1,S=arguments.length;E<S;E++)for(var C in y=arguments[E])Object.prototype.hasOwnProperty.call(y,C)&&(I[C]=y[C]);return I}).apply(this,arguments)};function m(F,I){var y={};for(var E in F)Object.prototype.hasOwnProperty.call(F,E)&&I.indexOf(E)<0&&(y[E]=F[E]);if(null!=F&&"function"==typeof Object.getOwnPropertySymbols){var S=0;for(E=Object.getOwnPropertySymbols(F);S<E.length;S++)I.indexOf(E[S])<0&&Object.prototype.propertyIsEnumerable.call(F,E[S])&&(y[E[S]]=F[E[S]])}return y}function N(F,I,y,E){var Q,S=arguments.length,C=S<3?I:null===E?E=Object.getOwnPropertyDescriptor(I,y):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)C=Reflect.decorate(F,I,y,E);else for(var O=F.length-1;O>=0;O--)(Q=F[O])&&(C=(S<3?Q(C):S>3?Q(I,y,C):Q(I,y))||C);return S>3&&C&&Object.defineProperty(I,y,C),C}function B(F,I,y,E){return new(y||(y=Promise))(function(C,Q){function O(oe){try{V(E.next(oe))}catch(me){Q(me)}}function W(oe){try{V(E.throw(oe))}catch(me){Q(me)}}function V(oe){oe.done?C(oe.value):function(C){return C instanceof y?C:new y(function(Q){Q(C)})}(oe.value).then(O,W)}V((E=E.apply(F,I||[])).next())})}function G(F,I){var E,S,C,Q,y={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return Q={next:O(0),throw:O(1),return:O(2)},"function"==typeof Symbol&&(Q[Symbol.iterator]=function(){return this}),Q;function O(V){return function(oe){return function(V){if(E)throw new TypeError("Generator is already executing.");for(;y;)try{if(E=1,S&&(C=2&V[0]?S.return:V[0]?S.throw||((C=S.return)&&C.call(S),0):S.next)&&!(C=C.call(S,V[1])).done)return C;switch(S=0,C&&(V=[2&V[0],C.value]),V[0]){case 0:case 1:C=V;break;case 4:return y.label++,{value:V[1],done:!1};case 5:y.label++,S=V[1],V=[0];continue;case 7:V=y.ops.pop(),y.trys.pop();continue;default:if(!(C=(C=y.trys).length>0&&C[C.length-1])&&(6===V[0]||2===V[0])){y=0;continue}if(3===V[0]&&(!C||V[1]>C[0]&&V[1]<C[3])){y.label=V[1];break}if(6===V[0]&&y.label<C[1]){y.label=C[1],C=V;break}if(C&&y.label<C[2]){y.label=C[2],y.ops.push(V);break}C[2]&&y.ops.pop(),y.trys.pop();continue}V=I.call(F,y)}catch(oe){V=[6,oe],S=0}finally{E=C=0}if(5&V[0])throw V[1];return{value:V[0]?V[1]:void 0,done:!0}}([V,oe])}}}function c(F){var I="function"==typeof Symbol&&Symbol.iterator,y=I&&F[I],E=0;if(y)return y.call(F);if(F&&"number"==typeof F.length)return{next:function(){return F&&E>=F.length&&(F=void 0),{value:F&&F[E++],done:!F}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(F,I){var y="function"==typeof Symbol&&F[Symbol.iterator];if(!y)return F;var S,Q,E=y.call(F),C=[];try{for(;(void 0===I||I-- >0)&&!(S=E.next()).done;)C.push(S.value)}catch(O){Q={error:O}}finally{try{S&&!S.done&&(y=E.return)&&y.call(E)}finally{if(Q)throw Q.error}}return C}function A(F,I,y){if(y||2===arguments.length)for(var C,E=0,S=I.length;E<S;E++)(C||!(E in I))&&(C||(C=Array.prototype.slice.call(I,0,E)),C[E]=I[E]);return F.concat(C||I)}}}]);